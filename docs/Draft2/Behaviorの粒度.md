Behaviorの粒度
==========

[2021/4/28] やっぱり Activity で分けた方がいいかも
----------

↓ Throwable を考えていた時のメモ。

```c
// 跳ね返し/飲み込み等判定 貫通の方が強い
// 回避判定 ... 
//   - 装備効果で必中/当たらず
//   - 地形や土偶効果で必中/当たらず
//   - 回避しないEntityもある(土偶・カッパ)
// 効果適用 ... self 側
// 消滅 ... self 側。貫通有無によっていつ消すかが変わるので。
// 落下 ... self 側
// ※貫通は別コマンドでよさそうな気もする。まずは非貫通を考える。

// コアスクリプトでは…
// - 命中判定と回避判定が別物。
// - 命中判定はアイテムの基本成功率が使われる。
//   - isPhysical の場合、さらに trait から集めた命中率が使われる。
// - 回避判定は、HitType に応じて target の物理回避・魔法回避 が使われる。
//   - item の hitType は 0(CERTAIN. isPlysical でも isMagical でもないので、回避はできない扱いになる)
//
// RE としては、"飲んだ" ときは回避判定は行わない（必中扱い）でよさそう。
// 投げ当てのときは、通常攻撃と同じように判定する。
// (ただし投げ当ての命中にだけ影響するような装備もあるので注意)
//
// 新種道具を考えると、1つの Entity に複数の RMMZ のアイテム情報が紐づくことがある。
// しかしこの場合、投げ当てるときの命中判定で使われるのはベースとなるアイテムの HitType にする必要がある。
// 複数の HitType なんてどう扱えばいいのか謎なので…。
// そうすると命中判定と効果発動は別のタイミングとなる。
//
// 例えば「ごんぼう」を考えてみる。
// - ベースは "武器Behavior". RMMZ の"アイテム"とは関係ない。RMMZ の"武器"と関係がある。
// - 通常攻撃と投げ当ての命中率は異なるものである。必中の剣は、通常攻撃時のみ効果を発揮する。
// - 仮に "薬草" を実装するために "アイテムBehavior" があるとする。
// - この時ごんぼうは "武器Behavior" か？ "アイテムBehavior" か？両方か？
// - RMMZ の DB に依った分類は避けた方がいいかも。
//   - 例えば Ability. 特攻効果はRMMZの"武器"データに定義したい。予防効果はRMMZの"防具"か"ステート"に定義したい。
// - 極端な話、RMMZの"アイテム"リストで武器を定義することも可能。
//   - 分類上はItemだた、装備できるし、飲むことができるアイテムも作れる、といこと。
//   - このときは <RE-Equipable> <RE-ApplyEffect:kWeapon_こんぼう> <RE-ApplyEffect:self> みたいにできる。
// - 新種道具なんてものが無くても、こんなふうに 複数の種類の効果を備えるアイテムを作ることがある。
// - このとき "武器Behavior" と "アイテムBehavior" 両方を使ってしまうと、"投げ当て" の処理をどこに持たせるのか？ということになる。
// - そうするとやっぱり ThrowableBehavior があった方が良いだろう。
// - 命中率をコントロールしたいときは、どのソースデータを使うのか、を指定できるようにしておこう。
// - <MR-Behavior:Throwable(self)> <MR-Behavior:Equipable> <MR-Behavior:Eatable> <RE-ApplyEffect:self> <RE-ApplyEffect:kEffect_FP30>
// - 罠を投げ当てる時も同様。 TrapBehavior?ItemBehavior?
```



[2021/4/27]
----------

### Activity 単位で分ける？

EatorBehavior, EatableBehavior, ThrowableBehavior など。

これはあまりよくないかもしれない。
食べることはできても、食べたことで何が起こるかはまた別の Behavior で実装することになるため。
例えば おにぎりアイテムは食べたときに RMMZのアイテムとしての効果を発動する、は自然だが、
ごんぼうのような武器を食べたときはアイテムの効果はどこから持ってくるの？というのがある。

別 Behavior に分けたとしても結局 onEatReaction をハンドリングする必要はあるので、あんまりわける意味もない。

### 具体的なアイテム単位で分ける？

薬草Behavior, 弟切草Behavior, いかすしの巻物Behaviorなど。

実質、再利用ができなくなる。薬草Behavior, 弟切草Behavior は,「食べたらアイテムの効果を発動するBehavior」にまとめたいところ。

### いい塩梅を探す

結局作りながら共通化できるものを探すのがベストかな…。


