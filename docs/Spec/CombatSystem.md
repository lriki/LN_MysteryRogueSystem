CombatSystem
==========

「攻撃」と「ダメージ適用」は別のコマンドとする。

> e.g) シレン2-ケンゴウの刀
> 攻撃したときに一定確率で、通常攻撃するのか特殊能力発動になるのか変わるケースがある。


EffectContext
----------

> 以前の DamageContext(攻撃用), MagicContext(魔法弾用) などを統合したもの。コアスクリプトの Game_Action みたいな感じ。

与ダメージや回復、状態異常の付加など、パラメータ変動を適用するために必要なあらゆる情報を収集し、修正値を作り上げるしくみ。

EffectContext 自身が Entity の Sequel を起動したり、座標を動かしたりすることは無い。
というより、今のところ EffectContext が Command を発行する予定はない。

一連の攻撃に関係する Entity の収集も行い、結果をそれぞれにフィードバックすることも行う。
攻撃側に経験値を与えたり、金銭のやりとりの処理など、Enitty として表現できないいわゆる「報酬」の受け渡しにも利用する。

一度の行動の中で複数の攻撃が発生することも考えられるため、EffectContext は唯一のインスタンスとはしない。
代表的なものだと、連鎖的な罠の発動やカウンター攻撃。




ステート (状態異常・状態変化)
----------

Attribute - Behavior のペアとして実装する。


Note: 攻撃に関係する要素
----------

- 武器攻撃力
- Unit基本攻撃力
- ちから
- 防具防御力
- Unit基本防御力
- 各種特攻
- 状態変化 (buff/debuff)
- 属性
    - 火炎
    - 爆発
    - 武器錆び
    - 盾錆び
- 固定修正値 (ちからの草 印)
- 防御側状態異常 (武器のバクスイ印)
- 環境効果 (10ダメージの土偶)

- ドレイン (回復の剣)
- ダメージ反射 (バトルカウンター)
- 属性耐性
    - 錆び避け (武器)
    - 錆び避け (盾)
- 攻撃側状態異常 (盾のバクスイ印)
- 状態異常・変化耐性



ちからダウンや装備の錆びもパラメータ操作と考え、EffectContext で処理した方がいいかも。

以下は Behavior 側でカバーするべきかも。
- 3方向攻撃
- 前方2マス、3マス攻撃
