/*! For license information please see LN_MysteryRogueSystem.js.LICENSE.txt */
//==============================================================================
// LN_MysteryRogueSystem.js
// -----------------------------------------------------------------------------
// Copyright (c) 2022 lriki
// This software is released under the MIT License.
// http://opensource.org/licenses/mit-license.php
// -----------------------------------------------------------------------------
// [GitHub]  : https://github.com/lriki/LN_MysteryRogueSystem
// [Twitter] : https://twitter.com/lriki8
//==============================================================================

/*:ja
 * @target MZ
 * @plugindesc LN_MysteryRogueSystem v0.8.0
 * @author lriki
 *
 * @help test.
 *
 * MIT License
 *
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 *
 * @param Group_Inventory
 * @text 持ち物
 * @default --------------------
 * 
 * @param InventoryCapacity
 * @text 持ち物の最大数
 * @parent Group_Inventory
 * @default 24
 * @type number
 * 
 * @param InventoryItemsPerPage
 * @text ウィンドウの1ページ分のアイテム数
 * @parent Group_Inventory
 * @default 12
 * @type number
 * 
 * @param Group_Map
 * @text マップ
 * @default --------------------
  * 
 * @param RandomMapPaddingX
 * @text ランダムマップの外周幅 (上下)
 * @desc ランダムマップ作成時の、マップ外周の侵入不可領域の大きさです。ゲーム画面のサイズに応じて、プレイヤーキャラを画面中央に表示するために変更できます。
 * @parent Group_Map
 * @default 8
 * @type number
 *
 * @param RandomPaddingY
 * @text ランダムマップの外周幅 (左右)
 * @desc ランダムマップ作成時の、マップ外周の侵入不可領域の大きさです。ゲーム画面のサイズに応じて、プレイヤーキャラを画面中央に表示するために変更できます。
 * @parent Group_Map
 * @default 6
 * @type number
 *
 * @param SuspendMenuEnabled
 * @text [中断] メニューの表示有無
 * @desc MRタクティクスマップ上でのメニュー画面で、[中断] を表示するかどうかを指定します。
 * @default false
 * @type boolean
 *
 *
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 *
 * @command MR-FinishChallenge
 * @text MR-FinishChallenge
 * @desc チャレンジを終了し、直前の Land の結果に応じた処理を実行します。 https://lriki.github.io/LN_MysteryRogueSystemSite/reference/plugin-commands/
 *
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

 * @command RE.ShowChallengeResult
 * @text ShowChallengeResult
 * @desc test
 *
 * @command MR-ShowWarehouseStoreDialog
 * @text ShowWarehouseStoreDialog
 * @desc 預ける
 * @arg serviceProviderKey
 * @type string
 * @arg serviceUserKey
 * @type string

 * @command MR-ShowWarehouseWithdrawDialog
 * @text ShowWarehouseWithdrawDialog
 * @desc 引き出す
 * @arg serviceProviderKey
 * @type string
 * @arg serviceUserKey
 * @type string

 * @command MR-ShowItemSellDialog
 * @desc 売る
 * @arg serviceProviderKey
 * @type string
 * @arg serviceUserKey
 * @type string
 * @arg inventoryOwnerKey
 * @type string

 * @command MR-ProceedFloorForward
 * @text ProceedFloorForward
 * @desc 次のフロアへ
 *
 * @command MR-ProceedFloorBackword
 * @text ProceedFloorBackword
 * @desc 前のフロアへ
 *
 * @command MR-SetProperty
 * @text MR-SetProperty
 * @desc entityKey で指定された Entity へ様々な情報を設定します。
 * @arg entityKey
 * @type string
 * @arg property
 * @type string
 * @arg value

 * @command MR-GetProperty
 * @text MR-GetProperty
 * @desc entityKey で指定された Entity から様々な情報を取得し、変数に代入します。
 * @arg entityKey
 * @type string
 * @arg property
 * @type string
 * @arg variable
 *
 * @command MR-ResetStatus
 * @text MR-ResetStatus
 * @desc entityKey で指定された Entity のパラメータ及びステートを初期状態に戻します。
 * @arg entityKey
 * @type string
 *
 * @command MR-ResetInventory
 * @text MR-ResetInventory
 * @desc entityKey で指定された Entity のインベントリを初期状態に戻します。
 * @arg entityKey
 * @type string
 *
 *
 *
 * @command MR-LivingResult-GetIncludesState
 * @text MR-LivingResult-GetIncludesState
 * @desc actorKey で指定された Entity の戦闘不能原因に、stateKey で指定されたステートが含まれているかを確認します。
 *       MR-CommndResult1: 1=含まれている, 0=含まれていない, -1=Entityが見つからなかった
 * @arg actorKey
 * @type string
 * @arg stateKey
 * @type string
 * 
 * 
 * @command MR-SetContext
 * @text MR-SetContext
 * @desc イベントコマンドの操作対象となる Entity を変更します。詳細は http://... を参照してください。
 * @arg key
 * @type string
 */


(()=>{var __webpack_modules__={9187:t=>{"use strict";function e(t,e,a){a=a||2;var n,o,c,u,d,f,m,y=e&&e.length,_=y?e[0]*a:t.length,g=i(t,0,_,a,!0),v=[];if(!g||g.next===g.prev)return v;if(y&&(g=function(t,e,s,a){var n,o,c,u=[];for(n=0,o=e.length;n<o;n++)(c=i(t,e[n]*a,n<o-1?e[n+1]*a:t.length,a,!1))===c.next&&(c.steiner=!0),u.push(p(c));for(u.sort(l),n=0;n<u.length;n++)s=r(s=h(u[n],s),s.next);return s}(t,e,g,a)),t.length>80*a){n=c=t[0],o=u=t[1];for(var S=a;S<_;S+=a)(d=t[S])<n&&(n=d),(f=t[S+1])<o&&(o=f),d>c&&(c=d),f>u&&(u=f);m=0!==(m=Math.max(c-n,u-o))?1/m:0}return s(g,v,a,n,o,m),v}function i(t,e,i,r,s){var a,n;if(s===x(t,e,i,r)>0)for(a=e;a<i;a+=r)n=b(a,t[a],t[a+1],n);else for(a=i-r;a>=e;a-=r)n=b(a,t[a],t[a+1],n);return n&&_(n,n.next)&&(E(n),n=n.next),n}function r(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!_(r,r.next)&&0!==y(r.prev,r,r.next))r=r.next;else{if(E(r),(r=e=r.prev)===r.next)break;i=!0}}while(i||r!==e);return e}function s(t,e,i,l,h,u,p){if(t){!p&&u&&function(t,e,i,r){var s=t;do{null===s.z&&(s.z=d(s.x,s.y,e,i,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,function(t){var e,i,r,s,a,n,o,c,l=1;do{for(i=t,t=null,a=null,n=0;i;){for(n++,r=i,o=0,e=0;e<l&&(o++,r=r.nextZ);e++);for(c=l;o>0||c>0&&r;)0!==o&&(0===c||!r||i.z<=r.z)?(s=i,i=i.nextZ,o--):(s=r,r=r.nextZ,c--),a?a.nextZ=s:t=s,s.prevZ=a,a=s;i=r}a.nextZ=null,l*=2}while(n>1)}(s)}(t,l,h,u);for(var f,m,y=t;t.prev!==t.next;)if(f=t.prev,m=t.next,u?n(t,l,h,u):a(t))e.push(f.i/i),e.push(t.i/i),e.push(m.i/i),E(t),t=m.next,y=m.next;else if((t=m)===y){p?1===p?s(t=o(r(t),e,i),e,i,l,h,u,2):2===p&&c(t,e,i,l,h,u):s(r(t),e,i,l,h,u,1);break}}}function a(t){var e=t.prev,i=t,r=t.next;if(y(e,i,r)>=0)return!1;for(var s=t.next.next;s!==t.prev;){if(f(e.x,e.y,i.x,i.y,r.x,r.y,s.x,s.y)&&y(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function n(t,e,i,r){var s=t.prev,a=t,n=t.next;if(y(s,a,n)>=0)return!1;for(var o=s.x<a.x?s.x<n.x?s.x:n.x:a.x<n.x?a.x:n.x,c=s.y<a.y?s.y<n.y?s.y:n.y:a.y<n.y?a.y:n.y,l=s.x>a.x?s.x>n.x?s.x:n.x:a.x>n.x?a.x:n.x,h=s.y>a.y?s.y>n.y?s.y:n.y:a.y>n.y?a.y:n.y,u=d(o,c,e,i,r),p=d(l,h,e,i,r),m=t.prevZ,_=t.nextZ;m&&m.z>=u&&_&&_.z<=p;){if(m!==t.prev&&m!==t.next&&f(s.x,s.y,a.x,a.y,n.x,n.y,m.x,m.y)&&y(m.prev,m,m.next)>=0)return!1;if(m=m.prevZ,_!==t.prev&&_!==t.next&&f(s.x,s.y,a.x,a.y,n.x,n.y,_.x,_.y)&&y(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;m&&m.z>=u;){if(m!==t.prev&&m!==t.next&&f(s.x,s.y,a.x,a.y,n.x,n.y,m.x,m.y)&&y(m.prev,m,m.next)>=0)return!1;m=m.prevZ}for(;_&&_.z<=p;){if(_!==t.prev&&_!==t.next&&f(s.x,s.y,a.x,a.y,n.x,n.y,_.x,_.y)&&y(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function o(t,e,i){var s=t;do{var a=s.prev,n=s.next.next;!_(a,n)&&g(a,s,s.next,n)&&M(a,n)&&M(n,a)&&(e.push(a.i/i),e.push(s.i/i),e.push(n.i/i),E(s),E(s.next),s=t=n),s=s.next}while(s!==t);return r(s)}function c(t,e,i,a,n,o){var c=t;do{for(var l=c.next.next;l!==c.prev;){if(c.i!==l.i&&m(c,l)){var h=R(c,l);return c=r(c,c.next),h=r(h,h.next),s(c,e,i,a,n,o),void s(h,e,i,a,n,o)}l=l.next}c=c.next}while(c!==t)}function l(t,e){return t.x-e.x}function h(t,e){var i=function(t,e){var i,r=e,s=t.x,a=t.y,n=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var o=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=s&&o>n){if(n=o,o===s){if(a===r.y)return r;if(a===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!i)return null;if(s===n)return i;var c,l=i,h=i.x,d=i.y,p=1/0;r=i;do{s>=r.x&&r.x>=h&&s!==r.x&&f(a<d?s:n,a,h,d,a<d?n:s,a,r.x,r.y)&&(c=Math.abs(a-r.y)/(s-r.x),M(r,t)&&(c<p||c===p&&(r.x>i.x||r.x===i.x&&u(i,r)))&&(i=r,p=c)),r=r.next}while(r!==l);return i}(t,e);if(!i)return e;var s=R(i,t),a=r(i,i.next);return r(s,s.next),e===i?a:e}function u(t,e){return y(t.prev,t,e.prev)<0&&y(e.next,t,t.next)<0}function d(t,e,i,r,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*s)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*s)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function p(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function f(t,e,i,r,s,a,n,o){return(s-n)*(e-o)-(t-n)*(a-o)>=0&&(t-n)*(r-o)-(i-n)*(e-o)>=0&&(i-n)*(a-o)-(s-n)*(r-o)>=0}function m(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&g(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(M(t,e)&&M(e,t)&&function(t,e){var i=t,r=!1,s=(t.x+e.x)/2,a=(t.y+e.y)/2;do{i.y>a!=i.next.y>a&&i.next.y!==i.y&&s<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r}(t,e)&&(y(t.prev,t,e.prev)||y(t,e.prev,e))||_(t,e)&&y(t.prev,t,t.next)>0&&y(e.prev,e,e.next)>0)}function y(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function _(t,e){return t.x===e.x&&t.y===e.y}function g(t,e,i,r){var s=S(y(t,e,i)),a=S(y(t,e,r)),n=S(y(i,r,t)),o=S(y(i,r,e));return s!==a&&n!==o||(!(0!==s||!v(t,i,e))||(!(0!==a||!v(t,r,e))||(!(0!==n||!v(i,t,r))||!(0!==o||!v(i,e,r)))))}function v(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function S(t){return t>0?1:t<0?-1:0}function M(t,e){return y(t.prev,t,t.next)<0?y(t,e,t.next)>=0&&y(t,t.prev,e)>=0:y(t,e,t.prev)<0||y(t,t.next,e)<0}function R(t,e){var i=new I(t.i,t.x,t.y),r=new I(e.i,e.x,e.y),s=t.next,a=e.prev;return t.next=e,e.prev=t,i.next=s,s.prev=i,r.next=i,i.prev=r,a.next=r,r.prev=a,r}function b(t,e,i,r){var s=new I(t,e,i);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function E(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function I(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function x(t,e,i,r){for(var s=0,a=e,n=i-r;a<i;a+=r)s+=(t[n]-t[a])*(t[a+1]+t[n+1]),n=a;return s}t.exports=e,t.exports.default=e,e.deviation=function(t,e,i,r){var s=e&&e.length,a=s?e[0]*i:t.length,n=Math.abs(x(t,0,a,i));if(s)for(var o=0,c=e.length;o<c;o++){var l=e[o]*i,h=o<c-1?e[o+1]*i:t.length;n-=Math.abs(x(t,l,h,i))}var u=0;for(o=0;o<r.length;o+=3){var d=r[o]*i,p=r[o+1]*i,f=r[o+2]*i;u+=Math.abs((t[d]-t[f])*(t[p+1]-t[d+1])-(t[d]-t[p])*(t[f+1]-t[d+1]))}return 0===n&&0===u?0:Math.abs((u-n)/n)},e.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,s=0;s<t.length;s++){for(var a=0;a<t[s].length;a++)for(var n=0;n<e;n++)i.vertices.push(t[s][a][n]);s>0&&(r+=t[s-1].length,i.holes.push(r))}return i}},6713:function(t,e,i){var r;!function(s){var a=s.Promise,n=a&&"resolve"in a&&"reject"in a&&"all"in a&&"race"in a&&function(){var t;return new a((function(e){t=e})),"function"==typeof t}();e?(e.Promise=n?a:x,e.Polyfill=x):void 0===(r=function(){return n?a:x}.call(e,i,e,t))||(t.exports=r);var o="pending",c="sealed",l="fulfilled",h="rejected",u=function(){};function d(t){return"[object Array]"===Object.prototype.toString.call(t)}var p,f="undefined"!=typeof setImmediate?setImmediate:setTimeout,m=[];function y(){for(var t=0;t<m.length;t++)m[t][0](m[t][1]);m=[],p=!1}function _(t,e){m.push([t,e]),p||(p=!0,f(y,0))}function g(t){var e=t.owner,i=e.state_,r=e.data_,s=t[i],a=t.then;if("function"==typeof s){i=l;try{r=s(r)}catch(t){R(a,t)}}v(a,r)||(i===l&&S(a,r),i===h&&R(a,r))}function v(t,e){var i;try{if(t===e)throw new TypeError("A promises callback cannot return that same promise.");if(e&&("function"==typeof e||"object"==typeof e)){var r=e.then;if("function"==typeof r)return r.call(e,(function(r){i||(i=!0,e!==r?S(t,r):M(t,r))}),(function(e){i||(i=!0,R(t,e))})),!0}}catch(e){return i||R(t,e),!0}return!1}function S(t,e){t!==e&&v(t,e)||M(t,e)}function M(t,e){t.state_===o&&(t.state_=c,t.data_=e,_(E,t))}function R(t,e){t.state_===o&&(t.state_=c,t.data_=e,_(I,t))}function b(t){var e=t.then_;t.then_=void 0;for(var i=0;i<e.length;i++)g(e[i])}function E(t){t.state_=l,b(t)}function I(t){t.state_=h,b(t)}function x(t){if("function"!=typeof t)throw new TypeError("Promise constructor takes a function argument");if(this instanceof x==!1)throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this.then_=[],function(t,e){function i(t){R(e,t)}try{t((function(t){S(e,t)}),i)}catch(t){i(t)}}(t,this)}x.prototype={constructor:x,state_:o,then_:null,data_:void 0,then:function(t,e){var i={owner:this,then:new this.constructor(u),fulfilled:t,rejected:e};return this.state_===l||this.state_===h?_(g,i):this.then_.push(i),i.then},catch:function(t){return this.then(null,t)}},x.all=function(t){if(!d(t))throw new TypeError("You must pass an array to Promise.all().");return new this((function(e,i){var r=[],s=0;function a(t){return s++,function(i){r[t]=i,--s||e(r)}}for(var n,o=0;o<t.length;o++)(n=t[o])&&"function"==typeof n.then?n.then(a(o),i):r[o]=n;s||e(r)}))},x.race=function(t){if(!d(t))throw new TypeError("You must pass an array to Promise.race().");return new this((function(e,i){for(var r,s=0;s<t.length;s++)(r=t[s])&&"function"==typeof r.then?r.then(e,i):e(r)}))},x.resolve=function(t){return t&&"object"==typeof t&&t.constructor===this?t:new this((function(e){e(t)}))},x.reject=function(t){return new this((function(e,i){i(t)}))}}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this)},6729:t=>{"use strict";var e=Object.prototype.hasOwnProperty,i="~";function r(){}function s(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function a(t,e,r,a,n){if("function"!=typeof r)throw new TypeError("The listener must be a function");var o=new s(r,a||t,n),c=i?i+e:e;return t._events[c]?t._events[c].fn?t._events[c]=[t._events[c],o]:t._events[c].push(o):(t._events[c]=o,t._eventsCount++),t}function n(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function o(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(i=!1)),o.prototype.eventNames=function(){var t,r,s=[];if(0===this._eventsCount)return s;for(r in t=this._events)e.call(t,r)&&s.push(i?r.slice(1):r);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(t)):s},o.prototype.listeners=function(t){var e=i?i+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,a=r.length,n=new Array(a);s<a;s++)n[s]=r[s].fn;return n},o.prototype.listenerCount=function(t){var e=i?i+t:t,r=this._events[e];return r?r.fn?1:r.length:0},o.prototype.emit=function(t,e,r,s,a,n){var o=i?i+t:t;if(!this._events[o])return!1;var c,l,h=this._events[o],u=arguments.length;if(h.fn){switch(h.once&&this.removeListener(t,h.fn,void 0,!0),u){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,e),!0;case 3:return h.fn.call(h.context,e,r),!0;case 4:return h.fn.call(h.context,e,r,s),!0;case 5:return h.fn.call(h.context,e,r,s,a),!0;case 6:return h.fn.call(h.context,e,r,s,a,n),!0}for(l=1,c=new Array(u-1);l<u;l++)c[l-1]=arguments[l];h.fn.apply(h.context,c)}else{var d,p=h.length;for(l=0;l<p;l++)switch(h[l].once&&this.removeListener(t,h[l].fn,void 0,!0),u){case 1:h[l].fn.call(h[l].context);break;case 2:h[l].fn.call(h[l].context,e);break;case 3:h[l].fn.call(h[l].context,e,r);break;case 4:h[l].fn.call(h[l].context,e,r,s);break;default:if(!c)for(d=1,c=new Array(u-1);d<u;d++)c[d-1]=arguments[d];h[l].fn.apply(h[l].context,c)}}return!0},o.prototype.on=function(t,e,i){return a(this,t,e,i,!1)},o.prototype.once=function(t,e,i){return a(this,t,e,i,!0)},o.prototype.removeListener=function(t,e,r,s){var a=i?i+t:t;if(!this._events[a])return this;if(!e)return n(this,a),this;var o=this._events[a];if(o.fn)o.fn!==e||s&&!o.once||r&&o.context!==r||n(this,a);else{for(var c=0,l=[],h=o.length;c<h;c++)(o[c].fn!==e||s&&!o[c].once||r&&o[c].context!==r)&&l.push(o[c]);l.length?this._events[a]=1===l.length?l[0]:l:n(this,a)}return this},o.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&n(this,e)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,t.exports=o},2940:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}();function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(e,i,s){void 0===i&&(i=!1),r(this,t),this._fn=e,this._once=i,this._thisArg=s,this._next=this._prev=this._owner=null}return i(t,[{key:"detach",value:function(){return null!==this._owner&&(this._owner.detach(this),!0)}}]),t}();function a(t,e){return t._head?(t._tail._next=e,e._prev=t._tail,t._tail=e):(t._head=e,t._tail=e),e._owner=t,e}var n=function(){function t(){r(this,t),this._head=this._tail=void 0}return i(t,[{key:"handlers",value:function(){var t=!(arguments.length<=0||void 0===arguments[0])&&arguments[0],e=this._head;if(t)return!!e;for(var i=[];e;)i.push(e),e=e._next;return i}},{key:"has",value:function(t){if(!(t instanceof s))throw new Error("MiniSignal#has(): First arg must be a MiniSignalBinding object.");return t._owner===this}},{key:"dispatch",value:function(){var t=this._head;if(!t)return!1;for(;t;)t._once&&this.detach(t),t._fn.apply(t._thisArg,arguments),t=t._next;return!0}},{key:"add",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof t)throw new Error("MiniSignal#add(): First arg must be a Function.");return a(this,new s(t,!1,e))}},{key:"once",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof t)throw new Error("MiniSignal#once(): First arg must be a Function.");return a(this,new s(t,!0,e))}},{key:"detach",value:function(t){if(!(t instanceof s))throw new Error("MiniSignal#detach(): First arg must be a MiniSignalBinding object.");return t._owner!==this||(t._prev&&(t._prev._next=t._next),t._next&&(t._next._prev=t._prev),t===this._head?(this._head=t._next,null===t._next&&(this._tail=null)):t===this._tail&&(this._tail=t._prev,this._tail._next=null),t._owner=null),this}},{key:"detachAll",value:function(){var t=this._head;if(!t)return this;for(this._head=this._tail=null;t;)t._owner=null,t=t._next;return this}}]),t}();n.MiniSignalBinding=s,e.default=n,t.exports=e.default},7418:t=>{"use strict";var e=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;function s(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},i=0;i<10;i++)e["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(t){r[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(t){return!1}}()?Object.assign:function(t,a){for(var n,o,c=s(t),l=1;l<arguments.length;l++){for(var h in n=Object(arguments[l]))i.call(n,h)&&(c[h]=n[h]);if(e){o=e(n);for(var u=0;u<o.length;u++)r.call(n,o[u])&&(c[o[u]]=n[o[u]])}}return c}},9571:t=>{"use strict";t.exports=function(t,e){if(t){e=e||{};for(var i={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},r=i.parser[e.strictMode?"strict":"loose"].exec(t),s={},a=14;a--;)s[i.key[a]]=r[a]||"";return s[i.q.name]={},s[i.key[12]].replace(i.q.parser,(function(t,e,r){e&&(s[i.q.name][e]=r)})),s}}},5287:(t,e,i)=>{"use strict";i.r(e),i.d(e,{ALPHA_MODES:()=>z,AbstractBatchRenderer:()=>Ar,AbstractRenderer:()=>br,AccessibilityManager:()=>fe,AnimatedSprite:()=>Qn,AppLoaderPlugin:()=>ps,Application:()=>Nr,Attribute:()=>ei,BLEND_MODES:()=>N,BUFFER_BITS:()=>O,BasePrepare:()=>ba,BaseRenderTexture:()=>Ye,BaseTexture:()=>Le,BatchDrawCall:()=>Tr,BatchGeometry:()=>Cr,BatchPluginFactory:()=>Fr,BatchRenderer:()=>Or,BatchShaderGenerator:()=>kr,BatchTextureArray:()=>Dr,BitmapFont:()=>en,BitmapFontData:()=>Xa,BitmapFontLoader:()=>nn,BitmapText:()=>an,Bounds:()=>ae,Buffer:()=>ri,CLEAR_MODES:()=>X,Circle:()=>Wt,Container:()=>ue,CountLimiter:()=>ma,DEG_TO_RAD:()=>Vt,DRAW_MODES:()=>j,DisplayObject:()=>ce,ENV:()=>B,Ellipse:()=>qt,Extract:()=>Vr,FORMATS:()=>U,FillStyle:()=>Rs,Filter:()=>Ji,FilterState:()=>fi,Framebuffer:()=>Xe,GC_MODES:()=>Y,GLFramebuffer:()=>Si,GLProgram:()=>pr,GLTexture:()=>vr,GRAPHICS_CURVES:()=>Ms,Geometry:()=>li,Graphics:()=>Qs,GraphicsData:()=>qs,GraphicsGeometry:()=>Xs,IGLUniformData:()=>dr,InteractionData:()=>ge,InteractionEvent:()=>Se,InteractionManager:()=>Ie,InteractionTrackingData:()=>Me,LINE_CAP:()=>_s,LINE_JOIN:()=>ys,LineStyle:()=>Ys,Loader:()=>ds,LoaderResource:()=>ls,MASK_TYPES:()=>$,MIPMAP_MODES:()=>G,MSAA_QUALITY:()=>Q,MaskData:()=>xi,Matrix:()=>Kt,Mesh:()=>Wa,MeshBatchUvs:()=>Ua,MeshGeometry:()=>Ga,MeshMaterial:()=>qa,NineSlicePlane:()=>Kn,ObjectRenderer:()=>yi,ObservablePoint:()=>Yt,PI_2:()=>jt,PRECISION:()=>K,ParticleContainer:()=>gs,ParticleRenderer:()=>Ss,PlaneGeometry:()=>qn,Point:()=>Xt,Polygon:()=>Gt,Prepare:()=>wa,Program:()=>$i,Quad:()=>hi,QuadUv:()=>ui,RAD_TO_DEG:()=>Ut,RENDERER_TYPE:()=>F,Rectangle:()=>Ht,RenderTexture:()=>Je,RenderTexturePool:()=>ti,Renderer:()=>Er,RopeGeometry:()=>Gn,RoundedRectangle:()=>zt,Runner:()=>xe,SCALE_MODES:()=>W,SHAPES:()=>Nt,Shader:()=>Qi,SimpleMesh:()=>Yn,SimplePlane:()=>Xn,SimpleRope:()=>zn,Sprite:()=>ia,SpriteMaskFilter:()=>ir,Spritesheet:()=>Da,SpritesheetLoader:()=>Pa,State:()=>Zi,System:()=>Ge,TARGETS:()=>V,TEXT_GRADIENT:()=>Js,TYPES:()=>H,TemporaryDisplayObject:()=>le,Text:()=>pa,TextMetrics:()=>ha,TextStyle:()=>na,Texture:()=>Qe,TextureLoader:()=>us,TextureMatrix:()=>er,TextureUvs:()=>Ke,Ticker:()=>ye,TickerPlugin:()=>_e,TilingSprite:()=>La,TilingSpriteRenderer:()=>Oa,TimeLimiter:()=>Ta,Transform:()=>se,UPDATE_PRIORITY:()=>pe,UniformGroup:()=>pi,VERSION:()=>io,ViewableBuffer:()=>Pr,WRAP_MODES:()=>q,accessibleTarget:()=>de,autoDetectRenderer:()=>Ir,checkMaxIfStatementsInShader:()=>Xi,defaultFilterVertex:()=>wr,defaultVertex:()=>xr,filters:()=>ro,graphicsUtils:()=>Ws,groupD8:()=>re,interactiveTarget:()=>be,isMobile:()=>T,resources:()=>qe,settings:()=>D,systems:()=>Mr,uniformParsers:()=>Vi,useDeprecated:()=>eo,utils:()=>r});var r={};i.r(r),i.d(r,{BaseTextureCache:()=>Tt,CanvasRenderTarget:()=>At,DATA_URI:()=>Lt,EventEmitter:()=>A(),ProgramCache:()=>xt,TextureCache:()=>wt,clearTextureCache:()=>Pt,correctBlendMode:()=>lt,createIndicesForQuads:()=>pt,decomposeDataUri:()=>Bt,deprecation:()=>It,destroyTextureCache:()=>Dt,determineCrossOrigin:()=>Ft,earcut:()=>C(),getBufferType:()=>ft,getResolutionOfUrl:()=>Ot,hex2rgb:()=>st,hex2string:()=>at,interleaveTypedArrays:()=>yt,isMobile:()=>T,isPow2:()=>gt,isWebGLSupported:()=>rt,log2:()=>vt,nextPow2:()=>_t,premultiplyBlendMode:()=>ct,premultiplyRgba:()=>ht,premultiplyTint:()=>ut,premultiplyTintToRgba:()=>dt,removeItems:()=>St,rgb2hex:()=>ot,sayHello:()=>it,sign:()=>Mt,skipHello:()=>et,string2hex:()=>nt,trimCanvas:()=>kt,uid:()=>bt,url:()=>Z()});var s=i(6713),a=i(7418),n=i.n(a);window.Promise||(window.Promise=s.Polyfill),Object.assign||(Object.assign=n());if(Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),!window.performance||!window.performance.now){var o=Date.now();window.performance||(window.performance={}),window.performance.now=function(){return Date.now()-o}}for(var c=Date.now(),l=["ms","moz","webkit","o"],h=0;h<l.length&&!window.requestAnimationFrame;++h){var u=l[h];window.requestAnimationFrame=window[u+"RequestAnimationFrame"],window.cancelAnimationFrame=window[u+"CancelAnimationFrame"]||window[u+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(t){if("function"!=typeof t)throw new TypeError(t+"is not a function");var e=Date.now(),i=16+c-e;return i<0&&(i=0),c=e,window.setTimeout((function(){c=Date.now(),t(performance.now())}),i)}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){return clearTimeout(t)}),Math.sign||(Math.sign=function(t){return 0===(t=Number(t))||isNaN(t)?t:t>0?1:-1}),Number.isInteger||(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),window.ArrayBuffer||(window.ArrayBuffer=Array),window.Float32Array||(window.Float32Array=Array),window.Uint32Array||(window.Uint32Array=Array),window.Uint16Array||(window.Uint16Array=Array),window.Uint8Array||(window.Uint8Array=Array),window.Int32Array||(window.Int32Array=Array);var d=/iPhone/i,p=/iPod/i,f=/iPad/i,m=/\biOS-universal(?:.+)Mac\b/i,y=/\bAndroid(?:.+)Mobile\b/i,_=/Android/i,g=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,v=/Silk/i,S=/Windows Phone/i,M=/\bWindows(?:.+)ARM\b/i,R=/BlackBerry/i,b=/BB10/i,E=/Opera Mini/i,I=/\b(CriOS|Chrome)(?:.+)Mobile/i,x=/Mobile(?:.+)Firefox\b/i,w=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};var T=function(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var i=e.userAgent,r=i.split("[FBAN");void 0!==r[1]&&(i=r[0]),void 0!==(r=i.split("Twitter"))[1]&&(i=r[0]);var s=function(t){return function(e){return e.test(t)}}(i),a={apple:{phone:s(d)&&!s(S),ipod:s(p),tablet:!s(d)&&(s(f)||w(e))&&!s(S),universal:s(m),device:(s(d)||s(p)||s(f)||s(m)||w(e))&&!s(S)},amazon:{phone:s(g),tablet:!s(g)&&s(v),device:s(g)||s(v)},android:{phone:!s(S)&&s(g)||!s(S)&&s(y),tablet:!s(S)&&!s(g)&&!s(y)&&(s(v)||s(_)),device:!s(S)&&(s(g)||s(v)||s(y)||s(_))||s(/\bokhttp\b/i)},windows:{phone:s(S),tablet:s(M),device:s(S)||s(M)},other:{blackberry:s(R),blackberry10:s(b),opera:s(E),firefox:s(x),chrome:s(I),device:s(R)||s(b)||s(E)||s(x)||s(I)},any:!1,phone:!1,tablet:!1};return a.any=a.apple.device||a.android.device||a.windows.device||a.other.device,a.phone=a.apple.phone||a.android.phone||a.windows.phone,a.tablet=a.apple.tablet||a.android.tablet||a.windows.tablet,a}(window.navigator);var D={MIPMAP_TEXTURES:1,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,SPRITE_MAX_TEXTURES:function(t){var e=!0;if(T.tablet||T.phone){var i;if(T.apple.device)if(i=navigator.userAgent.match(/OS (\d+)_(\d+)?/))parseInt(i[1],10)<11&&(e=!1);if(T.android.device)if(i=navigator.userAgent.match(/Android\s([0-9.]*)/))parseInt(i[1],10)<7&&(e=!1)}return e?t:4}(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,transparent:!1,backgroundColor:0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1},GC_MODE:0,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:33071,SCALE_MODE:1,PRECISION_VERTEX:"highp",PRECISION_FRAGMENT:T.apple.device?"highp":"mediump",CAN_UPLOAD_SAME_BUFFER:!T.apple.device,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1},P=i(6729),A=i.n(P),k=i(9187),C=i.n(k);const L=require("url");var B,F,O,N,j,U,V,H,W,q,G,z,X,Y,K,$,Q,Z=i.n(L);!function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"}(B||(B={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(F||(F={})),function(t){t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL"}(O||(O={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"}(N||(N={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(j||(j={})),function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(U||(U={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(V||(V={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=36193]="HALF_FLOAT"}(H||(H={})),function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"}(W||(W={})),function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(q||(q={})),function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON"}(G||(G={})),function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"}(z||(z={})),function(t){t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT"}(X||(X={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(Y||(Y={})),function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"}(K||(K={})),function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE"}($||($={})),function(t){t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH"}(Q||(Q={})),D.RETINA_PREFIX=/@([0-9\.]+)x/,D.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!0;var J,tt=!1;function et(){tt=!0}function it(t){var e;if(!tt){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var i=["\n %c %c %c PixiJS 5.3.11 - ✰ "+t+" ✰  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];(e=window.console).log.apply(e,i)}else window.console&&window.console.log("PixiJS 5.3.11 - "+t+" - http://www.pixijs.com/");tt=!0}}function rt(){return void 0===J&&(J=function(){var t={stencil:!0,failIfMajorPerformanceCaveat:D.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!window.WebGLRenderingContext)return!1;var e=document.createElement("canvas"),i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),r=!(!i||!i.getContextAttributes().stencil);if(i){var s=i.getExtension("WEBGL_lose_context");s&&s.loseContext()}return i=null,r}catch(t){return!1}}()),J}function st(t,e){return void 0===e&&(e=[]),e[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(255&t)/255,e}function at(t){var e=t.toString(16);return"#"+(e="000000".substr(0,6-e.length)+e)}function nt(t){return"string"==typeof t&&"#"===t[0]&&(t=t.substr(1)),parseInt(t,16)}function ot(t){return(255*t[0]<<16)+(255*t[1]<<8)+(255*t[2]|0)}var ct=function(){for(var t=[],e=[],i=0;i<32;i++)t[i]=i,e[i]=i;t[N.NORMAL_NPM]=N.NORMAL,t[N.ADD_NPM]=N.ADD,t[N.SCREEN_NPM]=N.SCREEN,e[N.NORMAL]=N.NORMAL_NPM,e[N.ADD]=N.ADD_NPM,e[N.SCREEN]=N.SCREEN_NPM;var r=[];return r.push(e),r.push(t),r}();function lt(t,e){return ct[e?1:0][t]}function ht(t,e,i,r){return i=i||new Float32Array(4),r||void 0===r?(i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e):(i[0]=t[0],i[1]=t[1],i[2]=t[2]),i[3]=e,i}function ut(t,e){if(1===e)return(255*e<<24)+t;if(0===e)return 0;var i=t>>16&255,r=t>>8&255,s=255&t;return(255*e<<24)+((i=i*e+.5|0)<<16)+((r=r*e+.5|0)<<8)+(s=s*e+.5|0)}function dt(t,e,i,r){return(i=i||new Float32Array(4))[0]=(t>>16&255)/255,i[1]=(t>>8&255)/255,i[2]=(255&t)/255,(r||void 0===r)&&(i[0]*=e,i[1]*=e,i[2]*=e),i[3]=e,i}function pt(t,e){void 0===e&&(e=null);var i=6*t;if((e=e||new Uint16Array(i)).length!==i)throw new Error("Out buffer length is incorrect, got "+e.length+" and expected "+i);for(var r=0,s=0;r<i;r+=6,s+=4)e[r+0]=s+0,e[r+1]=s+1,e[r+2]=s+2,e[r+3]=s+0,e[r+4]=s+2,e[r+5]=s+3;return e}function ft(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}var mt={Float32Array,Uint32Array,Int32Array,Uint8Array};function yt(t,e){for(var i=0,r=0,s={},a=0;a<t.length;a++)r+=e[a],i+=t[a].length;var n=new ArrayBuffer(4*i),o=null,c=0;for(a=0;a<t.length;a++){var l=e[a],h=t[a],u=ft(h);s[u]||(s[u]=new mt[u](n)),o=s[u];for(var d=0;d<h.length;d++){o[(d/l|0)*r+c+d%l]=h[d]}c+=l}return new Float32Array(n)}function _t(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1}function gt(t){return!(t&t-1||!t)}function vt(t){var e=(t>65535?1:0)<<4,i=((t>>>=e)>255?1:0)<<3;return e|=i,e|=i=((t>>>=i)>15?1:0)<<2,(e|=i=((t>>>=i)>3?1:0)<<1)|(t>>>=i)>>1}function St(t,e,i){var r,s=t.length;if(!(e>=s||0===i)){var a=s-(i=e+i>s?s-e:i);for(r=e;r<a;++r)t[r]=t[r+i];t.length=a}}function Mt(t){return 0===t?0:t<0?-1:1}var Rt=0;function bt(){return++Rt}var Et={};function It(t,e,i){if(void 0===i&&(i=3),!Et[e]){var r=(new Error).stack;void 0===r?console.warn("PixiJS Deprecation Warning: ",e+"\nDeprecated since v"+t):(r=r.split("\n").splice(i).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",e+"\nDeprecated since v"+t),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",e+"\nDeprecated since v"+t),console.warn(r))),Et[e]=!0}}var xt={},wt=Object.create(null),Tt=Object.create(null);function Dt(){var t;for(t in wt)wt[t].destroy();for(t in Tt)Tt[t].destroy()}function Pt(){var t;for(t in wt)delete wt[t];for(t in Tt)delete Tt[t]}var At=function(){function t(t,e,i){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=i||D.RESOLUTION,this.resize(t,e)}return t.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.resize=function(t,e){this.canvas.width=t*this.resolution,this.canvas.height=e*this.resolution},t.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(t.prototype,"width",{get:function(){return this.canvas.width},set:function(t){this.canvas.width=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.canvas.height},set:function(t){this.canvas.height=t},enumerable:!1,configurable:!0}),t}();function kt(t){var e,i,r,s=t.width,a=t.height,n=t.getContext("2d"),o=n.getImageData(0,0,s,a).data,c=o.length,l={top:null,left:null,right:null,bottom:null},h=null;for(e=0;e<c;e+=4)0!==o[e+3]&&(i=e/4%s,r=~~(e/4/s),null===l.top&&(l.top=r),(null===l.left||i<l.left)&&(l.left=i),(null===l.right||l.right<i)&&(l.right=i+1),(null===l.bottom||l.bottom<r)&&(l.bottom=r));return null!==l.top&&(s=l.right-l.left,a=l.bottom-l.top+1,h=n.getImageData(l.left,l.top,s,a)),{height:a,width:s,data:h}}var Ct,Lt=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function Bt(t){var e=Lt.exec(t);if(e)return{mediaType:e[1]?e[1].toLowerCase():void 0,subType:e[2]?e[2].toLowerCase():void 0,charset:e[3]?e[3].toLowerCase():void 0,encoding:e[4]?e[4].toLowerCase():void 0,data:e[5]}}function Ft(t,e){if(void 0===e&&(e=window.location),0===t.indexOf("data:"))return"";e=e||window.location,Ct||(Ct=document.createElement("a")),Ct.href=t;var i=(0,L.parse)(Ct.href),r=!i.port&&""===e.port||i.port===e.port;return i.hostname===e.hostname&&r&&i.protocol===e.protocol?"":"anonymous"}function Ot(t,e){var i=D.RETINA_PREFIX.exec(t);return i?parseFloat(i[1]):void 0!==e?e:1}var Nt,jt=2*Math.PI,Ut=180/Math.PI,Vt=Math.PI/180;!function(t){t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC"}(Nt||(Nt={}));var Ht=function(){function t(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(r),this.type=Nt.RECT}return Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(t,"EMPTY",{get:function(){return new t(0,0,0,0)},enumerable:!1,configurable:!0}),t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},t.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},t.prototype.contains=function(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height)},t.prototype.pad=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this},t.prototype.fit=function(t){var e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),r=Math.max(this.y,t.y),s=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=r,this.height=Math.max(s-r,0),this},t.prototype.ceil=function(t,e){void 0===t&&(t=1),void 0===e&&(e=.001);var i=Math.ceil((this.x+this.width-e)*t)/t,r=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=r-this.y,this},t.prototype.enlarge=function(t){var e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),r=Math.min(this.y,t.y),s=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=r,this.height=s-r,this},t}(),Wt=function(){function t(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.x=t,this.y=e,this.radius=i,this.type=Nt.CIRC}return t.prototype.clone=function(){return new t(this.x,this.y,this.radius)},t.prototype.contains=function(t,e){if(this.radius<=0)return!1;var i=this.radius*this.radius,r=this.x-t,s=this.y-e;return(r*=r)+(s*=s)<=i},t.prototype.getBounds=function(){return new Ht(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},t}(),qt=function(){function t(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this.x=t,this.y=e,this.width=i,this.height=r,this.type=Nt.ELIP}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=(t-this.x)/this.width,r=(e-this.y)/this.height;return(i*=i)+(r*=r)<=1},t.prototype.getBounds=function(){return new Ht(this.x-this.width,this.y-this.height,this.width,this.height)},t}(),Gt=function(){function t(){for(var t=arguments,e=[],i=0;i<arguments.length;i++)e[i]=t[i];var r=Array.isArray(e[0])?e[0]:e;if("number"!=typeof r[0]){for(var s=[],a=0,n=r.length;a<n;a++)s.push(r[a].x,r[a].y);r=s}this.points=r,this.type=Nt.POLY,this.closeStroke=!0}return t.prototype.clone=function(){var e=new t(this.points.slice());return e.closeStroke=this.closeStroke,e},t.prototype.contains=function(t,e){for(var i=!1,r=this.points.length/2,s=0,a=r-1;s<r;a=s++){var n=this.points[2*s],o=this.points[2*s+1],c=this.points[2*a],l=this.points[2*a+1];o>e!=l>e&&t<(e-o)/(l-o)*(c-n)+n&&(i=!i)}return i},t}(),zt=function(){function t(t,e,i,r,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===s&&(s=20),this.x=t,this.y=e,this.width=i,this.height=r,this.radius=s,this.type=Nt.RREC}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height,this.radius)},t.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){if(e>=this.y+this.radius&&e<=this.y+this.height-this.radius||t>=this.x+this.radius&&t<=this.x+this.width-this.radius)return!0;var i=t-(this.x+this.radius),r=e-(this.y+this.radius),s=this.radius*this.radius;if(i*i+r*r<=s)return!0;if((i=t-(this.x+this.width-this.radius))*i+r*r<=s)return!0;if(i*i+(r=e-(this.y+this.height-this.radius))*r<=s)return!0;if((i=t-(this.x+this.radius))*i+r*r<=s)return!0}return!1},t}(),Xt=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.copyFrom=function(t){return this.set(t.x,t.y),this},t.prototype.copyTo=function(t){return t.set(this.x,this.y),t},t.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},t.prototype.set=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x=t,this.y=e,this},t}(),Yt=function(){function t(t,e,i,r){void 0===i&&(i=0),void 0===r&&(r=0),this._x=i,this._y=r,this.cb=t,this.scope=e}return t.prototype.clone=function(e,i){return void 0===e&&(e=this.cb),void 0===i&&(i=this.scope),new t(e,i,this._x,this._y)},t.prototype.set=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this._x===t&&this._y===e||(this._x=t,this._y=e,this.cb.call(this.scope)),this},t.prototype.copyFrom=function(t){return this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this},t.prototype.copyTo=function(t){return t.set(this._x,this._y),t},t.prototype.equals=function(t){return t.x===this._x&&t.y===this._y},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),t}(),Kt=function(){function t(t,e,i,r,s,a){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===s&&(s=0),void 0===a&&(a=0),this.array=null,this.a=t,this.b=e,this.c=i,this.d=r,this.tx=s,this.ty=a}return t.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},t.prototype.set=function(t,e,i,r,s,a){return this.a=t,this.b=e,this.c=i,this.d=r,this.tx=s,this.ty=a,this},t.prototype.toArray=function(t,e){this.array||(this.array=new Float32Array(9));var i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i},t.prototype.apply=function(t,e){e=e||new Xt;var i=t.x,r=t.y;return e.x=this.a*i+this.c*r+this.tx,e.y=this.b*i+this.d*r+this.ty,e},t.prototype.applyInverse=function(t,e){e=e||new Xt;var i=1/(this.a*this.d+this.c*-this.b),r=t.x,s=t.y;return e.x=this.d*i*r+-this.c*i*s+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*s+-this.b*i*r+(-this.ty*this.a+this.tx*this.b)*i,e},t.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},t.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},t.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),r=this.a,s=this.c,a=this.tx;return this.a=r*e-this.b*i,this.b=r*i+this.b*e,this.c=s*e-this.d*i,this.d=s*i+this.d*e,this.tx=a*e-this.ty*i,this.ty=a*i+this.ty*e,this},t.prototype.append=function(t){var e=this.a,i=this.b,r=this.c,s=this.d;return this.a=t.a*e+t.b*r,this.b=t.a*i+t.b*s,this.c=t.c*e+t.d*r,this.d=t.c*i+t.d*s,this.tx=t.tx*e+t.ty*r+this.tx,this.ty=t.tx*i+t.ty*s+this.ty,this},t.prototype.setTransform=function(t,e,i,r,s,a,n,o,c){return this.a=Math.cos(n+c)*s,this.b=Math.sin(n+c)*s,this.c=-Math.sin(n-o)*a,this.d=Math.cos(n-o)*a,this.tx=t-(i*this.a+r*this.c),this.ty=e-(i*this.b+r*this.d),this},t.prototype.prepend=function(t){var e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){var i=this.a,r=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this},t.prototype.decompose=function(t){var e=this.a,i=this.b,r=this.c,s=this.d,a=-Math.atan2(-r,s),n=Math.atan2(i,e),o=Math.abs(a+n);return o<1e-5||Math.abs(jt-o)<1e-5?(t.rotation=n,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=n),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(r*r+s*s),t.position.x=this.tx,t.position.y=this.ty,t},t.prototype.invert=function(){var t=this.a,e=this.b,i=this.c,r=this.d,s=this.tx,a=t*r-e*i;return this.a=r/a,this.b=-e/a,this.c=-i/a,this.d=t/a,this.tx=(i*this.ty-r*s)/a,this.ty=-(t*this.ty-e*s)/a,this},t.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},t.prototype.clone=function(){var e=new t;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},t.prototype.copyTo=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},t.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},Object.defineProperty(t,"IDENTITY",{get:function(){return new t},enumerable:!1,configurable:!0}),Object.defineProperty(t,"TEMP_MATRIX",{get:function(){return new t},enumerable:!1,configurable:!0}),t}(),$t=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Qt=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Zt=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Jt=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],te=[],ee=[],ie=Math.sign;!function(){for(var t=0;t<16;t++){var e=[];te.push(e);for(var i=0;i<16;i++)for(var r=ie($t[t]*$t[i]+Zt[t]*Qt[i]),s=ie(Qt[t]*$t[i]+Jt[t]*Qt[i]),a=ie($t[t]*Zt[i]+Zt[t]*Jt[i]),n=ie(Qt[t]*Zt[i]+Jt[t]*Jt[i]),o=0;o<16;o++)if($t[o]===r&&Qt[o]===s&&Zt[o]===a&&Jt[o]===n){e.push(o);break}}for(t=0;t<16;t++){var c=new Kt;c.set($t[t],Qt[t],Zt[t],Jt[t],0,0),ee.push(c)}}();var re={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(t){return $t[t]},uY:function(t){return Qt[t]},vX:function(t){return Zt[t]},vY:function(t){return Jt[t]},inv:function(t){return 8&t?15&t:7&-t},add:function(t,e){return te[t][e]},sub:function(t,e){return te[t][re.inv(e)]},rotate180:function(t){return 4^t},isVertical:function(t){return 2==(3&t)},byDirection:function(t,e){return 2*Math.abs(t)<=Math.abs(e)?e>=0?re.S:re.N:2*Math.abs(e)<=Math.abs(t)?t>0?re.E:re.W:e>0?t>0?re.SE:re.SW:t>0?re.NE:re.NW},matrixAppendRotationInv:function(t,e,i,r){void 0===i&&(i=0),void 0===r&&(r=0);var s=ee[re.inv(e)];s.tx=i,s.ty=r,t.append(s)}},se=function(){function t(){this.worldTransform=new Kt,this.localTransform=new Kt,this.position=new Yt(this.onChange,this,0,0),this.scale=new Yt(this.onChange,this,1,1),this.pivot=new Yt(this.onChange,this,0,0),this.skew=new Yt(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}return t.prototype.onChange=function(){this._localID++},t.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},t.prototype.updateLocalTransform=function(){var t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)},t.prototype.updateTransform=function(t){var e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){var i=t.worldTransform,r=this.worldTransform;r.a=e.a*i.a+e.b*i.c,r.b=e.a*i.b+e.b*i.d,r.c=e.c*i.a+e.d*i.c,r.d=e.c*i.b+e.d*i.d,r.tx=e.tx*i.a+e.ty*i.c+i.tx,r.ty=e.tx*i.b+e.ty*i.d+i.ty,this._parentID=t._worldID,this._worldID++}},t.prototype.setFromMatrix=function(t){t.decompose(this),this._localID++},Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())},enumerable:!1,configurable:!0}),t.IDENTITY=new t,t}();D.SORTABLE_CHILDREN=!1;var ae=function(){function t(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}return t.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},t.prototype.clear=function(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},t.prototype.getRectangle=function(t){return this.minX>this.maxX||this.minY>this.maxY?Ht.EMPTY:((t=t||new Ht(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)},t.prototype.addPoint=function(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)},t.prototype.addQuad=function(t){var e=this.minX,i=this.minY,r=this.maxX,s=this.maxY,a=t[0],n=t[1];e=a<e?a:e,i=n<i?n:i,r=a>r?a:r,s=n>s?n:s,e=(a=t[2])<e?a:e,i=(n=t[3])<i?n:i,r=a>r?a:r,s=n>s?n:s,e=(a=t[4])<e?a:e,i=(n=t[5])<i?n:i,r=a>r?a:r,s=n>s?n:s,e=(a=t[6])<e?a:e,i=(n=t[7])<i?n:i,r=a>r?a:r,s=n>s?n:s,this.minX=e,this.minY=i,this.maxX=r,this.maxY=s},t.prototype.addFrame=function(t,e,i,r,s){this.addFrameMatrix(t.worldTransform,e,i,r,s)},t.prototype.addFrameMatrix=function(t,e,i,r,s){var a=t.a,n=t.b,o=t.c,c=t.d,l=t.tx,h=t.ty,u=this.minX,d=this.minY,p=this.maxX,f=this.maxY,m=a*e+o*i+l,y=n*e+c*i+h;u=m<u?m:u,d=y<d?y:d,p=m>p?m:p,f=y>f?y:f,u=(m=a*r+o*i+l)<u?m:u,d=(y=n*r+c*i+h)<d?y:d,p=m>p?m:p,f=y>f?y:f,u=(m=a*e+o*s+l)<u?m:u,d=(y=n*e+c*s+h)<d?y:d,p=m>p?m:p,f=y>f?y:f,u=(m=a*r+o*s+l)<u?m:u,d=(y=n*r+c*s+h)<d?y:d,p=m>p?m:p,f=y>f?y:f,this.minX=u,this.minY=d,this.maxX=p,this.maxY=f},t.prototype.addVertexData=function(t,e,i){for(var r=this.minX,s=this.minY,a=this.maxX,n=this.maxY,o=e;o<i;o+=2){var c=t[o],l=t[o+1];r=c<r?c:r,s=l<s?l:s,a=c>a?c:a,n=l>n?l:n}this.minX=r,this.minY=s,this.maxX=a,this.maxY=n},t.prototype.addVertices=function(t,e,i,r){this.addVerticesMatrix(t.worldTransform,e,i,r)},t.prototype.addVerticesMatrix=function(t,e,i,r,s,a){void 0===s&&(s=0),void 0===a&&(a=s);for(var n=t.a,o=t.b,c=t.c,l=t.d,h=t.tx,u=t.ty,d=this.minX,p=this.minY,f=this.maxX,m=this.maxY,y=i;y<r;y+=2){var _=e[y],g=e[y+1],v=n*_+c*g+h,S=l*g+o*_+u;d=Math.min(d,v-s),f=Math.max(f,v+s),p=Math.min(p,S-a),m=Math.max(m,S+a)}this.minX=d,this.minY=p,this.maxX=f,this.maxY=m},t.prototype.addBounds=function(t){var e=this.minX,i=this.minY,r=this.maxX,s=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>r?t.maxX:r,this.maxY=t.maxY>s?t.maxY:s},t.prototype.addBoundsMask=function(t,e){var i=t.minX>e.minX?t.minX:e.minX,r=t.minY>e.minY?t.minY:e.minY,s=t.maxX<e.maxX?t.maxX:e.maxX,a=t.maxY<e.maxY?t.maxY:e.maxY;if(i<=s&&r<=a){var n=this.minX,o=this.minY,c=this.maxX,l=this.maxY;this.minX=i<n?i:n,this.minY=r<o?r:o,this.maxX=s>c?s:c,this.maxY=a>l?a:l}},t.prototype.addBoundsMatrix=function(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)},t.prototype.addBoundsArea=function(t,e){var i=t.minX>e.x?t.minX:e.x,r=t.minY>e.y?t.minY:e.y,s=t.maxX<e.x+e.width?t.maxX:e.x+e.width,a=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(i<=s&&r<=a){var n=this.minX,o=this.minY,c=this.maxX,l=this.maxY;this.minX=i<n?i:n,this.minY=r<o?r:o,this.maxX=s>c?s:c,this.maxY=a>l?a:l}},t.prototype.pad=function(t,e){void 0===t&&(t=0),void 0===e&&(e=t),this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)},t.prototype.addFramePad=function(t,e,i,r,s,a){t-=s,e-=a,i+=s,r+=a,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>r?this.maxY:r},t}(),ne=function(t,e){return ne=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},ne(t,e)};function oe(t,e){function i(){this.constructor=t}ne(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var ce=function(t){function e(){var e=t.call(this)||this;return e.tempDisplayObjectParent=null,e.transform=new se,e.alpha=1,e.visible=!0,e.renderable=!0,e.parent=null,e.worldAlpha=1,e._lastSortedIndex=0,e._zIndex=0,e.filterArea=null,e.filters=null,e._enabledFilters=null,e._bounds=new ae,e._localBounds=null,e._boundsID=0,e._boundsRect=null,e._localBoundsRect=null,e._mask=null,e._destroyed=!1,e.isSprite=!1,e.isMask=!1,e}return oe(e,t),e.mixin=function(t){for(var i=Object.keys(t),r=0;r<i.length;++r){var s=i[r];Object.defineProperty(e.prototype,s,Object.getOwnPropertyDescriptor(t,s))}},e.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},e.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha},e.prototype.getBounds=function(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Ht),e=this._boundsRect),this._bounds.getRectangle(e)},e.prototype.getLocalBounds=function(t){t||(this._localBoundsRect||(this._localBoundsRect=new Ht),t=this._localBoundsRect),this._localBounds||(this._localBounds=new ae);var e=this.transform,i=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;var r=this._bounds,s=this._boundsID;this._bounds=this._localBounds;var a=this.getBounds(!1,t);return this.parent=i,this.transform=e,this._bounds=r,this._bounds.updateID+=this._boundsID-s,a},e.prototype.toGlobal=function(t,e,i){return void 0===i&&(i=!1),i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)},e.prototype.toLocal=function(t,e,i,r){return e&&(t=e.toGlobal(t,i,r)),r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,i)},e.prototype.setParent=function(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t},e.prototype.setTransform=function(t,e,i,r,s,a,n,o,c){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=1),void 0===r&&(r=1),void 0===s&&(s=0),void 0===a&&(a=0),void 0===n&&(n=0),void 0===o&&(o=0),void 0===c&&(c=0),this.position.x=t,this.position.y=e,this.scale.x=i||1,this.scale.y=r||1,this.rotation=s,this.skew.x=a,this.skew.y=n,this.pivot.x=o,this.pivot.y=c,this},e.prototype.destroy=function(t){this.parent&&this.parent.removeChild(this),this.removeAllListeners(),this.transform=null,this.parent=null,this._bounds=null,this._mask=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this._destroyed=!0},Object.defineProperty(e.prototype,"_tempDisplayObjectParent",{get:function(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new le),this.tempDisplayObjectParent},enumerable:!1,configurable:!0}),e.prototype.enableTempParent=function(){var t=this.parent;return this.parent=this._tempDisplayObjectParent,t},e.prototype.disableTempParent=function(t){this.parent=t},Object.defineProperty(e.prototype,"x",{get:function(){return this.position.x},set:function(t){this.transform.position.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.position.y},set:function(t){this.transform.position.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldTransform",{get:function(){return this.transform.worldTransform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localTransform",{get:function(){return this.transform.localTransform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.transform.position},set:function(t){this.transform.position.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this.transform.scale},set:function(t){this.transform.scale.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pivot",{get:function(){return this.transform.pivot},set:function(t){this.transform.pivot.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skew",{get:function(){return this.transform.skew},set:function(t){this.transform.skew.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(t){this.transform.rotation=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this.transform.rotation*Ut},set:function(t){this.transform.rotation=t*Vt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zIndex",{get:function(){return this._zIndex},set:function(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldVisible",{get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(t){var e;this._mask&&((e=this._mask.maskObject||this._mask).renderable=!0,e.isMask=!1);(this._mask=t,this._mask)&&((e=this._mask.maskObject||this._mask).renderable=!1,e.isMask=!0)},enumerable:!1,configurable:!0}),e}(A()),le=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sortDirty=null,e}return oe(e,t),e}(ce);function he(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}ce.prototype.displayObjectUpdateTransform=ce.prototype.updateTransform;var ue=function(t){function e(){var e=t.call(this)||this;return e.children=[],e.sortableChildren=D.SORTABLE_CHILDREN,e.sortDirty=!1,e}return oe(e,t),e.prototype.onChildrenChange=function(t){},e.prototype.addChild=function(){for(var t=arguments,e=[],i=0;i<arguments.length;i++)e[i]=t[i];if(e.length>1)for(var r=0;r<e.length;r++)this.addChild(e[r]);else{var s=e[0];s.parent&&s.parent.removeChild(s),s.parent=this,this.sortDirty=!0,s.transform._parentID=-1,this.children.push(s),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",s,this,this.children.length-1),s.emit("added",this)}return e[0]},e.prototype.addChildAt=function(t,e){if(e<0||e>this.children.length)throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t},e.prototype.swapChildren=function(t,e){if(t!==e){var i=this.getChildIndex(t),r=this.getChildIndex(e);this.children[i]=e,this.children[r]=t,this.onChildrenChange(i<r?i:r)}},e.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e},e.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error("The index "+e+" supplied is out of bounds "+this.children.length);var i=this.getChildIndex(t);St(this.children,i,1),this.children.splice(e,0,t),this.onChildrenChange(e)},e.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Index ("+t+") does not exist.");return this.children[t]},e.prototype.removeChild=function(){for(var t=arguments,e=[],i=0;i<arguments.length;i++)e[i]=t[i];if(e.length>1)for(var r=0;r<e.length;r++)this.removeChild(e[r]);else{var s=e[0],a=this.children.indexOf(s);if(-1===a)return null;s.parent=null,s.transform._parentID=-1,St(this.children,a,1),this._boundsID++,this.onChildrenChange(a),s.emit("removed",this),this.emit("childRemoved",s,this,a)}return e[0]},e.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,St(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e},e.prototype.removeChildren=function(t,e){void 0===t&&(t=0),void 0===e&&(e=this.children.length);var i,r=t,s=e-r;if(s>0&&s<=e){i=this.children.splice(r,s);for(var a=0;a<i.length;++a)i[a].parent=null,i[a].transform&&(i[a].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(a=0;a<i.length;++a)i[a].emit("removed",this),this.emit("childRemoved",i[a],this,a);return i}if(0===s&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},e.prototype.sortChildren=function(){for(var t=!1,e=0,i=this.children.length;e<i;++e){var r=this.children[e];r._lastSortedIndex=e,t||0===r.zIndex||(t=!0)}t&&this.children.length>1&&this.children.sort(he),this.sortDirty=!1},e.prototype.updateTransform=function(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var t=0,e=this.children.length;t<e;++t){var i=this.children[t];i.visible&&i.updateTransform()}},e.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.visible&&e.renderable)if(e.calculateBounds(),e._mask){var i=e._mask.maskObject||e._mask;i.calculateBounds(),this._bounds.addBoundsMask(e._bounds,i._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID},e.prototype.getLocalBounds=function(e,i){void 0===i&&(i=!1);var r=t.prototype.getLocalBounds.call(this,e);if(!i)for(var s=0,a=this.children.length;s<a;++s){var n=this.children[s];n.visible&&n.updateTransform()}return r},e.prototype._calculateBounds=function(){},e.prototype.render=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters&&this.filters.length)this.renderAdvanced(t);else{this._render(t);for(var e=0,i=this.children.length;e<i;++e)this.children[e].render(t)}},e.prototype.renderAdvanced=function(t){t.batch.flush();var e=this.filters,i=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var r=0;r<e.length;r++)e[r].enabled&&this._enabledFilters.push(e[r]);this._enabledFilters.length&&t.filter.push(this,this._enabledFilters)}i&&t.mask.push(this,this._mask),this._render(t);r=0;for(var s=this.children.length;r<s;r++)this.children[r].render(t);t.batch.flush(),i&&t.mask.pop(this),e&&this._enabledFilters&&this._enabledFilters.length&&t.filter.pop()},e.prototype._render=function(t){},e.prototype.destroy=function(e){t.prototype.destroy.call(this),this.sortDirty=!1;var i="boolean"==typeof e?e:e&&e.children,r=this.removeChildren(0,this.children.length);if(i)for(var s=0;s<r.length;++s)r[s].destroy(e)},Object.defineProperty(e.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t},enumerable:!1,configurable:!0}),e}(ce);ue.prototype.containerUpdateTransform=ue.prototype.updateTransform;var de={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};ce.mixin(de);var pe,fe=function(){function t(t){this._hookDiv=null,(T.tablet||T.phone)&&this.createTouchHook();var e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=2..toString(),this.div=e,this.pool=[],this.renderId=0,this.debug=!1,this.renderer=t,this.children=[],this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._isActive=!1,this._isMobileAccessibility=!1,this.androidUpdateCount=0,this.androidUpdateFrequency=500,window.addEventListener("keydown",this._onKeyDown,!1)}return Object.defineProperty(t.prototype,"isActive",{get:function(){return this._isActive},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isMobileAccessibility",{get:function(){return this._isMobileAccessibility},enumerable:!1,configurable:!0}),t.prototype.createTouchHook=function(){var t=this,e=document.createElement("button");e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.style.zIndex=2..toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessability for this content",e.addEventListener("focus",(function(){t._isMobileAccessibility=!0,t.activate(),t.destroyTouchHook()})),document.body.appendChild(e),this._hookDiv=e},t.prototype.destroyTouchHook=function(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)},t.prototype.activate=function(){this._isActive||(this._isActive=!0,window.document.addEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode&&this.renderer.view.parentNode.appendChild(this.div))},t.prototype.deactivate=function(){this._isActive&&!this._isMobileAccessibility&&(this._isActive=!1,window.document.removeEventListener("mousemove",this._onMouseMove,!0),window.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode&&this.div.parentNode.removeChild(this.div))},t.prototype.updateAccessibleObjects=function(t){if(t.visible&&t.accessibleChildren){t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);for(var e=t.children,i=0;i<e.length;i++)this.updateAccessibleObjects(e[i])}},t.prototype.update=function(){var t=performance.now();if(!(T.android.device&&t<this.androidUpdateCount)&&(this.androidUpdateCount=t+this.androidUpdateFrequency,this.renderer.renderingToScreen)){this.renderer._lastObjectRendered&&this.updateAccessibleObjects(this.renderer._lastObjectRendered);var e=this.renderer.view.getBoundingClientRect(),i=this.renderer.resolution,r=e.width/this.renderer.width*i,s=e.height/this.renderer.height*i,a=this.div;a.style.left=e.left+"px",a.style.top=e.top+"px",a.style.width=this.renderer.width+"px",a.style.height=this.renderer.height+"px";for(var n=0;n<this.children.length;n++){var o=this.children[n];if(o.renderId!==this.renderId)o._accessibleActive=!1,St(this.children,n,1),this.div.removeChild(o._accessibleDiv),this.pool.push(o._accessibleDiv),o._accessibleDiv=null,n--;else{a=o._accessibleDiv;var c=o.hitArea,l=o.worldTransform;o.hitArea?(a.style.left=(l.tx+c.x*l.a)*r+"px",a.style.top=(l.ty+c.y*l.d)*s+"px",a.style.width=c.width*l.a*r+"px",a.style.height=c.height*l.d*s+"px"):(c=o.getBounds(),this.capHitArea(c),a.style.left=c.x*r+"px",a.style.top=c.y*s+"px",a.style.width=c.width*r+"px",a.style.height=c.height*s+"px",a.title!==o.accessibleTitle&&null!==o.accessibleTitle&&(a.title=o.accessibleTitle),a.getAttribute("aria-label")!==o.accessibleHint&&null!==o.accessibleHint&&a.setAttribute("aria-label",o.accessibleHint)),o.accessibleTitle===a.title&&o.tabIndex===a.tabIndex||(a.title=o.accessibleTitle,a.tabIndex=o.tabIndex,this.debug&&this.updateDebugHTML(a))}}this.renderId++}},t.prototype.updateDebugHTML=function(t){t.innerHTML="type: "+t.type+"</br> title : "+t.title+"</br> tabIndex: "+t.tabIndex},t.prototype.capHitArea=function(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0),t.x+t.width>this.renderer.width&&(t.width=this.renderer.width-t.x),t.y+t.height>this.renderer.height&&(t.height=this.renderer.height-t.y)},t.prototype.addChild=function(t){var e=this.pool.pop();e||((e=document.createElement("button")).style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2..toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().indexOf("chrome")>-1?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:t.accessibleHint&&null!==t.accessibleHint||(e.title="displayObject "+t.tabIndex),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex},t.prototype._onClick=function(t){var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"click",e.eventData),e.dispatchEvent(t.target.displayObject,"pointertap",e.eventData),e.dispatchEvent(t.target.displayObject,"tap",e.eventData)},t.prototype._onFocus=function(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive");var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"mouseover",e.eventData)},t.prototype._onFocusOut=function(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite");var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"mouseout",e.eventData)},t.prototype._onKeyDown=function(t){9===t.keyCode&&this.activate()},t.prototype._onMouseMove=function(t){0===t.movementX&&0===t.movementY||this.deactivate()},t.prototype.destroy=function(){this.destroyTouchHook(),this.div=null,window.document.removeEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},t}();D.TARGET_FPMS=.06,function(t){t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY"}(pe||(pe={}));var me=function(){function t(t,e,i,r){void 0===e&&(e=null),void 0===i&&(i=0),void 0===r&&(r=!1),this.fn=t,this.context=e,this.priority=i,this.once=r,this.next=null,this.previous=null,this._destroyed=!1}return t.prototype.match=function(t,e){return void 0===e&&(e=null),this.fn===t&&this.context===e},t.prototype.emit=function(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));var e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e},t.prototype.connect=function(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this},t.prototype.destroy=function(t){void 0===t&&(t=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var e=this.next;return this.next=t?null:e,this.previous=null,e},t}(),ye=function(){function t(){var t=this;this._head=new me(null,null,1/0),this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this.autoStart=!1,this.deltaTime=1,this.deltaMS=1/D.TARGET_FPMS,this.elapsedMS=1/D.TARGET_FPMS,this.lastTime=-1,this.speed=1,this.started=!1,this._protected=!1,this._lastFrame=-1,this._tick=function(e){t._requestId=null,t.started&&(t.update(e),t.started&&null===t._requestId&&t._head.next&&(t._requestId=requestAnimationFrame(t._tick)))}}return t.prototype._requestIfNeeded=function(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},t.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},t.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},t.prototype.add=function(t,e,i){return void 0===i&&(i=pe.NORMAL),this._addListener(new me(t,e,i))},t.prototype.addOnce=function(t,e,i){return void 0===i&&(i=pe.NORMAL),this._addListener(new me(t,e,i,!0))},t.prototype._addListener=function(t){var e=this._head.next,i=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}else t.connect(i);return this._startIfPossible(),this},t.prototype.remove=function(t,e){for(var i=this._head.next;i;)i=i.match(t,e)?i.destroy():i.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(t.prototype,"count",{get:function(){if(!this._head)return 0;for(var t=0,e=this._head;e=e.next;)t++;return t},enumerable:!1,configurable:!0}),t.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},t.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},t.prototype.destroy=function(){if(!this._protected){this.stop();for(var t=this._head.next;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}},t.prototype.update=function(t){var e;if(void 0===t&&(t=performance.now()),t>this.lastTime){if((e=this.elapsedMS=t-this.lastTime)>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){var i=t-this._lastFrame|0;if(i<this._minElapsedMS)return;this._lastFrame=t-i%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*D.TARGET_FPMS;for(var r=this._head,s=r.next;s;)s=s.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t},Object.defineProperty(t.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(t){var e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,D.TARGET_FPMS);this._maxElapsedMS=1/i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(t){if(0===t)this._minElapsedMS=0;else{var e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"shared",{get:function(){if(!t._shared){var e=t._shared=new t;e.autoStart=!0,e._protected=!0}return t._shared},enumerable:!1,configurable:!0}),Object.defineProperty(t,"system",{get:function(){if(!t._system){var e=t._system=new t;e.autoStart=!0,e._protected=!0}return t._system},enumerable:!1,configurable:!0}),t}(),_e=function(){function t(){}return t.init=function(t){var e=this;t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set:function(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,pe.LOW)},get:function(){return this._ticker}}),this.stop=function(){e._ticker.stop()},this.start=function(){e._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?ye.shared:new ye,t.autoStart&&this.start()},t.destroy=function(){if(this._ticker){var t=this._ticker;this.ticker=null,t.destroy()}},t}(),ge=function(){function t(){this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0,this.global=new Xt,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}return Object.defineProperty(t.prototype,"pointerId",{get:function(){return this.identifier},enumerable:!1,configurable:!0}),t.prototype.getLocalPosition=function(t,e,i){return t.worldTransform.applyInverse(i||this.global,e)},t.prototype.copyEvent=function(t){"isPrimary"in t&&t.isPrimary&&(this.isPrimary=!0),this.button="button"in t&&t.button;var e="buttons"in t&&t.buttons;this.buttons=Number.isInteger(e)?e:"which"in t&&t.which,this.width="width"in t&&t.width,this.height="height"in t&&t.height,this.tiltX="tiltX"in t&&t.tiltX,this.tiltY="tiltY"in t&&t.tiltY,this.pointerType="pointerType"in t&&t.pointerType,this.pressure="pressure"in t&&t.pressure,this.rotationAngle="rotationAngle"in t&&t.rotationAngle,this.twist="twist"in t&&t.twist||0,this.tangentialPressure="tangentialPressure"in t&&t.tangentialPressure||0},t.prototype.reset=function(){this.isPrimary=!1},t}(),ve=function(t,e){return ve=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},ve(t,e)};var Se=function(){function t(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}return t.prototype.stopPropagation=function(){this.stopped=!0,this.stopPropagationHint=!0,this.stopsPropagatingAt=this.currentTarget},t.prototype.reset=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.currentTarget=null,this.target=null},t}(),Me=function(){function t(e){this._pointerId=e,this._flags=t.FLAGS.NONE}return t.prototype._doSet=function(t,e){this._flags=e?this._flags|t:this._flags&~t},Object.defineProperty(t.prototype,"pointerId",{get:function(){return this._pointerId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"flags",{get:function(){return this._flags},set:function(t){this._flags=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"none",{get:function(){return this._flags===t.FLAGS.NONE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"over",{get:function(){return 0!=(this._flags&t.FLAGS.OVER)},set:function(e){this._doSet(t.FLAGS.OVER,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightDown",{get:function(){return 0!=(this._flags&t.FLAGS.RIGHT_DOWN)},set:function(e){this._doSet(t.FLAGS.RIGHT_DOWN,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftDown",{get:function(){return 0!=(this._flags&t.FLAGS.LEFT_DOWN)},set:function(e){this._doSet(t.FLAGS.LEFT_DOWN,e)},enumerable:!1,configurable:!0}),t.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4}),t}(),Re=function(){function t(){this._tempPoint=new Xt}return t.prototype.recursiveFindHit=function(t,e,i,r,s){if(!e||!e.visible)return!1;var a=t.data.global,n=!1,o=s=e.interactive||s,c=!0;if(e.hitArea?(r&&(e.worldTransform.applyInverse(a,this._tempPoint),e.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?n=!0:(r=!1,c=!1)),o=!1):e._mask&&r&&(e._mask.containsPoint&&e._mask.containsPoint(a)||(r=!1)),c&&e.interactiveChildren&&e.children)for(var l=e.children,h=l.length-1;h>=0;h--){var u=l[h],d=this.recursiveFindHit(t,u,i,r,o);if(d){if(!u.parent)continue;o=!1,d&&(t.target&&(r=!1),n=!0)}}return s&&(r&&!t.target&&!e.hitArea&&e.containsPoint&&e.containsPoint(a)&&(n=!0),e.interactive&&(n&&!t.target&&(t.target=e),i&&i(t,e,!!n))),n},t.prototype.findHit=function(t,e,i,r){this.recursiveFindHit(t,e,i,r,!1)},t}(),be={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return"pointer"===this.cursor},set buttonMode(t){t?this.cursor="pointer":"pointer"===this.cursor&&(this.cursor=null)},cursor:null,get trackedPointers(){return void 0===this._trackedPointers&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0};ce.mixin(be);var Ee={target:null,data:{global:null}},Ie=function(t){function e(e,i){var r=t.call(this)||this;return i=i||{},r.renderer=e,r.autoPreventDefault=void 0===i.autoPreventDefault||i.autoPreventDefault,r.interactionFrequency=i.interactionFrequency||10,r.mouse=new ge,r.mouse.identifier=1,r.mouse.global.set(-999999),r.activeInteractionData={},r.activeInteractionData[1]=r.mouse,r.interactionDataPool=[],r.eventData=new Se,r.interactionDOMElement=null,r.moveWhenInside=!1,r.eventsAdded=!1,r.tickerAdded=!1,r.mouseOverRenderer=!1,r.supportsTouchEvents="ontouchstart"in window,r.supportsPointerEvents=!!window.PointerEvent,r.onPointerUp=r.onPointerUp.bind(r),r.processPointerUp=r.processPointerUp.bind(r),r.onPointerCancel=r.onPointerCancel.bind(r),r.processPointerCancel=r.processPointerCancel.bind(r),r.onPointerDown=r.onPointerDown.bind(r),r.processPointerDown=r.processPointerDown.bind(r),r.onPointerMove=r.onPointerMove.bind(r),r.processPointerMove=r.processPointerMove.bind(r),r.onPointerOut=r.onPointerOut.bind(r),r.processPointerOverOut=r.processPointerOverOut.bind(r),r.onPointerOver=r.onPointerOver.bind(r),r.cursorStyles={default:"inherit",pointer:"pointer"},r.currentCursorMode=null,r.cursor=null,r.resolution=1,r.delayedEvents=[],r.search=new Re,r._tempDisplayObject=new le,r._useSystemTicker=void 0===i.useSystemTicker||i.useSystemTicker,r.setTargetElement(r.renderer.view,r.renderer.resolution),r}return function(t,e){function i(){this.constructor=t}ve(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),Object.defineProperty(e.prototype,"useSystemTicker",{get:function(){return this._useSystemTicker},set:function(t){this._useSystemTicker=t,t?this.addTickerListener():this.removeTickerListener()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastObjectRendered",{get:function(){return this.renderer._lastObjectRendered||this._tempDisplayObject},enumerable:!1,configurable:!0}),e.prototype.hitTest=function(t,e){return Ee.target=null,Ee.data.global=t,e||(e=this.lastObjectRendered),this.processInteractive(Ee,e,null,!0),Ee.target},e.prototype.setTargetElement=function(t,e){void 0===e&&(e=1),this.removeTickerListener(),this.removeEvents(),this.interactionDOMElement=t,this.resolution=e,this.addEvents(),this.addTickerListener()},e.prototype.addTickerListener=function(){!this.tickerAdded&&this.interactionDOMElement&&this._useSystemTicker&&(ye.system.add(this.tickerUpdate,this,pe.INTERACTION),this.tickerAdded=!0)},e.prototype.removeTickerListener=function(){this.tickerAdded&&(ye.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)},e.prototype.addEvents=function(){if(!this.eventsAdded&&this.interactionDOMElement){var t=this.interactionDOMElement.style;window.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none"),this.supportsPointerEvents?(window.document.addEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,!0),window.addEventListener("pointercancel",this.onPointerCancel,!0),window.addEventListener("pointerup",this.onPointerUp,!0)):(window.document.addEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,!0),window.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,!0)),this.eventsAdded=!0}},e.prototype.removeEvents=function(){if(this.eventsAdded&&this.interactionDOMElement){var t=this.interactionDOMElement.style;window.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(window.document.removeEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,!0),window.removeEventListener("pointercancel",this.onPointerCancel,!0),window.removeEventListener("pointerup",this.onPointerUp,!0)):(window.document.removeEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,!0),window.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.interactionDOMElement=null,this.eventsAdded=!1}},e.prototype.tickerUpdate=function(t){this._deltaTime+=t,this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this.update())},e.prototype.update=function(){if(this.interactionDOMElement)if(this._didMove)this._didMove=!1;else{for(var t in this.cursor=null,this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(t)){var e=this.activeInteractionData[t];if(e.originalEvent&&"touch"!==e.pointerType){var i=this.configureInteractionEventForDOMEvent(this.eventData,e.originalEvent,e);this.processInteractive(i,this.lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},e.prototype.setCursorMode=function(t){if(t=t||"default",this.currentCursorMode!==t){this.currentCursorMode=t;var e=this.cursorStyles[t];if(e)switch(typeof e){case"string":this.interactionDOMElement.style.cursor=e;break;case"function":e(t);break;case"object":Object.assign(this.interactionDOMElement.style,e)}else"string"!=typeof t||Object.prototype.hasOwnProperty.call(this.cursorStyles,t)||(this.interactionDOMElement.style.cursor=t)}},e.prototype.dispatchEvent=function(t,e,i){i.stopPropagationHint&&t!==i.stopsPropagatingAt||(i.currentTarget=t,i.type=e,t.emit(e,i),t[e]&&t[e](i))},e.prototype.delayDispatchEvent=function(t,e,i){this.delayedEvents.push({displayObject:t,eventString:e,eventData:i})},e.prototype.mapPositionToPoint=function(t,e,i){var r;r=this.interactionDOMElement.parentElement?this.interactionDOMElement.getBoundingClientRect():{x:0,y:0,width:0,height:0};var s=1/this.resolution;t.x=(e-r.left)*(this.interactionDOMElement.width/r.width)*s,t.y=(i-r.top)*(this.interactionDOMElement.height/r.height)*s},e.prototype.processInteractive=function(t,e,i,r){var s=this.search.findHit(t,e,i,r),a=this.delayedEvents;if(!a.length)return s;t.stopPropagationHint=!1;var n=a.length;this.delayedEvents=[];for(var o=0;o<n;o++){var c=a[o],l=c.displayObject,h=c.eventString,u=c.eventData;u.stopsPropagatingAt===l&&(u.stopPropagationHint=!0),this.dispatchEvent(l,h,u)}return s},e.prototype.onPointerDown=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);if(this.autoPreventDefault&&e[0].isNormalized)(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(var i=e.length,r=0;r<i;r++){var s=e[r],a=this.getInteractionDataForPointerId(s),n=this.configureInteractionEventForDOMEvent(this.eventData,s,a);if(n.data.originalEvent=t,this.processInteractive(n,this.lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",n),"touch"===s.pointerType)this.emit("touchstart",n);else if("mouse"===s.pointerType||"pen"===s.pointerType){var o=2===s.button;this.emit(o?"rightdown":"mousedown",this.eventData)}}}},e.prototype.processPointerDown=function(t,e,i){var r=t.data,s=t.data.identifier;if(i)if(e.trackedPointers[s]||(e.trackedPointers[s]=new Me(s)),this.dispatchEvent(e,"pointerdown",t),"touch"===r.pointerType)this.dispatchEvent(e,"touchstart",t);else if("mouse"===r.pointerType||"pen"===r.pointerType){var a=2===r.button;a?e.trackedPointers[s].rightDown=!0:e.trackedPointers[s].leftDown=!0,this.dispatchEvent(e,a?"rightdown":"mousedown",t)}},e.prototype.onPointerComplete=function(t,e,i){for(var r=this.normalizeToPointerData(t),s=r.length,a=t.target!==this.interactionDOMElement?"outside":"",n=0;n<s;n++){var o=r[n],c=this.getInteractionDataForPointerId(o),l=this.configureInteractionEventForDOMEvent(this.eventData,o,c);if(l.data.originalEvent=t,this.processInteractive(l,this.lastObjectRendered,i,e||!a),this.emit(e?"pointercancel":"pointerup"+a,l),"mouse"===o.pointerType||"pen"===o.pointerType){var h=2===o.button;this.emit(h?"rightup"+a:"mouseup"+a,l)}else"touch"===o.pointerType&&(this.emit(e?"touchcancel":"touchend"+a,l),this.releaseInteractionDataForPointerId(o.pointerId))}},e.prototype.onPointerCancel=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!0,this.processPointerCancel)},e.prototype.processPointerCancel=function(t,e){var i=t.data,r=t.data.identifier;void 0!==e.trackedPointers[r]&&(delete e.trackedPointers[r],this.dispatchEvent(e,"pointercancel",t),"touch"===i.pointerType&&this.dispatchEvent(e,"touchcancel",t))},e.prototype.onPointerUp=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!1,this.processPointerUp)},e.prototype.processPointerUp=function(t,e,i){var r=t.data,s=t.data.identifier,a=e.trackedPointers[s],n="touch"===r.pointerType,o="mouse"===r.pointerType||"pen"===r.pointerType,c=!1;if(o){var l=2===r.button,h=Me.FLAGS,u=l?h.RIGHT_DOWN:h.LEFT_DOWN,d=void 0!==a&&a.flags&u;i?(this.dispatchEvent(e,l?"rightup":"mouseup",t),d&&(this.dispatchEvent(e,l?"rightclick":"click",t),c=!0)):d&&this.dispatchEvent(e,l?"rightupoutside":"mouseupoutside",t),a&&(l?a.rightDown=!1:a.leftDown=!1)}i?(this.dispatchEvent(e,"pointerup",t),n&&this.dispatchEvent(e,"touchend",t),a&&(o&&!c||this.dispatchEvent(e,"pointertap",t),n&&(this.dispatchEvent(e,"tap",t),a.over=!1))):a&&(this.dispatchEvent(e,"pointerupoutside",t),n&&this.dispatchEvent(e,"touchendoutside",t)),a&&a.none&&delete e.trackedPointers[s]},e.prototype.onPointerMove=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);"mouse"!==e[0].pointerType&&"pen"!==e[0].pointerType||(this._didMove=!0,this.cursor=null);for(var i=e.length,r=0;r<i;r++){var s=e[r],a=this.getInteractionDataForPointerId(s),n=this.configureInteractionEventForDOMEvent(this.eventData,s,a);n.data.originalEvent=t,this.processInteractive(n,this.lastObjectRendered,this.processPointerMove,!0),this.emit("pointermove",n),"touch"===s.pointerType&&this.emit("touchmove",n),"mouse"!==s.pointerType&&"pen"!==s.pointerType||this.emit("mousemove",n)}"mouse"===e[0].pointerType&&this.setCursorMode(this.cursor)}},e.prototype.processPointerMove=function(t,e,i){var r=t.data,s="touch"===r.pointerType,a="mouse"===r.pointerType||"pen"===r.pointerType;a&&this.processPointerOverOut(t,e,i),this.moveWhenInside&&!i||(this.dispatchEvent(e,"pointermove",t),s&&this.dispatchEvent(e,"touchmove",t),a&&this.dispatchEvent(e,"mousemove",t))},e.prototype.onPointerOut=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t)[0];"mouse"===e.pointerType&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var i=this.getInteractionDataForPointerId(e),r=this.configureInteractionEventForDOMEvent(this.eventData,e,i);r.data.originalEvent=e,this.processInteractive(r,this.lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",r),"mouse"===e.pointerType||"pen"===e.pointerType?this.emit("mouseout",r):this.releaseInteractionDataForPointerId(i.identifier)}},e.prototype.processPointerOverOut=function(t,e,i){var r=t.data,s=t.data.identifier,a="mouse"===r.pointerType||"pen"===r.pointerType,n=e.trackedPointers[s];i&&!n&&(n=e.trackedPointers[s]=new Me(s)),void 0!==n&&(i&&this.mouseOverRenderer?(n.over||(n.over=!0,this.delayDispatchEvent(e,"pointerover",t),a&&this.delayDispatchEvent(e,"mouseover",t)),a&&null===this.cursor&&(this.cursor=e.cursor)):n.over&&(n.over=!1,this.dispatchEvent(e,"pointerout",this.eventData),a&&this.dispatchEvent(e,"mouseout",t),n.none&&delete e.trackedPointers[s]))},e.prototype.onPointerOver=function(t){var e=this.normalizeToPointerData(t)[0],i=this.getInteractionDataForPointerId(e),r=this.configureInteractionEventForDOMEvent(this.eventData,e,i);r.data.originalEvent=e,"mouse"===e.pointerType&&(this.mouseOverRenderer=!0),this.emit("pointerover",r),"mouse"!==e.pointerType&&"pen"!==e.pointerType||this.emit("mouseover",r)},e.prototype.getInteractionDataForPointerId=function(t){var e,i=t.pointerId;return 1===i||"mouse"===t.pointerType?e=this.mouse:this.activeInteractionData[i]?e=this.activeInteractionData[i]:((e=this.interactionDataPool.pop()||new ge).identifier=i,this.activeInteractionData[i]=e),e.copyEvent(t),e},e.prototype.releaseInteractionDataForPointerId=function(t){var e=this.activeInteractionData[t];e&&(delete this.activeInteractionData[t],e.reset(),this.interactionDataPool.push(e))},e.prototype.configureInteractionEventForDOMEvent=function(t,e,i){return t.data=i,this.mapPositionToPoint(i.global,e.clientX,e.clientY),"touch"===e.pointerType&&(e.globalX=i.global.x,e.globalY=i.global.y),i.originalEvent=e,t.reset(),t},e.prototype.normalizeToPointerData=function(t){var e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(var i=0,r=t.changedTouches.length;i<r;i++){var s=t.changedTouches[i];void 0===s.button&&(s.button=t.touches.length?1:0),void 0===s.buttons&&(s.buttons=t.touches.length?1:0),void 0===s.isPrimary&&(s.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===s.width&&(s.width=s.radiusX||1),void 0===s.height&&(s.height=s.radiusY||1),void 0===s.tiltX&&(s.tiltX=0),void 0===s.tiltY&&(s.tiltY=0),void 0===s.pointerType&&(s.pointerType="touch"),void 0===s.pointerId&&(s.pointerId=s.identifier||0),void 0===s.pressure&&(s.pressure=s.force||.5),void 0===s.twist&&(s.twist=0),void 0===s.tangentialPressure&&(s.tangentialPressure=0),void 0===s.layerX&&(s.layerX=s.offsetX=s.clientX),void 0===s.layerY&&(s.layerY=s.offsetY=s.clientY),s.isNormalized=!0,e.push(s)}else if(!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof window.PointerEvent)e.push(t);else{var a=t;void 0===a.isPrimary&&(a.isPrimary=!0),void 0===a.width&&(a.width=1),void 0===a.height&&(a.height=1),void 0===a.tiltX&&(a.tiltX=0),void 0===a.tiltY&&(a.tiltY=0),void 0===a.pointerType&&(a.pointerType="mouse"),void 0===a.pointerId&&(a.pointerId=1),void 0===a.pressure&&(a.pressure=.5),void 0===a.twist&&(a.twist=0),void 0===a.tangentialPressure&&(a.tangentialPressure=0),a.isNormalized=!0,e.push(a)}return e},e.prototype.destroy=function(){this.removeEvents(),this.removeTickerListener(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this.search=null},e}(A()),xe=function(){function t(t){this.items=[],this._name=t,this._aliasCount=0}return t.prototype.emit=function(t,e,i,r,s,a,n,o){if(arguments.length>8)throw new Error("max arguments reached");var c=this,l=c.name,h=c.items;this._aliasCount++;for(var u=0,d=h.length;u<d;u++)h[u][l](t,e,i,r,s,a,n,o);return h===this.items&&this._aliasCount--,this},t.prototype.ensureNonAliasedItems=function(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))},t.prototype.add=function(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this},t.prototype.remove=function(t){var e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this},t.prototype.contains=function(t){return-1!==this.items.indexOf(t)},t.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},t.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.items.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),t}();Object.defineProperties(xe.prototype,{dispatch:{value:xe.prototype.emit},run:{value:xe.prototype.emit}}),D.PREFER_ENV=T.any?B.WEBGL:B.WEBGL2,D.STRICT_TEXTURE_CACHE=!1;var we=[];function Te(t,e){if(!t)return null;var i="";if("string"==typeof t){var r=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);r&&(i=r[1].toLowerCase())}for(var s=we.length-1;s>=0;--s){var a=we[s];if(a.test&&a.test(t,i))return new a(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}var De=function(t,e){return De=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},De(t,e)};function Pe(t,e){function i(){this.constructor=t}De(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var Ae=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new xe("setRealSize"),this.onUpdate=new xe("update"),this.onError=new xe("onError")}return t.prototype.bind=function(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)},t.prototype.unbind=function(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)},t.prototype.resize=function(t,e){t===this._width&&e===this._height||(this._width=t,this._height=e,this.onResize.emit(t,e))},Object.defineProperty(t.prototype,"valid",{get:function(){return!!this._width&&!!this._height},enumerable:!1,configurable:!0}),t.prototype.update=function(){this.destroyed||this.onUpdate.emit()},t.prototype.load=function(){return Promise.resolve(this)},Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),t.prototype.style=function(t,e,i){return!1},t.prototype.dispose=function(){},t.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},t.test=function(t,e){return!1},t}(),ke=function(t){function e(e,i){var r=this,s=i||{},a=s.width,n=s.height;if(!a||!n)throw new Error("BufferResource width or height invalid");return(r=t.call(this,a,n)||this).data=e,r}return Pe(e,t),e.prototype.upload=function(t,e,i){var r=t.gl;return r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===z.UNPACK),i.width===e.width&&i.height===e.height?r.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.type,this.data):(i.width=e.width,i.height=e.height,r.texImage2D(e.target,0,i.internalFormat,e.width,e.height,0,e.format,i.type,this.data)),!0},e.prototype.dispose=function(){this.data=null},e.test=function(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array},e}(Ae),Ce={scaleMode:W.NEAREST,format:U.RGBA,alphaMode:z.NPM},Le=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null);var r=t.call(this)||this,s=(i=i||{}).alphaMode,a=i.mipmap,n=i.anisotropicLevel,o=i.scaleMode,c=i.width,l=i.height,h=i.wrapMode,u=i.format,d=i.type,p=i.target,f=i.resolution,m=i.resourceOptions;return!e||e instanceof Ae||((e=Te(e,m)).internal=!0),r.width=c||0,r.height=l||0,r.resolution=f||D.RESOLUTION,r.mipmap=void 0!==a?a:D.MIPMAP_TEXTURES,r.anisotropicLevel=void 0!==n?n:D.ANISOTROPIC_LEVEL,r.wrapMode=h||D.WRAP_MODE,r.scaleMode=void 0!==o?o:D.SCALE_MODE,r.format=u||U.RGBA,r.type=d||H.UNSIGNED_BYTE,r.target=p||V.TEXTURE_2D,r.alphaMode=void 0!==s?s:z.UNPACK,void 0!==i.premultiplyAlpha&&(r.premultiplyAlpha=i.premultiplyAlpha),r.uid=bt(),r.touched=0,r.isPowerOfTwo=!1,r._refreshPOT(),r._glTextures={},r.dirtyId=0,r.dirtyStyleId=0,r.cacheId=null,r.valid=c>0&&l>0,r.textureCacheIds=[],r.destroyed=!1,r.resource=null,r._batchEnabled=0,r._batchLocation=0,r.parentTextureArray=null,r.setResource(e),r}return Pe(e,t),Object.defineProperty(e.prototype,"realWidth",{get:function(){return Math.ceil(this.width*this.resolution-1e-4)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"realHeight",{get:function(){return Math.ceil(this.height*this.resolution-1e-4)},enumerable:!1,configurable:!0}),e.prototype.setStyle=function(t,e){var i;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,i=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,i=!0),i&&this.dirtyStyleId++,this},e.prototype.setSize=function(t,e,i){return this.resolution=i||this.resolution,this.width=t,this.height=e,this._refreshPOT(),this.update(),this},e.prototype.setRealSize=function(t,e,i){return this.resolution=i||this.resolution,this.width=t/this.resolution,this.height=e/this.resolution,this._refreshPOT(),this.update(),this},e.prototype._refreshPOT=function(){this.isPowerOfTwo=gt(this.realWidth)&&gt(this.realHeight)},e.prototype.setResolution=function(t){var e=this.resolution;return e===t||(this.resolution=t,this.valid&&(this.width=this.width*e/t,this.height=this.height*e/t,this.emit("update",this)),this._refreshPOT()),this},e.prototype.setResource=function(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this},e.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},e.prototype.onError=function(t){this.emit("error",this,t)},e.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Tt[this.cacheId],delete wt[this.cacheId],this.cacheId=null),this.dispose(),e.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},e.prototype.dispose=function(){this.emit("dispose",this)},e.prototype.castToBaseTexture=function(){return this},e.from=function(t,i,r){void 0===r&&(r=D.STRICT_TEXTURE_CACHE);var s="string"==typeof t,a=null;s?a=t:(t._pixiId||(t._pixiId="pixiid_"+bt()),a=t._pixiId);var n=Tt[a];if(s&&r&&!n)throw new Error('The cacheId "'+a+'" does not exist in BaseTextureCache.');return n||((n=new e(t,i)).cacheId=a,e.addToCache(n,a)),n},e.fromBuffer=function(t,i,r,s){t=t||new Float32Array(i*r*4);var a=new ke(t,{width:i,height:r}),n=t instanceof Float32Array?H.FLOAT:H.UNSIGNED_BYTE;return new e(a,Object.assign(Ce,s||{width:i,height:r,type:n}))},e.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),Tt[e]&&console.warn("BaseTexture added to the cache with an id ["+e+"] that already had an entry"),Tt[e]=t)},e.removeFromCache=function(t){if("string"==typeof t){var e=Tt[t];if(e){var i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete Tt[t],e}}else if(t&&t.textureCacheIds){for(var r=0;r<t.textureCacheIds.length;++r)delete Tt[t.textureCacheIds[r]];return t.textureCacheIds.length=0,t}return null},e._globalBatch=0,e}(A()),Be=function(t){function e(e,i){var r=this,s=i||{},a=s.width,n=s.height;(r=t.call(this,a,n)||this).items=[],r.itemDirtyIds=[];for(var o=0;o<e;o++){var c=new Le;r.items.push(c),r.itemDirtyIds.push(-2)}return r.length=e,r._load=null,r.baseTexture=null,r}return Pe(e,t),e.prototype.initFromArray=function(t,e){for(var i=0;i<this.length;i++)t[i]&&(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):t[i]instanceof Ae?this.addResourceAt(t[i],i):this.addResourceAt(Te(t[i],e),i))},e.prototype.dispose=function(){for(var t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},e.prototype.addResourceAt=function(t,e){if(!this.items[e])throw new Error("Index "+e+" is out of bounds");return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this},e.prototype.bind=function(e){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");t.prototype.bind.call(this,e);for(var i=0;i<this.length;i++)this.items[i].parentTextureArray=e,this.items[i].on("update",e.update,e)},e.prototype.unbind=function(e){t.prototype.unbind.call(this,e);for(var i=0;i<this.length;i++)this.items[i].parentTextureArray=null,this.items[i].off("update",e.update,e)},e.prototype.load=function(){var t=this;if(this._load)return this._load;var e=this.items.map((function(t){return t.resource})).filter((function(t){return t})).map((function(t){return t.load()}));return this._load=Promise.all(e).then((function(){var e=t.items[0],i=e.realWidth,r=e.realHeight;return t.resize(i,r),Promise.resolve(t)})),this._load},e}(Ae),Fe=function(t){function e(e,i){var r,s,a=this,n=i||{},o=n.width,c=n.height;return Array.isArray(e)?(r=e,s=e.length):s=e,a=t.call(this,s,{width:o,height:c})||this,r&&a.initFromArray(r,i),a}return Pe(e,t),e.prototype.addBaseTextureAt=function(t,e){if(!t.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(t.resource,e),this},e.prototype.bind=function(e){t.prototype.bind.call(this,e),e.target=V.TEXTURE_2D_ARRAY},e.prototype.upload=function(t,e,i){var r=this,s=r.length,a=r.itemDirtyIds,n=r.items,o=t.gl;i.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,e.format,this._width,this._height,s,0,e.format,e.type,null);for(var c=0;c<s;c++){var l=n[c];a[c]<l.dirtyId&&(a[c]=l.dirtyId,l.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,c,l.resource.width,l.resource.height,1,e.format,e.type,l.resource.source))}return!0},e}(Be),Oe=function(t){function e(e){var i=this,r=e,s=r.naturalWidth||r.videoWidth||r.width,a=r.naturalHeight||r.videoHeight||r.height;return(i=t.call(this,s,a)||this).source=e,i.noSubImage=!1,i}return Pe(e,t),e.crossOrigin=function(t,e,i){void 0===i&&0!==e.indexOf("data:")?t.crossOrigin=Ft(e):!1!==i&&(t.crossOrigin="string"==typeof i?i:"anonymous")},e.prototype.upload=function(t,e,i,r){var s=t.gl,a=e.realWidth,n=e.realHeight;return r=r||this.source,s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===z.UNPACK),this.noSubImage||e.target!==s.TEXTURE_2D||i.width!==a||i.height!==n?(i.width=a,i.height=n,s.texImage2D(e.target,0,e.format,e.format,e.type,r)):s.texSubImage2D(s.TEXTURE_2D,0,0,0,e.format,e.type,r),!0},e.prototype.update=function(){if(!this.destroyed){var e=this.source,i=e.naturalWidth||e.videoWidth||e.width,r=e.naturalHeight||e.videoHeight||e.height;this.resize(i,r),t.prototype.update.call(this)}},e.prototype.dispose=function(){this.source=null},e}(Ae),Ne=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Pe(e,t),e.test=function(t){var e=window.OffscreenCanvas;return!!(e&&t instanceof e)||t instanceof HTMLCanvasElement},e}(Oe),je=function(t){function e(i,r){var s=this,a=r||{},n=a.width,o=a.height,c=a.autoLoad,l=a.linkBaseTexture;if(i&&i.length!==e.SIDES)throw new Error("Invalid length. Got "+i.length+", expected 6");s=t.call(this,6,{width:n,height:o})||this;for(var h=0;h<e.SIDES;h++)s.items[h].target=V.TEXTURE_CUBE_MAP_POSITIVE_X+h;return s.linkBaseTexture=!1!==l,i&&s.initFromArray(i,r),!1!==c&&s.load(),s}return Pe(e,t),e.prototype.bind=function(e){t.prototype.bind.call(this,e),e.target=V.TEXTURE_CUBE_MAP},e.prototype.addBaseTextureAt=function(t,e,i){if(void 0===i&&(i=this.linkBaseTexture),!this.items[e])throw new Error("Index "+e+" is out of bounds");if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0){if(!t.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(t.resource,e)}else t.target=V.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this},e.prototype.upload=function(t,i,r){for(var s=this.itemDirtyIds,a=0;a<e.SIDES;a++){var n=this.items[a];s[a]<n.dirtyId&&(n.valid&&n.resource?(n.resource.upload(t,n,r),s[a]=n.dirtyId):s[a]<-1&&(t.gl.texImage2D(n.target,0,r.internalFormat,i.realWidth,i.realHeight,0,i.format,r.type,null),s[a]=-1))}return!0},e.test=function(t){return Array.isArray(t)&&t.length===e.SIDES},e.SIDES=6,e}(Be),Ue=function(t){function e(e,i){var r=this;if(i=i||{},!(e instanceof HTMLImageElement)){var s=new Image;Oe.crossOrigin(s,e,i.crossorigin),s.src=e,e=s}return r=t.call(this,e)||this,!e.complete&&r._width&&r._height&&(r._width=0,r._height=0),r.url=e.src,r._process=null,r.preserveBitmap=!1,r.createBitmap=(void 0!==i.createBitmap?i.createBitmap:D.CREATE_IMAGE_BITMAP)&&!!window.createImageBitmap,r.alphaMode="number"==typeof i.alphaMode?i.alphaMode:null,void 0!==i.premultiplyAlpha&&(r.premultiplyAlpha=i.premultiplyAlpha),r.bitmap=null,r._load=null,!1!==i.autoLoad&&r.load(),r}return Pe(e,t),e.prototype.load=function(t){var e=this;return this._load||(void 0!==t&&(this.createBitmap=t),this._load=new Promise((function(t,i){var r=e.source;e.url=r.src;var s=function(){e.destroyed||(r.onload=null,r.onerror=null,e.resize(r.width,r.height),e._load=null,e.createBitmap?t(e.process()):t(e))};r.complete&&r.src?s():(r.onload=s,r.onerror=function(t){i(t),e.onError.emit(t)})}))),this._load},e.prototype.process=function(){var t=this,e=this.source;return null!==this._process?this._process:null===this.bitmap&&window.createImageBitmap?(this._process=window.createImageBitmap(e,0,0,e.width,e.height,{premultiplyAlpha:this.alphaMode===z.UNPACK?"premultiply":"none"}).then((function(e){return t.destroyed?Promise.reject():(t.bitmap=e,t.update(),t._process=null,Promise.resolve(t))})),this._process):Promise.resolve(this)},e.prototype.upload=function(e,i,r){if("number"==typeof this.alphaMode&&(i.alphaMode=this.alphaMode),!this.createBitmap)return t.prototype.upload.call(this,e,i,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(t.prototype.upload.call(this,e,i,r,this.bitmap),!this.preserveBitmap){var s=!0,a=i._glTextures;for(var n in a){var o=a[n];if(o!==r&&o.dirtyId!==i.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},e.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,t.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},e.test=function(t){return"string"==typeof t||t instanceof HTMLImageElement},e}(Oe),Ve=function(t){function e(e,i){var r=this;return i=i||{},(r=t.call(this,document.createElement("canvas"))||this)._width=0,r._height=0,r.svg=e,r.scale=i.scale||1,r._overrideWidth=i.width,r._overrideHeight=i.height,r._resolve=null,r._crossorigin=i.crossorigin,r._load=null,!1!==i.autoLoad&&r.load(),r}return Pe(e,t),e.prototype.load=function(){var t=this;return this._load||(this._load=new Promise((function(e){if(t._resolve=function(){t.resize(t.source.width,t.source.height),e(t)},/^\<svg/.test(t.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");t.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t.svg)))}t._loadSvg()}))),this._load},e.prototype._loadSvg=function(){var t=this,e=new Image;Oe.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=function(i){t._resolve&&(e.onerror=null,t.onError.emit(i))},e.onload=function(){if(t._resolve){var i=e.width,r=e.height;if(!i||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var s=i*t.scale,a=r*t.scale;(t._overrideWidth||t._overrideHeight)&&(s=t._overrideWidth||t._overrideHeight/r*i,a=t._overrideHeight||t._overrideWidth/i*r),s=Math.round(s),a=Math.round(a);var n=t.source;n.width=s,n.height=a,n._pixiId="canvas_"+bt(),n.getContext("2d").drawImage(e,0,0,i,r,0,0,s,a),t._resolve(),t._resolve=null}}},e.getSize=function(t){var i=e.SVG_SIZE.exec(t),r={};return i&&(r[i[1]]=Math.round(parseFloat(i[3])),r[i[5]]=Math.round(parseFloat(i[7]))),r},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},e.test=function(t,e){return"svg"===e||"string"==typeof t&&/^data:image\/svg\+xml(;(charset=utf8|utf8))?;base64/.test(t)||"string"==typeof t&&0===t.indexOf("<svg")},e.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,e}(Oe),He=function(t){function e(i,r){var s=this;if(r=r||{},!(i instanceof HTMLVideoElement)){var a=document.createElement("video");a.setAttribute("preload","auto"),a.setAttribute("webkit-playsinline",""),a.setAttribute("playsinline",""),"string"==typeof i&&(i=[i]);var n=i[0].src||i[0];Oe.crossOrigin(a,n,r.crossorigin);for(var o=0;o<i.length;++o){var c=document.createElement("source"),l=i[o],h=l.src,u=l.mime,d=(h=h||i[o]).split("?").shift().toLowerCase(),p=d.substr(d.lastIndexOf(".")+1);u=u||e.MIME_TYPES[p]||"video/"+p,c.src=h,c.type=u,a.appendChild(c)}i=a}return(s=t.call(this,i)||this).noSubImage=!0,s._autoUpdate=!0,s._isConnectedToTicker=!1,s._updateFPS=r.updateFPS||0,s._msToNextUpdate=0,s.autoPlay=!1!==r.autoPlay,s._load=null,s._resolve=null,s._onCanPlay=s._onCanPlay.bind(s),s._onError=s._onError.bind(s),!1!==r.autoLoad&&s.load(),s}return Pe(e,t),e.prototype.update=function(e){if(void 0===e&&(e=0),!this.destroyed){var i=ye.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-i),(!this._updateFPS||this._msToNextUpdate<=0)&&(t.prototype.update.call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},e.prototype.load=function(){var t=this;if(this._load)return this._load;var e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart.bind(this)),e.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise((function(i){t.valid?i(t):(t._resolve=i,e.load())})),this._load},e.prototype._onError=function(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)},e.prototype._isSourcePlaying=function(){var t=this.source;return t.currentTime>0&&!1===t.paused&&!1===t.ended&&t.readyState>2},e.prototype._isSourceReady=function(){var t=this.source;return 3===t.readyState||4===t.readyState},e.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(ye.shared.add(this.update,this),this._isConnectedToTicker=!0)},e.prototype._onPlayStop=function(){this._isConnectedToTicker&&(ye.shared.remove(this.update,this),this._isConnectedToTicker=!1)},e.prototype._onCanPlay=function(){var t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);var e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()},e.prototype.dispose=function(){this._isConnectedToTicker&&ye.shared.remove(this.update,this);var e=this.source;e&&(e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),t.prototype.dispose.call(this)},Object.defineProperty(e.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(ye.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(ye.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updateFPS",{get:function(){return this._updateFPS},set:function(t){t!==this._updateFPS&&(this._updateFPS=t)},enumerable:!1,configurable:!0}),e.test=function(t,i){return t instanceof HTMLVideoElement||e.TYPES.indexOf(i)>-1},e.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],e.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},e}(Oe),We=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Pe(e,t),e.test=function(t){return!!window.createImageBitmap&&t instanceof ImageBitmap},e}(Oe);we.push(Ue,We,Ne,He,Ve,ke,je,Fe);var qe={Resource:Ae,BaseImageResource:Oe,INSTALLED:we,autoDetectResource:Te,AbstractMultiResource:Be,ArrayResource:Fe,BufferResource:ke,CanvasResource:Ne,CubeResource:je,ImageResource:Ue,SVGResource:Ve,VideoResource:He,ImageBitmapResource:We},Ge=function(){function t(t){this.renderer=t}return t.prototype.destroy=function(){this.renderer=null},t}(),ze=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Pe(e,t),e.prototype.upload=function(t,e,i){var r=t.gl;return r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===z.UNPACK),i.width===e.width&&i.height===e.height?r.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.type,this.data):(i.width=e.width,i.height=e.height,r.texImage2D(e.target,0,1===t.context.webGLVersion?r.DEPTH_COMPONENT:r.DEPTH_COMPONENT16,e.width,e.height,0,e.format,e.type,this.data)),!0},e}(ke),Xe=function(){function t(t,e){this.width=Math.ceil(t||100),this.height=Math.ceil(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new xe("disposeFramebuffer"),this.multisample=Q.NONE}return Object.defineProperty(t.prototype,"colorTexture",{get:function(){return this.colorTextures[0]},enumerable:!1,configurable:!0}),t.prototype.addColorTexture=function(t,e){return void 0===t&&(t=0),this.colorTextures[t]=e||new Le(null,{scaleMode:W.NEAREST,resolution:1,mipmap:G.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},t.prototype.addDepthTexture=function(t){return this.depthTexture=t||new Le(new ze(null,{width:this.width,height:this.height}),{scaleMode:W.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:G.OFF,format:U.DEPTH_COMPONENT,type:H.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},t.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},t.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},t.prototype.resize=function(t,e){if(t=Math.ceil(t),e=Math.ceil(e),t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(var i=0;i<this.colorTextures.length;i++){var r=this.colorTextures[i],s=r.resolution;r.setSize(t/s,e/s)}if(this.depthTexture){s=this.depthTexture.resolution;this.depthTexture.setSize(t/s,e/s)}}},t.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},t.prototype.destroyDepthTexture=function(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)},t}(),Ye=function(t){function e(e){var i=this;if("number"==typeof e){var r=arguments[0],s=arguments[1],a=arguments[2],n=arguments[3];e={width:r,height:s,scaleMode:a,resolution:n}}i=t.call(this,null,e)||this;var o=e||{},c=o.width,l=o.height;return i.mipmap=0,i.width=Math.ceil(c)||100,i.height=Math.ceil(l)||100,i.valid=!0,i.clearColor=[0,0,0,0],i.framebuffer=new Xe(i.width*i.resolution,i.height*i.resolution).addColorTexture(0,i),i.maskStack=[],i.filterStack=[{}],i}return Pe(e,t),e.prototype.resize=function(t,e){t=Math.ceil(t),e=Math.ceil(e),this.framebuffer.resize(t*this.resolution,e*this.resolution)},e.prototype.dispose=function(){this.framebuffer.dispose(),t.prototype.dispose.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.framebuffer.destroyDepthTexture(),this.framebuffer=null},e}(Le),Ke=function(){function t(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}return t.prototype.set=function(t,e,i){var r=e.width,s=e.height;if(i){var a=t.width/2/r,n=t.height/2/s,o=t.x/r+a,c=t.y/s+n;i=re.add(i,re.NW),this.x0=o+a*re.uX(i),this.y0=c+n*re.uY(i),i=re.add(i,2),this.x1=o+a*re.uX(i),this.y1=c+n*re.uY(i),i=re.add(i,2),this.x2=o+a*re.uX(i),this.y2=c+n*re.uY(i),i=re.add(i,2),this.x3=o+a*re.uX(i),this.y3=c+n*re.uY(i)}else this.x0=t.x/r,this.y0=t.y/s,this.x1=(t.x+t.width)/r,this.y1=t.y/s,this.x2=(t.x+t.width)/r,this.y2=(t.y+t.height)/s,this.x3=t.x/r,this.y3=(t.y+t.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3},t}(),$e=new Ke,Qe=function(t){function e(i,r,s,a,n,o){var c=t.call(this)||this;if(c.noFrame=!1,r||(c.noFrame=!0,r=new Ht(0,0,1,1)),i instanceof e&&(i=i.baseTexture),c.baseTexture=i,c._frame=r,c.trim=a,c.valid=!1,c._uvs=$e,c.uvMatrix=null,c.orig=s||r,c._rotate=Number(n||0),!0===n)c._rotate=2;else if(c._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return c.defaultAnchor=o?new Xt(o.x,o.y):new Xt(0,0),c._updateID=0,c.textureCacheIds=[],i.valid?c.noFrame?i.valid&&c.onBaseTextureUpdated(i):c.frame=r:i.once("loaded",c.onBaseTextureUpdated,c),c.noFrame&&i.on("update",c.onBaseTextureUpdated,c),c}return Pe(e,t),e.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},e.prototype.onBaseTextureUpdated=function(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},e.prototype.destroy=function(t){if(this.baseTexture){if(t){var i=this.baseTexture;i&&i.url&&wt[i.url]&&e.removeFromCache(i.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,e.removeFromCache(this),this.textureCacheIds=null},e.prototype.clone=function(){return new e(this.baseTexture,this.frame.clone(),this.orig.clone(),this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor)},e.prototype.updateUvs=function(){this._uvs===$e&&(this._uvs=new Ke),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},e.from=function(t,i,r){void 0===i&&(i={}),void 0===r&&(r=D.STRICT_TEXTURE_CACHE);var s="string"==typeof t,a=null;s?a=t:(t._pixiId||(t._pixiId="pixiid_"+bt()),a=t._pixiId);var n=wt[a];if(s&&r&&!n)throw new Error('The cacheId "'+a+'" does not exist in TextureCache.');return n||(i.resolution||(i.resolution=Ot(t)),(n=new e(new Le(t,i))).baseTexture.cacheId=a,Le.addToCache(n.baseTexture,a),e.addToCache(n,a)),n},e.fromURL=function(t,i){var r=Object.assign({autoLoad:!1},null==i?void 0:i.resourceOptions),s=e.from(t,Object.assign({resourceOptions:r},i),!1),a=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):a.load().then((function(){return Promise.resolve(s)}))},e.fromBuffer=function(t,i,r,s){return new e(Le.fromBuffer(t,i,r,s))},e.fromLoader=function(t,i,r){var s=new Ue(t);s.url=i;var a=new e(new Le(s,{scaleMode:D.SCALE_MODE,resolution:Ot(i)}));return r||(r=i),Le.addToCache(a.baseTexture,r),e.addToCache(a,r),r!==i&&(Le.addToCache(a.baseTexture,i),e.addToCache(a,i)),a},e.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),wt[e]&&console.warn("Texture added to the cache with an id ["+e+"] that already had an entry"),wt[e]=t)},e.removeFromCache=function(t){if("string"==typeof t){var e=wt[t];if(e){var i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete wt[t],e}}else if(t&&t.textureCacheIds){for(var r=0;r<t.textureCacheIds.length;++r)wt[t.textureCacheIds[r]]===t&&delete wt[t.textureCacheIds[r]];return t.textureCacheIds.length=0,t}return null},Object.defineProperty(e.prototype,"resolution",{get:function(){return this.baseTexture.resolution},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frame",{get:function(){return this._frame},set:function(t){this._frame=t,this.noFrame=!1;var e=t.x,i=t.y,r=t.width,s=t.height,a=e+r>this.baseTexture.width,n=i+s>this.baseTexture.height;if(a||n){var o=a&&n?"and":"or",c="X: "+e+" + "+r+" = "+(e+r)+" > "+this.baseTexture.width,l="Y: "+i+" + "+s+" = "+(i+s)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+c+" "+o+" "+l)}this.valid=r&&s&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=t),this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotate",{get:function(){return this._rotate},set:function(t){this._rotate=t,this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.orig.height},enumerable:!1,configurable:!0}),e.prototype.castToBaseTexture=function(){return this.baseTexture},e}(A());function Ze(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}Qe.EMPTY=new Qe(new Le),Ze(Qe.EMPTY),Ze(Qe.EMPTY.baseTexture),Qe.WHITE=function(){var t=document.createElement("canvas");t.width=16,t.height=16;var e=t.getContext("2d");return e.fillStyle="white",e.fillRect(0,0,16,16),new Qe(new Le(new Ne(t)))}(),Ze(Qe.WHITE),Ze(Qe.WHITE.baseTexture);var Je=function(t){function e(e,i){var r=this,s=null;if(!(e instanceof Ye)){var a=arguments[1],n=arguments[2],o=arguments[3],c=arguments[4];console.warn("Please use RenderTexture.create("+a+", "+n+") instead of the ctor directly."),s=arguments[0],i=null,e=new Ye({width:a,height:n,scaleMode:o,resolution:c})}return(r=t.call(this,e,i)||this).legacyRenderer=s,r.valid=!0,r.filterFrame=null,r.filterPoolKey=null,r.updateUvs(),r}return Pe(e,t),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.baseTexture.framebuffer},enumerable:!1,configurable:!0}),e.prototype.resize=function(t,e,i){void 0===i&&(i=!0),t=Math.ceil(t),e=Math.ceil(e),this.valid=t>0&&e>0,this._frame.width=this.orig.width=t,this._frame.height=this.orig.height=e,i&&this.baseTexture.resize(t,e),this.updateUvs()},e.prototype.setResolution=function(t){var e=this.baseTexture;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))},e.create=function(t){return"number"==typeof t&&(t={width:t,height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),new e(new Ye(t))},e}(Qe),ti=function(){function t(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}return t.prototype.createTexture=function(t,e){var i=new Ye(Object.assign({width:t,height:e,resolution:1},this.textureOptions));return new Je(i)},t.prototype.getOptimalTexture=function(e,i,r){void 0===r&&(r=1);var s=t.SCREEN_KEY;e*=r,i*=r,this.enableFullScreen&&e===this._pixelsWidth&&i===this._pixelsHeight||(s=(65535&(e=_t(e)))<<16|65535&(i=_t(i))),this.texturePool[s]||(this.texturePool[s]=[]);var a=this.texturePool[s].pop();return a||(a=this.createTexture(e,i)),a.filterPoolKey=s,a.setResolution(r),a},t.prototype.getFilterTexture=function(t,e){var i=this.getOptimalTexture(t.width,t.height,e||t.resolution);return i.filterFrame=t.filterFrame,i},t.prototype.returnTexture=function(t){var e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)},t.prototype.returnFilterTexture=function(t){this.returnTexture(t)},t.prototype.clear=function(t){if(t=!1!==t)for(var e in this.texturePool){var i=this.texturePool[e];if(i)for(var r=0;r<i.length;r++)i[r].destroy(!0)}this.texturePool={}},t.prototype.setScreenSize=function(e){if(e.width!==this._pixelsWidth||e.height!==this._pixelsHeight){var i=t.SCREEN_KEY,r=this.texturePool[i];if(this.enableFullScreen=e.width>0&&e.height>0,r)for(var s=0;s<r.length;s++)r[s].destroy(!0);this.texturePool[i]=[],this._pixelsWidth=e.width,this._pixelsHeight=e.height}},t.SCREEN_KEY="screen",t}(),ei=function(){function t(t,e,i,r,s,a,n){void 0===e&&(e=0),void 0===i&&(i=!1),void 0===r&&(r=5126),this.buffer=t,this.size=e,this.normalized=i,this.type=r,this.stride=s,this.start=a,this.instance=n}return t.prototype.destroy=function(){this.buffer=null},t.from=function(e,i,r,s,a){return new t(e,i,r,s,a)},t}(),ii=0,ri=function(){function t(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!1),this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=e,this.id=ii++,this.disposeRunner=new xe("disposeBuffer")}return t.prototype.update=function(t){this.data=t||this.data,this._updateID++},t.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},t.prototype.destroy=function(){this.dispose(),this.data=null},t.from=function(e){return e instanceof Array&&(e=new Float32Array(e)),new t(e)},t}();function si(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}var ai={Float32Array,Uint32Array,Int32Array,Uint8Array};var ni={5126:4,5123:2,5121:1},oi=0,ci={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},li=function(){function t(t,e){void 0===t&&(t=[]),void 0===e&&(e={}),this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=oi++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new xe("disposeGeometry"),this.refCount=0}return t.prototype.addAttribute=function(t,e,i,r,s,a,n,o){if(void 0===i&&(i=0),void 0===r&&(r=!1),void 0===o&&(o=!1),!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof ri||(e instanceof Array&&(e=new Float32Array(e)),e=new ri(e));var c=t.split("|");if(c.length>1){for(var l=0;l<c.length;l++)this.addAttribute(c[l],e,i,r,s);return this}var h=this.buffers.indexOf(e);return-1===h&&(this.buffers.push(e),h=this.buffers.length-1),this.attributes[t]=new ei(h,i,r,s,a,n,o),this.instanced=this.instanced||o,this},t.prototype.getAttribute=function(t){return this.attributes[t]},t.prototype.getBuffer=function(t){return this.buffers[this.getAttribute(t).buffer]},t.prototype.addIndex=function(t){return t instanceof ri||(t instanceof Array&&(t=new Uint16Array(t)),t=new ri(t)),t.index=!0,this.indexBuffer=t,-1===this.buffers.indexOf(t)&&this.buffers.push(t),this},t.prototype.getIndex=function(){return this.indexBuffer},t.prototype.interleave=function(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;var t,e=[],i=[],r=new ri;for(t in this.attributes){var s=this.attributes[t],a=this.buffers[s.buffer];e.push(a.data),i.push(s.size*ni[s.type]/4),s.buffer=0}for(r.data=function(t,e){for(var i=0,r=0,s={},a=0;a<t.length;a++)r+=e[a],i+=t[a].length;var n=new ArrayBuffer(4*i),o=null,c=0;for(a=0;a<t.length;a++){var l=e[a],h=t[a],u=si(h);s[u]||(s[u]=new ai[u](n)),o=s[u];for(var d=0;d<h.length;d++)o[(d/l|0)*r+c+d%l]=h[d];c+=l}return new Float32Array(n)}(e,i),t=0;t<this.buffers.length;t++)this.buffers[t]!==this.indexBuffer&&this.buffers[t].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},t.prototype.getSize=function(){for(var t in this.attributes){var e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0},t.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},t.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},t.prototype.clone=function(){for(var e=new t,i=0;i<this.buffers.length;i++)e.buffers[i]=new ri(this.buffers[i].data.slice(0));for(var i in this.attributes){var r=this.attributes[i];e.attributes[i]=new ei(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.index=!0),e},t.merge=function(e){for(var i,r=new t,s=[],a=[],n=[],o=0;o<e.length;o++){i=e[o];for(var c=0;c<i.buffers.length;c++)a[c]=a[c]||0,a[c]+=i.buffers[c].data.length,n[c]=0}for(o=0;o<i.buffers.length;o++)s[o]=new(ci[si(i.buffers[o].data)])(a[o]),r.buffers[o]=new ri(s[o]);for(o=0;o<e.length;o++){i=e[o];for(c=0;c<i.buffers.length;c++)s[c].set(i.buffers[c].data,n[c]),n[c]+=i.buffers[c].data.length}if(r.attributes=i.attributes,i.indexBuffer){r.indexBuffer=r.buffers[i.buffers.indexOf(i.indexBuffer)],r.indexBuffer.index=!0;var l=0,h=0,u=0,d=0;for(o=0;o<i.buffers.length;o++)if(i.buffers[o]!==i.indexBuffer){d=o;break}for(var o in i.attributes){var p=i.attributes[o];(0|p.buffer)===d&&(h+=p.size*ni[p.type]/4)}for(o=0;o<e.length;o++){var f=e[o].indexBuffer.data;for(c=0;c<f.length;c++)r.indexBuffer.data[c+u]+=l;l+=i.buffers[d].data.length/h,u+=f.length}}return r},t}(),hi=function(t){function e(){var e=t.call(this)||this;return e.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]),e}return Pe(e,t),e}(li),ui=function(t){function e(){var e=t.call(this)||this;return e.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),e.uvs=new Float32Array([0,0,1,0,1,1,0,1]),e.vertexBuffer=new ri(e.vertices),e.uvBuffer=new ri(e.uvs),e.addAttribute("aVertexPosition",e.vertexBuffer).addAttribute("aTextureCoord",e.uvBuffer).addIndex([0,1,2,0,2,3]),e}return Pe(e,t),e.prototype.map=function(t,e){var i=0,r=0;return this.uvs[0]=i,this.uvs[1]=r,this.uvs[2]=i+e.width/t.width,this.uvs[3]=r,this.uvs[4]=i+e.width/t.width,this.uvs[5]=r+e.height/t.height,this.uvs[6]=i,this.uvs[7]=r+e.height/t.height,i=e.x,r=e.y,this.vertices[0]=i,this.vertices[1]=r,this.vertices[2]=i+e.width,this.vertices[3]=r,this.vertices[4]=i+e.width,this.vertices[5]=r+e.height,this.vertices[6]=i,this.vertices[7]=r+e.height,this.invalidate(),this},e.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},e}(li),di=0,pi=function(){function t(t,e){this.uniforms=t,this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=di++,this.static=!!e}return t.prototype.update=function(){this.dirtyId++},t.prototype.add=function(e,i,r){this.uniforms[e]=new t(i,r)},t.from=function(e,i){return new t(e,i)},t}(),fi=function(){function t(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.sourceFrame=new Ht,this.destinationFrame=new Ht,this.filters=[]}return t.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null},t}(),mi=function(t){function e(e){var i=t.call(this,e)||this;return i.defaultFilterStack=[{}],i.texturePool=new ti,i.texturePool.setScreenSize(e.view),i.statePool=[],i.quad=new hi,i.quadUv=new ui,i.tempRect=new Ht,i.activeState={},i.globalUniforms=new pi({outputFrame:i.tempRect,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),i.forceClear=!1,i.useMaxPadding=!1,i}return Pe(e,t),e.prototype.push=function(t,e){for(var i=this.renderer,r=this.defaultFilterStack,s=this.statePool.pop()||new fi,a=e[0].resolution,n=e[0].padding,o=e[0].autoFit,c=e[0].legacy,l=1;l<e.length;l++){var h=e[l];a=Math.min(a,h.resolution),n=this.useMaxPadding?Math.max(n,h.padding):n+h.padding,o=o&&h.autoFit,c=c||h.legacy}1===r.length&&(this.defaultFilterStack[0].renderTexture=i.renderTexture.current),r.push(s),s.resolution=a,s.legacy=c,s.target=t,s.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),s.sourceFrame.pad(n),o&&s.sourceFrame.fit(this.renderer.renderTexture.sourceFrame),s.sourceFrame.ceil(a),s.renderTexture=this.getOptimalFilterTexture(s.sourceFrame.width,s.sourceFrame.height,a),s.filters=e,s.destinationFrame.width=s.renderTexture.width,s.destinationFrame.height=s.renderTexture.height;var u=this.tempRect;u.width=s.sourceFrame.width,u.height=s.sourceFrame.height,s.renderTexture.filterFrame=s.sourceFrame,i.renderTexture.bind(s.renderTexture,s.sourceFrame,u),i.renderTexture.clear()},e.prototype.pop=function(){var t=this.defaultFilterStack,e=t.pop(),i=e.filters;this.activeState=e;var r=this.globalUniforms.uniforms;r.outputFrame=e.sourceFrame,r.resolution=e.resolution;var s=r.inputSize,a=r.inputPixel,n=r.inputClamp;if(s[0]=e.destinationFrame.width,s[1]=e.destinationFrame.height,s[2]=1/s[0],s[3]=1/s[1],a[0]=s[0]*e.resolution,a[1]=s[1]*e.resolution,a[2]=1/a[0],a[3]=1/a[1],n[0]=.5*a[2],n[1]=.5*a[3],n[2]=e.sourceFrame.width*s[2]-.5*a[2],n[3]=e.sourceFrame.height*s[3]-.5*a[3],e.legacy){var o=r.filterArea;o[0]=e.destinationFrame.width,o[1]=e.destinationFrame.height,o[2]=e.sourceFrame.x,o[3]=e.sourceFrame.y,r.filterClamp=r.inputClamp}this.globalUniforms.update();var c=t[t.length-1];if(e.renderTexture.framebuffer.multisample>1&&this.renderer.framebuffer.blit(),1===i.length)i[0].apply(this,e.renderTexture,c.renderTexture,X.BLEND,e),this.returnFilterTexture(e.renderTexture);else{var l=e.renderTexture,h=this.getOptimalFilterTexture(l.width,l.height,e.resolution);h.filterFrame=l.filterFrame;var u=0;for(u=0;u<i.length-1;++u){i[u].apply(this,l,h,X.CLEAR,e);var d=l;l=h,h=d}i[u].apply(this,l,c.renderTexture,X.BLEND,e),this.returnFilterTexture(l),this.returnFilterTexture(h)}e.clear(),this.statePool.push(e)},e.prototype.bindAndClear=function(t,e){if(void 0===e&&(e=X.CLEAR),t&&t.filterFrame){var i=this.tempRect;i.width=t.filterFrame.width,i.height=t.filterFrame.height,this.renderer.renderTexture.bind(t,t.filterFrame,i)}else this.renderer.renderTexture.bind(t);"boolean"==typeof e&&(e=e?X.CLEAR:X.BLEND,It("5.2.1","Use CLEAR_MODES when using clear applyFilter option")),(e===X.CLEAR||e===X.BLIT&&this.forceClear)&&this.renderer.renderTexture.clear()},e.prototype.applyFilter=function(t,e,i,r){var s=this.renderer;this.bindAndClear(i,r),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,s.state.set(t.state),s.shader.bind(t),t.legacy?(this.quadUv.map(e._frame,e.filterFrame),s.geometry.bind(this.quadUv),s.geometry.draw(j.TRIANGLES)):(s.geometry.bind(this.quad),s.geometry.draw(j.TRIANGLE_STRIP))},e.prototype.calculateSpriteMatrix=function(t,e){var i=this.activeState,r=i.sourceFrame,s=i.destinationFrame,a=e._texture.orig,n=t.set(s.width,0,0,s.height,r.x,r.y),o=e.worldTransform.copyTo(Kt.TEMP_MATRIX);return o.invert(),n.prepend(o),n.scale(1/a.width,1/a.height),n.translate(e.anchor.x,e.anchor.y),n},e.prototype.destroy=function(){this.texturePool.clear(!1)},e.prototype.getOptimalFilterTexture=function(t,e,i){return void 0===i&&(i=1),this.texturePool.getOptimalTexture(t,e,i)},e.prototype.getFilterTexture=function(t,e){if("number"==typeof t){var i=t;t=e,e=i}t=t||this.activeState.renderTexture;var r=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution);return r.filterFrame=t.filterFrame,r},e.prototype.returnFilterTexture=function(t){this.texturePool.returnTexture(t)},e.prototype.emptyPool=function(){this.texturePool.clear(!0)},e.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},e}(Ge),yi=function(){function t(t){this.renderer=t}return t.prototype.flush=function(){},t.prototype.destroy=function(){this.renderer=null},t.prototype.start=function(){},t.prototype.stop=function(){this.flush()},t.prototype.render=function(t){},t}(),_i=function(t){function e(e){var i=t.call(this,e)||this;return i.emptyRenderer=new yi(e),i.currentRenderer=i.emptyRenderer,i}return Pe(e,t),e.prototype.setObjectRenderer=function(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())},e.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},e.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},e.prototype.copyBoundTextures=function(t,e){for(var i=this.renderer.texture.boundTextures,r=e-1;r>=0;--r)t[r]=i[r]||null,t[r]&&(t[r]._batchLocation=r)},e.prototype.boundArray=function(t,e,i,r){for(var s=t.elements,a=t.ids,n=t.count,o=0,c=0;c<n;c++){var l=s[c],h=l._batchLocation;if(h>=0&&h<r&&e[h]===l)a[c]=h;else for(;o<r;){var u=e[o];if(!u||u._batchEnabled!==i||u._batchLocation!==o){a[c]=o,l._batchLocation=o,e[o]=l;break}o++}}},e}(Ge),gi=0,vi=function(t){function e(e){var i=t.call(this,e)||this;return i.webGLVersion=1,i.extensions={},i.supports={uint32Indices:!1},i.handleContextLost=i.handleContextLost.bind(i),i.handleContextRestored=i.handleContextRestored.bind(i),e.view.addEventListener("webglcontextlost",i.handleContextLost,!1),e.view.addEventListener("webglcontextrestored",i.handleContextRestored,!1),i}return Pe(e,t),Object.defineProperty(e.prototype,"isLost",{get:function(){return!this.gl||this.gl.isContextLost()},enumerable:!1,configurable:!0}),e.prototype.contextChange=function(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=gi++,t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").restoreContext()},e.prototype.initFromContext=function(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=gi++,this.renderer.runners.contextChange.emit(t)},e.prototype.initFromOptions=function(t){var e=this.createContext(this.renderer.view,t);this.initFromContext(e)},e.prototype.createContext=function(t,e){var i;if(D.PREFER_ENV>=B.WEBGL2&&(i=t.getContext("webgl2",e)),i)this.webGLVersion=2;else if(this.webGLVersion=1,!(i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e)))throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl},e.prototype.getExtensions=function(){var t=this.gl;1===this.webGLVersion?Object.assign(this.extensions,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),loseContext:t.getExtension("WEBGL_lose_context"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,{anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),colorBufferFloat:t.getExtension("EXT_color_buffer_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear")})},e.prototype.handleContextLost=function(t){t.preventDefault()},e.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.emit(this.gl)},e.prototype.destroy=function(){var t=this.renderer.view;t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},e.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},e.prototype.validateContext=function(t){var e=t.getContextAttributes(),i="WebGL2RenderingContext"in window&&t instanceof window.WebGL2RenderingContext;i&&(this.webGLVersion=2),e.stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");var r=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=r,r||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")},e}(Ge),Si=function(t){this.framebuffer=t,this.stencil=null,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.multisample=Q.NONE,this.msaaBuffer=null,this.blitFramebuffer=null},Mi=new Ht,Ri=function(t){function e(e){var i=t.call(this,e)||this;return i.managedFramebuffers=[],i.unknownFramebuffer=new Xe(10,10),i.msaaSamples=null,i}return Pe(e,t),e.prototype.contextChange=function(){var t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Ht,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),1===this.renderer.context.webGLVersion){var e=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;D.PREFER_ENV===B.WEBGL_LEGACY&&(e=null,i=null),e?t.drawBuffers=function(t){return e.drawBuffersWEBGL(t)}:(this.hasMRT=!1,t.drawBuffers=function(){}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)},e.prototype.bind=function(t,e){var i=this.gl;if(t){var r=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,i.bindFramebuffer(i.FRAMEBUFFER,r.framebuffer)),r.dirtyId!==t.dirtyId&&(r.dirtyId=t.dirtyId,r.dirtyFormat!==t.dirtyFormat?(r.dirtyFormat=t.dirtyFormat,this.updateFramebuffer(t)):r.dirtySize!==t.dirtySize&&(r.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(var s=0;s<t.colorTextures.length;s++){var a=t.colorTextures[s];this.renderer.texture.unbind(a.parentTextureArray||a)}t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,t.width,t.height)}else this.current&&(this.current=null,i.bindFramebuffer(i.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},e.prototype.setViewport=function(t,e,i,r){var s=this.viewport;s.width===i&&s.height===r&&s.x===t&&s.y===e||(s.x=t,s.y=e,s.width=i,s.height=r,this.gl.viewport(t,e,i,r))},Object.defineProperty(e.prototype,"size",{get:function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},enumerable:!1,configurable:!0}),e.prototype.clear=function(t,e,i,r,s){void 0===s&&(s=O.COLOR|O.DEPTH);var a=this.gl;a.clearColor(t,e,i,r),a.clear(s)},e.prototype.initFramebuffer=function(t){var e=this.gl,i=new Si(e.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i},e.prototype.resizeFramebuffer=function(t){var e=this.gl,i=t.glFramebuffers[this.CONTEXT_UID];i.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,i.stencil),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));for(var r=t.colorTextures,s=0;s<r.length;s++)this.renderer.texture.bind(r[s],0);t.depthTexture&&this.renderer.texture.bind(t.depthTexture,0)},e.prototype.updateFramebuffer=function(t){var e=this.gl,i=t.glFramebuffers[this.CONTEXT_UID],r=t.colorTextures.length;e.drawBuffers||(r=Math.min(r,1)),i.multisample>1&&(i.msaaBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,i.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,e.RGBA8,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,i.msaaBuffer));for(var s=[],a=0;a<r;a++)if(!(0===a&&i.multisample>1)){var n=t.colorTextures[a],o=n.parentTextureArray||n;this.renderer.texture.bind(o,0),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+a,n.target,o._glTextures[this.CONTEXT_UID].texture,0),s.push(e.COLOR_ATTACHMENT0+a)}if((s.length>1&&e.drawBuffers(s),t.depthTexture)&&this.writeDepthTexture){var c=t.depthTexture;this.renderer.texture.bind(c,0),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,c._glTextures[this.CONTEXT_UID].texture,0)}i.stencil||!t.stencil&&!t.depth||(i.stencil=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,i.stencil),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height),t.depthTexture||e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,i.stencil))},e.prototype.detectSamples=function(t){var e=this.msaaSamples,i=Q.NONE;if(t<=1||null===e)return i;for(var r=0;r<e.length;r++)if(e[r]<=t){i=e[r];break}return 1===i&&(i=Q.NONE),i},e.prototype.blit=function(t,e,i){var r=this,s=r.current,a=r.renderer,n=r.gl,o=r.CONTEXT_UID;if(2===a.context.webGLVersion&&s){var c=s.glFramebuffers[o];if(c){if(!t){if(c.multisample<=1)return;c.blitFramebuffer||(c.blitFramebuffer=new Xe(s.width,s.height),c.blitFramebuffer.addColorTexture(0,s.colorTextures[0])),(t=c.blitFramebuffer).width=s.width,t.height=s.height}e||((e=Mi).width=s.width,e.height=s.height),i||(i=e);var l=e.width===i.width&&e.height===i.height;this.bind(t),n.bindFramebuffer(n.READ_FRAMEBUFFER,c.framebuffer),n.blitFramebuffer(e.x,e.y,e.width,e.height,i.x,i.y,i.width,i.height,n.COLOR_BUFFER_BIT,l?n.NEAREST:n.LINEAR)}}},e.prototype.disposeFramebuffer=function(t,e){var i=t.glFramebuffers[this.CONTEXT_UID],r=this.gl;if(i){delete t.glFramebuffers[this.CONTEXT_UID];var s=this.managedFramebuffers.indexOf(t);s>=0&&this.managedFramebuffers.splice(s,1),t.disposeRunner.remove(this),e||(r.deleteFramebuffer(i.framebuffer),i.stencil&&r.deleteRenderbuffer(i.stencil))}},e.prototype.disposeAll=function(t){var e=this.managedFramebuffers;this.managedFramebuffers=[];for(var i=0;i<e.length;i++)this.disposeFramebuffer(e[i],t)},e.prototype.forceStencil=function(){var t=this.current;if(t){var e=t.glFramebuffers[this.CONTEXT_UID];if(e&&!e.stencil){t.enableStencil();var i=t.width,r=t.height,s=this.gl,a=s.createRenderbuffer();s.bindRenderbuffer(s.RENDERBUFFER,a),s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,i,r),e.stencil=a,s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,a)}}},e.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new Ht},e}(Ge),bi=function(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0},Ei={5126:4,5123:2,5121:1},Ii=function(t){function e(e){var i=t.call(this,e)||this;return i._activeGeometry=null,i._activeVao=null,i.hasVao=!0,i.hasInstance=!0,i.canUseUInt32ElementIndex=!1,i.managedGeometries={},i.managedBuffers={},i}return Pe(e,t),e.prototype.contextChange=function(){this.disposeAll(!0);var t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==e.webGLVersion){var i=this.renderer.context.extensions.vertexArrayObject;D.PREFER_ENV===B.WEBGL_LEGACY&&(i=null),i?(t.createVertexArray=function(){return i.createVertexArrayOES()},t.bindVertexArray=function(t){return i.bindVertexArrayOES(t)},t.deleteVertexArray=function(t){return i.deleteVertexArrayOES(t)}):(this.hasVao=!1,t.createVertexArray=function(){return null},t.bindVertexArray=function(){return null},t.deleteVertexArray=function(){return null})}if(2!==e.webGLVersion){var r=t.getExtension("ANGLE_instanced_arrays");r?(t.vertexAttribDivisor=function(t,e){return r.vertexAttribDivisorANGLE(t,e)},t.drawElementsInstanced=function(t,e,i,s,a){return r.drawElementsInstancedANGLE(t,e,i,s,a)},t.drawArraysInstanced=function(t,e,i,s){return r.drawArraysInstancedANGLE(t,e,i,s)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===e.webGLVersion||!!e.extensions.uint32ElementIndex},e.prototype.bind=function(t,e){e=e||this.renderer.shader.shader;var i=this.gl,r=t.glVertexArrayObjects[this.CONTEXT_UID],s=!1;r||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=r={},s=!0);var a=r[e.program.id]||this.initGeometryVao(t,e.program,s);this._activeGeometry=t,this._activeVao!==a&&(this._activeVao=a,this.hasVao?i.bindVertexArray(a):this.activateVao(t,e.program)),this.updateBuffers()},e.prototype.reset=function(){this.unbind()},e.prototype.updateBuffers=function(){for(var t=this._activeGeometry,e=this.gl,i=0;i<t.buffers.length;i++){var r=t.buffers[i],s=r._glBuffers[this.CONTEXT_UID];if(r._updateID!==s.updateID){s.updateID=r._updateID;var a=r.index?e.ELEMENT_ARRAY_BUFFER:e.ARRAY_BUFFER;if(e.bindBuffer(a,s.buffer),this._boundBuffer=s,s.byteLength>=r.data.byteLength)e.bufferSubData(a,0,r.data);else{var n=r.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;s.byteLength=r.data.byteLength,e.bufferData(a,r.data,n)}}}},e.prototype.checkCompatibility=function(t,e){var i=t.attributes,r=e.attributeData;for(var s in r)if(!i[s])throw new Error('shader and geometry incompatible, geometry missing the "'+s+'" attribute')},e.prototype.getSignature=function(t,e){var i=t.attributes,r=e.attributeData,s=["g",t.id];for(var a in i)r[a]&&s.push(a);return s.join("-")},e.prototype.initGeometryVao=function(t,e,i){void 0===i&&(i=!0),this.checkCompatibility(t,e);var r=this.gl,s=this.CONTEXT_UID,a=this.getSignature(t,e),n=t.glVertexArrayObjects[this.CONTEXT_UID],o=n[a];if(o)return n[e.id]=o,o;var c=t.buffers,l=t.attributes,h={},u={};for(var d in c)h[d]=0,u[d]=0;for(var d in l)!l[d].size&&e.attributeData[d]?l[d].size=e.attributeData[d].size:l[d].size||console.warn("PIXI Geometry attribute '"+d+"' size cannot be determined (likely the bound shader does not have the attribute)"),h[l[d].buffer]+=l[d].size*Ei[l[d].type];for(var d in l){var p=l[d],f=p.size;void 0===p.stride&&(h[p.buffer]===f*Ei[p.type]?p.stride=0:p.stride=h[p.buffer]),void 0===p.start&&(p.start=u[p.buffer],u[p.buffer]+=f*Ei[p.type])}o=r.createVertexArray(),r.bindVertexArray(o);for(var m=0;m<c.length;m++){var y=c[m];y._glBuffers[s]||(y._glBuffers[s]=new bi(r.createBuffer()),this.managedBuffers[y.id]=y,y.disposeRunner.add(this)),i&&y._glBuffers[s].refCount++}return this.activateVao(t,e),this._activeVao=o,n[e.id]=o,n[a]=o,o},e.prototype.disposeBuffer=function(t,e){if(this.managedBuffers[t.id]){delete this.managedBuffers[t.id];var i=t._glBuffers[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this),i&&(e||r.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}},e.prototype.disposeGeometry=function(t,e){if(this.managedGeometries[t.id]){delete this.managedGeometries[t.id];var i=t.glVertexArrayObjects[this.CONTEXT_UID],r=this.gl,s=t.buffers;if(t.disposeRunner.remove(this),i){for(var a=0;a<s.length;a++){var n=s[a]._glBuffers[this.CONTEXT_UID];n.refCount--,0!==n.refCount||e||this.disposeBuffer(s[a],e)}if(!e)for(var o in i)if("g"===o[0]){var c=i[o];this._activeVao===c&&this.unbind(),r.deleteVertexArray(c)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}},e.prototype.disposeAll=function(t){for(var e=Object.keys(this.managedGeometries),i=0;i<e.length;i++)this.disposeGeometry(this.managedGeometries[e[i]],t);e=Object.keys(this.managedBuffers);for(i=0;i<e.length;i++)this.disposeBuffer(this.managedBuffers[e[i]],t)},e.prototype.activateVao=function(t,e){var i=this.gl,r=this.CONTEXT_UID,s=t.buffers,a=t.attributes;t.indexBuffer&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t.indexBuffer._glBuffers[r].buffer);var n=null;for(var o in a){var c=a[o],l=s[c.buffer]._glBuffers[r];if(e.attributeData[o]){n!==l&&(i.bindBuffer(i.ARRAY_BUFFER,l.buffer),n=l);var h=e.attributeData[o].location;if(i.enableVertexAttribArray(h),i.vertexAttribPointer(h,c.size,c.type||i.FLOAT,c.normalized,c.stride,c.start),c.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");i.vertexAttribDivisor(h,1)}}}},e.prototype.draw=function(t,e,i,r){var s=this.gl,a=this._activeGeometry;if(a.indexBuffer){var n=a.indexBuffer.data.BYTES_PER_ELEMENT,o=2===n?s.UNSIGNED_SHORT:s.UNSIGNED_INT;2===n||4===n&&this.canUseUInt32ElementIndex?a.instanced?s.drawElementsInstanced(t,e||a.indexBuffer.data.length,o,(i||0)*n,r||1):s.drawElements(t,e||a.indexBuffer.data.length,o,(i||0)*n):console.warn("unsupported index buffer type: uint32")}else a.instanced?s.drawArraysInstanced(t,i,e||a.getSize(),r||1):s.drawArrays(t,i,e||a.getSize());return this},e.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},e}(Ge),xi=function(){function t(t){void 0===t&&(t=null),this.type=$.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._target=null}return t.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=$.NONE,this.autoDetect=!0),this._target=null},t.prototype.copyCountersOrReset=function(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)},t}();function wi(t,e,i){var r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),r}function Ti(t,e,i,r){var s=wi(t,t.VERTEX_SHADER,e),a=wi(t,t.FRAGMENT_SHADER,i),n=t.createProgram();if(t.attachShader(n,s),t.attachShader(n,a),r)for(var o in r)t.bindAttribLocation(n,r[o],o);return t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS)||(t.getShaderParameter(s,t.COMPILE_STATUS)||(console.warn(e),console.error(t.getShaderInfoLog(s))),t.getShaderParameter(a,t.COMPILE_STATUS)||(console.warn(i),console.error(t.getShaderInfoLog(a))),console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",t.getProgramParameter(n,t.VALIDATE_STATUS)),console.error("gl.getError()",t.getError()),""!==t.getProgramInfoLog(n)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(n)),t.deleteProgram(n),n=null),t.deleteShader(s),t.deleteShader(a),n}function Di(t){for(var e=new Array(t),i=0;i<e.length;i++)e[i]=!1;return e}function Pi(t,e){switch(t){case"float":case"int":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"bool":return!1;case"bvec2":return Di(2*e);case"bvec3":return Di(3*e);case"bvec4":return Di(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var Ai,ki={},Ci=ki;function Li(){if(Ci===ki||Ci&&Ci.isContextLost()){var t=document.createElement("canvas"),e=void 0;D.PREFER_ENV>=B.WEBGL2&&(e=t.getContext("webgl2",{})),e||((e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}))?e.getExtension("WEBGL_draw_buffers"):e=null),Ci=e}return Ci}function Bi(t,e,i){if("precision"!==t.substring(0,9)){var r=e;return e===K.HIGH&&i!==K.HIGH&&(r=K.MEDIUM),"precision "+r+" float;\n"+t}return i!==K.HIGH&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t}var Fi={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Oi(t){return Fi[t]}var Ni=null,ji={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Ui(t,e){if(!Ni){var i=Object.keys(ji);Ni={};for(var r=0;r<i.length;++r){var s=i[r];Ni[t[s]]=ji[s]}}return Ni[e]}var Vi=[{test:function(t){return"float"===t.type&&1===t.size},code:function(t){return'\n            if(uv["'+t+'"] !== ud["'+t+'"].value)\n            {\n                ud["'+t+'"].value = uv["'+t+'"]\n                gl.uniform1f(ud["'+t+'"].location, uv["'+t+'"])\n            }\n            '}},{test:function(t){return("sampler2D"===t.type||"samplerCube"===t.type||"sampler2DArray"===t.type)&&1===t.size&&!t.isArray},code:function(t){return't = syncData.textureCount++;\n\n            renderer.texture.bind(uv["'+t+'"], t);\n\n            if(ud["'+t+'"].value !== t)\n            {\n                ud["'+t+'"].value = t;\n                gl.uniform1i(ud["'+t+'"].location, t);\n; // eslint-disable-line max-len\n            }'}},{test:function(t,e){return"mat3"===t.type&&1===t.size&&void 0!==e.a},code:function(t){return'\n            gl.uniformMatrix3fv(ud["'+t+'"].location, false, uv["'+t+'"].toArray(true));\n            '}},{test:function(t,e){return"vec2"===t.type&&1===t.size&&void 0!==e.x},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["'+t+'"].location, v.x, v.y);\n                }'}},{test:function(t){return"vec2"===t.type&&1===t.size},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["'+t+'"].location, v[0], v[1]);\n                }\n            '}},{test:function(t,e){return"vec4"===t.type&&1===t.size&&void 0!==e.width},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["'+t+'"].location, v.x, v.y, v.width, v.height)\n                }'}},{test:function(t){return"vec4"===t.type&&1===t.size},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["'+t+'"].location, v[0], v[1], v[2], v[3])\n                }'}}],Hi={float:"\n    if(cv !== v)\n    {\n        cv.v = v;\n        gl.uniform1f(location, v)\n    }",vec2:"\n    if(cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"gl.uniform4f(location, v[0], v[1], v[2], v[3])",int:"gl.uniform1i(location, v)",ivec2:"gl.uniform2i(location, v[0], v[1])",ivec3:"gl.uniform3i(location, v[0], v[1], v[2])",ivec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",bool:"gl.uniform1i(location, v)",bvec2:"gl.uniform2i(location, v[0], v[1])",bvec3:"gl.uniform3i(location, v[0], v[1], v[2])",bvec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"gl.uniform1i(location, v)",samplerCube:"gl.uniform1i(location, v)",sampler2DArray:"gl.uniform1i(location, v)"},Wi={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};var qi,Gi=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function zi(t){for(var e="",i=0;i<t;++i)i>0&&(e+="\nelse "),i<t-1&&(e+="if(test == "+i+".0){}");return e}function Xi(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var i=e.createShader(e.FRAGMENT_SHADER);;){var r=Gi.replace(/%forloop%/gi,zi(t));if(e.shaderSource(i,r),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS))break;t=t/2|0}return t}var Yi=0,Ki={},$i=function(){function t(e,i,r){void 0===r&&(r="pixi-shader"),this.id=Yi++,this.vertexSrc=e||t.defaultVertexSrc,this.fragmentSrc=i||t.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),"#version"!==this.vertexSrc.substring(0,8)&&(r=r.replace(/\s+/g,"-"),Ki[r]?(Ki[r]++,r+="-"+Ki[r]):Ki[r]=1,this.vertexSrc="#define SHADER_NAME "+r+"\n"+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+r+"\n"+this.fragmentSrc,this.vertexSrc=Bi(this.vertexSrc,D.PRECISION_VERTEX,K.HIGH),this.fragmentSrc=Bi(this.fragmentSrc,D.PRECISION_FRAGMENT,function(){if(!Ai){Ai=K.MEDIUM;var t=Li();if(t&&t.getShaderPrecisionFormat){var e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);Ai=e.precision?K.HIGH:K.MEDIUM}}return Ai}())),this.extractData(this.vertexSrc,this.fragmentSrc),this.glPrograms={},this.syncUniforms=null}return t.prototype.extractData=function(t,e){var i=Li();if(i){var r=Ti(i,t,e);this.attributeData=this.getAttributeData(r,i),this.uniformData=this.getUniformData(r,i),i.deleteProgram(r)}else this.uniformData={},this.attributeData={}},t.prototype.getAttributeData=function(t,e){for(var i={},r=[],s=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),a=0;a<s;a++){var n=e.getActiveAttrib(t,a),o=Ui(e,n.type),c={type:o,name:n.name,size:Oi(o),location:0};i[n.name]=c,r.push(c)}r.sort((function(t,e){return t.name>e.name?1:-1}));for(a=0;a<r.length;a++)r[a].location=a;return i},t.prototype.getUniformData=function(t,e){for(var i={},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),s=0;s<r;s++){var a=e.getActiveUniform(t,s),n=a.name.replace(/\[.*?\]$/,""),o=a.name.match(/\[.*?\]$/),c=Ui(e,a.type);i[n]={type:c,size:a.size,isArray:o,value:Pi(c,a.size)}}return i},Object.defineProperty(t,"defaultVertexSrc",{get:function(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultFragmentSrc",{get:function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"},enumerable:!1,configurable:!0}),t.from=function(e,i,r){var s=e+i,a=xt[s];return a||(xt[s]=a=new t(e,i,r)),a},t}(),Qi=function(){function t(t,e){for(var i in this.program=t,this.uniformGroup=e?e instanceof pi?e:new pi(e):new pi({}),t.uniformData)this.uniformGroup.uniforms[i]instanceof Array&&(this.uniformGroup.uniforms[i]=new Float32Array(this.uniformGroup.uniforms[i]))}return t.prototype.checkUniformExists=function(t,e){if(e.uniforms[t])return!0;for(var i in e.uniforms){var r=e.uniforms[i];if(r.group&&this.checkUniformExists(t,r))return!0}return!1},t.prototype.destroy=function(){this.uniformGroup=null},Object.defineProperty(t.prototype,"uniforms",{get:function(){return this.uniformGroup.uniforms},enumerable:!1,configurable:!0}),t.from=function(e,i,r){return new t($i.from(e,i),r)},t}(),Zi=function(){function t(){this.data=0,this.blendMode=N.NORMAL,this.polygonOffset=0,this.blend=!0}return Object.defineProperty(t.prototype,"blend",{get:function(){return!!(1&this.data)},set:function(t){!!(1&this.data)!==t&&(this.data^=1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsets",{get:function(){return!!(2&this.data)},set:function(t){!!(2&this.data)!==t&&(this.data^=2)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"culling",{get:function(){return!!(4&this.data)},set:function(t){!!(4&this.data)!==t&&(this.data^=4)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthTest",{get:function(){return!!(8&this.data)},set:function(t){!!(8&this.data)!==t&&(this.data^=8)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clockwiseFrontFace",{get:function(){return!!(16&this.data)},set:function(t){!!(16&this.data)!==t&&(this.data^=16)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blendMode",{get:function(){return this._blendMode},set:function(t){this.blend=t!==N.NONE,this._blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"polygonOffset",{get:function(){return this._polygonOffset},set:function(t){this.offsets=!!t,this._polygonOffset=t},enumerable:!1,configurable:!0}),t.for2d=function(){var e=new t;return e.depthTest=!1,e.blend=!0,e},t}(),Ji=function(t){function e(i,r,s){var a=this,n=$i.from(i||e.defaultVertexSrc,r||e.defaultFragmentSrc);return(a=t.call(this,n,s)||this).padding=0,a.resolution=D.FILTER_RESOLUTION,a.enabled=!0,a.autoFit=!0,a.legacy=!!a.program.attributeData.aTextureCoord,a.state=new Zi,a}return Pe(e,t),e.prototype.apply=function(t,e,i,r,s){t.applyFilter(this,e,i,r)},Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultVertexSrc",{get:function(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultFragmentSrc",{get:function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"},enumerable:!1,configurable:!0}),e}(Qi),tr=new Kt,er=function(){function t(t,e){this._texture=t,this.mapCoord=new Kt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===e?.5:e,this.isSimple=!1}return Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture=t,this._textureID=-1},enumerable:!1,configurable:!0}),t.prototype.multiplyUvs=function(t,e){void 0===e&&(e=t);for(var i=this.mapCoord,r=0;r<t.length;r+=2){var s=t[r],a=t[r+1];e[r]=s*i.a+a*i.c+i.tx,e[r+1]=s*i.b+a*i.d+i.ty}return e},t.prototype.update=function(t){var e=this._texture;if(!e||!e.valid)return!1;if(!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;var i=e._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);var r=e.orig,s=e.trim;s&&(tr.set(r.width/s.width,0,0,r.height/s.height,-s.x/s.width,-s.y/s.height),this.mapCoord.append(tr));var a=e.baseTexture,n=this.uClampFrame,o=this.clampMargin/a.resolution,c=this.clampOffset;return n[0]=(e._frame.x+o+c)/a.width,n[1]=(e._frame.y+o+c)/a.height,n[2]=(e._frame.x+e._frame.width-o+c)/a.width,n[3]=(e._frame.y+e._frame.height-o+c)/a.height,this.uClampOffset[0]=c/a.realWidth,this.uClampOffset[1]=c/a.realHeight,this.isSimple=e._frame.width===a.width&&e._frame.height===a.height&&0===e.rotate,!0},t}(),ir=function(t){function e(e){var i=this,r=new Kt;return i=t.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n")||this,e.renderable=!1,i.maskSprite=e,i.maskMatrix=r,i}return Pe(e,t),e.prototype.apply=function(t,e,i,r){var s=this.maskSprite,a=s._texture;a.valid&&(a.uvMatrix||(a.uvMatrix=new er(a,0)),a.uvMatrix.update(),this.uniforms.npmAlpha=a.baseTexture.alphaMode?0:1,this.uniforms.mask=a,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,s).prepend(a.uvMatrix.mapCoord),this.uniforms.alpha=s.worldAlpha,this.uniforms.maskClamp=a.uvMatrix.uClampFrame,t.applyFilter(this,e,i,r))},e}(Ji),rr=function(t){function e(e){var i=t.call(this,e)||this;return i.enableScissor=!1,i.alphaMaskPool=[],i.maskDataPool=[],i.maskStack=[],i.alphaMaskIndex=0,i}return Pe(e,t),e.prototype.setMaskStack=function(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)},e.prototype.push=function(t,e){var i=e;if(!i.isMaskData){var r=this.maskDataPool.pop()||new xi;r.pooled=!0,r.maskObject=e,i=r}switch(i.autoDetect&&this.detect(i),i.copyCountersOrReset(this.maskStack[this.maskStack.length-1]),i._target=t,i.type){case $.SCISSOR:this.maskStack.push(i),this.renderer.scissor.push(i);break;case $.STENCIL:this.maskStack.push(i),this.renderer.stencil.push(i);break;case $.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i),this.maskStack.push(i)}},e.prototype.pop=function(t){var e=this.maskStack.pop();if(e&&e._target===t){switch(e.type){case $.SCISSOR:this.renderer.scissor.pop();break;case $.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case $.SPRITE:this.popSpriteMask()}e.reset(),e.pooled&&this.maskDataPool.push(e)}},e.prototype.detect=function(t){var e=t.maskObject;if(e.isSprite)t.type=$.SPRITE;else if(t.type=$.STENCIL,this.enableScissor&&e.isFastRect&&e.isFastRect()){var i=e.worldTransform,r=Math.atan2(i.b,i.a),s=Math.atan2(i.d,i.c);r=Math.round(r*(180/Math.PI)*100),s=((s=Math.round(s*(180/Math.PI)*100)-r)%18e3+18e3)%18e3,0===(r=(r%9e3+9e3)%9e3)&&9e3===s&&(t.type=$.SCISSOR)}},e.prototype.pushSpriteMask=function(t){var e=t.maskObject,i=t._target,r=this.alphaMaskPool[this.alphaMaskIndex];r||(r=this.alphaMaskPool[this.alphaMaskIndex]=[new ir(e)]),r[0].resolution=this.renderer.resolution,r[0].maskSprite=e;var s=i.filterArea;i.filterArea=e.getBounds(!0),this.renderer.filter.push(i,r),i.filterArea=s,this.alphaMaskIndex++},e.prototype.popSpriteMask=function(){this.renderer.filter.pop(),this.alphaMaskIndex--},e}(Ge),sr=function(t){function e(e){var i=t.call(this,e)||this;return i.maskStack=[],i.glConst=0,i}return Pe(e,t),e.prototype.getStackLength=function(){return this.maskStack.length},e.prototype.setMaskStack=function(t){var e=this.renderer.gl,i=this.getStackLength();this.maskStack=t;var r=this.getStackLength();r!==i&&(0===r?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))},e.prototype._useCurrent=function(){},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.maskStack=null},e}(Ge),ar=function(t){function e(e){var i=t.call(this,e)||this;return i.glConst=WebGLRenderingContext.SCISSOR_TEST,i}return Pe(e,t),e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0},e.prototype.push=function(t){var e=t.maskObject;e.renderable=!0;var i=t._scissorRect,r=e.getBounds(!0),s=this.renderer.gl;e.renderable=!1,i?r.fit(i):s.enable(s.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=r,this._useCurrent()},e.prototype.pop=function(){var t=this.renderer.gl;this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)},e.prototype._useCurrent=function(){var t=this.maskStack[this.maskStack.length-1]._scissorRect,e=this.renderer.renderTexture.current,i=this.renderer.projection,r=i.transform,s=i.sourceFrame,a=i.destinationFrame,n=e?e.resolution:this.renderer.resolution,o=(t.x-s.x)*n+a.x,c=(t.y-s.y)*n+a.y,l=t.width*n,h=t.height*n;r&&(o+=r.tx*n,c+=r.ty*n),e||(c=this.renderer.height-h-c),this.renderer.gl.scissor(o,c,l,h)},e}(sr),nr=function(t){function e(e){var i=t.call(this,e)||this;return i.glConst=WebGLRenderingContext.STENCIL_TEST,i}return Pe(e,t),e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0},e.prototype.push=function(t){var e=t.maskObject,i=this.renderer.gl,r=t._stencilCounter;0===r&&(this.renderer.framebuffer.forceStencil(),i.enable(i.STENCIL_TEST)),t._stencilCounter++,i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.EQUAL,r,this._getBitwiseMask()),i.stencilOp(i.KEEP,i.KEEP,i.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,this._useCurrent()},e.prototype.pop=function(t){var e=this.renderer.gl;0===this.getStackLength()?(e.disable(e.STENCIL_TEST),e.clear(e.STENCIL_BUFFER_BIT),e.clearStencil(0)):(e.colorMask(!1,!1,!1,!1),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,this._useCurrent())},e.prototype._useCurrent=function(){var t=this.renderer.gl;t.colorMask(!0,!0,!0,!0),t.stencilFunc(t.EQUAL,this.getStackLength(),this._getBitwiseMask()),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)},e.prototype._getBitwiseMask=function(){return(1<<this.getStackLength())-1},e}(sr),or=function(t){function e(e){var i=t.call(this,e)||this;return i.destinationFrame=null,i.sourceFrame=null,i.defaultFrame=null,i.projectionMatrix=new Kt,i.transform=null,i}return Pe(e,t),e.prototype.update=function(t,e,i,r){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,r),this.transform&&this.projectionMatrix.append(this.transform);var s=this.renderer;s.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,s.globalUniforms.update(),s.shader.shader&&s.shader.syncUniformGroup(s.shader.shader.uniforms.globals)},e.prototype.calculateProjection=function(t,e,i,r){var s=this.projectionMatrix,a=r?-1:1;s.identity(),s.a=1/e.width*2,s.d=a*(1/e.height*2),s.tx=-1-e.x*s.a,s.ty=-a-e.y*s.d},e.prototype.setTransform=function(t){},e}(Ge),cr=new Ht,lr=new Ht,hr=new Ht,ur=function(t){function e(e){var i=t.call(this,e)||this;return i.clearColor=e._backgroundColorRgba,i.defaultMaskStack=[],i.current=null,i.sourceFrame=new Ht,i.destinationFrame=new Ht,i}return Pe(e,t),e.prototype.bind=function(t,e,i){void 0===t&&(t=null);var r,s,a,n=this.renderer;this.current=t,t?(a=(r=t.baseTexture).resolution,e||(cr.width=t.frame.width,cr.height=t.frame.height,e=cr),i||(lr.x=t.frame.x,lr.y=t.frame.y,lr.width=e.width,lr.height=e.height,i=lr),s=r.framebuffer):(a=n.resolution,e||(cr.width=n.screen.width,cr.height=n.screen.height,e=cr),i||((i=cr).width=e.width,i.height=e.height)),hr.x=i.x*a,hr.y=i.y*a,hr.width=i.width*a,hr.height=i.height*a,this.renderer.framebuffer.bind(s,hr),this.renderer.projection.update(i,e,a,!s),t?this.renderer.mask.setMaskStack(r.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(i)},e.prototype.clear=function(t,e){t=this.current?t||this.current.baseTexture.clearColor:t||this.clearColor,this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],e)},e.prototype.resize=function(){this.bind(null)},e.prototype.reset=function(){this.bind(null)},e}(Ge),dr=function(){},pr=function(){function t(t,e){this.program=t,this.uniformData=e,this.uniformGroups={}}return t.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.program=null},t}(),fr=0,mr={textureCount:0},yr=function(t){function e(e){var i=t.call(this,e)||this;return i.destroyed=!1,i.systemCheck(),i.gl=null,i.shader=null,i.program=null,i.cache={},i.id=fr++,i}return Pe(e,t),e.prototype.systemCheck=function(){if(!function(){if("boolean"==typeof qi)return qi;try{var t=new Function("param1","param2","param3","return param1[param2] === param3;");qi=!0===t({a:"b"},"a","b")}catch(t){qi=!1}return qi}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},e.prototype.contextChange=function(t){this.gl=t,this.reset()},e.prototype.bind=function(t,e){t.uniforms.globals=this.renderer.globalUniforms;var i=t.program,r=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateShader(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(r.program)),e||(mr.textureCount=0,this.syncUniformGroup(t.uniformGroup,mr)),r},e.prototype.setUniforms=function(t){var e=this.shader.program,i=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(i.uniformData,t,this.renderer)},e.prototype.syncUniformGroup=function(t,e){var i=this.getglProgram();t.static&&t.dirtyId===i.uniformGroups[t.id]||(i.uniformGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,e))},e.prototype.syncUniforms=function(t,e,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,i)},e.prototype.createSyncGroups=function(t){var e=this.getSignature(t,this.shader.program.uniformData);return this.cache[e]||(this.cache[e]=function(t,e){var i=["\n        var v = null;\n        var cv = null\n        var t = 0;\n        var gl = renderer.gl\n    "];for(var r in t.uniforms){var s=e[r];if(s){for(var a=t.uniforms[r],n=!1,o=0;o<Vi.length;o++)if(Vi[o].test(s,a)){i.push(Vi[o].code(r,a)),n=!0;break}if(!n){var c=(1===s.size?Hi:Wi)[s.type].replace("location",'ud["'+r+'"].location');i.push('\n            cv = ud["'+r+'"].value;\n            v = uv["'+r+'"];\n            '+c+";")}}else t.uniforms[r].group&&i.push('\n                    renderer.shader.syncUniformGroup(uv["'+r+'"], syncData);\n                ')}return new Function("ud","uv","renderer","syncData",i.join("\n"))}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]},e.prototype.getSignature=function(t,e){var i=t.uniforms,r=[];for(var s in i)r.push(s),e[s]&&r.push(e[s].type);return r.join("-")},e.prototype.getglProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},e.prototype.generateShader=function(t){var e=this.gl,i=t.program,r={};for(var s in i.attributeData)r[s]=i.attributeData[s].location;var a=Ti(e,i.vertexSrc,i.fragmentSrc,r),n={};for(var s in i.uniformData){var o=i.uniformData[s];n[s]={location:e.getUniformLocation(a,s),value:Pi(o.type,o.size)}}var c=new pr(a,n);return i.glPrograms[this.renderer.CONTEXT_UID]=c,c},e.prototype.reset=function(){this.program=null,this.shader=null},e.prototype.destroy=function(){this.destroyed=!0},e}(Ge);var _r=function(t){function e(e){var i=t.call(this,e)||this;return i.gl=null,i.stateId=0,i.polygonOffset=0,i.blendMode=N.NONE,i._blendEq=!1,i.map=[],i.map[0]=i.setBlend,i.map[1]=i.setOffset,i.map[2]=i.setCullFace,i.map[3]=i.setDepthTest,i.map[4]=i.setFrontFace,i.checks=[],i.defaultState=new Zi,i.defaultState.blend=!0,i}return Pe(e,t),e.prototype.contextChange=function(t){this.gl=t,this.blendModes=function(t,e){return void 0===e&&(e=[]),e[N.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[N.ADD]=[t.ONE,t.ONE],e[N.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[N.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[N.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[N.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[N.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[N.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[N.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[N.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[N.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[N.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[N.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[N.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[N.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[N.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[N.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[N.NONE]=[0,0],e[N.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[N.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[N.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[N.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[N.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[N.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[N.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[N.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[N.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[N.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[N.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[N.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}(t),this.set(this.defaultState),this.reset()},e.prototype.set=function(t){if(t=t||this.defaultState,this.stateId!==t.data){for(var e=this.stateId^t.data,i=0;e;)1&e&&this.map[i].call(this,!!(t.data&1<<i)),e>>=1,i++;this.stateId=t.data}for(i=0;i<this.checks.length;i++)this.checks[i](this,t)},e.prototype.forceState=function(t){t=t||this.defaultState;for(var e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data},e.prototype.setBlend=function(t){this.updateCheck(e.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)},e.prototype.setOffset=function(t){this.updateCheck(e.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},e.prototype.setDepthTest=function(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)},e.prototype.setCullFace=function(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)},e.prototype.setFrontFace=function(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])},e.prototype.setBlendMode=function(t){if(t!==this.blendMode){this.blendMode=t;var e=this.blendModes[t],i=this.gl;2===e.length?i.blendFunc(e[0],e[1]):i.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,i.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}},e.prototype.setPolygonOffset=function(t,e){this.gl.polygonOffset(t,e)},e.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},e.prototype.updateCheck=function(t,e){var i=this.checks.indexOf(t);e&&-1===i?this.checks.push(t):e||-1===i||this.checks.splice(i,1)},e.checkBlendMode=function(t,e){t.setBlendMode(e.blendMode)},e.checkPolygonOffset=function(t,e){t.setPolygonOffset(1,e.polygonOffset)},e}(Ge),gr=function(t){function e(e){var i=t.call(this,e)||this;return i.count=0,i.checkCount=0,i.maxIdle=D.GC_MAX_IDLE,i.checkCountMax=D.GC_MAX_CHECK_COUNT,i.mode=D.GC_MODE,i}return Pe(e,t),e.prototype.postrender=function(){this.renderer.renderingToScreen&&(this.count++,this.mode!==Y.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},e.prototype.run=function(){for(var t=this.renderer.texture,e=t.managedTextures,i=!1,r=0;r<e.length;r++){var s=e[r];!s.framebuffer&&this.count-s.touched>this.maxIdle&&(t.destroyTexture(s,!0),e[r]=null,i=!0)}if(i){var a=0;for(r=0;r<e.length;r++)null!==e[r]&&(e[a++]=e[r]);e.length=a}},e.prototype.unload=function(t){var e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(var r=t.children.length-1;r>=0;r--)this.unload(t.children[r])},e}(Ge),vr=function(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=6408,this.internalFormat=5121},Sr=function(t){function e(e){var i=t.call(this,e)||this;return i.boundTextures=[],i.currentLocation=-1,i.managedTextures=[],i._unknownBoundTextures=!1,i.unknownTexture=new Le,i}return Pe(e,t),e.prototype.contextChange=function(){var t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion;var e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(var i=0;i<e;i++)this.boundTextures[i]=null;this.emptyTextures={};var r=new vr(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new vr(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(i=0;i<6;i++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(i=0;i<this.boundTextures.length;i++)this.bind(null,i)},e.prototype.bind=function(t,e){void 0===e&&(e=0);var i=this.gl;if(t){if((t=t.castToBaseTexture()).parentTextureArray)return;if(t.valid){t.touched=this.renderer.textureGC.count;var r=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(t.target,r.texture)),r.dirtyId!==t.dirtyId&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),this.updateTexture(t)),this.boundTextures[e]=t}}else this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[e]=null},e.prototype.reset=function(){this._unknownBoundTextures=!0,this.currentLocation=-1;for(var t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture},e.prototype.unbind=function(t){var e=this.gl,i=this.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var r=0;r<i.length;r++)i[r]===this.unknownTexture&&this.bind(null,r)}for(r=0;r<i.length;r++)i[r]===t&&(this.currentLocation!==r&&(e.activeTexture(e.TEXTURE0+r),this.currentLocation=r),e.bindTexture(t.target,this.emptyTextures[t.target].texture),i[r]=null)},e.prototype.initTexture=function(t){var e=new vr(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e},e.prototype.initTextureType=function(t,e){if(e.internalFormat=t.format,e.type=t.type,2===this.webGLVersion){var i=this.renderer.gl;t.type===i.FLOAT&&t.format===i.RGBA&&(e.internalFormat=i.RGBA32F),t.type===H.HALF_FLOAT&&(e.type=i.HALF_FLOAT),e.type===i.HALF_FLOAT&&t.format===i.RGBA&&(e.internalFormat=i.RGBA16F)}},e.prototype.updateTexture=function(t){var e=t._glTextures[this.CONTEXT_UID];if(e){var i=this.renderer;if(this.initTextureType(t,e),t.resource&&t.resource.upload(i,t,e));else{var r=t.realWidth,s=t.realHeight,a=i.gl;(e.width!==r||e.height!==s||e.dirtyId<0)&&(e.width=r,e.height=s,a.texImage2D(t.target,0,e.internalFormat,r,s,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}},e.prototype.destroyTexture=function(t,e){var i=this.gl;if((t=t.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){var r=this.managedTextures.indexOf(t);-1!==r&&St(this.managedTextures,r,1)}},e.prototype.updateTextureStyle=function(t){var e=t._glTextures[this.CONTEXT_UID];e&&(t.mipmap!==G.POW2&&2===this.webGLVersion||t.isPowerOfTwo?e.mipmap=t.mipmap>=1:e.mipmap=!1,2===this.webGLVersion||t.isPowerOfTwo?e.wrapMode=t.wrapMode:e.wrapMode=q.CLAMP,t.resource&&t.resource.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)},e.prototype.setStyle=function(t,e){var i=this.gl;if(e.mipmap&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===W.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);var r=this.renderer.context.extensions.anisotropicFiltering;if(r&&t.anisotropicLevel>0&&t.scaleMode===W.LINEAR){var s=Math.min(t.anisotropicLevel,i.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,r.TEXTURE_MAX_ANISOTROPY_EXT,s)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===W.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===W.LINEAR?i.LINEAR:i.NEAREST)},e}(Ge),Mr={FilterSystem:mi,BatchSystem:_i,ContextSystem:vi,FramebufferSystem:Ri,GeometrySystem:Ii,MaskSystem:rr,ScissorSystem:ar,StencilSystem:nr,ProjectionSystem:or,RenderTextureSystem:ur,ShaderSystem:yr,StateSystem:_r,TextureGCSystem:gr,TextureSystem:Sr},Rr=new Kt,br=function(t){function e(e,i){void 0===e&&(e=F.UNKNOWN);var r=t.call(this)||this;return(i=Object.assign({},D.RENDER_OPTIONS,i)).roundPixels&&(D.ROUND_PIXELS=i.roundPixels,It("5.0.0","Renderer roundPixels option is deprecated, please use PIXI.settings.ROUND_PIXELS",2)),r.options=i,r.type=e,r.screen=new Ht(0,0,i.width,i.height),r.view=i.view||document.createElement("canvas"),r.resolution=i.resolution||D.RESOLUTION,r.transparent=i.transparent,r.autoDensity=i.autoDensity||i.autoResize||!1,r.preserveDrawingBuffer=i.preserveDrawingBuffer,r.clearBeforeRender=i.clearBeforeRender,r._backgroundColor=0,r._backgroundColorRgba=[0,0,0,0],r._backgroundColorString="#000000",r.backgroundColor=i.backgroundColor||r._backgroundColor,r._lastObjectRendered=null,r.plugins={},r}return Pe(e,t),e.prototype.initPlugins=function(t){for(var e in t)this.plugins[e]=new t[e](this)},Object.defineProperty(e.prototype,"width",{get:function(){return this.view.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.view.height},enumerable:!1,configurable:!0}),e.prototype.resize=function(t,e){this.screen.width=t,this.screen.height=e,this.view.width=t*this.resolution,this.view.height=e*this.resolution,this.autoDensity&&(this.view.style.width=t+"px",this.view.style.height=e+"px"),this.emit("resize",t,e)},e.prototype.generateTexture=function(t,e,i,r){0===(r=r||t.getLocalBounds(null,!0)).width&&(r.width=1),0===r.height&&(r.height=1);var s=Je.create({width:0|r.width,height:0|r.height,scaleMode:e,resolution:i});return Rr.tx=-r.x,Rr.ty=-r.y,this.render(t,s,!1,Rr,!!t.parent),s},e.prototype.destroy=function(t){for(var e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null;t&&this.view.parentNode&&this.view.parentNode.removeChild(this.view);var i=this;i.plugins=null,i.type=F.UNKNOWN,i.view=null,i.screen=null,i._tempDisplayObjectParent=null,i.options=null,this._backgroundColorRgba=null,this._backgroundColorString=null,this._lastObjectRendered=null},Object.defineProperty(e.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t,this._backgroundColorString=at(t),st(t,this._backgroundColorRgba)},enumerable:!1,configurable:!0}),e}(A()),Er=function(t){function e(i){var r=t.call(this,F.WEBGL,i)||this;return i=r.options,r.gl=null,r.CONTEXT_UID=0,r.runners={destroy:new xe("destroy"),contextChange:new xe("contextChange"),reset:new xe("reset"),update:new xe("update"),postrender:new xe("postrender"),prerender:new xe("prerender"),resize:new xe("resize")},r.globalUniforms=new pi({projectionMatrix:new Kt},!0),r.addSystem(rr,"mask").addSystem(vi,"context").addSystem(_r,"state").addSystem(yr,"shader").addSystem(Sr,"texture").addSystem(Ii,"geometry").addSystem(Ri,"framebuffer").addSystem(ar,"scissor").addSystem(nr,"stencil").addSystem(or,"projection").addSystem(gr,"textureGC").addSystem(mi,"filter").addSystem(ur,"renderTexture").addSystem(_i,"batch"),r.initPlugins(e.__plugins),i.context?r.context.initFromContext(i.context):r.context.initFromOptions({alpha:!!r.transparent,antialias:i.antialias,premultipliedAlpha:r.transparent&&"notMultiplied"!==r.transparent,stencil:!0,preserveDrawingBuffer:i.preserveDrawingBuffer,powerPreference:r.options.powerPreference}),r.renderingToScreen=!0,it(2===r.context.webGLVersion?"WebGL 2":"WebGL 1"),r.resize(r.options.width,r.options.height),r}return Pe(e,t),e.create=function(t){if(rt())return new e(t);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},e.prototype.addSystem=function(t,e){e||(e=t.name);var i=new t(this);if(this[e])throw new Error('Whoops! The name "'+e+'" is already in use');for(var r in this[e]=i,this.runners)this.runners[r].add(i);return this},e.prototype.render=function(t,e,i,r,s){if(this.renderingToScreen=!e,this.runners.prerender.emit(),this.emit("prerender"),this.projection.transform=r,!this.context.isLost){if(e||(this._lastObjectRendered=t),!s){var a=t.enableTempParent();t.updateTransform(),t.disableTempParent(a)}this.renderTexture.bind(e),this.batch.currentRenderer.start(),(void 0!==i?i:this.clearBeforeRender)&&this.renderTexture.clear(),t.render(this),this.batch.currentRenderer.flush(),e&&e.baseTexture.update(),this.runners.postrender.emit(),this.projection.transform=null,this.emit("postrender")}},e.prototype.resize=function(e,i){t.prototype.resize.call(this,e,i),this.runners.resize.emit(e,i)},e.prototype.reset=function(){return this.runners.reset.emit(),this},e.prototype.clear=function(){this.renderTexture.bind(),this.renderTexture.clear()},e.prototype.destroy=function(e){for(var i in this.runners.destroy.emit(),this.runners)this.runners[i].destroy();t.prototype.destroy.call(this,e),this.gl=null},e.registerPlugin=function(t,i){e.__plugins=e.__plugins||{},e.__plugins[t]=i},e}(br);function Ir(t){return Er.create(t)}var xr="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",wr="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n",Tr=function(){this.texArray=null,this.blend=0,this.type=j.TRIANGLES,this.start=0,this.size=0,this.data=null},Dr=function(){function t(){this.elements=[],this.ids=[],this.count=0}return t.prototype.clear=function(){for(var t=0;t<this.count;t++)this.elements[t]=null;this.count=0},t}(),Pr=function(){function t(t){this.rawBinaryData=new ArrayBuffer(t),this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}return Object.defineProperty(t.prototype,"int8View",{get:function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uint8View",{get:function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"int16View",{get:function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uint16View",{get:function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"int32View",{get:function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},enumerable:!1,configurable:!0}),t.prototype.view=function(t){return this[t+"View"]},t.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},t.sizeOf=function(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(t+" isn't a valid view type")}},t}(),Ar=function(t){function e(e){var i=t.call(this,e)||this;return i.shaderGenerator=null,i.geometryClass=null,i.vertexSize=null,i.state=Zi.for2d(),i.size=4*D.SPRITE_BATCH_SIZE,i._vertexCount=0,i._indexCount=0,i._bufferedElements=[],i._bufferedTextures=[],i._bufferSize=0,i._shader=null,i._packedGeometries=[],i._packedGeometryPoolSize=2,i._flushId=0,i._aBuffers={},i._iBuffers={},i.MAX_TEXTURES=1,i.renderer.on("prerender",i.onPrerender,i),e.runners.contextChange.add(i),i._dcIndex=0,i._aIndex=0,i._iIndex=0,i._attributeBuffer=null,i._indexBuffer=null,i._tempBoundTextures=[],i}return Pe(e,t),e.prototype.contextChange=function(){var t=this.renderer.gl;D.PREFER_ENV===B.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),D.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=Xi(this.MAX_TEXTURES,t)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()},e.prototype.initFlushBuffers=function(){for(var t=e._drawCallPool,i=e._textureArrayPool,r=this.size/4,s=Math.floor(r/this.MAX_TEXTURES)+1;t.length<r;)t.push(new Tr);for(;i.length<s;)i.push(new Dr);for(var a=0;a<this.MAX_TEXTURES;a++)this._tempBoundTextures[a]=null},e.prototype.onPrerender=function(){this._flushId=0},e.prototype.render=function(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)},e.prototype.buildTexturesAndDrawCalls=function(){var t=this._bufferedTextures,i=this.MAX_TEXTURES,r=e._textureArrayPool,s=this.renderer.batch,a=this._tempBoundTextures,n=this.renderer.textureGC.count,o=++Le._globalBatch,c=0,l=r[0],h=0;s.copyBoundTextures(a,i);for(var u=0;u<this._bufferSize;++u){var d=t[u];t[u]=null,d._batchEnabled!==o&&(l.count>=i&&(s.boundArray(l,a,o,i),this.buildDrawCalls(l,h,u),h=u,l=r[++c],++o),d._batchEnabled=o,d.touched=n,l.elements[l.count++]=d)}l.count>0&&(s.boundArray(l,a,o,i),this.buildDrawCalls(l,h,this._bufferSize),++c,++o);for(u=0;u<a.length;u++)a[u]=null;Le._globalBatch=o},e.prototype.buildDrawCalls=function(t,i,r){var s=this,a=s._bufferedElements,n=s._attributeBuffer,o=s._indexBuffer,c=s.vertexSize,l=e._drawCallPool,h=this._dcIndex,u=this._aIndex,d=this._iIndex,p=l[h];p.start=this._iIndex,p.texArray=t;for(var f=i;f<r;++f){var m=a[f],y=m._texture.baseTexture,_=ct[y.alphaMode?1:0][m.blendMode];a[f]=null,i<f&&p.blend!==_&&(p.size=d-p.start,i=f,(p=l[++h]).texArray=t,p.start=d),this.packInterleavedGeometry(m,n,o,u,d),u+=m.vertexData.length/2*c,d+=m.indices.length,p.blend=_}i<r&&(p.size=d-p.start,++h),this._dcIndex=h,this._aIndex=u,this._iIndex=d},e.prototype.bindAndClearTexArray=function(t){for(var e=this.renderer.texture,i=0;i<t.count;i++)e.bind(t.elements[i],t.ids[i]),t.elements[i]=null;t.count=0},e.prototype.updateGeometry=function(){var t=this,e=t._packedGeometries,i=t._attributeBuffer,r=t._indexBuffer;D.CAN_UPLOAD_SAME_BUFFER?(e[this._flushId]._buffer.update(i.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(i.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},e.prototype.drawBatches=function(){for(var t=this._dcIndex,i=this.renderer,r=i.gl,s=i.state,a=e._drawCallPool,n=null,o=0;o<t;o++){var c=a[o],l=c.texArray,h=c.type,u=c.size,d=c.start,p=c.blend;n!==l&&(n=l,this.bindAndClearTexArray(l)),this.state.blendMode=p,s.set(this.state),r.drawElements(h,u,r.UNSIGNED_SHORT,2*d)}},e.prototype.flush=function(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},e.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.shader.bind(this._shader),D.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},e.prototype.stop=function(){this.flush()},e.prototype.destroy=function(){for(var e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),t.prototype.destroy.call(this)},e.prototype.getAttributeBuffer=function(t){var e=_t(Math.ceil(t/8)),i=vt(e),r=8*e;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);var s=this._aBuffers[r];return s||(this._aBuffers[r]=s=new Pr(r*this.vertexSize*4)),s},e.prototype.getIndexBuffer=function(t){var e=_t(Math.ceil(t/12)),i=vt(e),r=12*e;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);var s=this._iBuffers[i];return s||(this._iBuffers[i]=s=new Uint16Array(r)),s},e.prototype.packInterleavedGeometry=function(t,e,i,r,s){for(var a=e.uint32View,n=e.float32View,o=r/this.vertexSize,c=t.uvs,l=t.indices,h=t.vertexData,u=t._texture.baseTexture._batchLocation,d=Math.min(t.worldAlpha,1),p=d<1&&t._texture.baseTexture.alphaMode?ut(t._tintRGB,d):t._tintRGB+(255*d<<24),f=0;f<h.length;f+=2)n[r++]=h[f],n[r++]=h[f+1],n[r++]=c[f],n[r++]=c[f+1],a[r++]=p,n[r++]=u;for(f=0;f<l.length;f++)i[s++]=o+l[f]},e._drawCallPool=[],e._textureArrayPool=[],e}(yi),kr=function(){function t(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},e.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(e.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')}return t.prototype.generateShader=function(t){if(!this.programCache[t]){for(var e=new Int32Array(t),i=0;i<t;i++)e[i]=i;this.defaultGroupCache[t]=pi.from({uSamplers:e},!0);var r=this.fragTemplate;r=(r=r.replace(/%count%/gi,""+t)).replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new $i(this.vertexSrc,r)}var s={tint:new Float32Array([1,1,1,1]),translationMatrix:new Kt,default:this.defaultGroupCache[t]};return new Qi(this.programCache[t],s)},t.prototype.generateSampleSrc=function(t){var e="";e+="\n",e+="\n";for(var i=0;i<t;i++)i>0&&(e+="\nelse "),i<t-1&&(e+="if(vTextureId < "+i+".5)"),e+="\n{",e+="\n\tcolor = texture2D(uSamplers["+i+"], vTextureCoord);",e+="\n}";return e+="\n",e+="\n"},t}(),Cr=function(t){function e(e){void 0===e&&(e=!1);var i=t.call(this)||this;return i._buffer=new ri(null,e,!1),i._indexBuffer=new ri(null,e,!0),i.addAttribute("aVertexPosition",i._buffer,2,!1,H.FLOAT).addAttribute("aTextureCoord",i._buffer,2,!1,H.FLOAT).addAttribute("aColor",i._buffer,4,!0,H.UNSIGNED_BYTE).addAttribute("aTextureId",i._buffer,1,!0,H.FLOAT).addIndex(i._indexBuffer),i}return Pe(e,t),e}(li),Lr="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n",Br="varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n",Fr=function(){function t(){}return t.create=function(t){var e=Object.assign({vertex:Lr,fragment:Br,geometryClass:Cr,vertexSize:6},t),i=e.vertex,r=e.fragment,s=e.vertexSize,a=e.geometryClass;return function(t){function e(e){var n=t.call(this,e)||this;return n.shaderGenerator=new kr(i,r),n.geometryClass=a,n.vertexSize=s,n}return Pe(e,t),e}(Ar)},Object.defineProperty(t,"defaultVertexSrc",{get:function(){return Lr},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultFragmentTemplate",{get:function(){return Br},enumerable:!1,configurable:!0}),t}(),Or=Fr.create(),Nr=function(){function t(e){var i=this;e=Object.assign({forceCanvas:!1},e),this.renderer=Ir(e),this.stage=new ue,t._plugins.forEach((function(t){t.init.call(i,e)}))}return t.registerPlugin=function(e){t._plugins.push(e)},t.prototype.render=function(){this.renderer.render(this.stage)},Object.defineProperty(t.prototype,"view",{get:function(){return this.renderer.view},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"screen",{get:function(){return this.renderer.screen},enumerable:!1,configurable:!0}),t.prototype.destroy=function(e,i){var r=this,s=t._plugins.slice(0);s.reverse(),s.forEach((function(t){t.destroy.call(r)})),this.stage.destroy(i),this.stage=null,this.renderer.destroy(e),this.renderer=null},t}();Nr._plugins=[];var jr=function(){function t(){}return t.init=function(t){var e=this;Object.defineProperty(this,"resizeTo",{set:function(t){window.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(window.addEventListener("resize",this.queueResize),this.resize())},get:function(){return this._resizeTo}}),this.queueResize=function(){e._resizeTo&&(e.cancelResize(),e._resizeId=requestAnimationFrame((function(){return e.resize()})))},this.cancelResize=function(){e._resizeId&&(cancelAnimationFrame(e._resizeId),e._resizeId=null)},this.resize=function(){if(e._resizeTo){var t,i;if(e.cancelResize(),e._resizeTo===window)t=window.innerWidth,i=window.innerHeight;else{var r=e._resizeTo;t=r.clientWidth,i=r.clientHeight}e.renderer.resize(t,i)}},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null},t.destroy=function(){window.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null},t}();Nr.registerPlugin(jr);var Ur=new Ht,Vr=function(){function t(t){this.renderer=t,t.extract=this}return t.prototype.image=function(t,e,i){var r=new Image;return r.src=this.base64(t,e,i),r},t.prototype.base64=function(t,e,i){return this.canvas(t).toDataURL(e,i)},t.prototype.canvas=function(e){var i,r,s,a=this.renderer,n=!1,o=!1;e&&(e instanceof Je?s=e:(s=this.renderer.generateTexture(e),o=!0)),s?(i=s.baseTexture.resolution,r=s.frame,n=!1,a.renderTexture.bind(s)):(i=this.renderer.resolution,n=!0,(r=Ur).width=this.renderer.width,r.height=this.renderer.height,a.renderTexture.bind(null));var c=Math.floor(r.width*i+1e-4),l=Math.floor(r.height*i+1e-4),h=new At(c,l,1),u=new Uint8Array(4*c*l),d=a.gl;d.readPixels(r.x*i,r.y*i,c,l,d.RGBA,d.UNSIGNED_BYTE,u);var p=h.context.getImageData(0,0,c,l);if(t.arrayPostDivide(u,p.data),h.context.putImageData(p,0,0),n){var f=new At(h.width,h.height,1);f.context.scale(1,-1),f.context.drawImage(h.canvas,0,-l),h.destroy(),h=f}return o&&s.destroy(!0),h.canvas},t.prototype.pixels=function(e){var i,r,s,a=this.renderer,n=!1;e&&(e instanceof Je?s=e:(s=this.renderer.generateTexture(e),n=!0)),s?(i=s.baseTexture.resolution,r=s.frame,a.renderTexture.bind(s)):(i=a.resolution,(r=Ur).width=a.width,r.height=a.height,a.renderTexture.bind(null));var o=r.width*i,c=r.height*i,l=new Uint8Array(4*o*c),h=a.gl;return h.readPixels(r.x*i,r.y*i,o,c,h.RGBA,h.UNSIGNED_BYTE,l),n&&s.destroy(!0),t.arrayPostDivide(l,l),l},t.prototype.destroy=function(){this.renderer.extract=null,this.renderer=null},t.arrayPostDivide=function(t,e){for(var i=0;i<t.length;i+=4){var r=e[i+3]=t[i+3];0!==r?(e[i]=Math.round(Math.min(255*t[i]/r,255)),e[i+1]=Math.round(Math.min(255*t[i+1]/r,255)),e[i+2]=Math.round(Math.min(255*t[i+2]/r,255))):(e[i]=t[i],e[i+1]=t[i+1],e[i+2]=t[i+2])}},t}(),Hr=i(9571),Wr=i.n(Hr),qr=i(2940),Gr=i.n(qr);function zr(){}function Xr(t,e,i,r){var s=0,a=t.length;!function n(o){o||s===a?i&&i(o):r?setTimeout((function(){e(t[s++],n)}),1):e(t[s++],n)}()}function Yr(t){return function(){if(null===t)throw new Error("Callback was already called.");var e=t;t=null,e.apply(this,arguments)}}function Kr(t,e){if(null==e)e=1;else if(0===e)throw new Error("Concurrency must not be zero");var i=0,r={_tasks:[],concurrency:e,saturated:zr,unsaturated:zr,buffer:e/4,empty:zr,drain:zr,error:zr,started:!1,paused:!1,push:function(t,e){s(t,!1,e)},kill:function(){i=0,r.drain=zr,r.started=!1,r._tasks=[]},unshift:function(t,e){s(t,!0,e)},process:function(){for(;!r.paused&&i<r.concurrency&&r._tasks.length;){var e=r._tasks.shift();0===r._tasks.length&&r.empty(),(i+=1)===r.concurrency&&r.saturated(),t(e.data,Yr(a(e)))}},length:function(){return r._tasks.length},running:function(){return i},idle:function(){return r._tasks.length+i===0},pause:function(){!0!==r.paused&&(r.paused=!0)},resume:function(){if(!1!==r.paused){r.paused=!1;for(var t=1;t<=r.concurrency;t++)r.process()}}};function s(t,e,i){if(null!=i&&"function"!=typeof i)throw new Error("task callback must be a function");if(r.started=!0,null==t&&r.idle())setTimeout((function(){return r.drain()}),1);else{var s={data:t,callback:"function"==typeof i?i:zr};e?r._tasks.unshift(s):r._tasks.push(s),setTimeout((function(){return r.process()}),1)}}function a(t){return function(){i-=1,t.callback.apply(t,arguments),null!=arguments[0]&&r.error(arguments[0],t.data),i<=r.concurrency-r.buffer&&r.unsaturated(),r.idle()&&r.drain(),r.process()}}return r}var $r={};function Qr(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Zr(t,e,i){return e&&Qr(t.prototype,e),i&&Qr(t,i),t}var Jr=!(!window.XDomainRequest||"withCredentials"in new XMLHttpRequest),ts=null;function es(){}var is=function(){function t(e,i,r){if("string"!=typeof e||"string"!=typeof i)throw new Error("Both name and url are required for constructing a resource.");r=r||{},this._flags=0,this._setFlag(t.STATUS_FLAGS.DATA_URL,0===i.indexOf("data:")),this.name=e,this.url=i,this.extension=this._getExtension(),this.data=null,this.crossOrigin=!0===r.crossOrigin?"anonymous":r.crossOrigin,this.timeout=r.timeout||0,this.loadType=r.loadType||this._determineLoadType(),this.xhrType=r.xhrType,this.metadata=r.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=t.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=es,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundOnTimeout=this._onTimeout.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this.onStart=new(Gr()),this.onProgress=new(Gr()),this.onComplete=new(Gr()),this.onAfterMiddleware=new(Gr())}t.setExtensionLoadType=function(e,i){rs(t._loadTypeMap,e,i)},t.setExtensionXhrType=function(e,i){rs(t._xhrTypeMap,e,i)};var e=t.prototype;return e.complete=function(){this._clearEvents(),this._finish()},e.abort=function(e){if(!this.error){if(this.error=new Error(e),this._clearEvents(),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=t.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this._finish()}},e.load=function(e){var i=this;if(!this.isLoading)if(this.isComplete)e&&setTimeout((function(){return e(i)}),1);else switch(e&&this.onComplete.once(e),this._setFlag(t.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),!1!==this.crossOrigin&&"string"==typeof this.crossOrigin||(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case t.LOAD_TYPE.IMAGE:this.type=t.TYPE.IMAGE,this._loadElement("image");break;case t.LOAD_TYPE.AUDIO:this.type=t.TYPE.AUDIO,this._loadSourceElement("audio");break;case t.LOAD_TYPE.VIDEO:this.type=t.TYPE.VIDEO,this._loadSourceElement("video");break;case t.LOAD_TYPE.XHR:default:Jr&&this.crossOrigin?this._loadXdr():this._loadXhr()}},e._hasFlag=function(t){return 0!=(this._flags&t)},e._setFlag=function(t,e){this._flags=e?this._flags|t:this._flags&~t},e._clearEvents=function(){clearTimeout(this._elementTimer),this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("timeout",this._boundXhrOnTimeout,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null))},e._finish=function(){if(this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(t.STATUS_FLAGS.COMPLETE,!0),this._setFlag(t.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},e._loadElement=function(t){this.metadata.loadElement?this.data=this.metadata.loadElement:"image"===t&&void 0!==window.Image?this.data=new Image:this.data=document.createElement(t),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},e._loadSourceElement=function(t){if(this.metadata.loadElement?this.data=this.metadata.loadElement:"audio"===t&&void 0!==window.Audio?this.data=new Audio:this.data=document.createElement(t),null!==this.data){if(this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var e=this.metadata.mimeType,i=0;i<this.url.length;++i)this.data.appendChild(this._createSource(t,this.url[i],Array.isArray(e)?e[i]:e));else{var r=this.metadata.mimeType;this.data.appendChild(this._createSource(t,this.url,Array.isArray(r)?r[0]:r))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load(),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))}else this.abort("Unsupported element: "+t)},e._loadXhr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var e=this.xhr=new XMLHttpRequest;e.open("GET",this.url,!0),e.timeout=this.timeout,this.xhrType===t.XHR_RESPONSE_TYPE.JSON||this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT?e.responseType=t.XHR_RESPONSE_TYPE.TEXT:e.responseType=this.xhrType,e.addEventListener("error",this._boundXhrOnError,!1),e.addEventListener("timeout",this._boundXhrOnTimeout,!1),e.addEventListener("abort",this._boundXhrOnAbort,!1),e.addEventListener("progress",this._boundOnProgress,!1),e.addEventListener("load",this._boundXhrOnLoad,!1),e.send()},e._loadXdr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var t=this.xhr=new XDomainRequest;t.timeout=this.timeout||5e3,t.onerror=this._boundXhrOnError,t.ontimeout=this._boundXhrOnTimeout,t.onprogress=this._boundOnProgress,t.onload=this._boundXhrOnLoad,t.open("GET",this.url,!0),setTimeout((function(){return t.send()}),1)},e._createSource=function(t,e,i){i||(i=t+"/"+this._getExtension(e));var r=document.createElement("source");return r.src=e,r.type=i,r},e._onError=function(t){this.abort("Failed to load element using: "+t.target.nodeName)},e._onProgress=function(t){t&&t.lengthComputable&&this.onProgress.dispatch(this,t.loaded/t.total)},e._onTimeout=function(){this.abort("Load timed out.")},e._xhrOnError=function(){var t=this.xhr;this.abort(ss(t)+" Request failed. Status: "+t.status+', text: "'+t.statusText+'"')},e._xhrOnTimeout=function(){var t=this.xhr;this.abort(ss(t)+" Request timed out.")},e._xhrOnAbort=function(){var t=this.xhr;this.abort(ss(t)+" Request was aborted by the user.")},e._xhrOnLoad=function(){var e=this.xhr,i="",r=void 0===e.status?200:e.status;if(""!==e.responseType&&"text"!==e.responseType&&void 0!==e.responseType||(i=e.responseText),0===r&&(i.length>0||e.responseType===t.XHR_RESPONSE_TYPE.BUFFER)?r=200:1223===r&&(r=204),2===(r/100|0)){if(this.xhrType===t.XHR_RESPONSE_TYPE.TEXT)this.data=i,this.type=t.TYPE.TEXT;else if(this.xhrType===t.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(i),this.type=t.TYPE.JSON}catch(t){return void this.abort("Error trying to parse loaded json: "+t)}else if(this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser){var s=new DOMParser;this.data=s.parseFromString(i,"text/xml")}else{var a=document.createElement("div");a.innerHTML=i,this.data=a}this.type=t.TYPE.XML}catch(t){return void this.abort("Error trying to parse loaded xml: "+t)}else this.data=e.response||i;this.complete()}else this.abort("["+e.status+"] "+e.statusText+": "+e.responseURL)},e._determineCrossOrigin=function(t,e){if(0===t.indexOf("data:"))return"";if(window.origin!==window.location.origin)return"anonymous";e=e||window.location,ts||(ts=document.createElement("a")),ts.href=t;var i=!(t=Wr()(ts.href,{strictMode:!0})).port&&""===e.port||t.port===e.port,r=t.protocol?t.protocol+":":"";return t.host===e.hostname&&i&&r===e.protocol?"":"anonymous"},e._determineXhrType=function(){return t._xhrTypeMap[this.extension]||t.XHR_RESPONSE_TYPE.TEXT},e._determineLoadType=function(){return t._loadTypeMap[this.extension]||t.LOAD_TYPE.XHR},e._getExtension=function(){var t=this.url,e="";if(this.isDataUrl){var i=t.indexOf("/");e=t.substring(i+1,t.indexOf(";",i))}else{var r=t.indexOf("?"),s=t.indexOf("#"),a=Math.min(r>-1?r:t.length,s>-1?s:t.length);e=(t=t.substring(0,a)).substring(t.lastIndexOf(".")+1)}return e.toLowerCase()},e._getMimeFromXhrType=function(e){switch(e){case t.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case t.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case t.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case t.XHR_RESPONSE_TYPE.JSON:return"application/json";case t.XHR_RESPONSE_TYPE.DEFAULT:case t.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},Zr(t,[{key:"isDataUrl",get:function(){return this._hasFlag(t.STATUS_FLAGS.DATA_URL)}},{key:"isComplete",get:function(){return this._hasFlag(t.STATUS_FLAGS.COMPLETE)}},{key:"isLoading",get:function(){return this._hasFlag(t.STATUS_FLAGS.LOADING)}}]),t}();function rs(t,e,i){e&&0===e.indexOf(".")&&(e=e.substring(1)),e&&(t[e]=i)}function ss(t){return t.toString().replace("object ","")}is.STATUS_FLAGS={NONE:0,DATA_URL:1,COMPLETE:2,LOADING:4},is.TYPE={UNKNOWN:0,JSON:1,XML:2,IMAGE:3,AUDIO:4,VIDEO:5,TEXT:6},is.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4},is.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"},is._loadTypeMap={gif:is.LOAD_TYPE.IMAGE,png:is.LOAD_TYPE.IMAGE,bmp:is.LOAD_TYPE.IMAGE,jpg:is.LOAD_TYPE.IMAGE,jpeg:is.LOAD_TYPE.IMAGE,tif:is.LOAD_TYPE.IMAGE,tiff:is.LOAD_TYPE.IMAGE,webp:is.LOAD_TYPE.IMAGE,tga:is.LOAD_TYPE.IMAGE,svg:is.LOAD_TYPE.IMAGE,"svg+xml":is.LOAD_TYPE.IMAGE,mp3:is.LOAD_TYPE.AUDIO,ogg:is.LOAD_TYPE.AUDIO,wav:is.LOAD_TYPE.AUDIO,mp4:is.LOAD_TYPE.VIDEO,webm:is.LOAD_TYPE.VIDEO},is._xhrTypeMap={xhtml:is.XHR_RESPONSE_TYPE.DOCUMENT,html:is.XHR_RESPONSE_TYPE.DOCUMENT,htm:is.XHR_RESPONSE_TYPE.DOCUMENT,xml:is.XHR_RESPONSE_TYPE.DOCUMENT,tmx:is.XHR_RESPONSE_TYPE.DOCUMENT,svg:is.XHR_RESPONSE_TYPE.DOCUMENT,tsx:is.XHR_RESPONSE_TYPE.DOCUMENT,gif:is.XHR_RESPONSE_TYPE.BLOB,png:is.XHR_RESPONSE_TYPE.BLOB,bmp:is.XHR_RESPONSE_TYPE.BLOB,jpg:is.XHR_RESPONSE_TYPE.BLOB,jpeg:is.XHR_RESPONSE_TYPE.BLOB,tif:is.XHR_RESPONSE_TYPE.BLOB,tiff:is.XHR_RESPONSE_TYPE.BLOB,webp:is.XHR_RESPONSE_TYPE.BLOB,tga:is.XHR_RESPONSE_TYPE.BLOB,json:is.XHR_RESPONSE_TYPE.JSON,text:is.XHR_RESPONSE_TYPE.TEXT,txt:is.XHR_RESPONSE_TYPE.TEXT,ttf:is.XHR_RESPONSE_TYPE.BUFFER,otf:is.XHR_RESPONSE_TYPE.BUFFER},is.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";var as=window.URL||window.webkitURL;var ns={caching:function(t,e){var i=this;$r[t.url]?(t.data=$r[t.url],t.complete()):t.onComplete.once((function(){return $r[i.url]=i.data})),e()},parsing:function(t,e){if(t.data){if(t.xhr&&t.xhrType===is.XHR_RESPONSE_TYPE.BLOB)if(window.Blob&&"string"!=typeof t.data){if(0===t.data.type.indexOf("image")){var i=as.createObjectURL(t.data);return t.blob=t.data,t.data=new Image,t.data.src=i,t.type=is.TYPE.IMAGE,void(t.data.onload=function(){as.revokeObjectURL(i),t.data.onload=null,e()})}}else{var r=t.xhr.getResponseHeader("content-type");if(r&&0===r.indexOf("image"))return t.data=new Image,t.data.src="data:"+r+";base64,"+function(t){for(var e="",i=0;i<t.length;){for(var r=[0,0,0],s=[0,0,0,0],a=0;a<r.length;++a)i<t.length?r[a]=255&t.charCodeAt(i++):r[a]=0;switch(s[0]=r[0]>>2,s[1]=(3&r[0])<<4|r[1]>>4,s[2]=(15&r[1])<<2|r[2]>>6,s[3]=63&r[2],i-(t.length-1)){case 2:s[3]=64,s[2]=64;break;case 1:s[3]=64}for(var n=0;n<s.length;++n)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(s[n])}return e}(t.xhr.responseText),t.type=is.TYPE.IMAGE,void(t.data.onload=function(){t.data.onload=null,e()})}e()}else e()}},os=/(#[\w-]+)?$/,cs=function(){function t(e,i){var r=this;void 0===e&&(e=""),void 0===i&&(i=10),this.baseUrl=e,this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(t,e){return r._loadResource(t,e)},this._queue=Kr(this._boundLoadResource,i),this._queue.pause(),this.resources={},this.onProgress=new(Gr()),this.onError=new(Gr()),this.onLoad=new(Gr()),this.onStart=new(Gr()),this.onComplete=new(Gr());for(var s=0;s<t._defaultBeforeMiddleware.length;++s)this.pre(t._defaultBeforeMiddleware[s]);for(var a=0;a<t._defaultAfterMiddleware.length;++a)this.use(t._defaultAfterMiddleware[a])}var e=t.prototype;return e.add=function(t,e,i,r){if(Array.isArray(t)){for(var s=0;s<t.length;++s)this.add(t[s]);return this}if("object"==typeof t&&(r=e||t.callback||t.onComplete,i=t,e=t.url,t=t.name||t.key||t.url),"string"!=typeof e&&(r=i,i=e,e=t),"string"!=typeof e)throw new Error("No url passed to add resource to loader.");if("function"==typeof i&&(r=i,i=null),this.loading&&(!i||!i.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[t])throw new Error('Resource named "'+t+'" already exists.');if(e=this._prepareUrl(e),this.resources[t]=new is(t,e,i),"function"==typeof r&&this.resources[t].onAfterMiddleware.once(r),this.loading){for(var a=i.parentResource,n=[],o=0;o<a.children.length;++o)a.children[o].isComplete||n.push(a.children[o]);var c=a.progressChunk*(n.length+1)/(n.length+2);a.children.push(this.resources[t]),a.progressChunk=c;for(var l=0;l<n.length;++l)n[l].progressChunk=c;this.resources[t].progressChunk=c}return this._queue.push(this.resources[t]),this},e.pre=function(t){return this._beforeMiddleware.push(t),this},e.use=function(t){return this._afterMiddleware.push(t),this},e.reset=function(){for(var t in this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause(),this.resources){var e=this.resources[t];e._onLoadBinding&&e._onLoadBinding.detach(),e.isLoading&&e.abort()}return this.resources={},this},e.load=function(t){if("function"==typeof t&&this.onComplete.once(t),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var e=100/this._queue._tasks.length,i=0;i<this._queue._tasks.length;++i)this._queue._tasks[i].data.progressChunk=e;this._onStart(),this._queue.resume()}return this},e._prepareUrl=function(t){var e,i=Wr()(t,{strictMode:!0});if(e=i.protocol||!i.path||0===t.indexOf("//")?t:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==t.charAt(0)?this.baseUrl+"/"+t:this.baseUrl+t,this.defaultQueryString){var r=os.exec(e)[0];-1!==(e=e.substr(0,e.length-r.length)).indexOf("?")?e+="&"+this.defaultQueryString:e+="?"+this.defaultQueryString,e+=r}return e},e._loadResource=function(t,e){var i=this;t._dequeue=e,Xr(this._beforeMiddleware,(function(e,r){e.call(i,t,(function(){r(t.isComplete?{}:null)}))}),(function(){t.isComplete?i._onLoad(t):(t._onLoadBinding=t.onComplete.once(i._onLoad,i),t.load())}),!0)},e._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},e._onComplete=function(){this.progress=100,this.loading=!1,this.onComplete.dispatch(this,this.resources)},e._onLoad=function(t){var e=this;t._onLoadBinding=null,this._resourcesParsing.push(t),t._dequeue(),Xr(this._afterMiddleware,(function(i,r){i.call(e,t,r)}),(function(){t.onAfterMiddleware.dispatch(t),e.progress=Math.min(100,e.progress+t.progressChunk),e.onProgress.dispatch(e,t),t.error?e.onError.dispatch(t.error,e,t):e.onLoad.dispatch(e,t),e._resourcesParsing.splice(e._resourcesParsing.indexOf(t),1),e._queue.idle()&&0===e._resourcesParsing.length&&e._onComplete()}),!0)},Zr(t,[{key:"concurrency",get:function(){return this._queue.concurrency},set:function(t){this._queue.concurrency=t}}]),t}();cs._defaultBeforeMiddleware=[],cs._defaultAfterMiddleware=[],cs.pre=function(t){return cs._defaultBeforeMiddleware.push(t),cs},cs.use=function(t){return cs._defaultAfterMiddleware.push(t),cs};var ls=is,hs=function(t,e){return hs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},hs(t,e)};var us=function(){function t(){}return t.use=function(t,e){t.data&&t.type===is.TYPE.IMAGE&&(t.texture=Qe.fromLoader(t.data,t.url,t.name)),e()},t}(),ds=function(t){function e(i,r){for(var s=t.call(this,i,r)||this,a=0;a<e._plugins.length;++a){var n=e._plugins[a],o=n.pre,c=n.use;o&&s.pre(o),c&&s.use(c)}return s._protected=!1,s}return function(t,e){function i(){this.constructor=t}hs(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),e.prototype.destroy=function(){this._protected||this.reset()},Object.defineProperty(e,"shared",{get:function(){var t=e._shared;return t||((t=new e)._protected=!0,e._shared=t),t},enumerable:!1,configurable:!0}),e.registerPlugin=function(t){return e._plugins.push(t),t.add&&t.add(),e},e._plugins=[],e}(cs);ds.registerPlugin({use:ns.parsing}),ds.registerPlugin(us);var ps=function(){function t(){}return t.init=function(t){t=Object.assign({sharedLoader:!1},t),this.loader=t.sharedLoader?ds.shared:new ds},t.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},t}(),fs=function(t,e){return fs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},fs(t,e)};function ms(t,e){function i(){this.constructor=t}fs(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var ys,_s,gs=function(t){function e(e,i,r,s){void 0===e&&(e=1500),void 0===r&&(r=16384),void 0===s&&(s=!1);var a=t.call(this)||this;return r>16384&&(r=16384),a._properties=[!1,!0,!1,!1,!1],a._maxSize=e,a._batchSize=r,a._buffers=null,a._bufferUpdateIDs=[],a._updateID=0,a.interactiveChildren=!1,a.blendMode=N.NORMAL,a.autoResize=s,a.roundPixels=!0,a.baseTexture=null,a.setProperties(i),a._tint=0,a.tintRgb=new Float32Array(4),a.tint=16777215,a}return ms(e,t),e.prototype.setProperties=function(t){t&&(this._properties[0]="vertices"in t||"scale"in t?!!t.vertices||!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="tint"in t||"alpha"in t?!!t.tint||!!t.alpha:this._properties[4])},e.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t,st(t,this.tintRgb)},enumerable:!1,configurable:!0}),e.prototype.render=function(t){var e=this;this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",(function(){return e.onChildrenChange(0)}))),t.batch.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))},e.prototype.onChildrenChange=function(t){for(var e=Math.floor(t/this._batchSize);this._bufferUpdateIDs.length<e;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[e]=++this._updateID},e.prototype.dispose=function(){if(this._buffers){for(var t=0;t<this._buffers.length;++t)this._buffers[t].destroy();this._buffers=null}},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null},e}(ue),vs=function(){function t(t,e,i){this.geometry=new li,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(var r=0;r<t.length;++r){var s=t[r];s={attributeName:s.attributeName,size:s.size,uploadFunction:s.uploadFunction,type:s.type||H.FLOAT,offset:s.offset},e[r]?this.dynamicProperties.push(s):this.staticProperties.push(s)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}return t.prototype.initBuffers=function(){var t=this.geometry,e=0;this.indexBuffer=new ri(pt(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(var i=0;i<this.dynamicProperties.length;++i){(n=this.dynamicProperties[i]).offset=e,e+=n.size,this.dynamicStride+=n.size}var r=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(r),this.dynamicDataUint32=new Uint32Array(r),this.dynamicBuffer=new ri(this.dynamicData,!1,!1);var s=0;this.staticStride=0;for(i=0;i<this.staticProperties.length;++i){(n=this.staticProperties[i]).offset=s,s+=n.size,this.staticStride+=n.size}var a=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(a),this.staticDataUint32=new Uint32Array(a),this.staticBuffer=new ri(this.staticData,!0,!1);for(i=0;i<this.dynamicProperties.length;++i){var n=this.dynamicProperties[i];t.addAttribute(n.attributeName,this.dynamicBuffer,0,n.type===H.UNSIGNED_BYTE,n.type,4*this.dynamicStride,4*n.offset)}for(i=0;i<this.staticProperties.length;++i){n=this.staticProperties[i];t.addAttribute(n.attributeName,this.staticBuffer,0,n.type===H.UNSIGNED_BYTE,n.type,4*this.staticStride,4*n.offset)}},t.prototype.uploadDynamic=function(t,e,i){for(var r=0;r<this.dynamicProperties.length;r++){var s=this.dynamicProperties[r];s.uploadFunction(t,e,i,s.type===H.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,s.offset)}this.dynamicBuffer._updateID++},t.prototype.uploadStatic=function(t,e,i){for(var r=0;r<this.staticProperties.length;r++){var s=this.staticProperties[r];s.uploadFunction(t,e,i,s.type===H.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,s.offset)}this.staticBuffer._updateID++},t.prototype.destroy=function(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()},t}(),Ss=function(t){function e(e){var i=t.call(this,e)||this;return i.shader=null,i.properties=null,i.tempMatrix=new Kt,i.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:i.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:i.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:i.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:i.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:H.UNSIGNED_BYTE,uploadFunction:i.uploadTint,offset:0}],i.shader=Qi.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),i.state=Zi.for2d(),i}return ms(e,t),e.prototype.render=function(t){var e=t.children,i=t._maxSize,r=t._batchSize,s=this.renderer,a=e.length;if(0!==a){a>i&&!t.autoResize&&(a=i);var n=t._buffers;n||(n=t._buffers=this.generateBuffers(t));var o=e[0]._texture.baseTexture;this.state.blendMode=lt(t.blendMode,o.alphaMode),s.state.set(this.state);var c=s.gl,l=t.worldTransform.copyTo(this.tempMatrix);l.prepend(s.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=l.toArray(!0),this.shader.uniforms.uColor=ht(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,o.alphaMode),this.shader.uniforms.uSampler=o,this.renderer.shader.bind(this.shader);for(var h=!1,u=0,d=0;u<a;u+=r,d+=1){var p=a-u;p>r&&(p=r),d>=n.length&&n.push(this._generateOneMoreBuffer(t));var f=n[d];f.uploadDynamic(e,u,p);var m=t._bufferUpdateIDs[d]||0;(h=h||f._updateID<m)&&(f._updateID=t._updateID,f.uploadStatic(e,u,p)),s.geometry.bind(f.geometry),c.drawElements(c.TRIANGLES,6*p,c.UNSIGNED_SHORT,0)}}},e.prototype.generateBuffers=function(t){for(var e=[],i=t._maxSize,r=t._batchSize,s=t._properties,a=0;a<i;a+=r)e.push(new vs(this.properties,s,r));return e},e.prototype._generateOneMoreBuffer=function(t){var e=t._batchSize,i=t._properties;return new vs(this.properties,i,e)},e.prototype.uploadVertices=function(t,e,i,r,s,a){for(var n=0,o=0,c=0,l=0,h=0;h<i;++h){var u=t[e+h],d=u._texture,p=u.scale.x,f=u.scale.y,m=d.trim,y=d.orig;m?(n=(o=m.x-u.anchor.x*y.width)+m.width,c=(l=m.y-u.anchor.y*y.height)+m.height):(n=y.width*(1-u.anchor.x),o=y.width*-u.anchor.x,c=y.height*(1-u.anchor.y),l=y.height*-u.anchor.y),r[a]=o*p,r[a+1]=l*f,r[a+s]=n*p,r[a+s+1]=l*f,r[a+2*s]=n*p,r[a+2*s+1]=c*f,r[a+3*s]=o*p,r[a+3*s+1]=c*f,a+=4*s}},e.prototype.uploadPosition=function(t,e,i,r,s,a){for(var n=0;n<i;n++){var o=t[e+n].position;r[a]=o.x,r[a+1]=o.y,r[a+s]=o.x,r[a+s+1]=o.y,r[a+2*s]=o.x,r[a+2*s+1]=o.y,r[a+3*s]=o.x,r[a+3*s+1]=o.y,a+=4*s}},e.prototype.uploadRotation=function(t,e,i,r,s,a){for(var n=0;n<i;n++){var o=t[e+n].rotation;r[a]=o,r[a+s]=o,r[a+2*s]=o,r[a+3*s]=o,a+=4*s}},e.prototype.uploadUvs=function(t,e,i,r,s,a){for(var n=0;n<i;++n){var o=t[e+n]._texture._uvs;o?(r[a]=o.x0,r[a+1]=o.y0,r[a+s]=o.x1,r[a+s+1]=o.y1,r[a+2*s]=o.x2,r[a+2*s+1]=o.y2,r[a+3*s]=o.x3,r[a+3*s+1]=o.y3,a+=4*s):(r[a]=0,r[a+1]=0,r[a+s]=0,r[a+s+1]=0,r[a+2*s]=0,r[a+2*s+1]=0,r[a+3*s]=0,r[a+3*s+1]=0,a+=4*s)}},e.prototype.uploadTint=function(t,e,i,r,s,a){for(var n=0;n<i;++n){var o=t[e+n],c=o._texture.baseTexture.alphaMode>0,l=o.alpha,h=l<1&&c?ut(o._tintRGB,l):o._tintRGB+(255*l<<24);r[a]=h,r[a+s]=h,r[a+2*s]=h,r[a+3*s]=h,a+=4*s}},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null},e}(yi);!function(t){t.MITER="miter",t.BEVEL="bevel",t.ROUND="round"}(ys||(ys={})),function(t){t.BUTT="butt",t.ROUND="round",t.SQUARE="square"}(_s||(_s={}));var Ms={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount:function(t,e){if(void 0===e&&(e=20),!this.adaptive||!t||isNaN(t))return e;var i=Math.ceil(t/this.maxLength);return i<this.minSegments?i=this.minSegments:i>this.maxSegments&&(i=this.maxSegments),i}},Rs=function(){function t(){this.color=16777215,this.alpha=1,this.texture=Qe.WHITE,this.matrix=null,this.visible=!1,this.reset()}return t.prototype.clone=function(){var e=new t;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e},t.prototype.reset=function(){this.color=16777215,this.alpha=1,this.texture=Qe.WHITE,this.matrix=null,this.visible=!1},t.prototype.destroy=function(){this.texture=null,this.matrix=null},t}(),bs=function(t,e){return bs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},bs(t,e)};function Es(t,e){function i(){this.constructor=t}bs(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var Is={build:function(t){t.points=t.shape.points.slice()},triangulate:function(t,e){var i=t.points,r=t.holes,s=e.points,a=e.indices;if(i.length>=6){for(var n=[],o=0;o<r.length;o++){var c=r[o];n.push(i.length/2),i=i.concat(c.points)}var l=C()(i,n,2);if(!l)return;var h=s.length/2;for(o=0;o<l.length;o+=3)a.push(l[o]+h),a.push(l[o+1]+h),a.push(l[o+2]+h);for(o=0;o<i.length;o++)s.push(i[o])}}},xs={build:function(t){var e,i,r=t.shape,s=t.points,a=r.x,n=r.y;if(s.length=0,t.type===Nt.CIRC)e=r.radius,i=r.radius;else{var o=t.shape;e=o.width,i=o.height}if(0!==e&&0!==i){var c=Math.floor(30*Math.sqrt(r.radius))||Math.floor(15*Math.sqrt(e+i));c/=2.3;for(var l=2*Math.PI/c,h=0;h<c-.5;h++)s.push(a+Math.sin(-l*h)*e,n+Math.cos(-l*h)*i);s.push(s[0],s[1])}},triangulate:function(t,e){var i=t.points,r=e.points,s=e.indices,a=r.length/2,n=a,o=t.shape,c=t.matrix,l=o.x,h=o.y;r.push(t.matrix?c.a*l+c.c*h+c.tx:l,t.matrix?c.b*l+c.d*h+c.ty:h);for(var u=0;u<i.length;u+=2)r.push(i[u],i[u+1]),s.push(a++,n,a)}},ws={build:function(t){var e=t.shape,i=e.x,r=e.y,s=e.width,a=e.height,n=t.points;n.length=0,n.push(i,r,i+s,r,i+s,r+a,i,r+a)},triangulate:function(t,e){var i=t.points,r=e.points,s=r.length/2;r.push(i[0],i[1],i[2],i[3],i[6],i[7],i[4],i[5]),e.indices.push(s,s+1,s+2,s+1,s+2,s+3)}};function Ts(t,e,i){return t+(e-t)*i}function Ds(t,e,i,r,s,a,n){void 0===n&&(n=[]);for(var o=n,c=0,l=0,h=0,u=0,d=0,p=0,f=0,m=0;f<=20;++f)c=Ts(t,i,m=f/20),l=Ts(e,r,m),h=Ts(i,s,m),u=Ts(r,a,m),d=Ts(c,h,m),p=Ts(l,u,m),o.push(d,p);return o}var Ps={build:function(t){var e=t.shape,i=t.points,r=e.x,s=e.y,a=e.width,n=e.height,o=Math.max(0,Math.min(e.radius,Math.min(a,n)/2));i.length=0,o?(Ds(r,s+o,r,s,r+o,s,i),Ds(r+a-o,s,r+a,s,r+a,s+o,i),Ds(r+a,s+n-o,r+a,s+n,r+a-o,s+n,i),Ds(r+o,s+n,r,s+n,r,s+n-o,i)):i.push(r,s,r+a,s,r+a,s+n,r,s+n)},triangulate:function(t,e){for(var i=t.points,r=e.points,s=e.indices,a=r.length/2,n=C()(i,null,2),o=0,c=n.length;o<c;o+=3)s.push(n[o]+a),s.push(n[o+1]+a),s.push(n[o+2]+a);for(o=0,c=i.length;o<c;o++)r.push(i[o],i[++o])}};function As(t,e,i,r,s,a,n,o){var c,l;n?(c=r,l=-i):(c=-r,l=i);var h=t-i*s+c,u=e-r*s+l,d=t+i*a+c,p=e+r*a+l;return o.push(h,u),o.push(d,p),2}function ks(t,e,i,r,s,a,n,o){var c=i-t,l=r-e,h=Math.atan2(c,l),u=Math.atan2(s-t,a-e);o&&h<u?h+=2*Math.PI:!o&&h>u&&(u+=2*Math.PI);var d=h,p=u-h,f=Math.abs(p),m=Math.sqrt(c*c+l*l),y=1+(15*f*Math.sqrt(m)/Math.PI>>0),_=p/y;if(d+=_,o){n.push(t,e),n.push(i,r);for(var g=1,v=d;g<y;g++,v+=_)n.push(t,e),n.push(t+Math.sin(v)*m,e+Math.cos(v)*m);n.push(t,e),n.push(s,a)}else{n.push(i,r),n.push(t,e);for(g=1,v=d;g<y;g++,v+=_)n.push(t+Math.sin(v)*m,e+Math.cos(v)*m),n.push(t,e);n.push(s,a),n.push(t,e)}return 2*y}function Cs(t,e){t.lineStyle.native?function(t,e){var i=0,r=t.shape,s=t.points||r.points,a=r.type!==Nt.POLY||r.closeStroke;if(0!==s.length){var n=e.points,o=e.indices,c=s.length/2,l=n.length/2,h=l;for(n.push(s[0],s[1]),i=1;i<c;i++)n.push(s[2*i],s[2*i+1]),o.push(h,h+1),h++;a&&o.push(h,l)}}(t,e):function(t,e){var i=t.shape,r=t.points||i.points.slice(),s=e.closePointEps;if(0!==r.length){var a=t.lineStyle,n=new Xt(r[0],r[1]),o=new Xt(r[r.length-2],r[r.length-1]),c=i.type!==Nt.POLY||i.closeStroke,l=Math.abs(n.x-o.x)<s&&Math.abs(n.y-o.y)<s;if(c){r=r.slice(),l&&(r.pop(),r.pop(),o.set(r[r.length-2],r[r.length-1]));var h=.5*(n.x+o.x),u=.5*(o.y+n.y);r.unshift(h,u),r.push(h,u)}var d=e.points,p=r.length/2,f=r.length,m=d.length/2,y=a.width/2,_=y*y,g=a.miterLimit*a.miterLimit,v=r[0],S=r[1],M=r[2],R=r[3],b=0,E=0,I=-(S-R),x=v-M,w=0,T=0,D=Math.sqrt(I*I+x*x);I/=D,x/=D,I*=y,x*=y;var P=a.alignment,A=2*(1-P),k=2*P;c||(a.cap===_s.ROUND?f+=ks(v-I*(A-k)*.5,S-x*(A-k)*.5,v-I*A,S-x*A,v+I*k,S+x*k,d,!0)+2:a.cap===_s.SQUARE&&(f+=As(v,S,I,x,A,k,!0,d))),d.push(v-I*A,S-x*A),d.push(v+I*k,S+x*k);for(var C=1;C<p-1;++C){v=r[2*(C-1)],S=r[2*(C-1)+1],M=r[2*C],R=r[2*C+1],b=r[2*(C+1)],E=r[2*(C+1)+1],I=-(S-R),x=v-M,I/=D=Math.sqrt(I*I+x*x),x/=D,I*=y,x*=y,w=-(R-E),T=M-b,w/=D=Math.sqrt(w*w+T*T),T/=D,w*=y,T*=y;var L=M-v,B=S-R,F=M-b,O=E-R,N=B*F-O*L,j=N<0;if(Math.abs(N)<.1)d.push(M-I*A,R-x*A),d.push(M+I*k,R+x*k);else{var U=(-I+v)*(-x+R)-(-I+M)*(-x+S),V=(-w+b)*(-T+R)-(-w+M)*(-T+E),H=(L*V-F*U)/N,W=(O*U-B*V)/N,q=(H-M)*(H-M)+(W-R)*(W-R),G=M+(H-M)*A,z=R+(W-R)*A,X=M-(H-M)*k,Y=R-(W-R)*k,K=j?A:k;q<=Math.min(L*L+B*B,F*F+O*O)+K*K*_?a.join===ys.BEVEL||q/_>g?(j?(d.push(G,z),d.push(M+I*k,R+x*k),d.push(G,z),d.push(M+w*k,R+T*k)):(d.push(M-I*A,R-x*A),d.push(X,Y),d.push(M-w*A,R-T*A),d.push(X,Y)),f+=2):a.join===ys.ROUND?j?(d.push(G,z),d.push(M+I*k,R+x*k),f+=ks(M,R,M+I*k,R+x*k,M+w*k,R+T*k,d,!0)+4,d.push(G,z),d.push(M+w*k,R+T*k)):(d.push(M-I*A,R-x*A),d.push(X,Y),f+=ks(M,R,M-I*A,R-x*A,M-w*A,R-T*A,d,!1)+4,d.push(M-w*A,R-T*A),d.push(X,Y)):(d.push(G,z),d.push(X,Y)):(d.push(M-I*A,R-x*A),d.push(M+I*k,R+x*k),a.join===ys.BEVEL||q/_>g||(a.join===ys.ROUND?f+=j?ks(M,R,M+I*k,R+x*k,M+w*k,R+T*k,d,!0)+2:ks(M,R,M-I*A,R-x*A,M-w*A,R-T*A,d,!1)+2:(j?(d.push(X,Y),d.push(X,Y)):(d.push(G,z),d.push(G,z)),f+=2)),d.push(M-w*A,R-T*A),d.push(M+w*k,R+T*k),f+=2)}}v=r[2*(p-2)],S=r[2*(p-2)+1],M=r[2*(p-1)],I=-(S-(R=r[2*(p-1)+1])),x=v-M,I/=D=Math.sqrt(I*I+x*x),x/=D,I*=y,x*=y,d.push(M-I*A,R-x*A),d.push(M+I*k,R+x*k),c||(a.cap===_s.ROUND?f+=ks(M-I*(A-k)*.5,R-x*(A-k)*.5,M-I*A,R-x*A,M+I*k,R+x*k,d,!1)+2:a.cap===_s.SQUARE&&(f+=As(M,R,I,x,A,k,!1,d)));var $=e.indices,Q=Ms.epsilon*Ms.epsilon;for(C=m;C<f+m-2;++C)v=d[2*C],S=d[2*C+1],M=d[2*(C+1)],R=d[2*(C+1)+1],b=d[2*(C+2)],E=d[2*(C+2)+1],Math.abs(v*(R-E)+M*(E-S)+b*(S-R))<Q||$.push(C,C+1,C+2)}}(t,e)}var Ls,Bs=function(t){function e(e,i,r,s,a,n){void 0===n&&(n=0);a=a||s/2;for(var o=-1*Math.PI/2+n,c=2*r,l=jt/c,h=[],u=0;u<c;u++){var d=u%2?a:s,p=u*l+o;h.push(e+d*Math.cos(p),i+d*Math.sin(p))}return t.call(this,h)||this}return Es(e,t),e}(Gt),Fs=function(){function t(){}return t.curveTo=function(t,e,i,r,s,a){var n=a[a.length-2],o=a[a.length-1]-e,c=n-t,l=r-e,h=i-t,u=Math.abs(o*h-c*l);if(u<1e-8||0===s)return a[a.length-2]===t&&a[a.length-1]===e||a.push(t,e),null;var d=o*o+c*c,p=l*l+h*h,f=o*l+c*h,m=s*Math.sqrt(d)/u,y=s*Math.sqrt(p)/u,_=m*f/d,g=y*f/p,v=m*h+y*c,S=m*l+y*o,M=c*(y+_),R=o*(y+_),b=h*(m+g),E=l*(m+g);return{cx:v+t,cy:S+e,radius:s,startAngle:Math.atan2(R-S,M-v),endAngle:Math.atan2(E-S,b-v),anticlockwise:c*l>h*o}},t.arc=function(t,e,i,r,s,a,n,o,c){for(var l=n-a,h=Ms._segmentsCount(Math.abs(l)*s,40*Math.ceil(Math.abs(l)/jt)),u=l/(2*h),d=2*u,p=Math.cos(u),f=Math.sin(u),m=h-1,y=m%1/m,_=0;_<=m;++_){var g=u+a+d*(_+y*_),v=Math.cos(g),S=-Math.sin(g);c.push((p*v+f*S)*s+i,(p*-S+f*v)*s+r)}},t}(),Os=function(){function t(){}return t.curveLength=function(t,e,i,r,s,a,n,o){for(var c=0,l=0,h=0,u=0,d=0,p=0,f=0,m=0,y=0,_=0,g=0,v=t,S=e,M=1;M<=10;++M)_=v-(m=(f=(p=(d=1-(l=M/10))*d)*d)*t+3*p*l*i+3*d*(h=l*l)*s+(u=h*l)*n),g=S-(y=f*e+3*p*l*r+3*d*h*a+u*o),v=m,S=y,c+=Math.sqrt(_*_+g*g);return c},t.curveTo=function(e,i,r,s,a,n,o){var c=o[o.length-2],l=o[o.length-1];o.length-=2;var h=Ms._segmentsCount(t.curveLength(c,l,e,i,r,s,a,n)),u=0,d=0,p=0,f=0,m=0;o.push(c,l);for(var y=1,_=0;y<=h;++y)p=(d=(u=1-(_=y/h))*u)*u,m=(f=_*_)*_,o.push(p*c+3*d*_*e+3*u*f*r+m*a,p*l+3*d*_*i+3*u*f*s+m*n)},t}(),Ns=function(){function t(){}return t.curveLength=function(t,e,i,r,s,a){var n=t-2*i+s,o=e-2*r+a,c=2*i-2*t,l=2*r-2*e,h=4*(n*n+o*o),u=4*(n*c+o*l),d=c*c+l*l,p=2*Math.sqrt(h+u+d),f=Math.sqrt(h),m=2*h*f,y=2*Math.sqrt(d),_=u/f;return(m*p+f*u*(p-y)+(4*d*h-u*u)*Math.log((2*f+_+p)/(_+y)))/(4*m)},t.curveTo=function(e,i,r,s,a){for(var n=a[a.length-2],o=a[a.length-1],c=Ms._segmentsCount(t.curveLength(n,o,e,i,r,s)),l=0,h=0,u=1;u<=c;++u){var d=u/c;l=n+(e-n)*d,h=o+(i-o)*d,a.push(l+(e+(r-e)*d-l)*d,h+(i+(s-i)*d-h)*d)}},t}(),js=function(){function t(){this.reset()}return t.prototype.begin=function(t,e,i){this.reset(),this.style=t,this.start=e,this.attribStart=i},t.prototype.end=function(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start},t.prototype.reset=function(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0},t}(),Us=((Ls={})[Nt.POLY]=Is,Ls[Nt.CIRC]=xs,Ls[Nt.ELIP]=xs,Ls[Nt.RECT]=ws,Ls[Nt.RREC]=Ps,Ls),Vs=[],Hs=[],Ws={buildPoly:Is,buildCircle:xs,buildRectangle:ws,buildRoundedRectangle:Ps,FILL_COMMANDS:Us,BATCH_POOL:Vs,DRAW_CALL_POOL:Hs,buildLine:Cs,Star:Bs,ArcUtils:Fs,BezierUtils:Os,QuadraticUtils:Ns,BatchPart:js},qs=function(){function t(t,e,i,r){void 0===e&&(e=null),void 0===i&&(i=null),void 0===r&&(r=null),this.shape=t,this.lineStyle=i,this.fillStyle=e,this.matrix=r,this.type=t.type,this.points=[],this.holes=[]}return t.prototype.clone=function(){return new t(this.shape,this.fillStyle,this.lineStyle,this.matrix)},t.prototype.destroy=function(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null},t}(),Gs=new Xt,zs=new ae,Xs=function(t){function e(){var e=t.call(this)||this;return e.uvsFloat32=null,e.indicesUint16=null,e.points=[],e.colors=[],e.uvs=[],e.indices=[],e.textureIds=[],e.graphicsData=[],e.dirty=0,e.batchDirty=-1,e.cacheDirty=-1,e.clearDirty=0,e.drawCalls=[],e.batches=[],e.shapeIndex=0,e._bounds=new ae,e.boundsDirty=-1,e.boundsPadding=0,e.batchable=!1,e.indicesUint16=null,e.uvsFloat32=null,e.closePointEps=1e-4,e}return Es(e,t),Object.defineProperty(e.prototype,"bounds",{get:function(){return this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds},enumerable:!1,configurable:!0}),e.prototype.invalidate=function(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(var t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),Hs.push(this.drawCalls[t]);this.drawCalls.length=0;for(t=0;t<this.batches.length;t++){var e=this.batches[t];e.reset(),Vs.push(e)}this.batches.length=0},e.prototype.clear=function(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this},e.prototype.drawShape=function(t,e,i,r){void 0===e&&(e=null),void 0===i&&(i=null),void 0===r&&(r=null);var s=new qs(t,e,i,r);return this.graphicsData.push(s),this.dirty++,this},e.prototype.drawHole=function(t,e){if(void 0===e&&(e=null),!this.graphicsData.length)return null;var i=new qs(t,null,null,e),r=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=r.lineStyle,r.holes.push(i),this.dirty++,this},e.prototype.destroy=function(){t.prototype.destroy.call(this);for(var e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null},e.prototype.containsPoint=function(t){for(var e=this.graphicsData,i=0;i<e.length;++i){var r=e[i];if(r.fillStyle.visible&&(r.shape&&(r.matrix?r.matrix.applyInverse(t,Gs):Gs.copyFrom(t),r.shape.contains(Gs.x,Gs.y)))){var s=!1;if(r.holes)for(var a=0;a<r.holes.length;a++){if(r.holes[a].shape.contains(Gs.x,Gs.y)){s=!0;break}}if(!s)return!0}}return!1},e.prototype.updateBatches=function(t){if(this.graphicsData.length){if(this.validateBatching()){this.cacheDirty=this.dirty;var e=this.uvs,i=this.graphicsData,r=null,s=null;this.batches.length>0&&(s=(r=this.batches[this.batches.length-1]).style);for(var a=this.shapeIndex;a<i.length;a++){this.shapeIndex++;var n=i[a],o=n.fillStyle,c=n.lineStyle;Us[n.type].build(n),n.matrix&&this.transformPoints(n.points,n.matrix);for(var l=0;l<2;l++){var h=0===l?o:c;if(h.visible){var u=h.texture.baseTexture,d=this.indices.length,p=this.points.length/2;u.wrapMode=q.REPEAT,0===l?this.processFill(n):this.processLine(n);var f=this.points.length/2-p;0!==f&&(r&&!this._compareStyles(s,h)&&(r.end(d,p),r=null),r||((r=Vs.pop()||new js).begin(h,d,p),this.batches.push(r),s=h),this.addUvs(this.points,e,h.texture,p,f,h.matrix))}}}var m=this.indices.length,y=this.points.length/2;if(r&&r.end(m,y),0!==this.batches.length){if(this.indicesUint16&&this.indices.length===this.indicesUint16.length)this.indicesUint16.set(this.indices);else{var _=y>65535&&t;this.indicesUint16=_?new Uint32Array(this.indices):new Uint16Array(this.indices)}this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}else this.batchable=!0}}else this.batchable=!0},e.prototype._compareStyles=function(t,e){return!(!t||!e)&&(t.texture.baseTexture===e.texture.baseTexture&&(t.color+t.alpha===e.color+e.alpha&&!!t.native==!!e.native))},e.prototype.validateBatching=function(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(var t=0,e=this.graphicsData.length;t<e;t++){var i=this.graphicsData[t],r=i.fillStyle,s=i.lineStyle;if(r&&!r.texture.baseTexture.valid)return!1;if(s&&!s.texture.baseTexture.valid)return!1}return!0},e.prototype.packBatches=function(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);for(var t=this.batches,e=0,i=t.length;e<i;e++)for(var r=t[e],s=0;s<r.size;s++){var a=r.start+s;this.indicesUint16[a]=this.indicesUint16[a]-r.attribStart}},e.prototype.isBatchable=function(){if(this.points.length>131070)return!1;for(var t=this.batches,i=0;i<t.length;i++)if(t[i].style.native)return!1;return this.points.length<2*e.BATCHABLE_SIZE},e.prototype.buildDrawCalls=function(){for(var t=++Le._globalBatch,e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),Hs.push(this.drawCalls[e]);this.drawCalls.length=0;var i=this.colors,r=this.textureIds,s=Hs.pop();s||((s=new Tr).texArray=new Dr),s.texArray.count=0,s.start=0,s.size=0,s.type=j.TRIANGLES;var a=0,n=null,o=0,c=!1,l=j.TRIANGLES,h=0;this.drawCalls.push(s);for(e=0;e<this.batches.length;e++){var u=this.batches[e],d=u.style,p=d.texture.baseTexture;c!==!!d.native&&(l=(c=!!d.native)?j.LINES:j.TRIANGLES,n=null,a=8,t++),n!==p&&(n=p,p._batchEnabled!==t&&(8===a&&(t++,a=0,s.size>0&&((s=Hs.pop())||((s=new Tr).texArray=new Dr),this.drawCalls.push(s)),s.start=h,s.size=0,s.texArray.count=0,s.type=l),p.touched=1,p._batchEnabled=t,p._batchLocation=a,p.wrapMode=10497,s.texArray.elements[s.texArray.count++]=p,a++)),s.size+=u.size,h+=u.size,o=p._batchLocation,this.addColors(i,d.color,d.alpha,u.attribSize,u.attribStart),this.addTextureIds(r,o,u.attribSize,u.attribStart)}Le._globalBatch=t,this.packAttributes()},e.prototype.packAttributes=function(){for(var t=this.points,e=this.uvs,i=this.colors,r=this.textureIds,s=new ArrayBuffer(3*t.length*4),a=new Float32Array(s),n=new Uint32Array(s),o=0,c=0;c<t.length/2;c++)a[o++]=t[2*c],a[o++]=t[2*c+1],a[o++]=e[2*c],a[o++]=e[2*c+1],n[o++]=i[c],a[o++]=r[c];this._buffer.update(s),this._indexBuffer.update(this.indicesUint16)},e.prototype.processFill=function(t){t.holes.length?(this.processHoles(t.holes),Is.triangulate(t,this)):Us[t.type].triangulate(t,this)},e.prototype.processLine=function(t){Cs(t,this);for(var e=0;e<t.holes.length;e++)Cs(t.holes[e],this)},e.prototype.processHoles=function(t){for(var e=0;e<t.length;e++){var i=t[e];Us[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}},e.prototype.calculateBounds=function(){var t=this._bounds,e=zs,i=Kt.IDENTITY;this._bounds.clear(),e.clear();for(var r=0;r<this.graphicsData.length;r++){var s=this.graphicsData[r],a=s.shape,n=s.type,o=s.lineStyle,c=s.matrix||Kt.IDENTITY,l=0;if(o&&o.visible){var h=o.alignment;l=o.width,n===Nt.POLY?l*=.5+Math.abs(.5-h):l*=Math.max(0,h)}if(i!==c&&(e.isEmpty()||(t.addBoundsMatrix(e,i),e.clear()),i=c),n===Nt.RECT||n===Nt.RREC){var u=a;e.addFramePad(u.x,u.y,u.x+u.width,u.y+u.height,l,l)}else if(n===Nt.CIRC){var d=a;e.addFramePad(d.x,d.y,d.x,d.y,d.radius+l,d.radius+l)}else if(n===Nt.ELIP){var p=a;e.addFramePad(p.x,p.y,p.x,p.y,p.width+l,p.height+l)}else{var f=a;t.addVerticesMatrix(i,f.points,0,f.points.length,l,l)}}e.isEmpty()||t.addBoundsMatrix(e,i),t.pad(this.boundsPadding,this.boundsPadding)},e.prototype.transformPoints=function(t,e){for(var i=0;i<t.length/2;i++){var r=t[2*i],s=t[2*i+1];t[2*i]=e.a*r+e.c*s+e.tx,t[2*i+1]=e.b*r+e.d*s+e.ty}},e.prototype.addColors=function(t,e,i,r,s){void 0===s&&(s=0);var a=ut((e>>16)+(65280&e)+((255&e)<<16),i);t.length=Math.max(t.length,s+r);for(var n=0;n<r;n++)t[s+n]=a},e.prototype.addTextureIds=function(t,e,i,r){void 0===r&&(r=0),t.length=Math.max(t.length,r+i);for(var s=0;s<i;s++)t[r+s]=e},e.prototype.addUvs=function(t,e,i,r,s,a){void 0===a&&(a=null);for(var n=0,o=e.length,c=i.frame;n<s;){var l=t[2*(r+n)],h=t[2*(r+n)+1];if(a){var u=a.a*l+a.c*h+a.tx;h=a.b*l+a.d*h+a.ty,l=u}n++,e.push(l/c.width,h/c.height)}var d=i.baseTexture;(c.width<d.width||c.height<d.height)&&this.adjustUvs(e,i,o,s)},e.prototype.adjustUvs=function(t,e,i,r){for(var s=e.baseTexture,a=1e-6,n=i+2*r,o=e.frame,c=o.width/s.width,l=o.height/s.height,h=o.x/o.width,u=o.y/o.height,d=Math.floor(t[i]+a),p=Math.floor(t[i+1]+a),f=i+2;f<n;f+=2)d=Math.min(d,Math.floor(t[f]+a)),p=Math.min(p,Math.floor(t[f+1]+a));h-=d,u-=p;for(f=i;f<n;f+=2)t[f]=(t[f]+h)*c,t[f+1]=(t[f+1]+u)*l},e.BATCHABLE_SIZE=100,e}(Cr),Ys=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.width=0,e.alignment=.5,e.native=!1,e.cap=_s.BUTT,e.join=ys.MITER,e.miterLimit=10,e}return Es(e,t),e.prototype.clone=function(){var t=new e;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t},e.prototype.reset=function(){t.prototype.reset.call(this),this.color=0,this.alignment=.5,this.width=0,this.native=!1},e}(Rs),Ks=new Float32Array(3),$s={},Qs=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this)||this;return i._geometry=e||new Xs,i._geometry.refCount++,i.shader=null,i.state=Zi.for2d(),i._fillStyle=new Rs,i._lineStyle=new Ys,i._matrix=null,i._holeMode=!1,i.currentPath=null,i.batches=[],i.batchTint=-1,i.batchDirty=-1,i.vertexData=null,i.pluginName="batch",i._transformID=-1,i.tint=16777215,i.blendMode=N.NORMAL,i}return Es(e,t),Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),e.prototype.clone=function(){return this.finishPoly(),new e(this._geometry)},Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fill",{get:function(){return this._fillStyle},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"line",{get:function(){return this._lineStyle},enumerable:!1,configurable:!0}),e.prototype.lineStyle=function(t){if(void 0===t&&(t=null),"number"==typeof t){var e=arguments;t={width:e[0]||0,color:e[1]||0,alpha:void 0!==e[2]?e[2]:1,alignment:void 0!==e[3]?e[3]:.5,native:!!e[4]}}return this.lineTextureStyle(t)},e.prototype.lineTextureStyle=function(t){if("number"==typeof t){It("v5.2.0","Please use object-based options for Graphics#lineTextureStyle");var e=arguments,i=e[0],r=e[1],s=e[2],a=e[3],n=e[4],o=e[5],c=e[6];t={width:i,texture:r,color:s,alpha:a,matrix:n,alignment:o,native:c},Object.keys(t).forEach((function(e){return void 0===t[e]&&delete t[e]}))}t=Object.assign({width:0,texture:Qe.WHITE,color:t&&t.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:_s.BUTT,join:ys.MITER,miterLimit:10},t),this.currentPath&&this.startPoly();var l=t.width>0&&t.alpha>0;return l?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:l},t)):this._lineStyle.reset(),this},e.prototype.startPoly=function(){if(this.currentPath){var t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new Gt,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new Gt,this.currentPath.closeStroke=!1},e.prototype.finishPoly=function(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)},e.prototype.moveTo=function(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this},e.prototype.lineTo=function(t,e){this.currentPath||this.moveTo(0,0);var i=this.currentPath.points,r=i[i.length-2],s=i[i.length-1];return r===t&&s===e||i.push(t,e),this},e.prototype._initCurve=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)},e.prototype.quadraticCurveTo=function(t,e,i,r){this._initCurve();var s=this.currentPath.points;return 0===s.length&&this.moveTo(0,0),Ns.curveTo(t,e,i,r,s),this},e.prototype.bezierCurveTo=function(t,e,i,r,s,a){return this._initCurve(),Os.curveTo(t,e,i,r,s,a,this.currentPath.points),this},e.prototype.arcTo=function(t,e,i,r,s){this._initCurve(t,e);var a=this.currentPath.points,n=Fs.curveTo(t,e,i,r,s,a);if(n){var o=n.cx,c=n.cy,l=n.radius,h=n.startAngle,u=n.endAngle,d=n.anticlockwise;this.arc(o,c,l,h,u,d)}return this},e.prototype.arc=function(t,e,i,r,s,a){if(void 0===a&&(a=!1),r===s)return this;if(!a&&s<=r?s+=jt:a&&r<=s&&(r+=jt),0===s-r)return this;var n=t+Math.cos(r)*i,o=e+Math.sin(r)*i,c=this._geometry.closePointEps,l=this.currentPath?this.currentPath.points:null;if(l){var h=Math.abs(l[l.length-2]-n),u=Math.abs(l[l.length-1]-o);h<c&&u<c||l.push(n,o)}else this.moveTo(n,o),l=this.currentPath.points;return Fs.arc(n,o,t,e,i,r,s,a,l),this},e.prototype.beginFill=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=1),this.beginTextureFill({texture:Qe.WHITE,color:t,alpha:e})},e.prototype.beginTextureFill=function(t){if(t instanceof Qe){It("v5.2.0","Please use object-based options for Graphics#beginTextureFill");var e=arguments,i=e[0],r=e[1],s=e[2],a=e[3];t={texture:i,color:r,alpha:s,matrix:a},Object.keys(t).forEach((function(e){return void 0===t[e]&&delete t[e]}))}t=Object.assign({texture:Qe.WHITE,color:16777215,alpha:1,matrix:null},t),this.currentPath&&this.startPoly();var n=t.alpha>0;return n?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:n},t)):this._fillStyle.reset(),this},e.prototype.endFill=function(){return this.finishPoly(),this._fillStyle.reset(),this},e.prototype.drawRect=function(t,e,i,r){return this.drawShape(new Ht(t,e,i,r))},e.prototype.drawRoundedRect=function(t,e,i,r,s){return this.drawShape(new zt(t,e,i,r,s))},e.prototype.drawCircle=function(t,e,i){return this.drawShape(new Wt(t,e,i))},e.prototype.drawEllipse=function(t,e,i,r){return this.drawShape(new qt(t,e,i,r))},e.prototype.drawPolygon=function(){for(var t,e=arguments,i=[],r=0;r<arguments.length;r++)i[r]=e[r];var s=!0,a=i[0];a.points?(s=a.closeStroke,t=a.points):t=Array.isArray(i[0])?i[0]:i;var n=new Gt(t);return n.closeStroke=s,this.drawShape(n),this},e.prototype.drawShape=function(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this},e.prototype.drawStar=function(t,e,i,r,s,a){return void 0===a&&(a=0),this.drawPolygon(new Bs(t,e,i,r,s,a))},e.prototype.clear=function(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this},e.prototype.isFastRect=function(){var t=this._geometry.graphicsData;return 1===t.length&&t[0].shape.type===Nt.RECT&&!(t[0].lineStyle.visible&&t[0].lineStyle.width)},e.prototype._render=function(t){this.finishPoly();var e=this._geometry,i=t.context.supports.uint32Indices;e.updateBatches(i),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))},e.prototype._populateBatches=function(){var t=this._geometry,e=this.blendMode,i=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(t.points);for(var r=0;r<i;r++){var s=t.batches[r],a=s.style.color,n=new Float32Array(this.vertexData.buffer,4*s.attribStart*2,2*s.attribSize),o=new Float32Array(t.uvsFloat32.buffer,4*s.attribStart*2,2*s.attribSize),c={vertexData:n,blendMode:e,indices:new Uint16Array(t.indicesUint16.buffer,2*s.start,s.size),uvs:o,_batchRGB:st(a),_tintRGB:a,_texture:s.style.texture,alpha:s.style.alpha,worldAlpha:1};this.batches[r]=c}},e.prototype._renderBatched=function(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(var e=0,i=this.batches.length;e<i;e++){var r=this.batches[e];r.worldAlpha=this.worldAlpha*r.alpha,t.plugins[this.pluginName].render(r)}}},e.prototype._renderDirect=function(t){var e=this._resolveDirectShader(t),i=this._geometry,r=this.tint,s=this.worldAlpha,a=e.uniforms,n=i.drawCalls;a.translationMatrix=this.transform.worldTransform,a.tint[0]=(r>>16&255)/255*s,a.tint[1]=(r>>8&255)/255*s,a.tint[2]=(255&r)/255*s,a.tint[3]=s,t.shader.bind(e),t.geometry.bind(i,e),t.state.set(this.state);for(var o=0,c=n.length;o<c;o++)this._renderDrawCallDirect(t,i.drawCalls[o])},e.prototype._renderDrawCallDirect=function(t,e){for(var i=e.texArray,r=e.type,s=e.size,a=e.start,n=i.count,o=0;o<n;o++)t.texture.bind(i.elements[o],o);t.geometry.draw(r,s,a)},e.prototype._resolveDirectShader=function(t){var e=this.shader,i=this.pluginName;if(!e){if(!$s[i]){for(var r=t.plugins.batch.MAX_TEXTURES,s=new Int32Array(r),a=0;a<r;a++)s[a]=a;var n={tint:new Float32Array([1,1,1,1]),translationMatrix:new Kt,default:pi.from({uSamplers:s},!0)},o=t.plugins[i]._shader.program;$s[i]=new Qi(o,n)}e=$s[i]}return e},e.prototype._calculateBounds=function(){this.finishPoly();var t=this._geometry;if(t.graphicsData.length){var e=t.bounds,i=e.minX,r=e.minY,s=e.maxX,a=e.maxY;this._bounds.addFrame(this.transform,i,r,s,a)}},e.prototype.containsPoint=function(t){return this.worldTransform.applyInverse(t,e._TEMP_POINT),this._geometry.containsPoint(e._TEMP_POINT)},e.prototype.calculateTints=function(){if(this.batchTint!==this.tint){this.batchTint=this.tint;for(var t=st(this.tint,Ks),e=0;e<this.batches.length;e++){var i=this.batches[e],r=i._batchRGB,s=(t[0]*r[0]*255<<16)+(t[1]*r[1]*255<<8)+(0|t[2]*r[2]*255);i._tintRGB=(s>>16)+(65280&s)+((255&s)<<16)}}},e.prototype.calculateVertices=function(){var t=this.transform._worldID;if(this._transformID!==t){this._transformID=t;for(var e=this.transform.worldTransform,i=e.a,r=e.b,s=e.c,a=e.d,n=e.tx,o=e.ty,c=this._geometry.points,l=this.vertexData,h=0,u=0;u<c.length;u+=2){var d=c[u],p=c[u+1];l[h++]=i*d+s*p+n,l[h++]=a*p+r*d+o}}},e.prototype.closePath=function(){var t=this.currentPath;return t&&(t.closeStroke=!0),this},e.prototype.setMatrix=function(t){return this._matrix=t,this},e.prototype.beginHole=function(){return this.finishPoly(),this._holeMode=!0,this},e.prototype.endHole=function(){return this.finishPoly(),this._holeMode=!1,this},e.prototype.destroy=function(e){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,t.prototype.destroy.call(this,e)},e._TEMP_POINT=new Xt,e}(ue),Zs=function(t,e){return Zs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},Zs(t,e)};var Js,ta=new Xt,ea=new Uint16Array([0,1,2,0,2,3]),ia=function(t){function e(e){var i=t.call(this)||this;return i._anchor=new Yt(i._onAnchorUpdate,i,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),i._texture=null,i._width=0,i._height=0,i._tint=null,i._tintRGB=null,i.tint=16777215,i.blendMode=N.NORMAL,i._cachedTint=16777215,i.uvs=null,i.texture=e||Qe.EMPTY,i.vertexData=new Float32Array(8),i.vertexTrimmedData=null,i._transformID=-1,i._textureID=-1,i._transformTrimmedID=-1,i._textureTrimmedID=-1,i.indices=ea,i.pluginName="batch",i.isSprite=!0,i._roundPixels=D.ROUND_PIXELS,i}return function(t,e){function i(){this.constructor=t}Zs(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),e.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Mt(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Mt(this.scale.y)*this._height/this._texture.orig.height)},e.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},e.prototype.calculateVertices=function(){var t=this._texture;if(this._transformID!==this.transform._worldID||this._textureID!==t._updateID){this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;var e=this.transform.worldTransform,i=e.a,r=e.b,s=e.c,a=e.d,n=e.tx,o=e.ty,c=this.vertexData,l=t.trim,h=t.orig,u=this._anchor,d=0,p=0,f=0,m=0;if(l?(d=(p=l.x-u._x*h.width)+l.width,f=(m=l.y-u._y*h.height)+l.height):(d=(p=-u._x*h.width)+h.width,f=(m=-u._y*h.height)+h.height),c[0]=i*p+s*m+n,c[1]=a*m+r*p+o,c[2]=i*d+s*m+n,c[3]=a*m+r*d+o,c[4]=i*d+s*f+n,c[5]=a*f+r*d+o,c[6]=i*p+s*f+n,c[7]=a*f+r*p+o,this._roundPixels)for(var y=D.RESOLUTION,_=0;_<c.length;++_)c[_]=Math.round((c[_]*y|0)/y)}},e.prototype.calculateTrimmedVertices=function(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var t=this._texture,e=this.vertexTrimmedData,i=t.orig,r=this._anchor,s=this.transform.worldTransform,a=s.a,n=s.b,o=s.c,c=s.d,l=s.tx,h=s.ty,u=-r._x*i.width,d=u+i.width,p=-r._y*i.height,f=p+i.height;e[0]=a*u+o*p+l,e[1]=c*p+n*u+h,e[2]=a*d+o*p+l,e[3]=c*p+n*d+h,e[4]=a*d+o*f+l,e[5]=c*f+n*d+h,e[6]=a*u+o*f+l,e[7]=c*f+n*u+h},e.prototype._render=function(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)},e.prototype._calculateBounds=function(){var t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},e.prototype.getLocalBounds=function(e){return 0===this.children.length?(this._bounds.minX=this._texture.orig.width*-this._anchor._x,this._bounds.minY=this._texture.orig.height*-this._anchor._y,this._bounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._bounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new Ht),e=this._localBoundsRect),this._bounds.getRectangle(e)):t.prototype.getLocalBounds.call(this,e)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,ta);var e=this._texture.orig.width,i=this._texture.orig.height,r=-e*this.anchor.x,s=0;return ta.x>=r&&ta.x<r+e&&(s=-i*this.anchor.y,ta.y>=s&&ta.y<s+i)},e.prototype.destroy=function(e){if(t.prototype.destroy.call(this,e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,"boolean"==typeof e?e:e&&e.texture){var i="boolean"==typeof e?e:e&&e.baseTexture;this._texture.destroy(!!i)}this._texture=null},e.from=function(t,i){return new e(t instanceof Qe?t:Qe.from(t,i))},Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){var e=Mt(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){var e=Mt(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anchor",{get:function(){return this._anchor},set:function(t){this._anchor.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Qe.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))},enumerable:!1,configurable:!0}),e}(ue),ra=function(t,e){return ra=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},ra(t,e)};!function(t){t[t.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",t[t.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL"}(Js||(Js={}));var sa={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Js.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},aa=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],na=function(){function t(t){this.styleID=0,this.reset(),la(this,t,t)}return t.prototype.clone=function(){var e={};return la(e,this,sa),new t(e)},t.prototype.reset=function(){la(this,sa,sa)},Object.defineProperty(t.prototype,"align",{get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"breakWords",{get:function(){return this._breakWords},set:function(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadow",{get:function(){return this._dropShadow},set:function(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowAlpha",{get:function(){return this._dropShadowAlpha},set:function(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowAngle",{get:function(){return this._dropShadowAngle},set:function(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowBlur",{get:function(){return this._dropShadowBlur},set:function(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowColor",{get:function(){return this._dropShadowColor},set:function(t){var e=ca(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowDistance",{get:function(){return this._dropShadowDistance},set:function(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fill",{get:function(){return this._fill},set:function(t){var e=ca(t);this._fill!==e&&(this._fill=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fillGradientType",{get:function(){return this._fillGradientType},set:function(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fillGradientStops",{get:function(){return this._fillGradientStops},set:function(t){(function(t,e){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(var i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontVariant",{get:function(){return this._fontVariant},set:function(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leading",{get:function(){return this._leading},set:function(t){this._leading!==t&&(this._leading=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lineJoin",{get:function(){return this._lineJoin},set:function(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"miterLimit",{get:function(){return this._miterLimit},set:function(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"padding",{get:function(){return this._padding},set:function(t){this._padding!==t&&(this._padding=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stroke",{get:function(){return this._stroke},set:function(t){var e=ca(t);this._stroke!==e&&(this._stroke=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"strokeThickness",{get:function(){return this._strokeThickness},set:function(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textBaseline",{get:function(){return this._textBaseline},set:function(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"trim",{get:function(){return this._trim},set:function(t){this._trim!==t&&(this._trim=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"whiteSpace",{get:function(){return this._whiteSpace},set:function(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wordWrap",{get:function(){return this._wordWrap},set:function(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wordWrapWidth",{get:function(){return this._wordWrapWidth},set:function(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)},enumerable:!1,configurable:!0}),t.prototype.toFontString=function(){var t="number"==typeof this.fontSize?this.fontSize+"px":this.fontSize,e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(var i=e.length-1;i>=0;i--){var r=e[i].trim();!/([\"\'])[^\'\"]+\1/.test(r)&&aa.indexOf(r)<0&&(r='"'+r+'"'),e[i]=r}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+t+" "+e.join(",")},t}();function oa(t){return"number"==typeof t?at(t):("string"==typeof t&&0===t.indexOf("0x")&&(t=t.replace("0x","#")),t)}function ca(t){if(Array.isArray(t)){for(var e=0;e<t.length;++e)t[e]=oa(t[e]);return t}return oa(t)}function la(t,e,i){for(var r in i)Array.isArray(e[r])?t[r]=e[r].slice():t[r]=e[r]}var ha=function(){function t(t,e,i,r,s,a,n,o,c){this.text=t,this.style=e,this.width=i,this.height=r,this.lines=s,this.lineWidths=a,this.lineHeight=n,this.maxLineWidth=o,this.fontProperties=c}return t.measureText=function(e,i,r,s){void 0===s&&(s=t._canvas),r=null==r?i.wordWrap:r;var a=i.toFontString(),n=t.measureFont(a);0===n.fontSize&&(n.fontSize=i.fontSize,n.ascent=i.fontSize);var o=s.getContext("2d");o.font=a;for(var c=(r?t.wordWrap(e,i,s):e).split(/(?:\r\n|\r|\n)/),l=new Array(c.length),h=0,u=0;u<c.length;u++){var d=o.measureText(c[u]).width+(c[u].length-1)*i.letterSpacing;l[u]=d,h=Math.max(h,d)}var p=h+i.strokeThickness;i.dropShadow&&(p+=i.dropShadowDistance);var f=i.lineHeight||n.fontSize+i.strokeThickness,m=Math.max(f,n.fontSize+i.strokeThickness)+(c.length-1)*(f+i.leading);return i.dropShadow&&(m+=i.dropShadowDistance),new t(e,i,p,m,c,l,f+i.leading,h,n)},t.wordWrap=function(e,i,r){void 0===r&&(r=t._canvas);for(var s=r.getContext("2d"),a=0,n="",o="",c=Object.create(null),l=i.letterSpacing,h=i.whiteSpace,u=t.collapseSpaces(h),d=t.collapseNewlines(h),p=!u,f=i.wordWrapWidth+l,m=t.tokenize(e),y=0;y<m.length;y++){var _=m[y];if(t.isNewline(_)){if(!d){o+=t.addLine(n),p=!u,n="",a=0;continue}_=" "}if(u){var g=t.isBreakingSpace(_),v=t.isBreakingSpace(n[n.length-1]);if(g&&v)continue}var S=t.getFromCache(_,l,c,s);if(S>f)if(""!==n&&(o+=t.addLine(n),n="",a=0),t.canBreakWords(_,i.breakWords))for(var M=t.wordWrapSplit(_),R=0;R<M.length;R++){for(var b=M[R],E=1;M[R+E];){var I=M[R+E],x=b[b.length-1];if(t.canBreakChars(x,I,_,R,i.breakWords))break;b+=I,E++}R+=b.length-1;var w=t.getFromCache(b,l,c,s);w+a>f&&(o+=t.addLine(n),p=!1,n="",a=0),n+=b,a+=w}else{n.length>0&&(o+=t.addLine(n),n="",a=0);var T=y===m.length-1;o+=t.addLine(_,!T),p=!1,n="",a=0}else S+a>f&&(p=!1,o+=t.addLine(n),n="",a=0),(n.length>0||!t.isBreakingSpace(_)||p)&&(n+=_,a+=S)}return o+=t.addLine(n,!1)},t.addLine=function(e,i){return void 0===i&&(i=!0),e=t.trimRight(e),e=i?e+"\n":e},t.getFromCache=function(t,e,i,r){var s=i[t];if("number"!=typeof s){var a=t.length*e;s=r.measureText(t).width+a,i[t]=s}return s},t.collapseSpaces=function(t){return"normal"===t||"pre-line"===t},t.collapseNewlines=function(t){return"normal"===t},t.trimRight=function(e){if("string"!=typeof e)return"";for(var i=e.length-1;i>=0;i--){var r=e[i];if(!t.isBreakingSpace(r))break;e=e.slice(0,-1)}return e},t.isNewline=function(e){return"string"==typeof e&&t._newlines.indexOf(e.charCodeAt(0))>=0},t.isBreakingSpace=function(e){return"string"==typeof e&&t._breakingSpaces.indexOf(e.charCodeAt(0))>=0},t.tokenize=function(e){var i=[],r="";if("string"!=typeof e)return i;for(var s=0;s<e.length;s++){var a=e[s];t.isBreakingSpace(a)||t.isNewline(a)?(""!==r&&(i.push(r),r=""),i.push(a)):r+=a}return""!==r&&i.push(r),i},t.canBreakWords=function(t,e){return e},t.canBreakChars=function(t,e,i,r,s){return!0},t.wordWrapSplit=function(t){return t.split("")},t.measureFont=function(e){if(t._fonts[e])return t._fonts[e];var i={ascent:0,descent:0,fontSize:0},r=t._canvas,s=t._context;s.font=e;var a=t.METRICS_STRING+t.BASELINE_SYMBOL,n=Math.ceil(s.measureText(a).width),o=Math.ceil(s.measureText(t.BASELINE_SYMBOL).width),c=2*o;o=o*t.BASELINE_MULTIPLIER|0,r.width=n,r.height=c,s.fillStyle="#f00",s.fillRect(0,0,n,c),s.font=e,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText(a,0,o);var l=s.getImageData(0,0,n,c).data,h=l.length,u=4*n,d=0,p=0,f=!1;for(d=0;d<o;++d){for(var m=0;m<u;m+=4)if(255!==l[p+m]){f=!0;break}if(f)break;p+=u}for(i.ascent=o-d,p=h-u,f=!1,d=c;d>o;--d){for(m=0;m<u;m+=4)if(255!==l[p+m]){f=!0;break}if(f)break;p-=u}return i.descent=d-o,i.fontSize=i.ascent+i.descent,t._fonts[e]=i,i},t.clearMetrics=function(e){void 0===e&&(e=""),e?delete t._fonts[e]:t._fonts={}},t}(),ua=function(){try{var t=new OffscreenCanvas(0,0),e=t.getContext("2d");return e&&e.measureText?t:document.createElement("canvas")}catch(t){return document.createElement("canvas")}}();ua.width=ua.height=10,ha._canvas=ua,ha._context=ua.getContext("2d"),ha._fonts={},ha.METRICS_STRING="|ÉqÅ",ha.BASELINE_SYMBOL="M",ha.BASELINE_MULTIPLIER=1.4,ha._newlines=[10,13],ha._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var da={texture:!0,children:!1,baseTexture:!0},pa=function(t){function e(e,i,r){var s=this,a=!1;r||(r=document.createElement("canvas"),a=!0),r.width=3,r.height=3;var n=Qe.from(r);return n.orig=new Ht,n.trim=new Ht,(s=t.call(this,n)||this)._ownCanvas=a,s.canvas=r,s.context=s.canvas.getContext("2d"),s._resolution=D.RESOLUTION,s._autoResolution=!0,s._text=null,s._style=null,s._styleListener=null,s._font="",s.text=e,s.style=i,s.localStyleID=-1,s}return function(t,e){function i(){this.constructor=t}ra(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),e.prototype.updateText=function(t){var e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),this.dirty||!t){this._font=this._style.toFontString();var i,r,s=this.context,a=ha.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),n=a.width,o=a.height,c=a.lines,l=a.lineHeight,h=a.lineWidths,u=a.maxLineWidth,d=a.fontProperties;this.canvas.width=Math.ceil((Math.max(1,n)+2*e.padding)*this._resolution),this.canvas.height=Math.ceil((Math.max(1,o)+2*e.padding)*this._resolution),s.scale(this._resolution,this._resolution),s.clearRect(0,0,this.canvas.width,this.canvas.height),s.font=this._font,s.lineWidth=e.strokeThickness,s.textBaseline=e.textBaseline,s.lineJoin=e.lineJoin,s.miterLimit=e.miterLimit;for(var p=e.dropShadow?2:1,f=0;f<p;++f){var m=e.dropShadow&&0===f,y=m?Math.ceil(Math.max(1,o)+2*e.padding):0,_=y*this._resolution;if(m){s.fillStyle="black",s.strokeStyle="black";var g=e.dropShadowColor,v=st("number"==typeof g?g:nt(g));s.shadowColor="rgba("+255*v[0]+","+255*v[1]+","+255*v[2]+","+e.dropShadowAlpha+")",s.shadowBlur=e.dropShadowBlur,s.shadowOffsetX=Math.cos(e.dropShadowAngle)*e.dropShadowDistance,s.shadowOffsetY=Math.sin(e.dropShadowAngle)*e.dropShadowDistance+_}else s.fillStyle=this._generateFillStyle(e,c,a),s.strokeStyle=e.stroke,s.shadowColor="black",s.shadowBlur=0,s.shadowOffsetX=0,s.shadowOffsetY=0;for(var S=0;S<c.length;S++)i=e.strokeThickness/2,r=e.strokeThickness/2+S*l+d.ascent,"right"===e.align?i+=u-h[S]:"center"===e.align&&(i+=(u-h[S])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(c[S],i+e.padding,r+e.padding-y,!0),e.fill&&this.drawLetterSpacing(c[S],i+e.padding,r+e.padding-y)}this.updateTexture()}},e.prototype.drawLetterSpacing=function(t,e,i,r){void 0===r&&(r=!1);var s=this._style.letterSpacing;if(0!==s)for(var a=e,n=Array.from?Array.from(t):t.split(""),o=this.context.measureText(t).width,c=0,l=0;l<n.length;++l){var h=n[l];r?this.context.strokeText(h,a,i):this.context.fillText(h,a,i),a+=o-(c=this.context.measureText(t.substring(l+1)).width)+s,o=c}else r?this.context.strokeText(t,e,i):this.context.fillText(t,e,i)},e.prototype.updateTexture=function(){var t=this.canvas;if(this._style.trim){var e=kt(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}var i=this._texture,r=this._style,s=r.trim?0:r.padding,a=i.baseTexture;i.trim.width=i._frame.width=Math.ceil(t.width/this._resolution),i.trim.height=i._frame.height=Math.ceil(t.height/this._resolution),i.trim.x=-s,i.trim.y=-s,i.orig.width=i._frame.width-2*s,i.orig.height=i._frame.height-2*s,this._onTextureUpdate(),a.setRealSize(t.width,t.height,this._resolution),this._recursivePostUpdateTransform(),this.dirty=!1},e.prototype._render=function(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),t.prototype._render.call(this,e)},e.prototype.getLocalBounds=function(e){return this.updateText(!0),t.prototype.getLocalBounds.call(this,e)},e.prototype._calculateBounds=function(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},e.prototype._generateFillStyle=function(t,e,i){var r,s=t.fill;if(!Array.isArray(s))return s;if(1===s.length)return s[0];var a=t.dropShadow?t.dropShadowDistance:0,n=t.padding||0,o=Math.ceil(this.canvas.width/this._resolution)-a-2*n,c=Math.ceil(this.canvas.height/this._resolution)-a-2*n,l=s.slice(),h=t.fillGradientStops.slice();if(!h.length)for(var u=l.length+1,d=1;d<u;++d)h.push(d/u);if(l.unshift(s[0]),h.unshift(0),l.push(s[s.length-1]),h.push(1),t.fillGradientType===Js.LINEAR_VERTICAL){r=this.context.createLinearGradient(o/2,n,o/2,c+n);var p=0,f=(i.fontProperties.fontSize+t.strokeThickness)/c;for(d=0;d<e.length;d++)for(var m=i.lineHeight*d,y=0;y<l.length;y++){var _=m/c+("number"==typeof h[y]?h[y]:y/l.length)*f,g=Math.max(p,_);g=Math.min(g,1),r.addColorStop(g,l[y]),p=g}}else{r=this.context.createLinearGradient(n,c/2,o+n,c/2);var v=l.length+1,S=1;for(d=0;d<l.length;d++){var M=void 0;M="number"==typeof h[d]?h[d]:S/v,r.addColorStop(M,l[d]),S++}}return r},e.prototype.destroy=function(e){"boolean"==typeof e&&(e={children:e}),e=Object.assign({},da,e),t.prototype.destroy.call(this,e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null},Object.defineProperty(e.prototype,"width",{get:function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){this.updateText(!0);var e=Mt(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){this.updateText(!0);var e=Mt(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this._style},set:function(t){t=t||{},this._style=t instanceof na?t:new na(t),this.localStyleID=-1,this.dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resolution",{get:function(){return this._resolution},set:function(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)},enumerable:!1,configurable:!0}),e}(ia);D.UPLOADS_PER_FRAME=4;var fa=function(t,e){return fa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},fa(t,e)};var ma=function(){function t(t){this.maxItemsPerFrame=t,this.itemsLeft=0}return t.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},t.prototype.allowedToUpload=function(){return this.itemsLeft-- >0},t}();function ya(t,e){var i=!1;if(t&&t._textures&&t._textures.length)for(var r=0;r<t._textures.length;r++)if(t._textures[r]instanceof Qe){var s=t._textures[r].baseTexture;-1===e.indexOf(s)&&(e.push(s),i=!0)}return i}function _a(t,e){if(t.baseTexture instanceof Le){var i=t.baseTexture;return-1===e.indexOf(i)&&e.push(i),!0}return!1}function ga(t,e){if(t._texture&&t._texture instanceof Qe){var i=t._texture.baseTexture;return-1===e.indexOf(i)&&e.push(i),!0}return!1}function va(t,e){return e instanceof pa&&(e.updateText(!0),!0)}function Sa(t,e){if(e instanceof na){var i=e.toFontString();return ha.measureFont(i),!0}return!1}function Ma(t,e){if(t instanceof pa){-1===e.indexOf(t.style)&&e.push(t.style),-1===e.indexOf(t)&&e.push(t);var i=t._texture.baseTexture;return-1===e.indexOf(i)&&e.push(i),!0}return!1}function Ra(t,e){return t instanceof na&&(-1===e.indexOf(t)&&e.push(t),!0)}var ba=function(){function t(t){var e=this;this.limiter=new ma(D.UPLOADS_PER_FRAME),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){e.queue&&e.prepareItems()},this.registerFindHook(Ma),this.registerFindHook(Ra),this.registerFindHook(ya),this.registerFindHook(_a),this.registerFindHook(ga),this.registerUploadHook(va),this.registerUploadHook(Sa)}return t.prototype.upload=function(t,e){"function"==typeof t&&(e=t,t=null),t&&this.add(t),this.queue.length?(e&&this.completes.push(e),this.ticking||(this.ticking=!0,ye.system.addOnce(this.tick,this,pe.UTILITY))):e&&e()},t.prototype.tick=function(){setTimeout(this.delayedTick,0)},t.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var t=this.queue[0],e=!1;if(t&&!t._destroyed)for(var i=0,r=this.uploadHooks.length;i<r;i++)if(this.uploadHooks[i](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)ye.system.addOnce(this.tick,this,pe.UTILITY);else{this.ticking=!1;var s=this.completes.slice(0);this.completes.length=0;for(i=0,r=s.length;i<r;i++)s[i]()}},t.prototype.registerFindHook=function(t){return t&&this.addHooks.push(t),this},t.prototype.registerUploadHook=function(t){return t&&this.uploadHooks.push(t),this},t.prototype.add=function(t){for(var e=0,i=this.addHooks.length;e<i&&!this.addHooks[e](t,this.queue);e++);if(t instanceof ue)for(e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this},t.prototype.destroy=function(){this.ticking&&ye.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null},t}();function Ea(t,e){return e instanceof Le&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function Ia(t,e){if(!(e instanceof Qs))return!1;var i=e.geometry;e.finishPoly(),i.updateBatches();for(var r=i.batches,s=0;s<r.length;s++){var a=r[s].style.texture;a&&Ea(t,a.baseTexture)}return i.batchable||t.geometry.bind(i,e._resolveDirectShader(t)),!0}function xa(t,e){return t instanceof Qs&&(e.push(t),!0)}var wa=function(t){function e(e){var i=t.call(this,e)||this;return i.uploadHookHelper=i.renderer,i.registerFindHook(xa),i.registerUploadHook(Ea),i.registerUploadHook(Ia),i}return function(t,e){function i(){this.constructor=t}fa(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),e}(ba),Ta=function(){function t(t){this.maxMilliseconds=t,this.frameStart=0}return t.prototype.beginFrame=function(){this.frameStart=Date.now()},t.prototype.allowedToUpload=function(){return Date.now()-this.frameStart<this.maxMilliseconds},t}(),Da=function(){function t(t,e,i){void 0===i&&(i=null),this._texture=t instanceof Qe?t:null,this.baseTexture=t instanceof Le?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;var r=this.baseTexture.resource;this.resolution=this._updateResolution(i||(r?r.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}return t.prototype._updateResolution=function(t){void 0===t&&(t=null);var e=this.data.meta.scale,i=Ot(t,null);return null===i&&(i=void 0!==e?parseFloat(e):1),1!==i&&this.baseTexture.setResolution(i),i},t.prototype.parse=function(e){this._batchIndex=0,this._callback=e,this._frameKeys.length<=t.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()},t.prototype._processFrames=function(e){for(var i=e,r=t.BATCH_SIZE;i-e<r&&i<this._frameKeys.length;){var s=this._frameKeys[i],a=this._frames[s],n=a.frame;if(n){var o=null,c=null,l=!1!==a.trimmed&&a.sourceSize?a.sourceSize:a.frame,h=new Ht(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);o=a.rotated?new Ht(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.h)/this.resolution,Math.floor(n.w)/this.resolution):new Ht(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution),!1!==a.trimmed&&a.spriteSourceSize&&(c=new Ht(Math.floor(a.spriteSourceSize.x)/this.resolution,Math.floor(a.spriteSourceSize.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution)),this.textures[s]=new Qe(this.baseTexture,o,h,c,a.rotated?2:0,a.anchor),Qe.addToCache(this.textures[s],s)}i++}},t.prototype._processAnimations=function(){var t=this.data.animations||{};for(var e in t){this.animations[e]=[];for(var i=0;i<t[e].length;i++){var r=t[e][i];this.animations[e].push(this.textures[r])}}},t.prototype._parseComplete=function(){var t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)},t.prototype._nextBatch=function(){var e=this;this._processFrames(this._batchIndex*t.BATCH_SIZE),this._batchIndex++,setTimeout((function(){e._batchIndex*t.BATCH_SIZE<e._frameKeys.length?e._nextBatch():(e._processAnimations(),e._parseComplete())}),0)},t.prototype.destroy=function(t){var e;for(var i in void 0===t&&(t=!1),this.textures)this.textures[i].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(null===(e=this._texture)||void 0===e||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null},t.BATCH_SIZE=1e3,t}(),Pa=function(){function t(){}return t.use=function(e,i){var r=this,s=e.name+"_image";if(e.data&&e.type===ls.TYPE.JSON&&e.data.frames&&!r.resources[s]){var a={crossOrigin:e.crossOrigin,metadata:e.metadata.imageMetadata,parentResource:e},n=t.getResourcePath(e,r.baseUrl);r.add(s,n,a,(function(t){if(t.error)i(t.error);else{var r=new Da(t.texture,e.data,e.url);r.parse((function(){e.spritesheet=r,e.textures=r.textures,i()}))}}))}else i()},t.getResourcePath=function(t,e){return t.isDataUrl?t.data.meta.image:Z().resolve(t.url.replace(e,""),t.data.meta.image)},t}(),Aa=function(t,e){return Aa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},Aa(t,e)};function ka(t,e){function i(){this.constructor=t}Aa(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var Ca=new Xt,La=function(t){function e(e,i,r){void 0===i&&(i=100),void 0===r&&(r=100);var s=t.call(this,e)||this;return s.tileTransform=new se,s._width=i,s._height=r,s.uvMatrix=s.texture.uvMatrix||new er(e),s.pluginName="tilingSprite",s.uvRespectAnchor=!1,s}return ka(e,t),Object.defineProperty(e.prototype,"clampMargin",{get:function(){return this.uvMatrix.clampMargin},set:function(t){this.uvMatrix.clampMargin=t,this.uvMatrix.update(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tileScale",{get:function(){return this.tileTransform.scale},set:function(t){this.tileTransform.scale.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tilePosition",{get:function(){return this.tileTransform.position},set:function(t){this.tileTransform.position.copyFrom(t)},enumerable:!1,configurable:!0}),e.prototype._onTextureUpdate=function(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215},e.prototype._render=function(t){var e=this._texture;e&&e.valid&&(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))},e.prototype._calculateBounds=function(){var t=this._width*-this._anchor._x,e=this._height*-this._anchor._y,i=this._width*(1-this._anchor._x),r=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,t,e,i,r)},e.prototype.getLocalBounds=function(e){return 0===this.children.length?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new Ht),e=this._localBoundsRect),this._bounds.getRectangle(e)):t.prototype.getLocalBounds.call(this,e)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,Ca);var e=this._width,i=this._height,r=-e*this.anchor._x;if(Ca.x>=r&&Ca.x<r+e){var s=-i*this.anchor._y;if(Ca.y>=s&&Ca.y<s+i)return!0}return!1},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this.tileTransform=null,this.uvMatrix=null},e.from=function(t,i){return"number"==typeof i&&(It("5.3.0","TilingSprite.from use options instead of width and height args"),i={width:i,height:arguments[2]}),new e(Qe.from(t,i),i.width,i.height)},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t},enumerable:!1,configurable:!0}),e}(ia),Ba="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n",Fa=new Kt,Oa=function(t){function e(e){var i=t.call(this,e)||this,r={globals:i.renderer.globalUniforms};return i.shader=Qi.from(Ba,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture2D(uSampler, coord);\n    gl_FragColor = texSample * uColor;\n}\n",r),i.simpleShader=Qi.from(Ba,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n",r),i.quad=new ui,i.state=Zi.for2d(),i}return ka(e,t),e.prototype.render=function(t){var e=this.renderer,i=this.quad,r=i.vertices;r[0]=r[6]=t._width*-t.anchor.x,r[1]=r[3]=t._height*-t.anchor.y,r[2]=r[4]=t._width*(1-t.anchor.x),r[5]=r[7]=t._height*(1-t.anchor.y),t.uvRespectAnchor&&((r=i.uvs)[0]=r[6]=-t.anchor.x,r[1]=r[3]=-t.anchor.y,r[2]=r[4]=1-t.anchor.x,r[5]=r[7]=1-t.anchor.y),i.invalidate();var s=t._texture,a=s.baseTexture,n=t.tileTransform.localTransform,o=t.uvMatrix,c=a.isPowerOfTwo&&s.frame.width===a.width&&s.frame.height===a.height;c&&(a._glTextures[e.CONTEXT_UID]?c=a.wrapMode!==q.CLAMP:a.wrapMode===q.CLAMP&&(a.wrapMode=q.REPEAT));var l=c?this.simpleShader:this.shader,h=s.width,u=s.height,d=t._width,p=t._height;Fa.set(n.a*h/d,n.b*h/p,n.c*u/d,n.d*u/p,n.tx/d,n.ty/p),Fa.invert(),c?Fa.prepend(o.mapCoord):(l.uniforms.uMapCoord=o.mapCoord.toArray(!0),l.uniforms.uClampFrame=o.uClampFrame,l.uniforms.uClampOffset=o.uClampOffset),l.uniforms.uTransform=Fa.toArray(!0),l.uniforms.uColor=dt(t.tint,t.worldAlpha,l.uniforms.uColor,a.alphaMode),l.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),l.uniforms.uSampler=s,e.shader.bind(l),e.geometry.bind(i),this.state.blendMode=lt(t.blendMode,a.alphaMode),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)},e}(yi),Na=function(t,e){return Na=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},Na(t,e)};function ja(t,e){function i(){this.constructor=t}Na(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var Ua=function(){function t(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}return t.prototype.update=function(t){if(t||this._bufferUpdateId!==this.uvBuffer._updateID||this._textureUpdateId!==this.uvMatrix._updateID){this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;var e=this.uvBuffer.data;this.data&&this.data.length===e.length||(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}},t}(),Va=new Xt,Ha=new Gt,Wa=function(t){function e(e,i,r,s){void 0===s&&(s=j.TRIANGLES);var a=t.call(this)||this;return a.geometry=e,e.refCount++,a.shader=i,a.state=r||Zi.for2d(),a.drawMode=s,a.start=0,a.size=0,a.uvs=null,a.indices=null,a.vertexData=new Float32Array(1),a.vertexDirty=0,a._transformID=-1,a._roundPixels=D.ROUND_PIXELS,a.batchUvs=null,a}return ja(e,t),Object.defineProperty(e.prototype,"uvBuffer",{get:function(){return this.geometry.buffers[1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"verticesBuffer",{get:function(){return this.geometry.buffers[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"material",{get:function(){return this.shader},set:function(t){this.shader=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this.shader.tint},set:function(t){this.shader.tint=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this.shader.texture},set:function(t){this.shader.texture=t},enumerable:!1,configurable:!0}),e.prototype._render=function(t){var i=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===j.TRIANGLES&&i.length<2*e.BATCHABLE_SIZE?this._renderToBatch(t):this._renderDefault(t)},e.prototype._renderDefault=function(t){var e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.program.uniformData.translationMatrix&&(e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0)),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)},e.prototype._renderToBatch=function(t){var e=this.geometry;this.shader.uvMatrix&&(this.shader.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=this.shader._tintRGB,this._texture=this.shader.texture;var i=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[i]),t.plugins[i].render(this)},e.prototype.calculateVertices=function(){var t=this.geometry,e=t.buffers[0].data;if(t.vertexDirtyId!==this.vertexDirty||this._transformID!==this.transform._worldID){this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));for(var i=this.transform.worldTransform,r=i.a,s=i.b,a=i.c,n=i.d,o=i.tx,c=i.ty,l=this.vertexData,h=0;h<l.length/2;h++){var u=e[2*h],d=e[2*h+1];l[2*h]=r*u+a*d+o,l[2*h+1]=s*u+n*d+c}if(this._roundPixels){var p=D.RESOLUTION;for(h=0;h<l.length;++h)l[h]=Math.round((l[h]*p|0)/p)}this.vertexDirty=t.vertexDirtyId}},e.prototype.calculateUvs=function(){var t=this.geometry.buffers[1];this.shader.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new Ua(t,this.shader.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)},e.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)},e.prototype.containsPoint=function(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,Va);for(var e=this.geometry.getBuffer("aVertexPosition").data,i=Ha.points,r=this.geometry.getIndex().data,s=r.length,a=4===this.drawMode?3:1,n=0;n+2<s;n+=a){var o=2*r[n],c=2*r[n+1],l=2*r[n+2];if(i[0]=e[o],i[1]=e[o+1],i[2]=e[c],i[3]=e[c+1],i[4]=e[l],i[5]=e[l+1],Ha.contains(Va.x,Va.y))return!0}return!1},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this.geometry.refCount--,0===this.geometry.refCount&&this.geometry.dispose(),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null},e.BATCHABLE_SIZE=100,e}(ue),qa=function(t){function e(e,i){var r=this,s={uSampler:e,alpha:1,uTextureMatrix:Kt.IDENTITY,uColor:new Float32Array([1,1,1,1])};return(i=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},i)).uniforms&&Object.assign(s,i.uniforms),(r=t.call(this,i.program||$i.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),s)||this)._colorDirty=!1,r.uvMatrix=new er(e),r.batchable=void 0===i.program,r.pluginName=i.pluginName,r.tint=i.tint,r.alpha=i.alpha,r}return ja(e,t),Object.defineProperty(e.prototype,"texture",{get:function(){return this.uniforms.uSampler},set:function(t){this.uniforms.uSampler!==t&&(this.uniforms.uSampler=t,this.uvMatrix.texture=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16),this._colorDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.update=function(){if(this._colorDirty){this._colorDirty=!1;var t=this.texture.baseTexture;dt(this._tint,this._alpha,this.uniforms.uColor,t.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)},e}(Qi),Ga=function(t){function e(e,i,r){var s=t.call(this)||this,a=new ri(e),n=new ri(i,!0),o=new ri(r,!0,!0);return s.addAttribute("aVertexPosition",a,2,!1,H.FLOAT).addAttribute("aTextureCoord",n,2,!1,H.FLOAT).addIndex(o),s._updateId=-1,s}return ja(e,t),Object.defineProperty(e.prototype,"vertexDirtyId",{get:function(){return this.buffers[0]._updateID},enumerable:!1,configurable:!0}),e}(li),za=function(t,e){return za=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},za(t,e)};var Xa=function(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[]},Ya=function(){function t(){}return t.test=function(t){return"string"==typeof t&&0===t.indexOf("info face=")},t.parse=function(t){var e=t.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[]};for(var r in e){var s=e[r].match(/^[a-z]+/gm)[0],a=e[r].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),n={};for(var o in a){var c=a[o].split("="),l=c[0],h=c[1].replace(/"/gm,""),u=parseFloat(h),d=isNaN(u)?h:u;n[l]=d}i[s].push(n)}var p=new Xa;return i.info.forEach((function(t){return p.info.push({face:t.face,size:parseInt(t.size,10)})})),i.common.forEach((function(t){return p.common.push({lineHeight:parseInt(t.lineHeight,10)})})),i.page.forEach((function(t){return p.page.push({id:parseInt(t.id,10),file:t.file})})),i.char.forEach((function(t){return p.char.push({id:parseInt(t.id,10),page:parseInt(t.page,10),x:parseInt(t.x,10),y:parseInt(t.y,10),width:parseInt(t.width,10),height:parseInt(t.height,10),xoffset:parseInt(t.xoffset,10),yoffset:parseInt(t.yoffset,10),xadvance:parseInt(t.xadvance,10)})})),i.kerning.forEach((function(t){return p.kerning.push({first:parseInt(t.first,10),second:parseInt(t.second,10),amount:parseInt(t.amount,10)})})),p},t}(),Ka=function(){function t(){}return t.test=function(t){return t instanceof XMLDocument&&t.getElementsByTagName("page").length&&null!==t.getElementsByTagName("info")[0].getAttribute("face")},t.parse=function(t){for(var e=new Xa,i=t.getElementsByTagName("info"),r=t.getElementsByTagName("common"),s=t.getElementsByTagName("page"),a=t.getElementsByTagName("char"),n=t.getElementsByTagName("kerning"),o=0;o<i.length;o++)e.info.push({face:i[o].getAttribute("face"),size:parseInt(i[o].getAttribute("size"),10)});for(o=0;o<r.length;o++)e.common.push({lineHeight:parseInt(r[o].getAttribute("lineHeight"),10)});for(o=0;o<s.length;o++)e.page.push({id:parseInt(s[o].getAttribute("id"),10)||0,file:s[o].getAttribute("file")});for(o=0;o<a.length;o++){var c=a[o];e.char.push({id:parseInt(c.getAttribute("id"),10),page:parseInt(c.getAttribute("page"),10)||0,x:parseInt(c.getAttribute("x"),10),y:parseInt(c.getAttribute("y"),10),width:parseInt(c.getAttribute("width"),10),height:parseInt(c.getAttribute("height"),10),xoffset:parseInt(c.getAttribute("xoffset"),10),yoffset:parseInt(c.getAttribute("yoffset"),10),xadvance:parseInt(c.getAttribute("xadvance"),10)})}for(o=0;o<n.length;o++)e.kerning.push({first:parseInt(n[o].getAttribute("first"),10),second:parseInt(n[o].getAttribute("second"),10),amount:parseInt(n[o].getAttribute("amount"),10)});return e},t}(),$a=function(){function t(){}return t.test=function(t){if("string"==typeof t&&t.indexOf("<font>")>-1){var e=(new self.DOMParser).parseFromString(t,"text/xml");return Ka.test(e)}return!1},t.parse=function(t){var e=(new window.DOMParser).parseFromString(t,"text/xml");return Ka.parse(e)},t}(),Qa=[Ya,Ka,$a];function Za(t){for(var e=0;e<Qa.length;e++)if(Qa[e].test(t))return Qa[e];return null}function Ja(t,e,i,r,s,a){var n,o=i.fill;if(!Array.isArray(o))return o;if(1===o.length)return o[0];var c=i.dropShadow?i.dropShadowDistance:0,l=i.padding||0,h=Math.ceil(t.width/r)-c-2*l,u=Math.ceil(t.height/r)-c-2*l,d=o.slice(),p=i.fillGradientStops.slice();if(!p.length)for(var f=d.length+1,m=1;m<f;++m)p.push(m/f);if(d.unshift(o[0]),p.unshift(0),d.push(o[o.length-1]),p.push(1),i.fillGradientType===Js.LINEAR_VERTICAL){n=e.createLinearGradient(h/2,l,h/2,u+l);var y=0,_=(a.fontProperties.fontSize+i.strokeThickness)/u;for(m=0;m<s.length;m++)for(var g=a.lineHeight*m,v=0;v<d.length;v++){var S=g/u+("number"==typeof p[v]?p[v]:v/d.length)*_,M=Math.max(y,S);M=Math.min(M,1),n.addColorStop(M,d[v]),y=M}}else{n=e.createLinearGradient(l,u/2,h+l,u/2);var R=d.length+1,b=1;for(m=0;m<d.length;m++){var E=void 0;E="number"==typeof p[m]?p[m]:b/R,n.addColorStop(E,d[m]),b++}}return n}function tn(t,e,i,r,s,a,n){var o=i.text,c=i.fontProperties;e.translate(r,s),e.scale(a,a);var l=n.strokeThickness/2,h=-n.strokeThickness/2;e.font=n.toFontString(),e.lineWidth=n.strokeThickness,e.textBaseline=n.textBaseline,e.lineJoin=n.lineJoin,e.miterLimit=n.miterLimit,e.fillStyle=Ja(t,e,n,a,[o],i),e.strokeStyle=n.stroke,e.font=n.toFontString(),e.lineWidth=n.strokeThickness,e.textBaseline=n.textBaseline,e.lineJoin=n.lineJoin,e.miterLimit=n.miterLimit,e.fillStyle=Ja(t,e,n,a,[o],i),e.strokeStyle=n.stroke;var u=n.dropShadowColor,d=st("number"==typeof u?u:nt(u));n.dropShadow?(e.shadowColor="rgba("+255*d[0]+","+255*d[1]+","+255*d[2]+","+n.dropShadowAlpha+")",e.shadowBlur=n.dropShadowBlur,e.shadowOffsetX=Math.cos(n.dropShadowAngle)*n.dropShadowDistance,e.shadowOffsetY=Math.sin(n.dropShadowAngle)*n.dropShadowDistance):(e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),n.stroke&&n.strokeThickness&&e.strokeText(o,l,h+i.lineHeight-c.descent),n.fill&&e.fillText(o,l,h+i.lineHeight-c.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}var en=function(){function t(t,e,i){var r=t.info[0],s=t.common[0],a=Ot(t.page[0].file),n={};this._ownsTextures=i,this.font=r.face,this.size=r.size,this.lineHeight=s.lineHeight/a,this.chars={},this.pageTextures=n;for(var o=0;o<t.page.length;o++){var c=t.page[o],l=c.id,h=c.file;n[l]=e instanceof Array?e[o]:e[h]}for(o=0;o<t.char.length;o++){var u=t.char[o],d=(l=u.id,u.page),p=t.char[o],f=p.x,m=p.y,y=p.width,_=p.height,g=p.xoffset,v=p.yoffset,S=p.xadvance;m/=a,y/=a,_/=a,g/=a,v/=a,S/=a;var M=new Ht((f/=a)+n[d].frame.x/a,m+n[d].frame.y/a,y,_);this.chars[l]={xOffset:g,yOffset:v,xAdvance:S,kerning:{},texture:new Qe(n[d].baseTexture,M),page:d}}for(o=0;o<t.kerning.length;o++){var R=t.kerning[o],b=R.first,E=R.second,I=R.amount;b/=a,E/=a,I/=a,this.chars[E]&&(this.chars[E].kerning[b]=I)}}return t.prototype.destroy=function(){for(var t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(var t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null},t.install=function(e,i,r){var s;if(e instanceof Xa)s=e;else{var a=Za(e);if(!a)throw new Error("Unrecognized data format for font.");s=a.parse(e)}i instanceof Qe&&(i=[i]);var n=new t(s,i,r);return t.available[n.font]=n,n},t.uninstall=function(e){var i=t.available[e];if(!i)throw new Error("No font found named '"+e+"'");i.destroy(),delete t.available[e]},t.from=function(e,i,r){if(!e)throw new Error("[BitmapFont] Property `name` is required.");var s=Object.assign({},t.defaultOptions,r),a=s.chars,n=s.padding,o=s.resolution,c=s.textureWidth,l=s.textureHeight,h=function(t){"string"==typeof t&&(t=[t]);for(var e=[],i=0,r=t.length;i<r;i++){var s=t[i];if(Array.isArray(s)){if(2!==s.length)throw new Error("[BitmapFont]: Invalid character range length, expecting 2 got "+s.length+".");var a=s[0].charCodeAt(0),n=s[1].charCodeAt(0);if(n<a)throw new Error("[BitmapFont]: Invalid character range.");for(var o=a,c=n;o<=c;o++)e.push(String.fromCharCode(o))}else e.push.apply(e,s.split(""))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}(a),u=i instanceof na?i:new na(i),d=c,p=new Xa;p.info[0]={face:u.fontFamily,size:u.fontSize},p.common[0]={lineHeight:u.fontSize};for(var f,m,y,_=0,g=0,v=0,S=[],M=0;M<h.length;M++){f||((f=document.createElement("canvas")).width=c,f.height=l,m=f.getContext("2d"),y=new Le(f,{resolution:o}),S.push(new Qe(y)),p.page.push({id:S.length-1,file:""}));var R=ha.measureText(h[M],u,!1,f),b=R.width,E=Math.ceil(R.height),I=Math.ceil(("italic"===u.fontStyle?2:1)*b);if(g>=l-E*o){if(0===g)throw new Error("[BitmapFont] textureHeight "+l+"px is too small for "+u.fontSize+"px fonts");--M,f=null,m=null,y=null,g=0,_=0,v=0}else if(v=Math.max(E+R.fontProperties.descent,v),I*o+_>=d)--M,g+=v*o,g=Math.ceil(g),_=0,v=0;else{tn(f,m,R,_,g,o,u);var x=R.text.charCodeAt(0);p.char.push({id:x,page:S.length-1,x:_/o,y:g/o,width:I,height:E,xoffset:0,yoffset:0,xadvance:Math.ceil(b-(u.dropShadow?u.dropShadowDistance:0)-(u.stroke?u.strokeThickness:0))}),_+=(I+2*n)*o,_=Math.ceil(_)}}var w=new t(p,S,!0);return void 0!==t.available[e]&&t.uninstall(e),t.available[e]=w,w},t.ALPHA=[["a","z"],["A","Z"]," "],t.NUMERIC=[["0","9"]],t.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],t.ASCII=[[" ","~"]],t.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:t.ALPHANUMERIC},t.available={},t}(),rn=[],sn=[],an=function(t){function e(i,r){void 0===r&&(r={});var s=t.call(this)||this;s._tint=16777215,r.font&&(It("5.3.0","PIXI.BitmapText constructor style.font property is deprecated."),s._upgradeStyle(r));var a=Object.assign({},e.styleDefaults,r),n=a.align,o=a.tint,c=a.maxWidth,l=a.letterSpacing,h=a.fontName,u=a.fontSize;if(!en.available[h])throw new Error('Missing BitmapFont "'+h+'"');return s._activePagesMeshData=[],s._textWidth=0,s._textHeight=0,s._align=n,s._tint=o,s._fontName=h,s._fontSize=u||en.available[h].size,s._text=i,s._maxWidth=c,s._maxLineHeight=0,s._letterSpacing=l,s._anchor=new Yt((function(){s.dirty=!0}),s,0,0),s._roundPixels=D.ROUND_PIXELS,s.dirty=!0,s._textureCache={},s}return function(t,e){function i(){this.constructor=t}za(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),e.prototype.updateText=function(){for(var t,e=en.available[this._fontName],i=this._fontSize/e.size,r=new Xt,s=[],a=[],n=this._text.replace(/(?:\r\n|\r)/g,"\n")||" ",o=n.length,c=this._maxWidth*e.size/this._fontSize,l=null,h=0,u=0,d=0,p=-1,f=0,m=0,y=0,_=0;_<o;_++){var g=n.charCodeAt(_),v=n.charAt(_);if(/(?:\s)/.test(v)&&(p=_,f=h),"\r"!==v&&"\n"!==v){var S=e.chars[g];if(S){l&&S.kerning[l]&&(r.x+=S.kerning[l]);var M=sn.pop()||{texture:Qe.EMPTY,line:0,charCode:0,position:new Xt};M.texture=S.texture,M.line=d,M.charCode=g,M.position.x=r.x+S.xOffset+this._letterSpacing/2,M.position.y=r.y+S.yOffset,s.push(M),r.x+=S.xAdvance+this._letterSpacing,h=r.x,y=Math.max(y,S.yOffset+S.texture.height),l=g,-1!==p&&c>0&&r.x>c&&(St(s,1+p-++m,1+_-p),_=p,p=-1,a.push(f),u=Math.max(u,f),d++,r.x=0,r.y+=e.lineHeight,l=null)}}else a.push(h),u=Math.max(u,h),++d,++m,r.x=0,r.y+=e.lineHeight,l=null}var R=n.charAt(n.length-1);"\r"!==R&&"\n"!==R&&(/(?:\s)/.test(R)&&(h=f),a.push(h),u=Math.max(u,h));var b=[];for(_=0;_<=d;_++){var E=0;"right"===this._align?E=u-a[_]:"center"===this._align&&(E=(u-a[_])/2),b.push(E)}var I=s.length,x={},w=[],T=this._activePagesMeshData;for(_=0;_<T.length;_++)rn.push(T[_]);for(_=0;_<I;_++){var D=(N=s[_].texture).baseTexture.uid;if(!x[D]){if(!(G=rn.pop())){var P=new Ga,A=new qa(Qe.EMPTY);G={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:new Wa(P,A),vertices:null,uvs:null,indices:null}}G.index=0,G.indexCount=0,G.vertexCount=0,G.uvsCount=0,G.total=0;var k=this._textureCache;k[D]=k[D]||new Qe(N.baseTexture),G.mesh.texture=k[D],G.mesh.tint=this._tint,w.push(G),x[D]=G}x[D].total++}for(_=0;_<T.length;_++)-1===w.indexOf(T[_])&&this.removeChild(T[_].mesh);for(_=0;_<w.length;_++)w[_].mesh.parent!==this&&this.addChild(w[_].mesh);for(var _ in this._activePagesMeshData=w,x){var C=(G=x[_]).total;if(!((null===(t=G.indices)||void 0===t?void 0:t.length)>6*C)||G.vertices.length<2*Wa.BATCHABLE_SIZE)G.vertices=new Float32Array(8*C),G.uvs=new Float32Array(8*C),G.indices=new Uint16Array(6*C);else for(var L=G.total,B=G.vertices,F=4*L*2;F<B.length;F++)B[F]=0;G.mesh.size=6*C}for(_=0;_<I;_++){var O=(v=s[_]).position.x+b[v.line];this._roundPixels&&(O=Math.round(O));var N,j=O*i,U=v.position.y*i,V=x[(N=v.texture).baseTexture.uid],H=N.frame,W=N._uvs,q=V.index++;V.indices[6*q+0]=0+4*q,V.indices[6*q+1]=1+4*q,V.indices[6*q+2]=2+4*q,V.indices[6*q+3]=0+4*q,V.indices[6*q+4]=2+4*q,V.indices[6*q+5]=3+4*q,V.vertices[8*q+0]=j,V.vertices[8*q+1]=U,V.vertices[8*q+2]=j+H.width*i,V.vertices[8*q+3]=U,V.vertices[8*q+4]=j+H.width*i,V.vertices[8*q+5]=U+H.height*i,V.vertices[8*q+6]=j,V.vertices[8*q+7]=U+H.height*i,V.uvs[8*q+0]=W.x0,V.uvs[8*q+1]=W.y0,V.uvs[8*q+2]=W.x1,V.uvs[8*q+3]=W.y1,V.uvs[8*q+4]=W.x2,V.uvs[8*q+5]=W.y2,V.uvs[8*q+6]=W.x3,V.uvs[8*q+7]=W.y3}for(var _ in this._textWidth=u*i,this._textHeight=(r.y+e.lineHeight)*i,x){var G=x[_];if(0!==this.anchor.x||0!==this.anchor.y)for(var z=0,X=this._textWidth*this.anchor.x,Y=this._textHeight*this.anchor.y,K=0;K<G.total;K++)G.vertices[z++]-=X,G.vertices[z++]-=Y,G.vertices[z++]-=X,G.vertices[z++]-=Y,G.vertices[z++]-=X,G.vertices[z++]-=Y,G.vertices[z++]-=X,G.vertices[z++]-=Y;this._maxLineHeight=y*i;var $=G.mesh.geometry.getBuffer("aVertexPosition"),Q=G.mesh.geometry.getBuffer("aTextureCoord"),Z=G.mesh.geometry.getIndex();$.data=G.vertices,Q.data=G.uvs,Z.data=G.indices,$.update(),Q.update(),Z.update()}for(_=0;_<s.length;_++)sn.push(s[_])},e.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},e.prototype.getLocalBounds=function(){return this.validate(),t.prototype.getLocalBounds.call(this)},e.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){if(this._tint!==t){this._tint=t;for(var e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"align",{get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontName",{get:function(){return this._fontName},set:function(t){if(!en.available[t])throw new Error('Missing BitmapFont "'+t+'"');this._fontName!==t&&(this._fontName=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anchor",{get:function(){return this._anchor},set:function(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxLineHeight",{get:function(){return this.validate(),this._maxLineHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textWidth",{get:function(){return this.validate(),this._textWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textHeight",{get:function(){return this.validate(),this._textHeight},enumerable:!1,configurable:!0}),e.prototype._upgradeStyle=function(t){if("string"==typeof t.font){var e=t.font.split(" ");t.fontName=1===e.length?e[0]:e.slice(1).join(" "),e.length>=2&&(t.fontSize=parseInt(e[0],10))}else t.fontName=t.font.name,t.fontSize="number"==typeof t.font.size?t.font.size:parseInt(t.font.size,10)},e.prototype.destroy=function(e){var i=this._textureCache;for(var r in i){i[r].destroy(),delete i[r]}this._textureCache=null,t.prototype.destroy.call(this,e)},e.registerFont=function(t,e){return It("5.3.0","PIXI.BitmapText.registerFont is deprecated, use PIXI.BitmapFont.install"),en.install(t,e)},Object.defineProperty(e,"fonts",{get:function(){return It("5.3.0","PIXI.BitmapText.fonts is deprecated, use PIXI.BitmapFont.available"),en.available},enumerable:!1,configurable:!0}),e.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0},e}(ue),nn=function(){function t(){}return t.add=function(){ls.setExtensionXhrType("fnt",ls.XHR_RESPONSE_TYPE.TEXT)},t.use=function(e,i){var r=Za(e.data);if(r)for(var s=t.getBaseUrl(this,e),a=r.parse(e.data),n={},o=function(t){n[t.metadata.pageFile]=t.texture,Object.keys(n).length===a.page.length&&(e.bitmapFont=en.install(a,n,!0),i())},c=0;c<a.page.length;++c){var l=a.page[c].file,h=s+l,u=!1;for(var d in this.resources){var p=this.resources[d];if(p.url===h){p.metadata.pageFile=l,p.texture?o(p):p.onAfterMiddleware.add(o),u=!0;break}}if(!u){var f={crossOrigin:e.crossOrigin,loadType:ls.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile:l},e.metadata.imageMetadata),parentResource:e};this.add(h,f,o)}}else i()},t.getBaseUrl=function(e,i){var r=i.isDataUrl?"":t.dirname(i.url);return i.isDataUrl&&("."===r&&(r=""),e.baseUrl&&r&&"/"===e.baseUrl.charAt(e.baseUrl.length-1)&&(r+="/")),(r=r.replace(e.baseUrl,""))&&"/"!==r.charAt(r.length-1)&&(r+="/"),r},t.dirname=function(t){var e=t.replace(/\\/g,"/").replace(/\/$/,"").replace(/\/[^\/]*$/,"");return e===t?".":""===e?"/":e},t}(),on=function(t,e){return on=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},on(t,e)};var cn=function(t){function e(e){void 0===e&&(e=1);var i=t.call(this,xr,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1})||this;return i.alpha=e,i}return function(t,e){function i(){this.constructor=t}on(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),Object.defineProperty(e.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t},enumerable:!1,configurable:!0}),e}(Ji),ln=function(t,e){return ln=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},ln(t,e)};function hn(t,e){function i(){this.constructor=t}ln(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var un,dn,pn,fn,mn,yn,_n,gn,vn,Sn,Mn,Rn,bn,En,In,xn,wn,Tn={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},Dn=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");!function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"}(un||(un={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(dn||(dn={})),function(t){t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL"}(pn||(pn={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"}(fn||(fn={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(mn||(mn={})),function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(yn||(yn={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(_n||(_n={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=36193]="HALF_FLOAT"}(gn||(gn={})),function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"}(vn||(vn={})),function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Sn||(Sn={})),function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON"}(Mn||(Mn={})),function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"}(Rn||(Rn={})),function(t){t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT"}(bn||(bn={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(En||(En={})),function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"}(In||(In={})),function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE"}(xn||(xn={})),function(t){t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH"}(wn||(wn={}));var Pn=function(t){function e(e,i,r,s,a){void 0===i&&(i=8),void 0===r&&(r=4),void 0===s&&(s=D.FILTER_RESOLUTION),void 0===a&&(a=5);var n=this,o=function(t,e){var i,r=Math.ceil(t/2),s="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",a="";i=e?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(var n=0;n<t;n++){var o=i.replace("%index%",n.toString());a+=o=o.replace("%sampleIndex%",n-(r-1)+".0"),a+="\n"}return(s=s.replace("%blur%",a)).replace("%size%",t.toString())}(a,e),c=function(t){for(var e,i=Tn[t],r=i.length,s=Dn,a="",n=0;n<t;n++){var o="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",n.toString());e=n,n>=r&&(e=t-n-1),a+=o=o.replace("%value%",i[e].toString()),a+="\n"}return(s=s.replace("%blur%",a)).replace("%size%",t.toString())}(a);return(n=t.call(this,o,c)||this).horizontal=e,n.resolution=s,n._quality=0,n.quality=r,n.blur=i,n}return hn(e,t),e.prototype.apply=function(t,e,i,r){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/e.width):this.uniforms.strength=1/i.height*(i.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,i,r);else{var s=t.getFilterTexture(),a=t.renderer,n=e,o=s;this.state.blend=!1,t.applyFilter(this,n,o,bn.CLEAR);for(var c=1;c<this.passes-1;c++){t.bindAndClear(n,bn.BLIT),this.uniforms.uSampler=o;var l=o;o=n,n=l,a.shader.bind(this),a.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,o,i,r),t.returnFilterTexture(s)}},Object.defineProperty(e.prototype,"blur",{get:function(){return this.strength},set:function(t){this.padding=1+2*Math.abs(t),this.strength=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this._quality},set:function(t){this._quality=t,this.passes=t},enumerable:!1,configurable:!0}),e}(Ji),An=function(t){function e(e,i,r,s){void 0===e&&(e=8),void 0===i&&(i=4),void 0===r&&(r=D.FILTER_RESOLUTION),void 0===s&&(s=5);var a=t.call(this)||this;return a.blurXFilter=new Pn(!0,e,i,r,s),a.blurYFilter=new Pn(!1,e,i,r,s),a.resolution=r,a.quality=i,a.blur=e,a.repeatEdgePixels=!1,a}return hn(e,t),e.prototype.apply=function(t,e,i,r){var s=Math.abs(this.blurXFilter.strength),a=Math.abs(this.blurYFilter.strength);if(s&&a){var n=t.getFilterTexture();this.blurXFilter.apply(t,e,n,bn.CLEAR),this.blurYFilter.apply(t,n,i,r),t.returnFilterTexture(n)}else a?this.blurYFilter.apply(t,e,i,r):this.blurXFilter.apply(t,e,i,r)},e.prototype.updatePadding=function(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))},Object.defineProperty(e.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this.blurXFilter.quality},set:function(t){this.blurXFilter.quality=this.blurYFilter.quality=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(t){this.blurYFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.blurYFilter.blendMode},set:function(t){this.blurYFilter.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"repeatEdgePixels",{get:function(){return this._repeatEdgePixels},set:function(t){this._repeatEdgePixels=t,this.updatePadding()},enumerable:!1,configurable:!0}),e}(Ji),kn=function(t,e){return kn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},kn(t,e)};var Cn=function(t){function e(){var e=this,i={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};return(e=t.call(this,wr,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",i)||this).alpha=1,e}return function(t,e){function i(){this.constructor=t}kn(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),e.prototype._loadMatrix=function(t,e){void 0===e&&(e=!1);var i=t;e&&(this._multiply(i,this.uniforms.m,t),i=this._colorMatrix(i)),this.uniforms.m=i},e.prototype._multiply=function(t,e,i){return t[0]=e[0]*i[0]+e[1]*i[5]+e[2]*i[10]+e[3]*i[15],t[1]=e[0]*i[1]+e[1]*i[6]+e[2]*i[11]+e[3]*i[16],t[2]=e[0]*i[2]+e[1]*i[7]+e[2]*i[12]+e[3]*i[17],t[3]=e[0]*i[3]+e[1]*i[8]+e[2]*i[13]+e[3]*i[18],t[4]=e[0]*i[4]+e[1]*i[9]+e[2]*i[14]+e[3]*i[19]+e[4],t[5]=e[5]*i[0]+e[6]*i[5]+e[7]*i[10]+e[8]*i[15],t[6]=e[5]*i[1]+e[6]*i[6]+e[7]*i[11]+e[8]*i[16],t[7]=e[5]*i[2]+e[6]*i[7]+e[7]*i[12]+e[8]*i[17],t[8]=e[5]*i[3]+e[6]*i[8]+e[7]*i[13]+e[8]*i[18],t[9]=e[5]*i[4]+e[6]*i[9]+e[7]*i[14]+e[8]*i[19]+e[9],t[10]=e[10]*i[0]+e[11]*i[5]+e[12]*i[10]+e[13]*i[15],t[11]=e[10]*i[1]+e[11]*i[6]+e[12]*i[11]+e[13]*i[16],t[12]=e[10]*i[2]+e[11]*i[7]+e[12]*i[12]+e[13]*i[17],t[13]=e[10]*i[3]+e[11]*i[8]+e[12]*i[13]+e[13]*i[18],t[14]=e[10]*i[4]+e[11]*i[9]+e[12]*i[14]+e[13]*i[19]+e[14],t[15]=e[15]*i[0]+e[16]*i[5]+e[17]*i[10]+e[18]*i[15],t[16]=e[15]*i[1]+e[16]*i[6]+e[17]*i[11]+e[18]*i[16],t[17]=e[15]*i[2]+e[16]*i[7]+e[17]*i[12]+e[18]*i[17],t[18]=e[15]*i[3]+e[16]*i[8]+e[17]*i[13]+e[18]*i[18],t[19]=e[15]*i[4]+e[16]*i[9]+e[17]*i[14]+e[18]*i[19]+e[19],t},e.prototype._colorMatrix=function(t){var e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e},e.prototype.brightness=function(t,e){var i=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)},e.prototype.greyscale=function(t,e){var i=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)},e.prototype.blackAndWhite=function(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)},e.prototype.hue=function(t,e){t=(t||0)/180*Math.PI;var i=Math.cos(t),r=Math.sin(t),s=1/3,a=(0,Math.sqrt)(s),n=[i+(1-i)*s,s*(1-i)-a*r,s*(1-i)+a*r,0,0,s*(1-i)+a*r,i+s*(1-i),s*(1-i)-a*r,0,0,s*(1-i)-a*r,s*(1-i)+a*r,i+s*(1-i),0,0,0,0,0,1,0];this._loadMatrix(n,e)},e.prototype.contrast=function(t,e){var i=(t||0)+1,r=-.5*(i-1),s=[i,0,0,0,r,0,i,0,0,r,0,0,i,0,r,0,0,0,1,0];this._loadMatrix(s,e)},e.prototype.saturate=function(t,e){void 0===t&&(t=0);var i=2*t/3+1,r=-.5*(i-1),s=[i,r,r,0,0,r,i,r,0,0,r,r,i,0,0,0,0,0,1,0];this._loadMatrix(s,e)},e.prototype.desaturate=function(){this.saturate(-1)},e.prototype.negative=function(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)},e.prototype.sepia=function(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)},e.prototype.technicolor=function(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)},e.prototype.polaroid=function(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)},e.prototype.toBGR=function(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)},e.prototype.kodachrome=function(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)},e.prototype.browni=function(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)},e.prototype.vintage=function(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)},e.prototype.colorTone=function(t,e,i,r,s){var a=((i=i||16770432)>>16&255)/255,n=(i>>8&255)/255,o=(255&i)/255,c=((r=r||3375104)>>16&255)/255,l=(r>>8&255)/255,h=(255&r)/255,u=[.3,.59,.11,0,0,a,n,o,t=t||.2,0,c,l,h,e=e||.15,0,a-c,n-l,o-h,0,0];this._loadMatrix(u,s)},e.prototype.night=function(t,e){var i=[-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(i,e)},e.prototype.predator=function(t,e){var i=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(i,e)},e.prototype.lsd=function(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)},e.prototype.reset=function(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)},Object.defineProperty(e.prototype,"matrix",{get:function(){return this.uniforms.m},set:function(t){this.uniforms.m=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t},enumerable:!1,configurable:!0}),e}(Ji);Cn.prototype.grayscale=Cn.prototype.greyscale;var Ln=function(t,e){return Ln=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},Ln(t,e)};var Bn=function(t){function e(e,i){var r=this,s=new Kt;return e.renderable=!1,(r=t.call(this,"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:e._texture,filterMatrix:s,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])})||this).maskSprite=e,r.maskMatrix=s,null==i&&(i=20),r.scale=new Xt(i,i),r}return function(t,e){function i(){this.constructor=t}Ln(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),e.prototype.apply=function(t,e,i,r){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;var s=this.maskSprite.worldTransform,a=Math.sqrt(s.a*s.a+s.b*s.b),n=Math.sqrt(s.c*s.c+s.d*s.d);0!==a&&0!==n&&(this.uniforms.rotation[0]=s.a/a,this.uniforms.rotation[1]=s.b/a,this.uniforms.rotation[2]=s.c/n,this.uniforms.rotation[3]=s.d/n),t.applyFilter(this,e,i,r)},Object.defineProperty(e.prototype,"map",{get:function(){return this.uniforms.mapSampler},set:function(t){this.uniforms.mapSampler=t},enumerable:!1,configurable:!0}),e}(Ji),Fn=function(t,e){return Fn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},Fn(t,e)};var On=function(t){function e(){return t.call(this,"\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputPixel;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputPixel.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputPixel;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputPixel.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')||this}return function(t,e){function i(){this.constructor=t}Fn(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),e}(Ji),Nn=function(t,e){return Nn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},Nn(t,e)};var jn=function(t){function e(e,i){void 0===e&&(e=.5),void 0===i&&(i=Math.random());var r=t.call(this,wr,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0})||this;return r.noise=e,r.seed=i,r}return function(t,e){function i(){this.constructor=t}Nn(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),Object.defineProperty(e.prototype,"noise",{get:function(){return this.uniforms.uNoise},set:function(t){this.uniforms.uNoise=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"seed",{get:function(){return this.uniforms.uSeed},set:function(t){this.uniforms.uSeed=t},enumerable:!1,configurable:!0}),e}(Ji),Un=new Kt;ce.prototype._cacheAsBitmap=!1,ce.prototype._cacheData=null;var Vn=function(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null};Object.defineProperties(ce.prototype,{cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){var e;this._cacheAsBitmap!==t&&(this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new Vn),(e=this._cacheData).originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):((e=this._cacheData).sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea))}}}),ce.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},ce.prototype._initCachedDisplayObject=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.alpha;this.alpha=1,t.batch.flush();var i=this.getLocalBounds(null,!0).clone();if(this.filters){var r=this.filters[0].padding;i.pad(r)}i.ceil(D.RESOLUTION);var s=t.renderTexture.current,a=t.renderTexture.sourceFrame.clone(),n=t.renderTexture.destinationFrame.clone(),o=t.projection.transform,c=Je.create({width:i.width,height:i.height}),l="cacheAsBitmap_"+bt();this._cacheData.textureCacheId=l,Le.addToCache(c.baseTexture,l),Qe.addToCache(c,l);var h=this.transform.localTransform.copyTo(Un).invert().translate(-i.x,-i.y);this.render=this._cacheData.originalRender,t.render(this,c,!0,h,!1),t.projection.transform=o,t.renderTexture.bind(s,a,n),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null;var u=new ia(c);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-i.x/i.width,u.anchor.y=-i.y/i.height,u.alpha=e,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=u.containsPoint.bind(u)}},ce.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},ce.prototype._initCachedDisplayObjectCanvas=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.getLocalBounds(null,!0),i=this.alpha;this.alpha=1;var r=t.context,s=t._projTransform;e.ceil(D.RESOLUTION);var a=Je.create({width:e.width,height:e.height}),n="cacheAsBitmap_"+bt();this._cacheData.textureCacheId=n,Le.addToCache(a.baseTexture,n),Qe.addToCache(a,n);var o=Un;this.transform.localTransform.copyTo(o),o.invert(),o.tx-=e.x,o.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,a,!0,o,!1),t.context=r,t._projTransform=s,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null;var c=new ia(a);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-e.x/e.width,c.anchor.y=-e.y/e.height,c.alpha=i,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=c.containsPoint.bind(c)}},ce.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},ce.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},ce.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,Le.removeFromCache(this._cacheData.textureCacheId),Qe.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},ce.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},ce.prototype.name=null,ue.prototype.getChildByName=function(t,e){for(var i=0,r=this.children.length;i<r;i++)if(this.children[i].name===t)return this.children[i];if(e)for(i=0,r=this.children.length;i<r;i++){if(this.children[i].getChildByName){var s=this.children[i].getChildByName(t,!0);if(s)return s}}return null},ce.prototype.getGlobalPosition=function(t,e){return void 0===t&&(t=new Xt),void 0===e&&(e=!1),this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};var Hn=function(t,e){return Hn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},Hn(t,e)};function Wn(t,e){function i(){this.constructor=t}Hn(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var qn=function(t){function e(e,i,r,s){void 0===e&&(e=100),void 0===i&&(i=100),void 0===r&&(r=10),void 0===s&&(s=10);var a=t.call(this)||this;return a.segWidth=r,a.segHeight=s,a.width=e,a.height=i,a.build(),a}return Wn(e,t),e.prototype.build=function(){for(var t=this.segWidth*this.segHeight,e=[],i=[],r=[],s=this.segWidth-1,a=this.segHeight-1,n=this.width/s,o=this.height/a,c=0;c<t;c++){var l=c%this.segWidth,h=c/this.segWidth|0;e.push(l*n,h*o),i.push(l/s,h/a)}var u=s*a;for(c=0;c<u;c++){var d=c%s,p=c/s|0,f=p*this.segWidth+d,m=p*this.segWidth+d+1,y=(p+1)*this.segWidth+d,_=(p+1)*this.segWidth+d+1;r.push(f,m,y,m,_,y)}this.buffers[0].data=new Float32Array(e),this.buffers[1].data=new Float32Array(i),this.indexBuffer.data=new Uint16Array(r),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()},e}(Ga),Gn=function(t){function e(e,i,r){void 0===e&&(e=200),void 0===r&&(r=0);var s=t.call(this,new Float32Array(4*i.length),new Float32Array(4*i.length),new Uint16Array(6*(i.length-1)))||this;return s.points=i,s._width=e,s.textureScale=r,s.build(),s}return Wn(e,t),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),e.prototype.build=function(){var t=this.points;if(t){var e=this.getBuffer("aVertexPosition"),i=this.getBuffer("aTextureCoord"),r=this.getIndex();if(!(t.length<1)){e.data.length/4!==t.length&&(e.data=new Float32Array(4*t.length),i.data=new Float32Array(4*t.length),r.data=new Uint16Array(6*(t.length-1)));var s=i.data,a=r.data;s[0]=0,s[1]=0,s[2]=0,s[3]=1;for(var n=0,o=t[0],c=this._width*this.textureScale,l=t.length,h=0;h<l;h++){var u=4*h;if(this.textureScale>0){var d=o.x-t[h].x,p=o.y-t[h].y,f=Math.sqrt(d*d+p*p);o=t[h],n+=f/c}else n=h/(l-1);s[u]=n,s[u+1]=0,s[u+2]=n,s[u+3]=1}var m=0;for(h=0;h<l-1;h++){u=2*h;a[m++]=u,a[m++]=u+1,a[m++]=u+2,a[m++]=u+2,a[m++]=u+1,a[m++]=u+3}i.update(),r.update(),this.updateVertices()}}},e.prototype.updateVertices=function(){var t=this.points;if(!(t.length<1)){for(var e,i=t[0],r=0,s=0,a=this.buffers[0].data,n=t.length,o=0;o<n;o++){var c=t[o],l=4*o;s=-((e=o<t.length-1?t[o+1]:c).x-i.x),r=e.y-i.y;var h=Math.sqrt(r*r+s*s),u=this.textureScale>0?this.textureScale*this._width/2:this._width/2;r/=h,s/=h,r*=u,s*=u,a[l]=c.x+r,a[l+1]=c.y+s,a[l+2]=c.x-r,a[l+3]=c.y-s,i=c}this.buffers[0].update()}},e.prototype.update=function(){this.textureScale>0?this.build():this.updateVertices()},e}(Ga),zn=function(t){function e(e,i,r){void 0===r&&(r=0);var s=this,a=new Gn(e.height,i,r),n=new qa(e);return r>0&&(e.baseTexture.wrapMode=q.REPEAT),(s=t.call(this,a,n)||this).autoUpdate=!0,s}return Wn(e,t),e.prototype._render=function(e){var i=this.geometry;(this.autoUpdate||i._width!==this.shader.texture.height)&&(i._width=this.shader.texture.height,i.update()),t.prototype._render.call(this,e)},e}(Wa),Xn=function(t){function e(e,i,r){var s=this,a=new qn(e.width,e.height,i,r),n=new qa(Qe.WHITE);return(s=t.call(this,a,n)||this).texture=e,s}return Wn(e,t),e.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID;var t=this.geometry;t.width=this.shader.texture.width,t.height=this.shader.texture.height,t.build()},Object.defineProperty(e.prototype,"texture",{get:function(){return this.shader.texture},set:function(t){this.shader.texture!==t&&(this.shader.texture=t,this._textureID=-1,t.baseTexture.valid?this.textureUpdated():t.once("update",this.textureUpdated,this))},enumerable:!1,configurable:!0}),e.prototype._render=function(e){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),t.prototype._render.call(this,e)},e.prototype.destroy=function(e){this.shader.texture.off("update",this.textureUpdated,this),t.prototype.destroy.call(this,e)},e}(Wa),Yn=function(t){function e(e,i,r,s,a){void 0===e&&(e=Qe.EMPTY);var n=this,o=new Ga(i,r,s);o.getBuffer("aVertexPosition").static=!1;var c=new qa(e);return(n=t.call(this,o,c,null,a)||this).autoUpdate=!0,n}return Wn(e,t),Object.defineProperty(e.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(t){this.geometry.getBuffer("aVertexPosition").data=t},enumerable:!1,configurable:!0}),e.prototype._render=function(e){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),t.prototype._render.call(this,e)},e}(Wa),Kn=function(t){function e(e,i,r,s,a){void 0===i&&(i=10),void 0===r&&(r=10),void 0===s&&(s=10),void 0===a&&(a=10);var n=t.call(this,Qe.WHITE,4,4)||this;return n._origWidth=e.orig.width,n._origHeight=e.orig.height,n._width=n._origWidth,n._height=n._origHeight,n._leftWidth=i,n._rightWidth=s,n._topHeight=r,n._bottomHeight=a,n.texture=e,n}return Wn(e,t),e.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID,this._refresh()},Object.defineProperty(e.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(t){this.geometry.getBuffer("aVertexPosition").data=t},enumerable:!1,configurable:!0}),e.prototype.updateHorizontalVertices=function(){var t=this.vertices,e=this._getMinScale();t[9]=t[11]=t[13]=t[15]=this._topHeight*e,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight*e,t[25]=t[27]=t[29]=t[31]=this._height},e.prototype.updateVerticalVertices=function(){var t=this.vertices,e=this._getMinScale();t[2]=t[10]=t[18]=t[26]=this._leftWidth*e,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth*e,t[6]=t[14]=t[22]=t[30]=this._width},e.prototype._getMinScale=function(){var t=this._leftWidth+this._rightWidth,e=this._width>t?1:this._width/t,i=this._topHeight+this._bottomHeight,r=this._height>i?1:this._height/i;return Math.min(e,r)},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftWidth",{get:function(){return this._leftWidth},set:function(t){this._leftWidth=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightWidth",{get:function(){return this._rightWidth},set:function(t){this._rightWidth=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"topHeight",{get:function(){return this._topHeight},set:function(t){this._topHeight=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bottomHeight",{get:function(){return this._bottomHeight},set:function(t){this._bottomHeight=t,this._refresh()},enumerable:!1,configurable:!0}),e.prototype._refresh=function(){var t=this.texture,e=this.geometry.buffers[1].data;this._origWidth=t.orig.width,this._origHeight=t.orig.height;var i=1/this._origWidth,r=1/this._origHeight;e[0]=e[8]=e[16]=e[24]=0,e[1]=e[3]=e[5]=e[7]=0,e[6]=e[14]=e[22]=e[30]=1,e[25]=e[27]=e[29]=e[31]=1,e[2]=e[10]=e[18]=e[26]=i*this._leftWidth,e[4]=e[12]=e[20]=e[28]=1-i*this._rightWidth,e[9]=e[11]=e[13]=e[15]=r*this._topHeight,e[17]=e[19]=e[21]=e[23]=1-r*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()},e}(Xn),$n=function(t,e){return $n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},$n(t,e)};var Qn=function(t){function e(e,i){void 0===i&&(i=!0);var r=t.call(this,e[0]instanceof Qe?e[0]:e[0].texture)||this;return r._textures=null,r._durations=null,r._autoUpdate=i,r._isConnectedToTicker=!1,r.animationSpeed=1,r.loop=!0,r.updateAnchor=!1,r.onComplete=null,r.onFrameChange=null,r.onLoop=null,r._currentTime=0,r._playing=!1,r._previousFrame=null,r.textures=e,r}return function(t,e){function i(){this.constructor=t}$n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),e.prototype.stop=function(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(ye.shared.remove(this.update,this),this._isConnectedToTicker=!1))},e.prototype.play=function(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(ye.shared.add(this.update,this,pe.HIGH),this._isConnectedToTicker=!0))},e.prototype.gotoAndStop=function(t){this.stop();var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()},e.prototype.gotoAndPlay=function(t){var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture(),this.play()},e.prototype.update=function(t){if(this._playing){var e=this.animationSpeed*t,i=this.currentFrame;if(null!==this._durations){var r=this._currentTime%1*this._durations[this.currentFrame];for(r+=e/60*1e3;r<0;)this._currentTime--,r+=this._durations[this.currentFrame];var s=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);r>=this._durations[this.currentFrame];)r-=this._durations[this.currentFrame]*s,this._currentTime+=s;this._currentTime+=r/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):i!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<i||this.animationSpeed<0&&this.currentFrame>i)&&this.onLoop(),this.updateTexture())}},e.prototype.updateTexture=function(){var t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))},e.prototype.destroy=function(e){this.stop(),t.prototype.destroy.call(this,e),this.onComplete=null,this.onFrameChange=null,this.onLoop=null},e.fromFrames=function(t){for(var i=[],r=0;r<t.length;++r)i.push(Qe.from(t[r]));return new e(i)},e.fromImages=function(t){for(var i=[],r=0;r<t.length;++r)i.push(Qe.from(t[r]));return new e(i)},Object.defineProperty(e.prototype,"totalFrames",{get:function(){return this._textures.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textures",{get:function(){return this._textures},set:function(t){if(t[0]instanceof Qe)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(var e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentFrame",{get:function(){var t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playing",{get:function(){return this._playing},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(ye.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(ye.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),e}(ia),Zn=function(t,e){return Zn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},Zn(t,e)};function Jn(t,e){function i(){this.constructor=t}Zn(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var to="5.0.0";function eo(){var t=this;Object.defineProperties(t,{SVG_SIZE:{get:function(){return It(to,"PIXI.utils.SVG_SIZE property has moved to PIXI.resources.SVGResource.SVG_SIZE"),t.SVGResource.SVG_SIZE}},TransformStatic:{get:function(){return It(to,"PIXI.TransformStatic class has been removed, use PIXI.Transform"),t.Transform}},TransformBase:{get:function(){return It(to,"PIXI.TransformBase class has been removed, use PIXI.Transform"),t.Transform}},TRANSFORM_MODE:{get:function(){return It(to,"PIXI.TRANSFORM_MODE property has been removed"),{STATIC:0,DYNAMIC:1}}},WebGLRenderer:{get:function(){return It(to,"PIXI.WebGLRenderer class has moved to PIXI.Renderer"),t.Renderer}},CanvasRenderTarget:{get:function(){return It(to,"PIXI.CanvasRenderTarget class has moved to PIXI.utils.CanvasRenderTarget"),t.utils.CanvasRenderTarget}},loader:{get:function(){return It(to,"PIXI.loader instance has moved to PIXI.Loader.shared"),t.Loader.shared}},FilterManager:{get:function(){return It(to,"PIXI.FilterManager class has moved to PIXI.systems.FilterSystem"),t.systems.FilterSystem}},CanvasTinter:{get:function(){return It("5.2.0","PIXI.CanvasTinter namespace has moved to PIXI.canvasUtils"),t.canvasUtils}},GroupD8:{get:function(){return It("5.2.0","PIXI.GroupD8 namespace has moved to PIXI.groupD8"),t.groupD8}}}),t.accessibility={},Object.defineProperties(t.accessibility,{AccessibilityManager:{get:function(){return It("5.3.0","PIXI.accessibility.AccessibilityManager moved to PIXI.AccessibilityManager"),t.AccessibilityManager}}}),t.interaction={},Object.defineProperties(t.interaction,{InteractionManager:{get:function(){return It("5.3.0","PIXI.interaction.InteractionManager moved to PIXI.InteractionManager"),t.InteractionManager}},InteractionData:{get:function(){return It("5.3.0","PIXI.interaction.InteractionData moved to PIXI.InteractionData"),t.InteractionData}},InteractionEvent:{get:function(){return It("5.3.0","PIXI.interaction.InteractionEvent moved to PIXI.InteractionEvent"),t.InteractionEvent}}}),t.prepare={},Object.defineProperties(t.prepare,{BasePrepare:{get:function(){return It("5.2.1","PIXI.prepare.BasePrepare moved to PIXI.BasePrepare"),t.BasePrepare}},Prepare:{get:function(){return It("5.2.1","PIXI.prepare.Prepare moved to PIXI.Prepare"),t.Prepare}},CanvasPrepare:{get:function(){return It("5.2.1","PIXI.prepare.CanvasPrepare moved to PIXI.CanvasPrepare"),t.CanvasPrepare}}}),t.extract={},Object.defineProperties(t.extract,{Extract:{get:function(){return It("5.2.1","PIXI.extract.Extract moved to PIXI.Extract"),t.Extract}},CanvasExtract:{get:function(){return It("5.2.1","PIXI.extract.CanvasExtract moved to PIXI.CanvasExtract"),t.CanvasExtract}}}),t.extras={},Object.defineProperties(t.extras,{TilingSprite:{get:function(){return It(to,"PIXI.extras.TilingSprite class has moved to PIXI.TilingSprite"),t.TilingSprite}},TilingSpriteRenderer:{get:function(){return It(to,"PIXI.extras.TilingSpriteRenderer class has moved to PIXI.TilingSpriteRenderer"),t.TilingSpriteRenderer}},AnimatedSprite:{get:function(){return It(to,"PIXI.extras.AnimatedSprite class has moved to PIXI.AnimatedSprite"),t.AnimatedSprite}},BitmapText:{get:function(){return It(to,"PIXI.extras.BitmapText class has moved to PIXI.BitmapText"),t.BitmapText}}}),t.TilingSprite.fromFrame=function(e,i,r){return It("5.3.0","TilingSprite.fromFrame is deprecated, use TilingSprite.from"),t.TilingSprite.from(e,{width:i,height:r})},t.TilingSprite.fromImage=function(e,i,r,s){return void 0===s&&(s={}),It("5.3.0","TilingSprite.fromImage is deprecated, use TilingSprite.from"),s&&"object"!=typeof s&&(s={scaleMode:arguments[4],resourceOptions:{crossorigin:arguments[3]}}),s.width=i,s.height=r,t.TilingSprite.from(e,s)},Object.defineProperties(t.utils,{getSvgSize:{get:function(){return It(to,"PIXI.utils.getSvgSize function has moved to PIXI.resources.SVGResource.getSize"),t.resources.SVGResource.getSize}}}),t.mesh={},Object.defineProperties(t.mesh,{Mesh:{get:function(){return It(to,"PIXI.mesh.Mesh class has moved to PIXI.SimpleMesh"),t.SimpleMesh}},NineSlicePlane:{get:function(){return It(to,"PIXI.mesh.NineSlicePlane class has moved to PIXI.NineSlicePlane"),t.NineSlicePlane}},Plane:{get:function(){return It(to,"PIXI.mesh.Plane class has moved to PIXI.SimplePlane"),t.SimplePlane}},Rope:{get:function(){return It(to,"PIXI.mesh.Rope class has moved to PIXI.SimpleRope"),t.SimpleRope}},RawMesh:{get:function(){return It(to,"PIXI.mesh.RawMesh class has moved to PIXI.Mesh"),t.Mesh}},CanvasMeshRenderer:{get:function(){return It(to,"PIXI.mesh.CanvasMeshRenderer class has moved to PIXI.CanvasMeshRenderer"),t.CanvasMeshRenderer}},MeshRenderer:{get:function(){return It(to,"PIXI.mesh.MeshRenderer class has moved to PIXI.MeshRenderer"),t.MeshRenderer}}}),t.particles={},Object.defineProperties(t.particles,{ParticleContainer:{get:function(){return It(to,"PIXI.particles.ParticleContainer class has moved to PIXI.ParticleContainer"),t.ParticleContainer}},ParticleRenderer:{get:function(){return It(to,"PIXI.particles.ParticleRenderer class has moved to PIXI.ParticleRenderer"),t.ParticleRenderer}}}),t.ticker={},Object.defineProperties(t.ticker,{Ticker:{get:function(){return It(to,"PIXI.ticker.Ticker class has moved to PIXI.Ticker"),t.Ticker}},shared:{get:function(){return It(to,"PIXI.ticker.shared instance has moved to PIXI.Ticker.shared"),t.Ticker.shared}}}),t.loaders={},Object.defineProperties(t.loaders,{Loader:{get:function(){return It(to,"PIXI.loaders.Loader class has moved to PIXI.Loader"),t.Loader}},Resource:{get:function(){return It(to,"PIXI.loaders.Resource class has moved to PIXI.LoaderResource"),t.LoaderResource}},bitmapFontParser:{get:function(){return It(to,"PIXI.loaders.bitmapFontParser function has moved to PIXI.BitmapFontLoader.use"),t.BitmapFontLoader.use}},parseBitmapFontData:{get:function(){It(to,"PIXI.loaders.parseBitmapFontData function has removed")}},spritesheetParser:{get:function(){return It(to,"PIXI.loaders.spritesheetParser function has moved to PIXI.SpritesheetLoader.use"),t.SpritesheetLoader.use}},getResourcePath:{get:function(){return It(to,"PIXI.loaders.getResourcePath property has moved to PIXI.SpritesheetLoader.getResourcePath"),t.SpritesheetLoader.getResourcePath}}}),t.Loader.addPixiMiddleware=function(e){return It(to,"PIXI.loaders.Loader.addPixiMiddleware function is deprecated, use PIXI.loaders.Loader.registerPlugin"),t.loaders.Loader.registerPlugin({use:e()})};var e=function(t){return"on"+t.charAt(0).toUpperCase()+t.slice(1)};Object.assign(t.Loader.prototype,{on:function(t){var i=e(t);It(to,"PIXI.Loader#on is completely deprecated, use PIXI.Loader#"+i+".add")},once:function(t){var i=e(t);It(to,"PIXI.Loader#once is completely deprecated, use PIXI.Loader#"+i+".once")},off:function(t){var i=e(t);It(to,"PIXI.Loader#off is completely deprecated, use PIXI.Loader#"+i+".detach")}}),Object.defineProperty(t.extract,"WebGLExtract",{get:function(){return It(to,"PIXI.extract.WebGLExtract method has moved to PIXI.Extract"),t.Extract}}),Object.defineProperty(t.prepare,"WebGLPrepare",{get:function(){return It(to,"PIXI.prepare.WebGLPrepare class has moved to PIXI.Prepare"),t.Prepare}}),t.Container.prototype._renderWebGL=function(t){It(to,"PIXI.Container._renderWebGL method has moved to PIXI.Container._render"),this._render(t)},t.Container.prototype.renderWebGL=function(t){It(to,"PIXI.Container.renderWebGL method has moved to PIXI.Container.render"),this.render(t)},t.DisplayObject.prototype.renderWebGL=function(t){It(to,"PIXI.DisplayObject.renderWebGL method has moved to PIXI.DisplayObject.render"),this.render(t)},t.Container.prototype.renderAdvancedWebGL=function(t){It(to,"PIXI.Container.renderAdvancedWebGL method has moved to PIXI.Container.renderAdvanced"),this.renderAdvanced(t)},Object.defineProperties(t.settings,{TRANSFORM_MODE:{get:function(){return It(to,"PIXI.settings.TRANSFORM_MODE property has been removed"),0},set:function(){It(to,"PIXI.settings.TRANSFORM_MODE property has been removed")}}});var i=t.BaseTexture;i.prototype.loadSource=function(e){It(to,"PIXI.BaseTexture.loadSource method has been deprecated");var i=t.resources.autoDetectResource(e);i.internal=!0,this.setResource(i),this.update()};var r=!1;Object.defineProperties(i.prototype,{hasLoaded:{get:function(){return It(to,"PIXI.BaseTexture.hasLoaded property has been removed, use PIXI.BaseTexture.valid"),this.valid}},imageUrl:{get:function(){var t;return It(to,"PIXI.BaseTexture.imageUrl property has been removed, use PIXI.BaseTexture.resource.url"),null===(t=this.resource)||void 0===t?void 0:t.url},set:function(t){It(to,"PIXI.BaseTexture.imageUrl property has been removed, use PIXI.BaseTexture.resource.url"),this.resource&&(this.resource.url=t)}},source:{get:function(){return It(to,"PIXI.BaseTexture.source property has been moved, use `PIXI.BaseTexture.resource.source`"),this.resource.source},set:function(t){It(to,"PIXI.BaseTexture.source property has been moved, use `PIXI.BaseTexture.resource.source` if you want to set HTMLCanvasElement. Otherwise, create new BaseTexture."),this.resource&&(this.resource.source=t)}},premultiplyAlpha:{get:function(){return It("5.2.0","PIXI.BaseTexture.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),0!==this.alphaMode},set:function(t){It("5.2.0","PIXI.BaseTexture.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),this.alphaMode=Number(t)}},_id:{get:function(){return r||(It("5.2.0","PIXI.BaseTexture._id batch local field has been changed to `_batchLocation`"),r=!0),this._batchLocation},set:function(t){this._batchLocation=t}}}),i.fromImage=function(t,e,r,s){It(to,"PIXI.BaseTexture.fromImage method has been replaced with PIXI.BaseTexture.from");var a={scale:s,crossorigin:e};return i.from(t,{scaleMode:r,resourceOptions:a})},i.fromCanvas=function(t,e){return It(to,"PIXI.BaseTexture.fromCanvas method has been replaced with PIXI.BaseTexture.from"),i.from(t,{scaleMode:e})},i.fromSVG=function(t,e,r,s){It(to,"PIXI.BaseTexture.fromSVG method has been replaced with PIXI.BaseTexture.from");var a={scale:s,crossorigin:e};return i.from(t,{scaleMode:r,resourceOptions:a})},Object.defineProperties(t.resources.ImageResource.prototype,{premultiplyAlpha:{get:function(){return It("5.2.0","PIXI.resources.ImageResource.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),0!==this.alphaMode},set:function(t){It("5.2.0","PIXI.resources.ImageResource.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),this.alphaMode=Number(t)}}}),t.Point.prototype.copy=function(t){return It(to,"PIXI.Point.copy method has been replaced with PIXI.Point.copyFrom"),this.copyFrom(t)},t.ObservablePoint.prototype.copy=function(t){return It(to,"PIXI.ObservablePoint.copy method has been replaced with PIXI.ObservablePoint.copyFrom"),this.copyFrom(t)},t.Rectangle.prototype.copy=function(t){return It(to,"PIXI.Rectangle.copy method has been replaced with PIXI.Rectangle.copyFrom"),this.copyFrom(t)},t.Matrix.prototype.copy=function(t){return It(to,"PIXI.Matrix.copy method has been replaced with PIXI.Matrix.copyTo"),this.copyTo(t)},t.systems.StateSystem.prototype.setState=function(t){return It("v5.1.0","StateSystem.setState has been renamed to StateSystem.set"),this.set(t)},Object.assign(t.systems.FilterSystem.prototype,{getRenderTarget:function(t,e){return It(to,"PIXI.FilterManager.getRenderTarget method has been replaced with PIXI.systems.FilterSystem#getFilterTexture"),this.getFilterTexture(null,e)},returnRenderTarget:function(t){It(to,"PIXI.FilterManager.returnRenderTarget method has been replaced with PIXI.systems.FilterSystem.returnFilterTexture"),this.returnFilterTexture(t)},calculateScreenSpaceMatrix:function(t){It(to,"PIXI.systems.FilterSystem.calculateScreenSpaceMatrix method is removed, use `(vTextureCoord * inputSize.xy) + outputFrame.xy` instead");var e=t.identity(),i=this.activeState,r=i.sourceFrame,s=i.destinationFrame;return e.translate(r.x/s.width,r.y/s.height),e.scale(s.width,s.height),e},calculateNormalizedScreenSpaceMatrix:function(t){It(to,"PIXI.systems.FilterManager.calculateNormalizedScreenSpaceMatrix method is removed, use `((vTextureCoord * inputSize.xy) + outputFrame.xy) / outputFrame.zw` instead.");var e=this.activeState,i=e.sourceFrame,r=e.destinationFrame,s=t.identity();s.translate(i.x/r.width,i.y/r.height);var a=r.width/i.width,n=r.height/i.height;return s.scale(a,n),s}}),Object.defineProperties(t.RenderTexture.prototype,{sourceFrame:{get:function(){return It(to,"PIXI.RenderTexture.sourceFrame property has been removed"),this.filterFrame}},size:{get:function(){return It(to,"PIXI.RenderTexture.size property has been removed"),this._frame}}});var s=function(t){function e(e,i,r,s){return It(to,"PIXI.filters.BlurXFilter class is deprecated, use PIXI.filters.BlurFilterPass"),t.call(this,!0,e,i,r,s)||this}return Jn(e,t),e}(t.filters.BlurFilterPass),a=function(t){function e(e,i,r,s){return It(to,"PIXI.filters.BlurYFilter class is deprecated, use PIXI.filters.BlurFilterPass"),t.call(this,!1,e,i,r,s)||this}return Jn(e,t),e}(t.filters.BlurFilterPass);Object.assign(t.filters,{BlurXFilter:s,BlurYFilter:a});var n=t.Sprite,o=t.Texture,c=t.Graphics;function l(t,e,i,r){return It(to,"PIXI.Sprite."+t+" method is deprecated, use PIXI.Sprite.from"),n.from(e,{resourceOptions:{scale:r,crossorigin:i}})}function h(t,e,i,r){return It(to,"PIXI.Texture."+t+" method is deprecated, use PIXI.Texture.from"),o.from(e,{resourceOptions:{scale:r,crossorigin:i}})}c.prototype.generateCanvasTexture||(c.prototype.generateCanvasTexture=function(){It(to,'PIXI.Graphics.generateCanvasTexture method is only available in "pixi.js-legacy"')}),Object.defineProperty(c.prototype,"graphicsData",{get:function(){return It(to,"PIXI.Graphics.graphicsData property is deprecated, use PIXI.Graphics.geometry.graphicsData"),this.geometry.graphicsData}}),n.fromImage=l.bind(null,"fromImage"),n.fromSVG=l.bind(null,"fromSVG"),n.fromCanvas=l.bind(null,"fromCanvas"),n.fromVideo=l.bind(null,"fromVideo"),n.fromFrame=l.bind(null,"fromFrame"),o.fromImage=h.bind(null,"fromImage"),o.fromSVG=h.bind(null,"fromSVG"),o.fromCanvas=h.bind(null,"fromCanvas"),o.fromVideo=h.bind(null,"fromVideo"),o.fromFrame=h.bind(null,"fromFrame"),Object.defineProperty(t.AbstractRenderer.prototype,"autoResize",{get:function(){return It(to,"PIXI.AbstractRenderer.autoResize property is deprecated, use PIXI.AbstractRenderer.autoDensity"),this.autoDensity},set:function(t){It(to,"PIXI.AbstractRenderer.autoResize property is deprecated, use PIXI.AbstractRenderer.autoDensity"),this.autoDensity=t}}),Object.defineProperty(t.Renderer.prototype,"textureManager",{get:function(){return It(to,"PIXI.Renderer.textureManager property is deprecated, use PIXI.Renderer.texture"),this.texture}}),t.utils.mixins={mixin:function(){It(to,"PIXI.utils.mixins.mixin function is no longer available")},delayMixin:function(){It(to,"PIXI.utils.mixins.delayMixin function is no longer available")},performMixins:function(){It(to,"PIXI.utils.mixins.performMixins function is no longer available")}},Object.defineProperty(t.BitmapText.prototype,"font",{get:function(){return It("5.3.0","PIXI.BitmapText.font property is deprecated, use fontName, fontSize, tint or align properties"),{name:this._fontName,size:this._fontSize,tint:this._tint,align:this._align}},set:function(e){if(It("5.3.0","PIXI.BitmapText.font property is deprecated, use fontName, fontSize, tint or align properties"),e){var i={font:e};this._upgradeStyle(i),i.fontSize=i.fontSize||t.BitmapFont.available[i.fontName].size,this._fontName=i.fontName,this._fontSize=i.fontSize,this.dirty=!0}}})}Er.registerPlugin("accessibility",fe),Er.registerPlugin("extract",Vr),Er.registerPlugin("interaction",Ie),Er.registerPlugin("particle",Ss),Er.registerPlugin("prepare",wa),Er.registerPlugin("batch",Or),Er.registerPlugin("tilingSprite",Oa),ds.registerPlugin(nn),ds.registerPlugin(Pa),Nr.registerPlugin(_e),Nr.registerPlugin(ps);var io="5.3.11",ro={AlphaFilter:cn,BlurFilter:An,BlurFilterPass:Pn,ColorMatrixFilter:Cn,DisplacementFilter:Bn,FXAAFilter:On,NoiseFilter:jn}},2144:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.THVisualExtension=e.THSystemExtension=e.THGameExtension=e.THDataExtension=void 0;const r=i(4127),s=i(4893),a=i(1163),n=i(9018);class o extends r.MRDataExtension{}e.THDataExtension=o;class c extends s.MRGameExtension{}e.THGameExtension=c;class l extends a.MRSystemExtension{}e.THSystemExtension=l;class h extends n.MRVisualExtension{}e.THVisualExtension=h},215:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.registerExtensions=void 0;const r=i(9185),s=i(7352),a=i(9115),n=i(8855),o=i(2144);e.registerExtensions=function(){r.MRData.ext=new o.THDataExtension,a.MRSystem.ext=new o.THSystemExtension,s.MRLively.ext=new o.THGameExtension,n.MRView.ext=new o.THVisualExtension}},4180:function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),s=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),i(3983),i(1639),i(7515),i(9124),i(3395),i(4246),i(6996),i(6753),i(3243),i(9590),i(9185),i(3758),i(3654),i(8665),i(4685),i(6229),i(4168),i(9154),i(5150),i(6847),i(9955),i(2508),i(9769),i(9613),i(3477),i(9320),i(5136),i(8543),i(3013),i(664),i(169),i(9139),i(215),s(i(2163),e)},1298:(t,e,i)=>{"use strict";function r(t){return t}Object.defineProperty(e,"__esModule",{value:!0}),e.MRSerializable=e.TypeStore=e.Log=e.tr2=e.tr=e.assert=void 0,i(3983),e.assert=function(t,e){if(!t)throw console.error("assert: "+e),new Error(e)},e.tr=function(t,...e){for(var i=t,r=0;r<e.length;r++){var s=new RegExp("\\{"+r+"\\}","g");i=i.replace(s,e[r])}return i},e.tr2=r;class s{static d(t){this._enabled&&console.log("%c"+t,"color: blue; font-weight: bold")}static postCommand(t){this._enabled&&console.log(`%c[Post: ${t}]`,"color: maroon")}static doCommand(t){this._enabled&&console.log(`%c[Do: ${t}]`,"color: fuchsia")}}e.Log=s,s._enabled=!1;class a{static register(t){let e=t.name;this.typeInfos.push({fullName:t.name,friendlyName:e,function:t})}static createInstance(t){const e=this.typeInfos.find((e=>e.fullName==t||e.friendlyName==t));if(!e){const e="%1が登録されていません。@MRSerializable でクラスを装飾してください。".format(t);throw console.error(e),new Error(e)}return Object.create(e.function.prototype)}}e.TypeStore=a,a.typeInfos=[],e.MRSerializable=function(t){a.register(t)}},9139:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(1298),s=i(6291),a=i(4836),n=i(9185),o=i(9248),c=i(7352),l=i(9154),h=i(9115),u=i(2217);window.MR={entities:function(t){if("world"==t)throw new Error("Not implemented.");return c.MRLively.map.entities()},mapInfo:function(){return c.MRLively.map},setHP:function(t,e){const i=c.MRLively.world.entityByIndex(t);u.SDebugHelpers.setHP(i,e)},setFP:function(t,e){const i=c.MRLively.world.entityByIndex(t);u.SDebugHelpers.setFP(i,e)},setPlayerParameter:function(t,e){const i=c.MRLively.camera.focusedEntity();i&&i.setParamCurrentValue(n.MRData.getParameter(t).id,e)},addState:function(t,e){c.MRLively.world.getFirstEntityByKey(t).addState(n.MRData.getState(e).id)},visitAll:function(){const t=c.MRLively.world.entity(c.MRLively.system.mainPlayerEntityId);t.addState(n.MRData.getState("UT気配察知").id),t.addState(n.MRData.getState("UT道具感知").id),c.MRLively.map.unitClarity=!0,c.MRLively.map.blocks().forEach((t=>t._passed=!0)),h.MRSystem.minimapData.setRefreshNeeded()},setVariable:function(t,e){$gameVariables.setValue(t,e)},levelMax:function(){const t=c.MRLively.camera.focusedEntity();t&&t.setParamCurrentValue(a.MRBasics.params.level,99)},moveToExit:function(){const t=c.MRLively.map.entities().find((t=>t.kindDataId()==a.MRBasics.entityCategories.exitPoint));if(!t)return;const e=c.MRLively.camera.focusedEntity();e&&c.MRLively.world.transferEntity(e,e.floorId,t.mx,t.my)},addItem:function(t){const e=l.SEntityFactory.newEntity(s.DEntityCreateInfo.makeSingle(n.MRData.getEntity(t).id)),i=c.MRLively.camera.focusedEntity();i&&i.getEntityBehavior(o.LInventoryBehavior).addEntity(e)}},Object.defineProperty(window.MR,"player",{get:function(){const t=c.MRLively.camera.focusedEntity();return(0,r.assert)(t),t}})},7048:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Diag=void 0;e.Diag=class{static error(t){throw new Error(t)}}},3609:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.paramInventoryItemsPerPage=e.paramInventoryCapacity=e.paramSuspendMenuEnabled=e.paramThrowingDistance=e.paramRandomMapPaddingY=e.paramRandomMapPaddingX=e.paramDefaultVisibiltyLength=e.paramMonsterHouseItemsMin=e.paramMonsterHouseItemsMax=e.paramMonsterHouseEnemiesMin=e.paramMonsterHouseEnemiesMax=e.paramMaxTrapsInMap=e.paramMaxItemsInMap=e.paramMaxUnitsInMap=e.paramFPLoss=e.paramMaxEntityStackCount=e.paraIndirectPhysicalHitRate=e.paramExposedTrapTriggerRate=e.paramHiddenTrapTriggerRate=e.paramPowerToAtk=e.paramEnemySpawnInvalidArea=e.paramRandomMapDefaultHeight=e.paramRandomMapDefaultWidth=e.paramFixedMapPassagewayRegionId=e.paramFixedMapItemShopRoomRegionId=e.paramFixedMapMonsterHouseRoomRegionId=e.paramFixedMapRoomRegionId=void 0;var i="LN_MysteryRogueSystem";function r(t,e){if("undefined"==typeof PluginManager)return e;const r=PluginManager.parameters(i)[t];return void 0===r?e:Number(r)}e.paramFixedMapRoomRegionId=1,e.paramFixedMapMonsterHouseRoomRegionId=2,e.paramFixedMapItemShopRoomRegionId=3,e.paramFixedMapPassagewayRegionId=8,e.paramRandomMapDefaultWidth=60,e.paramRandomMapDefaultHeight=48,e.paramEnemySpawnInvalidArea=12,e.paramPowerToAtk=!0,e.paramHiddenTrapTriggerRate=80,e.paramExposedTrapTriggerRate=50,e.paraIndirectPhysicalHitRate=85,e.paramMaxEntityStackCount=99,e.paramFPLoss=r("BasicFPLoss",10),e.paramMaxUnitsInMap=50,e.paramMaxItemsInMap=100,e.paramMaxTrapsInMap=100,e.paramMonsterHouseEnemiesMax=20,e.paramMonsterHouseEnemiesMin=5,e.paramMonsterHouseItemsMax=20,e.paramMonsterHouseItemsMin=5,e.paramDefaultVisibiltyLength=6,e.paramRandomMapPaddingX=r("RandomMapPaddingX",8),e.paramRandomMapPaddingY=r("RandomMapPaddingY",6),e.paramThrowingDistance=10,e.paramSuspendMenuEnabled=function(t,e){if("undefined"==typeof PluginManager)return e;const r=PluginManager.parameters(i)[t];return void 0===r?e:"true"===r.toLowerCase()}("SuspendMenuEnabled",!1),e.paramInventoryCapacity=r("InventoryCapacity",24),e.paramInventoryItemsPerPage=r("InventoryItemsPerPage",12)},9782:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DAbility_Default=void 0,e.DAbility_Default=function(){return{id:0,key:"null",reactions:[]}}},8899:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DActor=void 0;e.DActor=class{constructor(t){this.id=t,this.rmmzActorId=0,this.initialX=0,this.initialY=0,this.maxLevel=0,this.initialLevel=0,this.actionCommands=[]}setup(t){this.rmmzActorId=t.id,this.initialLevel=t.initialLevel,this.maxLevel=t.maxLevel}}},1869:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DChronus=e.DChronusTimeFrameKind=void 0;const r=i(1298);var s;!function(t){t[t.Daytime=0]="Daytime",t[t.Nighttime=1]="Nighttime"}(s=e.DChronusTimeFrameKind||(e.DChronusTimeFrameKind={}));e.DChronus=class{constructor(){this.secondsInMinute=60,this.minutesInHour=60,this.hoursInDay=24,this.enabled=!1,this.timeFrames=[{name:(0,r.tr2)("深夜"),kind:s.Nighttime,startHour:0,lastHouer:4,timeFrameId:0},{name:(0,r.tr2)("早朝"),kind:s.Nighttime,startHour:5,lastHouer:6,timeFrameId:1},{name:(0,r.tr2)("朝"),kind:s.Daytime,startHour:7,lastHouer:11,timeFrameId:2},{name:(0,r.tr2)("昼"),kind:s.Daytime,startHour:12,lastHouer:16,timeFrameId:3},{name:(0,r.tr2)("夕方"),kind:s.Daytime,startHour:17,lastHouer:18,timeFrameId:4},{name:(0,r.tr2)("夜"),kind:s.Nighttime,startHour:19,lastHouer:21,timeFrameId:5},{name:(0,r.tr2)("深夜"),kind:s.Nighttime,startHour:22,lastHouer:24,timeFrameId:0}],this.timeTones=[{timeFrameId:0,value:[-102,-102,-68,102]},{timeFrameId:1,value:[-68,-68,0,0]},{timeFrameId:2,value:[0,0,0,0]},{timeFrameId:3,value:[34,34,34,0]},{timeFrameId:4,value:[68,-34,-34,0]},{timeFrameId:5,value:[-68,-68,0,68]}],this.daysOfMonth=[31,28,31,30,31,30,31,31,30,31,30,31],this.monthNames=["Jan.","Feb.","Mar.","Apr.","May.","Jun.","Jul.","Aug.","Sep.","Oct.","Nov.","Dec."],this.weekNames=["(日)","(月)","(火)","(水)","(木)","(金)","(土)"],this.secondsInRound=this.secondsInHour}get secondsInDay(){return this.secondsInMinute*this.minutesInHour*this.hoursInDay}get secondsInHour(){return this.secondsInMinute*this.minutesInHour}getDaysOfWeek(){return this.weekNames.length}getDaysOfMonth(t){return this.daysOfMonth[t-1]}getDaysOfYear(){let t=0;for(const e of this.daysOfMonth)t+=e;return t}}},8097:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DClass=void 0;e.DClass=class{constructor(t){this.id=0,this.name="null",this.expParams=[],this.params=[],this.traits=[],this.learnings=[]}}},8068:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DCommand=void 0;e.DCommand=class{constructor(t,e){this.id=t,this.name=e}}},5967:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DBlockLayerScope=e.DBlockLayerKind=e.DColorIndex=e.DSubComponentEffectTargetKey=void 0;class i{constructor(){this.path="",this.kindId=0,this.tags=[]}static make(t,e,r){const s=new i;return s.path=t,e&&(s.kindId=e),r&&(s.tags=r),s}clone(){const t=new i;return t.path=this.path,t.kindId=this.kindId,t.tags=this.tags.slice(),t}}e.DSubComponentEffectTargetKey=i,function(t){t[t.Default=0]="Default"}(e.DColorIndex||(e.DColorIndex={})),function(t){t[t.Terrain=0]="Terrain",t[t.Ground=1]="Ground",t[t.Unit=2]="Unit",t[t.Projectile=3]="Projectile",t[t.System=4]="System",t[t.Top=4]="Top"}(e.DBlockLayerKind||(e.DBlockLayerKind={})),function(t){t[t.TopOnly=0]="TopOnly",t[t.All=1]="All"}(e.DBlockLayerScope||(e.DBlockLayerScope={}))},9873:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DDataImporter=void 0;const r=i(9185);e.DDataImporter=class{static importMapData(t,e,i,r){if(i.name.includes("[Table]")){const t=this.findLand(r);if(t)if("Event"==e.name)t.eventTableMapId=e.id;else if("Enemy"==e.name)t.enemyTableMapId=e.id;else if("Item"==e.name)t.itemTableMapId=e.id;else if("Trap"==e.name)t.trapTableMapId=e.id;else if("Shop"==e.name)t.shopTableMapId=e.id;else{if(e.name.includes("Shop(Peddler)"))throw new Error("Not implemented.");if(e.name.includes("Shop(Weapon)"))throw new Error("Not implemented.");if(e.name.includes("Shop(Luxury)"))throw new Error("Not implemented.");if(e.name.includes("RandomPot"))throw new Error("Not implemented.")}}else if(i.name.includes("[System]")){const i=this.findLand(r);i&&"ExitMap"==e.name&&i.addEventMapAsExitMap(t)}else if(i.name.includes("[Event]")){t.eventMap=!0;const e=this.findLand(r);e&&(t.eventMap=!0,t.landId=e.id)}}static findLand(t){if(t)return r.MRData.lands.find((e=>t&&e.rmmzMapId==t.id))}}},4561:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEmittorCost=e.DParamCostType=e.DSkillCostSource=e.DEffect=e.DBuffLevelOp=e.DBuffType=e.DBuffMode=e.DEffectFieldScope=e.DEffectScopeTargetFactionFlags=e.DEffectFieldScopeArea=e.DEffectFieldScopeType=e.DEffectHitType=e.DRmmzEffectScope=e.LStateLevelType=e.DParameterQualifying=e.DValuePoint=e.DParameterEffectApplyType=void 0;const r=i(5967),s=i(9185),a=i(2213),n=i(5739),o=i(5168),c=i(6539);var l,h,u,d,p,f,m;!function(t){t[t.None=0]="None",t[t.Damage=1]="Damage",t[t.Recover=2]="Recover",t[t.Drain=3]="Drain"}(l=e.DParameterEffectApplyType||(e.DParameterEffectApplyType={})),function(t){t[t.Actual=0]="Actual",t[t.Minimum=1]="Minimum",t[t.Growth=2]="Growth"}(h=e.DValuePoint||(e.DValuePoint={}));class y{constructor(t,e,i){this.conditionTargetCategoryId=0,this.fallback=!1,this.flavorEffects=[],this._parameterId=t,this.applyType=i,this.applyTarget=h.Actual,this.elementIds=[0],this.formula=e,this.variance=0,this.silent=!1}withApplyTarget(t){return this.applyTarget=t,this}withElementId(t){return this.elementIds[0]=t,this}withVariance(t){return this.variance=t,this}withSilent(t=!0){return this.silent=t,this}withConditionFormula(t){return this.conditionFormula=t,this}withFallback(t=!0){return this.fallback=t,this}getParameterFlavorEffectByLooksFaction(t){return this.flavorEffects.filter((e=>e.looksFaction===t))}clone(){const t=new y(0,"",l.None);return t.copyFrom(this),t}copyFrom(t){this._parameterId=t._parameterId,this.applyType=t.applyType,this.applyTarget=t.applyTarget,this.elementIds=[...t.elementIds],this.formula=t.formula,this.variance=t.variance,this.silent=t.silent,this.conditionFormula=t.conditionFormula,this.conditionTargetCategoryId=t.conditionTargetCategoryId,this.flavorEffects=[...t.flavorEffects],this.alliesSideGainMessage=t.alliesSideGainMessage,this.alliesSideLossMessage=t.alliesSideLossMessage,this.opponentGainMessage=t.opponentGainMessage,this.opponentLossMessage=t.opponentLossMessage}}e.DParameterQualifying=y,function(t){t[t.AbsoluteValue=0]="AbsoluteValue",t[t.RelativeValue=1]="RelativeValue"}(e.LStateLevelType||(e.LStateLevelType={})),function(t){t[t.None=0]="None",t[t.Opponent_Single=1]="Opponent_Single",t[t.Opponent_All=2]="Opponent_All",t[t.Opponent_Random_1=3]="Opponent_Random_1",t[t.Opponent_Random_2=4]="Opponent_Random_2",t[t.Opponent_Random_3=5]="Opponent_Random_3",t[t.Opponent_Random_4=6]="Opponent_Random_4",t[t.Friend_Single_Alive=7]="Friend_Single_Alive",t[t.Friend_All_Alive=8]="Friend_All_Alive",t[t.Friend_Single_Dead=9]="Friend_Single_Dead",t[t.Friend_All_Dead=10]="Friend_All_Dead",t[t.User=11]="User",t[t.Friend_Single_Unconditional=12]="Friend_Single_Unconditional",t[t.Friend_All_Unconditional=13]="Friend_All_Unconditional",t[t.Everyone=14]="Everyone"}(e.DRmmzEffectScope||(e.DRmmzEffectScope={})),function(t){t[t.Certain=0]="Certain",t[t.Physical=1]="Physical",t[t.Magical=2]="Magical"}(u=e.DEffectHitType||(e.DEffectHitType={})),function(t){t[t.Performer=0]="Performer",t[t.Front1=1]="Front1",t[t.StraightProjectile=2]="StraightProjectile",t[t.ReceiveProjectile=3]="ReceiveProjectile",t[t.PointProjectile=4]="PointProjectile",t[t.Selection=5]="Selection",t[t.Around=6]="Around",t[t.AroundAndCenter=7]="AroundAndCenter",t[t.Center=8]="Center",t[t.Room=9]="Room",t[t.Map=10]="Map"}(d=e.DEffectFieldScopeType||(e.DEffectFieldScopeType={})),function(t){t[t.Room=0]="Room",t[t.Floor=1]="Floor"}(p=e.DEffectFieldScopeArea||(e.DEffectFieldScopeArea={})),function(t){t[t.Friend=1]="Friend",t[t.Nature=2]="Nature",t[t.Hostile=4]="Hostile",t[t.All=7]="All"}(e.DEffectScopeTargetFactionFlags||(e.DEffectScopeTargetFactionFlags={}));e.DEffectFieldScope=class{constructor(){this.area=p.Room,this.range=d.Performer,this.length=-1,this.projectilePrefabKey="",this.layers=[r.DBlockLayerKind.Unit],this.layerScope=r.DBlockLayerScope.TopOnly}},function(t){t.Strength="strength",t.Weakness="weakness"}(e.DBuffMode||(e.DBuffMode={})),function(t){t[t.Add=0]="Add",t[t.Mul=1]="Mul"}(f=e.DBuffType||(e.DBuffType={})),function(t){t[t.Set=0]="Set",t[t.Add=1]="Add"}(m=e.DBuffLevelOp||(e.DBuffLevelOp={}));e.DEffect=class{constructor(t,e){this.id=t,this.key=e,this.subEntityFindKey={kindId:0,key:void 0},this.critical=!1,this.successRate=100,this.hitType=u.Certain,this.flavorEffect=null,this.parameterQualifyings=[],this.otherEffectQualifyings=[],this.effectBehaviors=[],this.rmmzSpecialEffectQualifyings=[],this.buffQualifying=[]}applyProps(t){var e;if(this.critical=null!==(e=t.critical)&&void 0!==e?e:this.critical,this.flavorEffect=t.flavorEffect?new n.DFlavorEffect(t.flavorEffect):this.flavorEffect,t.parameterValues)for(const e of t.parameterValues){const t=new y(s.MRData.getParameter(e.parameterKey).id,e.formula,a.DHelpers.stringToEnum(e.type,{damage:l.Damage,recovery:l.Recover,drain:l.Drain,_:l.Damage}));if(t.applyTarget=a.DHelpers.stringToEnum(e.point,{actual:h.Actual,growth:h.Growth,_:h.Actual}),e.conditionTargetCategoryKey&&(t.conditionTargetCategoryId=s.MRData.getEntityCategory(e.conditionTargetCategoryKey).id),e.conditionFormula&&(t.conditionFormula=e.conditionFormula),e.conditionFallback&&(t.fallback=e.conditionFallback),e.silent&&(t.silent=e.silent),e.parameterFlavorEffects)for(const i of e.parameterFlavorEffects)t.flavorEffects.push(new c.DParameterFlavorEffect(i));this.parameterQualifyings.push(t)}if(t.parameterBuffs)for(const e of t.parameterBuffs){const t={paramId:s.MRData.getParameter(e.parameterKey).id,type:a.DHelpers.stringToEnum(e.type,{constant:f.Add,ratio:f.Mul}),levelType:a.DHelpers.stringToEnum(e.levelOp,{add:m.Add,set:m.Set,_:m.Add}),level:e.level,turn:e.turn};this.buffQualifying.push(t)}if(t.specialEffects)for(const e of t.specialEffects)this.effectBehaviors.push(o.DSpecialEffect.makeSpecialEffectRef(e))}copyFrom(t){this.subEntityFindKey=Object.assign({},t.subEntityFindKey),this.critical=t.critical,this.successRate=t.successRate,this.hitType=t.hitType,this.flavorEffect=t.flavorEffect,this.parameterQualifyings=t.parameterQualifyings.map((t=>t.clone())),this.otherEffectQualifyings=t.otherEffectQualifyings.slice(),this.effectBehaviors=t.effectBehaviors.slice(),this.rmmzSpecialEffectQualifyings=t.rmmzSpecialEffectQualifyings.slice(),this.buffQualifying=t.buffQualifying.slice()}hasAnyValidEffect(){return this.parameterQualifyings.length>0||this.otherEffectQualifyings.length>0||this.effectBehaviors.length>0||this.rmmzSpecialEffectQualifyings.length>0||this.buffQualifying.length>0}},function(t){t[t.Actor=0]="Actor",t[t.Item=1]="Item"}(e.DSkillCostSource||(e.DSkillCostSource={})),function(t){t[t.Decrease=0]="Decrease",t[t.Increase=1]="Increase"}(e.DParamCostType||(e.DParamCostType={}));e.DEmittorCost=class{constructor(){this.paramCosts=[]}setParamCost(t,e,i){let r=this.paramCosts[t];r||(r=[],this.paramCosts[t]=r),r[e]=i}}},5117:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEffectSuite=e.DEffectRef=void 0;const r=i(9185);class s{constructor(t){this._effectId=t,this.conditions={targetCategoryId:0,targetRaceId:0,applyRating:0,fallback:!1}}get effectId(){return this._effectId}get effect(){return r.MRData.effects[this._effectId]}hasCondition(){return 0!=this.conditions.targetCategoryId||(0!=this.conditions.targetRaceId||(0!=this.conditions.applyRating||!!this.conditions.fallback))}copyFrom(t){this._effectId=t._effectId,this.conditions=Object.assign({},t.conditions)}clone(){const t=r.MRData.cloneEffect(this.effect),e=new s(t.id);return e.conditions=Object.assign({},this.conditions),e}}e.DEffectRef=s;e.DEffectSuite=class{constructor(t){this.selfEffectId=new s(r.MRData.newEffect(t).id),this._targetEffectRefs=[]}get selfEffect(){return this.selfEffectId}targetEffects(){return this._targetEffectRefs}targetEffect(t){return this._targetEffectRefs[t]}clearTargetEffects(){this._targetEffectRefs=[]}setTargetEffect(t,e){this._targetEffectRefs[t]=e}addTargetEffect(t){this._targetEffectRefs.push(t)}copyFrom(t){this.selfEffect.copyFrom(t.selfEffect),this._targetEffectRefs=[];for(const e of t._targetEffectRefs)this._targetEffectRefs.push(e.clone())}hitType(){return this.targetEffect(0).effect.hitType}}},8370:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DElement=void 0;e.DElement=class{constructor(t,e){this.id=t,this.key=e,this.name=""}}},4746:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEmittor=void 0;const r=i(4561),s=i(5117),a=i(2213),n=i(9185);e.DEmittor=class{constructor(t,e){this.id=t,this.key=e,this.effectSuite=new s.DEffectSuite(e),this.costs=new r.DEmittorCost,this.scope=new r.DEffectFieldScope,this.selfAnimationId=0,this.targetAreaAnimationId=0,this.selfSequelId=0}applyProps(t){if(t.scopeType&&(this.scope.range=a.DHelpers.stringToEnum(t.scopeType,{front:r.DEffectFieldScopeType.Front1,_:r.DEffectFieldScopeType.Performer})),t.targetEffectKeys){this.effectSuite.clearTargetEffects();for(const e of t.targetEffectKeys){const t=n.MRData.getEffect(e),i=new s.DEffectRef(t.id);this.effectSuite.addTargetEffect(i)}}if(t.targetEffects){this.effectSuite.clearTargetEffects();for(const e of t.targetEffects){const t=n.MRData.getEffect(e.effectKey),i=new s.DEffectRef(t.id);e.conditionTargetCategoryKey&&(i.conditions.targetCategoryId=n.MRData.getEntityCategory(e.conditionTargetCategoryKey).id),e.conditionTargetRaceKey&&(i.conditions.targetRaceId=n.MRData.getRace(e.conditionTargetRaceKey).id),e.conditionRating&&(i.conditions.applyRating=e.conditionRating),e.conditionFallback&&(i.conditions.fallback=e.conditionFallback),this.effectSuite.addTargetEffect(i)}}}copyFrom(t){this.scope=Object.assign({},t.scope),this.effectSuite.copyFrom(t.effectSuite)}setupFromRmmzScope(t){switch(t){case r.DRmmzEffectScope.Opponent_Single:this.scope.range=r.DEffectFieldScopeType.Front1;break;case r.DRmmzEffectScope.Opponent_All:this.scope.range=r.DEffectFieldScopeType.Room;break;default:this.scope.range=r.DEffectFieldScopeType.Performer}}}},2633:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEnemy=e.DDropItem=void 0;const r=i(9185);class s{constructor(){this.entityId=0,this.denominator=0,this.gold=0}static makeFromRmmzDropItemList(t,e){const i=t.filter((t=>t.kind>0)).map((t=>this.makeFromRmmzDropItem(t)));return e>0&&i.push(this.makeFromRmmzDropGold(e)),i}static makeFromRmmzDropItem(t){const e=new s;if(1===t.kind)e.entityId=r.MRData.items[r.MRData.itemDataIdOffset+t.dataId];else if(2===t.kind)e.entityId=r.MRData.items[r.MRData.weaponDataIdOffset+t.dataId];else{if(3!==t.kind)throw new Error("Unreachable.");e.entityId=r.MRData.items[r.MRData.armorDataIdOffset+t.dataId]}return e.denominator=t.dataId,e}static makeFromRmmzDropGold(t){const e=new s;return e.entityId=0,e.gold=t,e}}e.DDropItem=s;e.DEnemy=class{constructor(t,e){this.id=t,this.entityId=e,this.exp=0,this.traits=[],this.actions=[],this.dropItems=[]}entity(){return r.MRData.entities[this.entityId]}}},6291:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEntitySpawner2=e.DEntityCreateInfo=e.DEntity=e.DReaction=e.DIdentificationDifficulty=void 0;const r=i(1298),s=i(927),a=i(8516),n=i(2213),o=i(177),c=i(9185),l=i(9929);var h;!function(t){t[t.Clearly=0]="Clearly",t[t.NameGuessed=1]="NameGuessed",t[t.Obscure=2]="Obscure"}(h=e.DIdentificationDifficulty||(e.DIdentificationDifficulty={}));class u{constructor(t){this._actionId=t,this._emittorIds=[],this.primariyUse=!1}get actionId(){return this._actionId}addEmittor(t){this._emittorIds.push(t.id)}hasEmittor(){return this._emittorIds.length>0}emittorIds(){return this._emittorIds}emittors(){return this._emittorIds.map((t=>c.MRData.getEmittorById(t)))}}e.DReaction=u;e.DEntity=class{constructor(t){this.upgradeMin=0,this.upgradeMax=0,this.shortcut=!1,this.id=t,this.prefabId=0,this.entity=(0,a.DEntityProperties_Default)(),this.display={name:"null",stackedName:"null(%1)",iconIndex:0},this.description="",this.identificationDifficulty=h.Clearly,this.identificationReaction=0,this.sellingPrice2=0,this.purchasePrice=0,this.allowModifierState=!0,this.itemData=void 0,this.enemy=void 0,this.classId=0,this.raceIds=[],this.selfTraits=[],this.equipmentTraits=[],this.isTraitCharmItem=!1,this.factionId=0,this.idealParams=[],this.reactions=[],this._mainEmittorId=0,this.autoAdditionStates=[],this.majorActionDeclines=0,this.volatilityProjectile=!1,this.counterActions=[]}get isValidKey(){return""!=this.entity.key}prefab(){return c.MRData.prefabs[this.prefabId]}actorData(){return(0,r.assert)(this.actor),this.actor}item(){return(0,r.assert)(this.itemData),this.itemData}enemyData(){return(0,r.assert)(this.enemy),this.enemy}equippedTraits(){return this.isTraitCharmItem?[]:this.equipmentTraits}charmedTraits(){return this.isTraitCharmItem?this.equipmentTraits:[]}addReaction(t,e,i){let r=this.reactions.find((e=>e.actionId==t));return r||(r=new u(t),this.reactions.push(r)),e&&r.addEmittor(e),i&&(r.primariyUse=i),r}findReaction(t){return this.reactions.find((e=>e.actionId==t))}getReaction(t){const e=this.reactions.find((e=>e.actionId==t));return(0,r.assert)(e),e}setMainEmittor(t){this._mainEmittorId=t.id}mainEmittor(){return(0,r.assert)(this._mainEmittorId>0),c.MRData.emittors[this._mainEmittorId]}makeDisplayName(t){return t>=2?this.display.stackedName.format(t):this.display.name}verify(){}applyProps(t){if(t.reactions){this.reactions=[];for(const e of t.reactions){const t=c.MRData.getSkill(e.actionKey);if(e.emittorKeys)for(const i of e.emittorKeys){const r=c.MRData.getEmittor(i),s=this.addReaction(t.id,r,!1);e.commandName&&(s.overrideDisplayCommandName=e.commandName)}}}if(t.allowModifierState&&(this.allowModifierState=t.allowModifierState),t.identificationActionKey&&(this.identificationDifficulty=n.DHelpers.stringToEnum(t.identificationActionKey,{clearly:h.Clearly,named:h.NameGuessed,obscure:h.Obscure})),t.identificationActionKey&&(this.identificationReaction=c.MRData.getSkill(t.identificationActionKey).id),t.selfTraits)for(const e of t.selfTraits)this.selfTraits.push(o.DTrait.makeTraitData(e));if(t.equipmentTraits)for(const e of t.equipmentTraits)this.equipmentTraits.push(o.DTrait.makeTraitData(e))}};class d{constructor(){this.entityId=0,this.stateIds=[],this.debugName="",this.stackCount=void 0,this.override=!1,this.gold=0}static makeSingle(t,e,i){const r=new d;return r.entityId=t,e&&(r.stateIds=e),i&&(r.debugName=i),r}withStackCount(t){return this.stackCount=t,this}}e.DEntityCreateInfo=d;class p extends d{constructor(){super(),this.troopId=0,this.overrideEvent=void 0,this.keeper=!1,this.rate=100}entityData(){return(0,r.assert)(this.entityId>0),c.MRData.entities[this.entityId]}static makeFromEventData(t,e){return this.makeFromEventPageData(t,t.pages[0],e)}static makeFromEventPageData(t,e,i){var a,n;const o=s.DAnnotationReader.readEntityMetadataFromPage(e);if(!o)return;const h=new p;if(h.troopId=o.troopId,h.entityId=c.MRData.entities.findIndex((t=>t.entity.key==o.entity)),h.stackCount=o.stackCount,h.override=o.override,h.gold=o.gold,h.overrideEvent=o.overrideEvent?t:void 0,h.keeper=null!==(a=o.keeper)&&void 0!==a&&a,h.xName=o.entity,h.rate=null!==(n=o.rate)&&void 0!==n?n:100,""!=o.entity&&h.entityId<=0)throw new Error((0,r.tr2)("@MR-Spawner で指定された Entity Key '%1' が存在しません。 %2 %3").format(o.entity,l.DValidationHelper.makeRmmzMapName(i),l.DValidationHelper.makeRmmzEventName(t)));for(const t of o.states){const e=c.MRData.states.findIndex((e=>e.key==t));if(!(e>0))throw new Error(`State "${t}" not found.`);h.stateIds.push(e)}return h}}e.DEntitySpawner2=p},1289:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEntityCategory=void 0;const r=i(4836);e.DEntityCategory=class{constructor(t,e){this.id=t,this.key=e,this.displayName=""}static isMonster(t){return t.entity.kindId==r.MRBasics.entityCategories.MonsterKindId}static isTrap(t){return t.entity.kindId==r.MRBasics.entityCategories.TrapKindId}static isEntryPoint(t){return t.entity.kindId==r.MRBasics.entityCategories.entryPoint}static isExitPoint(t){return t.entity.kindId==r.MRBasics.entityCategories.exitPoint}static isOrnament(t){return t.entity.kindId==r.MRBasics.entityCategories.Ornament}static isItem(t){return!(this.isMonster(t)||this.isEntryPoint(t)||this.isExitPoint(t)||this.isOrnament(t))}applyProps(t){}}},8516:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parseMetadata_Behavior=e.parseMetaToEntityProperties=e.DEntityProperties_Default=e.DItemEquipmentSide=void 0;const r=i(2213),s=i(9185);var a;function n(){return{key:"",kindId:0,behaviors:[],commandNames:[],reactionNames:[],abilityNames:[],capacity:void 0,equipmentImage:{name:"",side:a.Right},meta_prefabName:""}}function o(t){const e=[];for(const i of t)e.push(r.DHelpers.parseConstructionExpr(i));return e}!function(t){t[t.Right=0]="Right",t[t.Left=1]="Left"}(a=e.DItemEquipmentSide||(e.DItemEquipmentSide={})),e.DEntityProperties_Default=n,e.parseMetaToEntityProperties=function(t){var e,i;if(t){const r=t["MR-Category"],n=r?s.MRData.findEntityCategory(r.trim()):void 0,c={key:(null!==(e=t["MR-Key"])&&void 0!==e?e:"").trim(),kindId:n?n.id:0,behaviors:[],commandNames:[],reactionNames:[],abilityNames:[],capacity:t["RE-Capacity"],equipmentImage:{name:"",side:a.Right},meta_prefabName:(null!==(i=t["MR-Prefab"])&&void 0!==i?i:"").trim()},l=t["MR-Behavior"];l&&(c.behaviors=o("string"==typeof l?[l]:l));const h=t["RE-Command"];h&&(c.commandNames=h.split(";"));const u=t["RE-Reaction"];u&&(c.reactionNames=u.split(";"));const d=t["RE-Ability"];d&&(c.abilityNames=d.split(";"));const p=t["RE-EquipmentImage"];if(p){const t=p.split(",");switch(c.equipmentImage.name=t[0],t[1].toLocaleLowerCase()){case"right":c.equipmentImage.side=a.Right;break;case"left":c.equipmentImage.side=a.Left;break;default:throw new Error(`Invalid token. (${t[1]})`)}}return c}return n()},e.parseMetadata_Behavior=o},62:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEntityTemplate=void 0;const r=i(1298),s=i(9547);e.DEntityTemplate=class{constructor(t,e,i){this.id=t,this.key=e,this._props=i}get props(){return this._props}resetProps(t){(0,r.assert)(this.props.type==t.type),this._props=t}applyTo(t){switch(this.props.type){case"null":break;case"Weapon":this.applyTo_Weapon(t);break;case"Shield":this.applyTo_Shield(t);break;case"Armor":this.applyTo_Armor(t);break;case"Accessory":this.applyTo_Accessory(t);break;case"Grass":this.applyTo_Grass(t);break;case"Food":this.applyTo_Food(t);break;default:(0,r.assert)(!1)}}applyTo_Weapon(t){(0,r.assert)("Weapon"==this.props.type),s.MRSetup.setupWeaponCommon(t)}applyTo_Shield(t){(0,r.assert)("Shield"==this.props.type),s.MRSetup.setupShieldCommon(t)}applyTo_Armor(t){(0,r.assert)("Armor"==this.props.type)}applyTo_Accessory(t){(0,r.assert)("Accessory"==this.props.type)}applyTo_Grass(t){(0,r.assert)("Grass"==this.props.type),s.MRSetup.setupGrassCommon(t,this.props.recoverFP)}applyTo_Food(t){(0,r.assert)("Food"==this.props.type),s.MRSetup.setupFoodCommon(t)}}},9394:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEquipmentType_Default=void 0,e.DEquipmentType_Default={id:0,name:"null"}},6901:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DFactionType=void 0,function(t){t.Neutral="Neutral",t.Friendly="Friendly",t.Hostile="Hostile"}(e.DFactionType||(e.DFactionType={}))},5739:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DFlavorEffect=e.DSound=void 0;class i{constructor(t){var e,i,r;this.name=t.name,this.pan=null!==(e=t.pan)&&void 0!==e?e:0,this.pitch=null!==(i=t.pitch)&&void 0!==i?i:100,this.volume=null!==(r=t.volume)&&void 0!==r?r:90}}e.DSound=i;class r{constructor(t){var e,r;void 0===(t=t||{}).text?this.text=[]:t.text instanceof Array?this.text=t.text:this.text=[t.text],this.sound=t.sound?new i(t.sound):void 0,this.rmmzAnimationId=null!==(e=t.animationId)&&void 0!==e?e:0,this.motionId=null!==(r=t.motionId)&&void 0!==r?r:0}static fromRmmzAnimationId(t){const e=new r;return e.rmmzAnimationId=t,e}}e.DFlavorEffect=r},2213:(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DHelpers=void 0;const DEffect_1=__webpack_require__(4561);class DHelpers{static isVanillaLand(t){return t==this.VanillaLandId}static getMapTopTile(t,e,i){for(let r=3;r>=0;r--){const s=t.data[(r*t.height+i)*t.width+e]||0;if(s>0)return s}return 0}static isTileA3(t){return t>=this.TILE_ID_A3&&t<this.TILE_ID_A4}static isTileA4(t){return t>=this.TILE_ID_A4&&t<this.TILE_ID_MAX}static isAutotile(t){return t>=this.TILE_ID_A1}static getAutotileKind(t){return Math.floor((t-this.TILE_ID_A1)/48)}static autotileKindToTileId(t){return 48*t+this.TILE_ID_A1}static isWallSideAutoTile(t){const e=this.autotileKindToTileId(t);return(this.isTileA3(e)||this.isTileA4(e))&&this.getAutotileKind(e)%16>=8}static stringToEnum(t,e){if(t){const i=e[t];if(void 0!==i)return i}const i=e._;if(void 0!==i)return i;throw new Error(`Unknown value: ${t}`)}static checkItemScope(t,e){return e.includes(t)}static isForOpponent(t){return this.checkItemScope(t,[DEffect_1.DRmmzEffectScope.Opponent_Single,DEffect_1.DRmmzEffectScope.Opponent_All,DEffect_1.DRmmzEffectScope.Opponent_Random_1,DEffect_1.DRmmzEffectScope.Opponent_Random_2,DEffect_1.DRmmzEffectScope.Opponent_Random_3,DEffect_1.DRmmzEffectScope.Opponent_Random_4,DEffect_1.DRmmzEffectScope.Everyone])}static isForAliveFriend(t){return this.checkItemScope(t,[DEffect_1.DRmmzEffectScope.Friend_Single_Alive,DEffect_1.DRmmzEffectScope.Friend_All_Alive,DEffect_1.DRmmzEffectScope.User,DEffect_1.DRmmzEffectScope.Everyone])}static isForDeadFriend(t){return this.checkItemScope(t,[DEffect_1.DRmmzEffectScope.Friend_Single_Dead,DEffect_1.DRmmzEffectScope.Friend_All_Dead])}static isForFriend(t){return this.isForAliveFriend(t)||this.isForDeadFriend(t)}static isSingle(t){return this.checkItemScope(t,[DEffect_1.DRmmzEffectScope.Friend_Single_Dead,DEffect_1.DRmmzEffectScope.Friend_Single_Alive,DEffect_1.DRmmzEffectScope.Opponent_Single])}static countSomeTilesRight_E(t,e,i){const r=function(e,i){for(const r of t.events)if(r&&r.x==e&&r.y==i)return r},s=DHelpers.getMapTopTile(t,e,i);let a=e+1;if(DHelpers.TILE_ID_E<=s&&s<DHelpers.TILE_ID_A5)for(;a<t.width&&(s==DHelpers.getMapTopTile(t,a,i)&&!r(a,i));a++);return a-1-e}static extractMetadata(t){for(t.meta={};;){var e=this.extractMetadataRegex.exec(t.note);if(!e)break;var i=":"!==e[2]||e[3];if(t.meta[e[1]])if(t.meta[e[1]].constructor===Array)t.meta[e[1]].push(i);else{var r=t.meta[e[1]];t.meta[e[1]]=[r,i]}else t.meta[e[1]]=i}}static makeRmmzMapDebugName(t){var e;return`${t}:${null===(e=$dataMapInfos[t])||void 0===e?void 0:e.name}`}static isNode(){return"browser"!==process.title}static parseConstructionExpr(expr){const lp=expr.indexOf("("),rp=expr.lastIndexOf(")");if(lp>=0&&rp>=0){const expr2="["+expr.substr(lp+1,rp-lp-1)+"]",args=eval(expr2);return{name:expr.substr(0,lp).trim(),args}}return{name:expr.trim(),args:[]}}static parseDisplayName(t){const e=t.lastIndexOf(".");return e>=0?t.substring(0,e):t}}exports.DHelpers=DHelpers,DHelpers.TILE_ID_E=768,DHelpers.TILE_ID_A5=1536,DHelpers.TILE_ID_A1=2048,DHelpers.TILE_ID_A2=2816,DHelpers.TILE_ID_A3=4352,DHelpers.TILE_ID_A4=5888,DHelpers.TILE_ID_MAX=8192,DHelpers.VanillaLandId=1,DHelpers.extractMetadataRegex=/<([^<>:]+)(:?)([^>]*)>/g},1855:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEquipment=e.DItem=void 0;const r=i(9185);e.DItem=class{constructor(t,e){this.id=t,this.entityId=e,this.rmmzItemId=0,this.rmmzWeaponId=0,this.rmmzArmorId=0}entityData(){return r.MRData.entities[this.entityId]}};e.DEquipment=class{constructor(){this.equipmentPart=0,this.equipmentOccupancyParts=[],this.parameters=[],this.targetRmmzAnimationId=0}}},2890:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DItemEffect=void 0;class i{}e.DItemEffect=i,i.EFFECT_RECOVER_HP=11,i.EFFECT_RECOVER_MP=12,i.EFFECT_GAIN_TP=13,i.EFFECT_ADD_STATE=21,i.EFFECT_REMOVE_STATE=22,i.EFFECT_ADD_BUFF=31,i.EFFECT_ADD_DEBUFF=32,i.EFFECT_REMOVE_BUFF=33,i.EFFECT_REMOVE_DEBUFF=34,i.EFFECT_SPECIAL=41,i.EFFECT_GROW=42,i.EFFECT_LEARN_SKILL=43,i.EFFECT_COMMON_EVENT=44,i.SPECIAL_EFFECT_ESCAPE=0,i.HITTYPE_CERTAIN=0,i.HITTYPE_PHYSICAL=1,i.HITTYPE_MAGICAL=2},2255:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DLand=e.DLandRule=e.DLandExitInventoryRule=e.DLandExitStatusRule=e.DLandForwardDirection=e.DLandIdentificationLevel=e.DTerrainSettingRef=e.DFloorStructures=e.DFloorClass=void 0;const r=i(1298),s=i(927),a=i(6291),n=i(1289),o=i(2213),c=i(9185),l=i(7048),h=i(9929);var u,d,p,f,m;!function(t){t[t.FloorMap=0]="FloorMap",t[t.EventMap=1]="EventMap"}(u=e.DFloorClass||(e.DFloorClass={}));e.DFloorStructures=class{};e.DTerrainSettingRef=class{constructor(t,e){this.terrainSettingsId=t,this.rating=e}},function(t){t[t.Unknown=0]="Unknown",t[t.Kind=1]="Kind",t[t.Entity=2]="Entity"}(d=e.DLandIdentificationLevel||(e.DLandIdentificationLevel={})),function(t){t[t.Uphill=0]="Uphill",t[t.Downhill=1]="Downhill",t[t.Flat=2]="Flat"}(p=e.DLandForwardDirection||(e.DLandForwardDirection={})),function(t){t[t.Default=0]="Default",t[t.None=1]="None",t[t.Initialize=2]="Initialize"}(f=e.DLandExitStatusRule||(e.DLandExitStatusRule={})),function(t){t[t.Default=0]="Default",t[t.None=1]="None",t[t.Initialize=2]="Initialize"}(m=e.DLandExitInventoryRule||(e.DLandExitInventoryRule={}));e.DLandRule=class{constructor(){this.enteredStatus=f.Default,this.enteredInventory=m.Default,this.conqueredStatus=f.Default,this.conqueredInventory=m.Default,this.abandonedStatus=f.Default,this.abandonedInventory=m.Default}};class y{constructor(t,e){this.id=t,this.name="null",this.rmmzMapId=0,this.eventTableMapId=0,this.itemTableMapId=0,this.enemyTableMapId=0,this.trapTableMapId=0,this.shopTableMapId=0,this.appearanceTable={entities:[],maxFloors:0,system:[],enemies:[],traps:[],items:[],events:[],shop:[]},this.floorInfos=[],this.floorIds=[],this.fixedMapIds=[],this._eventMapIds=[],this._exitEventMapIndex=-1,this.identifiedKinds=[],this.forwardDirection=p.Uphill,this._isWorld=e}toDebugName(){return h.DValidationHelper.makeDataName("Land",this.id,this.name)}validate(){this.id>0&&!this.isVanillaLand&&0==this._exitEventMapIndex&&l.Diag.error(this.toDebugName()+(0,r.tr)("の ExitMap が設定されていません。"))}get isVanillaLand(){return o.DHelpers.isVanillaLand(this.id)}get isWorldLand(){return this._isWorld}get eventMapIds(){return this._eventMapIds}get exitMapId(){return(0,r.assert)(this._exitEventMapIndex>=0),this._eventMapIds[this._exitEventMapIndex]}get exitMapData(){return c.MRData.maps[this.exitMapId]}getFloorClass(t){return(0,r.assert)(t.landId===this.id),this._eventMapIds.find((e=>t.id))?u.EventMap:u.FloorMap}findFixedMapByName(t){if(!t)return;const e=this.fixedMapIds.find((e=>c.MRData.maps[e].name==t));return e?c.MRData.maps[e]:void 0}addEventMap(t){(0,r.assert)(0===t.landId),t.landId=this.id,this._eventMapIds.push(t.id)}addEventMapAsExitMap(t){this._exitEventMapIndex>=0&&l.Diag.error(this.toDebugName()+(0,r.tr2)("既に ExitMap が設定されています。")),(0,r.assert)(t.landId===this.id),t.landId=this.id,t.exitMap=!0,this._exitEventMapIndex=this._eventMapIds.length,this._eventMapIds.push(t.id)}import(t){this.floorInfos=y.buildFloorTable(t),this.appearanceTable=y.buildAppearanceTableSet(t,this.rmmzMapId,this.floorInfos.length);for(const e of t.events){if(!e)continue;const t=s.DAnnotationReader.readLandMetadata(e);if(t){if(t.identifications)for(const e of t.identifications){const t=e.split(":"),i=t[0];if("all"==i.toLowerCase()){const e=this.parseLandIdentificationLevel(t[1].toLowerCase());for(const t of c.MRData.categories)this.identifiedKinds[t.id]=e}else{const e=c.MRData.getEntityCategory(i.toLowerCase());this.identifiedKinds[e.id]=this.parseLandIdentificationLevel(t[1].toLowerCase())}}break}}for(const e of t.events)if(e){if(s.DAnnotationReader.readPrefabMetadata(e,this.rmmzMapId)){const t=c.MRData.newPrefab();t.rmmzMapId=this.rmmzMapId,t.rmmzEventData=e}}}parseLandIdentificationLevel(t){switch(t){case"entity":return d.Entity;case"kind":return d.Kind;default:throw new Error(`IdentificationLevel "${t}" is invalid.`)}}checkIdentifiedKind(t){const e=this.identifiedKinds[t.id];return!!e&&e>=d.Kind}checkIdentifiedEntity(t){const e=this.identifiedKinds[t.id];return!!e&&e>=d.Entity}static buildFloorTable(t){var e,i,r,a;const n=[];for(const l of t.events){if(!l)continue;const h=s.DAnnotationReader.readFloorMetadataFromPage(l.pages[0]);if(h){const s={key:l.name,template:null!==(e=h.template)&&void 0!==e?e:void 0,displayName:null!==(i=h.displayName)&&void 0!==i?i:void 0,fixedMapName:null!==(r=h.fixedMap)&&void 0!==r?r:"",safetyActions:null!==(a=h.safety)&&void 0!==a&&a,bgmName:h.bgm?h.bgm[0]:"",bgmVolume:h.bgm?h.bgm[1]:90,bgmPitch:h.bgm?h.bgm[2]:100,presetId:h.preset?c.MRData.getFloorPreset(h.preset).id:1},u=l.x+o.DHelpers.countSomeTilesRight_E(t,l.x,l.y);for(let t=l.x;t<=u;t++)n[t]=s}}return n}static buildAppearanceTableSet(t,e,i){const r={entities:[],maxFloors:0,system:[],enemies:[],traps:[],items:[],events:[],shop:[]},c=[];r.maxFloors=t.width;for(const i of t.events){if(!i)continue;const n=i.x,l=i.y,h=s.DAnnotationReader.readEntityMetadataFromPage(i.pages[0]);if(h){const s=a.DEntitySpawner2.makeFromEventData(i,e);if(!s)throw new Error(`Entity "${h.entity}" not found. (Map:${o.DHelpers.makeRmmzMapDebugName(e)}, Event:${i.id}.${i.name})`);if(s.entityId<=0&&s.troopId<=0)throw new Error(`Entity "${s.xName}" not found. (Map:${o.DHelpers.makeRmmzMapDebugName(e)}, Event:${i.id}.${i.name})`);const c={spawiInfo:s,startFloorNumber:n,lastFloorNumber:n+o.DHelpers.countSomeTilesRight_E(t,n,l)};r.entities.push(c)}if(s.DAnnotationReader.readREEventMetadataFromPage(i.pages[0])){const e={rmmzEventId:i.id,startFloorNumber:n,lastFloorNumber:n+o.DHelpers.countSomeTilesRight_E(t,n,l)};c.push(e)}}const l=Math.max(r.maxFloors,i);r.system=new Array(l),r.enemies=new Array(l),r.traps=new Array(l),r.items=new Array(l),r.events=new Array(l),r.shop=new Array(l);for(let t=0;t<l;t++)r.system[t]=[],r.enemies[t]=[],r.traps[t]=[],r.items[t]=[],r.events[t]=[],r.shop[t]=[];for(const t of r.entities){const e=t.spawiInfo;for(let i=t.startFloorNumber;i<=t.lastFloorNumber;i++)e.troopId>0||n.DEntityCategory.isMonster(e.entityData())?r.enemies[i].push(t):n.DEntityCategory.isTrap(e.entityData())?r.traps[i].push(t):n.DEntityCategory.isItem(e.entityData())?r.items[i].push(t):r.system[i].push(t)}for(const t of c)for(let e=t.startFloorNumber;e<=t.lastFloorNumber;e++)r.events[e].push(t);return r}static buildSubAppearanceTable(t,e,i,n,c){var l;if(e.width!=c.length)throw new Error((0,r.tr2)("%1に含まれる%2テーブルのマップサイズが一致していません。").format(t.name,null===(l=$dataMapInfos[i])||void 0===l?void 0:l.name));(0,r.assert)(n.maxFloors==c.length);const h=[];for(const t of e.events){if(!t)continue;const r=t.x,n=t.y,c=s.DAnnotationReader.readEntityMetadataFromPage(t.pages[0]);if(c){const s=a.DEntitySpawner2.makeFromEventData(t,i);if(!s)throw new Error(`Entity "${c.entity}" not found. (Map:${o.DHelpers.makeRmmzMapDebugName(i)}, Event:${t.id}.${t.name})`);const l={spawiInfo:s,startFloorNumber:r,lastFloorNumber:r+o.DHelpers.countSomeTilesRight_E(e,r,n)};h.push(l)}}for(let t=0;t<n.maxFloors;t++)c[t]||(c[t]=[]);for(const t of h){n.entities.push(t);for(let e=t.startFloorNumber;e<=t.lastFloorNumber;e++)c[e].push(t)}}}e.DLand=y},5545:(t,e)=>{"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.DMap=e.REFloorMapKind=void 0,function(t){t[t.Land=0]="Land",t[t.TemplateMap=1]="TemplateMap",t[t.FixedMap=2]="FixedMap",t[t.ShuffleMap=3]="ShuffleMap",t[t.RandomMap=4]="RandomMap"}(i=e.REFloorMapKind||(e.REFloorMapKind={}));e.DMap=class{constructor(t){this.id=t,this.landId=0,this.mapId=0,this.mapKind=i.FixedMap,this.exitMap=!1,this.safetyMap=!1,this.defaultSystem=!1,this.eventMap=!1}get name(){const t=$dataMapInfos[this.mapId];return t?t.name:""}}},6539:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DParameter=e.DParameterFlavorEffect=e.DValueAddition=e.DParamMessageValueSource=e.DParameterType=void 0;const r=i(4561),s=i(6901),a=i(5739),n=i(2213);var o,c,l;!function(t){t[t.Normal=0]="Normal",t[t.Dependent=1]="Dependent"}(o=e.DParameterType||(e.DParameterType={})),function(t){t[t.Relative=0]="Relative",t[t.Absolute=1]="Absolute"}(c=e.DParamMessageValueSource||(e.DParamMessageValueSource={})),function(t){t[t.None=0]="None",t[t.Gain=1]="Gain",t[t.Loss=2]="Loss"}(l=e.DValueAddition||(e.DValueAddition={}));class h{constructor(t){this.looksFaction=s.DFactionType.Neutral,this.point=r.DValuePoint.Actual,this.addition=l.Loss,(t=t||{flavorEffect:{}}).point&&(this.point=n.DHelpers.stringToEnum(t.point,{actual:r.DValuePoint.Actual,growth:r.DValuePoint.Growth,_:r.DValuePoint.Actual})),t.addition&&(this.addition=n.DHelpers.stringToEnum(t.addition,{none:l.None,loss:l.Loss,gain:l.Gain,_:l.Loss})),t.looksFaction&&(this.looksFaction=n.DHelpers.stringToEnum(t.looksFaction,{neutral:s.DFactionType.Neutral,friendly:s.DFactionType.Friendly,hostile:s.DFactionType.Hostile,_:s.DFactionType.Neutral})),this.conditionFormula=t.conditionFormula,this.flavorEffect=new a.DFlavorEffect(t.flavorEffect)}}e.DParameterFlavorEffect=h;class u{constructor(t,e,i){this.magnification=1,this.friendlySideMessages=[],this.opponentSideMessages=[],this.parameterFlavorEffects=[],this.allowDamage=!0,this.id=t,this.key=e,this.code=e,this.type=o.Normal,this.displayName=i,this.displayNameMaximum=i,this.battlerParamId=-1,this.initialIdealValue=100,this.minEffortLimit=0,this.maxEffortLimit=1/0,this.minLimit=0,this.maxLimit=1/0,this.addBuffCoe=100,this.mulBuffCore=.25,this.messageValueSource=c.Relative,this.recoverTarget=!0,this.parameterFlavorEffects=[]}static makeBuiltin(t,e,i,r,s,a,n,o,c){const l=new u(t,e,i);return l.displayNameMaximum=r,l.battlerParamId=s,l.initialIdealValue=a,l.minLimit=n,l.maxLimit=o,l.recoverTarget=c,l}makeDisplayValue(t){return t*this.magnification}getParameterFlavorEffectByLooksFaction(t){return this.parameterFlavorEffects.filter((e=>e.looksFaction===t))}addFlavorEffect(t){const e=new h(t);return this.parameterFlavorEffects.push(e),e}addTextFlavorEffect(t,e,i,r){const s=new h;return s.flavorEffect=new a.DFlavorEffect,s.flavorEffect.text=[r],s.looksFaction=t,s.point=e,s.addition=i,this.parameterFlavorEffects.push(s),s}}e.DParameter=u},8428:(t,e)=>{"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.DPrefab=e.DPrefabMoveType=e.DSystemPrefabKind=void 0,function(t){t[t.Unknown=0]="Unknown",t[t.EntryPoint=1]="EntryPoint",t[t.ExitPoint=2]="ExitPoint"}(e.DSystemPrefabKind||(e.DSystemPrefabKind={})),function(t){t[t.Fix=0]="Fix",t[t.Random=1]="Random"}(i=e.DPrefabMoveType||(e.DPrefabMoveType={}));e.DPrefab=class{constructor(t){this.id=0,this.key="",this.id=t,this.image={characterName:"",direction:2,pattern:0,characterIndex:0,directionFix:!1,stepAnime:!1,walkAnime:!1},this.subPages=[],this.stateImages=[],this.downImage={},this.moveType=i.Random,this.rmmzMapId=0,this.rmmzEventData={id:0,name:"null",note:"",pages:[{conditions:{actorId:1,actorValid:!1,itemId:1,itemValid:!1,selfSwitchCh:"A",selfSwitchValid:!1,switch1Id:1,switch1Valid:!1,switch2Id:1,switch2Valid:!1,variableId:1,variableValid:!1,variableValue:1},directionFix:!1,image:{tileId:0,characterName:"",direction:2,pattern:0,characterIndex:1},list:[],moveFrequency:3,moveRoute:{list:[],repeat:!0,skippable:!1,wait:!1},moveSpeed:3,moveType:0,priorityType:1,stepAnime:!1,through:!1,trigger:0,walkAnime:!0}],x:0,y:0}}}},8336:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DPseudonymous=void 0;const r=i(1298),s=i(9185);e.DPseudonymous=class{constructor(){this._names=[]}setup(t){const e=t;for(const t of e){const e=s.MRData.getEntityCategory(t.kind);this._names[e.id]={names:t.names}}}kinds(){const t=[];for(let e=0;e<this._names.length;e++)this._names[e]&&t.push(s.MRData.categories[e]);return t}nameList(t){const e=this._names[t];return e?e.names:void 0}getNameList(t){const e=this.nameList(t);return(0,r.assert)(e),e}}},4659:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DRace=void 0;e.DRace=class{constructor(t){this.id=t,this.key="",this.name="",this.traits=[]}}},6413:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DSkill=void 0;const r=i(4561),s=i(5739),a=i(9185);e.DSkill=class{constructor(t,e){this.priority=0,this.id=t,this.key=e,this.name="null",this.isActivity=!1,this.rmmzEffectScope=r.DRmmzEffectScope.None,this.emittorId=0,this.flavorEffect=void 0}emittor(){return a.MRData.getEmittorById(this.emittorId)}setFlavorEffect(t){this.flavorEffect=new s.DFlavorEffect(t)}applyProps(t){t.flavorEffect&&this.setFlavorEffect(t.flavorEffect)}}},5168:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DSpecialEffect=void 0;const r=i(9185);e.DSpecialEffect=class{constructor(t,e){this.id=t,this.key=e}static makeSpecialEffectRef(t){const e=r.MRData.getSpecialEffect(t.code).id;switch(t.code){case"RandomWarp":return{specialEffectId:e,entityId:0,dataId:0,value:0};case"AddState":case"RemoveState":return{specialEffectId:e,entityId:0,dataId:r.MRData.getState(t.stateKey).id,value:t.chance};case"Unknown":return{specialEffectId:e,entityId:0,dataId:t.dataKey,value:t.value};default:throw new Error(`SpecialEffect code "${t.code}" unsupported.`)}}}},6189:(t,e)=>{"use strict";var i,r;Object.defineProperty(e,"__esModule",{value:!0}),e.makeStateBehaviorsFromMeta=e.DState=e.DStateIntentions=e.DStateEffect=e.DStateRestriction=e.DAutoRemovalTiming=void 0,function(t){t[t.None=0]="None",t[t.AfterAction=1]="AfterAction",t[t.TurnEnd=2]="TurnEnd",t[t.ActualParam=3]="ActualParam",t[t.DamageTesting=4]="DamageTesting",t[t.FloorTransfer=5]="FloorTransfer"}(i=e.DAutoRemovalTiming||(e.DAutoRemovalTiming={})),function(t){t[t.None=0]="None",t[t.AttcakToOpponent=1]="AttcakToOpponent",t[t.AttackToOther=2]="AttackToOther",t[t.AttcakToFriend=3]="AttcakToFriend",t[t.NotAction=4]="NotAction",t[t.Blind=5]="Blind"}(e.DStateRestriction||(e.DStateRestriction={})),function(t){t.fromRmmzRestriction=function(e){switch(e){case 0:return t.None;case 1:return t.AttcakToOpponent;case 2:return t.AttackToOther;case 3:return t.AttcakToFriend;case 4:return t.NotAction;default:throw new Error("Unreachable.")}}}(e.DStateRestriction||(e.DStateRestriction={}));class s{constructor(){this.matchConditions={kindId:0},this.restriction=0,this.traits=[],this.behaviors=[],this.autoRemovals=[],this.damageRemovels=[]}}e.DStateEffect=s,function(t){t[t.None=0]="None",t[t.Positive=1]="Positive",t[t.Negative=2]="Negative"}(r=e.DStateIntentions||(e.DStateIntentions={}));e.DState=class{constructor(t){this.id=t,this.displayName="",this.key="",this.iconIndex=0,this.displayNameIcon=!1,this.intentions=r.None,this.priority=0,this.message1="",this.message2="",this.message3="",this.message4="",this.stateGroupKeys=[],this.stateGroupIds=[],this.deadState=!1,this.autoAdditionCondition=void 0,this.effect=new s,this.submatchStates=[],this.idleSequel=0,this.applyConditions={kindIds:[]}}import(t){if(t.meta){const e=t.meta["MR-StateGroup"];if(e){const t=e instanceof Array?e:[e];this.stateGroupKeys=t.map((t=>t.trim()))}}switch(t.autoRemovalTiming){case 0:break;case 1:this.effect.autoRemovals.push({kind:i.AfterAction});break;case 2:this.effect.autoRemovals.push({kind:i.TurnEnd,minTurns:t.minTurns,maxTurns:t.maxTurns});break;default:throw new Error("Unreachable.")}}},e.makeStateBehaviorsFromMeta=function(t){const e=t["MR-Behavior"];return e?e instanceof Array?e.map((t=>t.trim())):[e.trim()]:[]}},3201:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DStateGroup=void 0;e.DStateGroup=class{constructor(t){this.id=t,this.name="",this.key="",this.exclusive=!1}}},6543:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DSystem=void 0;const r=i(5739),s=i(9185);e.DSystem=class{constructor(){this.floorRoundLimit=1e3,this.factions={player:1,enemy:2,neutral:3},this.trapTargetFactionId=this.factions.player,this.skills={move:0,normalAttack:0},this.states={bless:0,curse:0,seal:0,plating:0},this.fallbackEnemyEntityId=0,this.fallbackItemEntityId=0,this.fallbackGoldEntityId=0,this.initialPartyMembers=[],this.bareHandsFlavorEffect=new r.DFlavorEffect,this.bareHandsFlavorEffect.rmmzAnimationId=1}link(t){const e=s.MRData.getState("kState_System_Bless"),i=s.MRData.getState("kState_System_Curse"),r=s.MRData.getState("kState_System_Seal");e.displayNameIcon=!0,i.displayNameIcon=!0,r.displayNameIcon=!0,this.skills.normalAttack=s.MRData.getSkill("kSkill_System_NormalAttack").id,this.skills.move=s.MRData.getSkill("kSkill_System_Move").id,this.states.bless=e.id,this.states.curse=i.id,this.states.seal=r.id,this.states.plating=s.MRData.getState("kState_System_Plating").id,this.fallbackEnemyEntityId=s.MRData.getEnemy("kEntity_スライムA").entityId,this.fallbackItemEntityId=s.MRData.getItem("kEntity_雑草A").id,this.fallbackGoldEntityId=s.MRData.getItem("kEntity_GoldA").id;for(let t=1;t<s.MRData.enemies.length;t++){const e=s.MRData.enemyData(t);for(const t of e.dropItems)t.gold>0&&0==t.entityId&&(t.entityId=this.fallbackGoldEntityId)}}}},2020:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DTemplateMap=e.DBlockVisualPart=e.DBlockVisualPartPlacementType=e.DBlockVisualPartTileType=e.DBlockVisualPartType=void 0;const r=i(927),s=i(2213);var a,n,o;!function(t){t[t.Floor=0]="Floor",t[t.FloorDecoration=1]="FloorDecoration",t[t.Footpath=2]="Footpath",t[t.FootpathDecoration=3]="FootpathDecoration",t[t.Passageway=4]="Passageway",t[t.PassagewayDecoration=5]="PassagewayDecoration",t[t.Water=6]="Water",t[t.WaterDecoration=7]="WaterDecoration",t[t.ShopFloor=8]="ShopFloor",t[t.ShopFloorDecoration=9]="ShopFloorDecoration",t[t.Wall=10]="Wall",t[t.WallDecoration=11]="WallDecoration",t[t.HardWall=12]="HardWall"}(a=e.DBlockVisualPartType||(e.DBlockVisualPartType={})),function(t){t[t.Normal=0]="Normal",t[t.Autotile=1]="Autotile"}(n=e.DBlockVisualPartTileType||(e.DBlockVisualPartTileType={})),function(t){t[t.Random=0]="Random"}(o=e.DBlockVisualPartPlacementType||(e.DBlockVisualPartPlacementType={}));class c{constructor(t){this.index=t,this.type=a.Floor,this.tileType=n.Normal,this.tiles=[],this.height=1,this.placementType=o.Random}}e.DBlockVisualPart=c;e.DTemplateMap=class{constructor(t){this.id=t,this.name="null",this.mapId=0,this.parts=[new c(0)],this.partIndex=[],this.tilesetId=0,this.wallHeadAutoTileKind=0,this.wallEdgeAutoTileKind=0,this.floorAutoTileKind=0,this.itemShopFloorAutoTileKind=0}import(t){var e;this.tilesetId=t.tilesetId,this.wallHeadAutoTileKind=s.DHelpers.getAutotileKind(s.DHelpers.getMapTopTile(t,1,1)),this.wallEdgeAutoTileKind=s.DHelpers.getAutotileKind(s.DHelpers.getMapTopTile(t,1,2)),this.floorAutoTileKind=s.DHelpers.getAutotileKind(s.DHelpers.getMapTopTile(t,1,3)),this.itemShopFloorAutoTileKind=s.DHelpers.getAutotileKind(s.DHelpers.getMapTopTile(t,1,7));for(const i of t.events){if(!i)continue;const a=i.x,o=i.y,l=r.DAnnotationReader.readTemplatePartAttributeFromPage(i.pages[0]);if(!l)continue;if(!l.type)throw new Error("Invalid @MR-TemplatePart type");const h=new c(this.parts.length);let u;this.parts.push(h),h.type=this.toTemplateMapPartType(l.type),h.height=null!==(e=l.height)&&void 0!==e?e:1,l.placement&&(h.placementType=this.toTemplateMapPartPlacementType(l.placement));for(let e=0;e<h.height;e++){const i=s.DHelpers.getMapTopTile(t,a,o-e),r=s.DHelpers.isAutotile(i)?n.Autotile:n.Normal;if(void 0===u)u=r;else if(u!==r)throw new Error("Invalid tile kinds.");r==n.Autotile?h.tiles.push(s.DHelpers.getAutotileKind(i)):h.tiles.push(i)}h.tileType=null!=u?u:n.Normal,void 0===this.partIndex[h.type]?this.partIndex[h.type]=[h.index]:this.partIndex[h.type].push(h.index)}}toTemplateMapPartType(t){switch(t){case"Floor":return a.Floor;case"FloorDecoration":return a.FloorDecoration;case"Footpath":return a.Footpath;case"FootpathDecoration":return a.FootpathDecoration;case"Passageway":return a.Passageway;case"PassagewayDecoration":return a.PassagewayDecoration;case"Water":return a.Water;case"WaterDecoration":return a.WaterDecoration;case"ShopFloor":return a.ShopFloor;case"ShopFloorDecoration":return a.ShopFloorDecoration;case"Wall":return a.Wall;case"WallDecoration":return a.WallDecoration;case"HardWall":return a.HardWall;default:throw new Error(`Invalid type: ${t}.`)}}toTemplateMapPartPlacementType(t){if("Random"===t)return o.Random;throw new Error(`Invalid type: ${t}.`)}}},5712:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DFloorPreset=e.DTerrainSetting=e.DTerrainShape=e.FGenericRandomMapWayConnectionMode=e.DSectorConnectionPreset=void 0;const r=i(3609);var s,a;!function(t){t[t.Default=0]="Default",t[t.C=1]="C",t[t.H=2]="H"}(s=e.DSectorConnectionPreset||(e.DSectorConnectionPreset={})),function(t){t[t.SectionEdge=0]="SectionEdge",t[t.RoomEdge=1]="RoomEdge"}(a=e.FGenericRandomMapWayConnectionMode||(e.FGenericRandomMapWayConnectionMode={}));e.DTerrainShape=class{constructor(t){this.id=t,this.key="",this.width=r.paramRandomMapDefaultWidth,this.height=r.paramRandomMapDefaultHeight,this.divisionCountX=3,this.divisionCountY=3,this.roomCountMin=1/0,this.roomCountMax=1/0,this.wayConnectionMode=a.SectionEdge,this.connectionPreset=s.Default,this.forceRoomShapes=[]}};e.DTerrainSetting=class{constructor(t){this.id=t,this.key="",this.shapeRefs=[],this.structureDefs=[{typeName:"default",rate:5}],this.forceStructures=[],this.shopDefs=[{typeName:"default",rate:5}],this.monsterHouseDefs=[{typeName:"default",rate:5}]}};e.DFloorPreset=class{constructor(t){this.id=t,this.key="",this.terrains=[],this.monsterHouses=[]}}},3654:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DTextManager=void 0;const r=i(1298),s=i(9185);class a{static basic(t){return $dataSystem.terms.basic[t]||""}static param(t){if($dataSystem.terms.params[t])return $dataSystem.terms.params[t];{const e=s.MRData.parameters[t];return e?e.displayName:""}}static command(t){return $dataSystem.terms.commands[t]||""}static message(t){return $dataSystem.terms.messages[t]||""}static get level(){return this.basic(0)}static get exp(){return this.basic(8)}static get save(){return this.command(9)}static get obtainExp(){return this.message("obtainExp")}static get levelUp(){return this.message("levelUp")}static get actorDamage(){return this.message("actorDamage")}static get actorRecovery(){return this.message("actorRecovery")}static get actorDrain(){return this.message("actorDrain")}static get actorNoDamage(){return this.message("actorNoDamage")}static get actorGain(){return this.message("actorGain")}static get actorLoss(){return this.message("actorLoss")}static get actorNoHit(){return this.message("actorNoHit")}static get enemyDamage(){return this.message("enemyDamage")}static get enemyRecovery(){return this.message("enemyRecovery")}static get enemyDrain(){return this.message("enemyDrain")}static get enemyNoDamage(){return this.message("enemyNoDamage")}static get enemyGain(){return this.message("enemyGain")}static get enemyLoss(){return this.message("enemyLoss")}static get enemyNoHit(){return this.message("enemyNoHit")}static get buffAdd(){return this.message("buffAdd")}static get debuffAdd(){return this.message("debuffAdd")}static get buffRemove(){return this.message("buffRemove")}static get actionFailure(){return this.message("actionFailure")}static get currencyUnit(){return $dataSystem.currencyUnit}static weaponStrength(){return(0,r.tr2)("武器の強さ")}static shieldStrength(){return(0,r.tr2)("盾の強さ")}}e.DTextManager=a,a.score="スコア"},177:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DTrait=void 0;const r=i(1298),s=i(2213),a=i(4836),n=i(9185);e.DTrait=class{constructor(t,e){this.id=t,this.key=e}static parseTraitMetadata(t){const e=t["MR-Trait"];if(!e)return[];const i=e instanceof Array?e:[e],r=[];for(const t of i){const e=s.DHelpers.parseConstructionExpr(t);r.push({code:n.MRData.getTrait(e.name).id,dataId:this.parseDataId(e.args[0]),value:Number(e.args[1])})}return r}static parseDataId(t){if("string"==typeof t){const e=t.toLowerCase(),i=n.MRData.parameters.find((t=>t.code==e));if(i)return i.id;throw new Error((0,r.tr2)("Trait に指定されているパラメータ名 %1 は不正です。").format(t))}return Number(t)}static makeTraitData(t){switch(t.code){case"DeathVulnerableElement":return{code:n.MRData.getTrait("DeathVulnerableElement").id,dataId:n.MRData.getElement(t.elementKey).id,value:n.MRData.getState(t.stateKey).id};case"RaceRate":return{code:a.MRBasics.traits.RaceRate,dataId:n.MRData.getRace(t.raceKey).id,value:t.value};case"SurvivalParameterLossRate":return{code:a.MRBasics.traits.SurvivalParamLossRate,dataId:n.MRData.getParameter(t.parameterKey).id,value:t.value};case"ParameterDamageRate":return{code:a.MRBasics.traits.ParamDamageRate,dataId:n.MRData.getParameter(t.parameterKey).id,value:t.value};case"SkillGuard":return{code:a.MRBasics.traits.SkillGuard,dataId:n.MRData.getSkill(t.skillKey).id,value:0};case"Unknown":return{code:0,dataId:t.dataKey,value:t.value};default:throw new Error(`Trait code "${t.code}" unsupported.`)}}}},8914:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DTroop=void 0;e.DTroop=class{constructor(t){this.id=t,this.key="",this.members=[]}}},9929:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DValidationHelper=void 0;const r=i(1298);e.DValidationHelper=class{static makeDataName(t,e,i){return`<${t} ${e}:${i}>: `}static makeRmmzTroopName(t){const e=$dataTroops[t];return(0,r.tr2)("敵グループ(%1:%2)").format(e.id,e.name)}static makeRmmzEnemyName(t){const e=$dataEnemies[t];return(0,r.tr2)("敵キャラ(%1:%2)").format(e.id,e.name)}static makeRmmzMapName(t){const e=$dataMapInfos[t];return this.makeDataName("マップ",t,e?e.name:"???")}static makeRmmzEventName(t){return this.makeDataName("イベント",t.id,t.name)}}},4836:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MRBasics=e.DClarificationType=void 0,function(t){t[t.Unit=0]="Unit",t[t.Item=1]="Item",t[t.Trap=2]="Trap",t[t.Terrain=3]="Terrain",t[t.Sight=4]="Sight"}(e.DClarificationType||(e.DClarificationType={}));e.MRBasics=class{}},9185:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MRData=e.LandExitResult=void 0;const r=i(6413),s=i(8097),a=i(1855),n=i(1289),o=i(2633),c=i(8899),l=i(2020),h=i(8428),u=i(177),d=i(6539),p=i(6291),f=i(8336),m=i(4127),y=i(4746),_=i(8370),g=i(4659),v=i(5712),S=i(8068),M=i(4561),R=i(5545),b=i(62),E=i(5168),I=i(1869);!function(t){t[t.Challenging=100]="Challenging",t[t.Goal=200]="Goal",t[t.Escape=300]="Escape",t[t.Gameover=400]="Gameover",t[t.Abandoned=401]="Abandoned",t[t.InvalidSuspend=402]="InvalidSuspend"}(e.LandExitResult||(e.LandExitResult={}));class x{static reset(){this.chronus=new I.DChronus,this.categories=[new n.DEntityCategory(0,"null")],this.classes=[],this.newClass("null"),this.races=[new g.DRace(0)],this.actors=[0],this.enemies=[],this.lands=[],this.maps=[new R.DMap(0)],this.templateMaps=[new l.DTemplateMap(0)],this.factions=[],this.commands=[new S.DCommand(0,"null")],this.sequels=[{id:0,name:"null",parallel:!1,fluidSequence:!1}],this.parameters=[],this.effectBehaviors=[new E.DSpecialEffect(0,"null")],this.skills=[],this.items=[],this.states=[],this.prefabs=[new h.DPrefab(0)],this.entities=[new p.DEntity(0)],this.entityTemplates=[new b.DEntityTemplate(0,"null",{type:"null"})],this.emittors=[new y.DEmittor(0,"null")],this.effects=[new M.DEffect(0,"null")],this.terrainSettings=[new v.DTerrainSetting(0)],this.floorPresets=[new v.DFloorPreset(0)]}static newElement(t){const e=new _.DElement(this.races.length,t);return this.elements.push(e),e}static getElement(t){const e=this.elements.find((e=>""!=e.key&&e.key==t));if(e)return e;throw new Error(`AttackElement "${t}" not found.`)}static newEntityCategory(t,e=""){const i=new n.DEntityCategory(this.categories.length,t);return i.displayName=e,this.categories.push(i),i}static findEntityCategory(t){return this.findHelper(this.categories,t,(e=>e.key===t))}static getEntityCategory(t){const e=this.findEntityCategory(t);if(!e)throw new Error(`EntityCategory "${t}" not found.`);return e}static newClass(t){const e=this.classes.length,i=new s.DClass(e);return i.name=t,this.classes.push(i),e}static newRace(){const t=new g.DRace(this.races.length);return this.races.push(t),t}static findRace(t){const e=parseInt(t);return isNaN(e)?this.races.find((e=>""!=e.key&&e.key==t||e.name==t)):this.races[e]}static getRace(t){const e=this.findRace(t);if(e)return e;throw new Error(`Race "${t}" not found.`)}static newTemplateMap(){const t=this.templateMaps.length,e=new l.DTemplateMap(t);return this.templateMaps.push(e),e}static newCommand(t){const e=this.commands.length,i=new S.DCommand(e,t);return this.commands.push(i),i}static addSequel(t){const e=this.sequels.length;return this.sequels.push({id:e,name:t,parallel:!1,fluidSequence:!1}),e}static addParams(t,e){const i=new d.DParameter(this.parameters.length,t,e);return this.parameters.push(i),i}static getParameter(t){let e;if("number"==typeof t?e=this.parameters[t]:"string"==typeof t&&(e=this.parameters.find((e=>e.key==t))),e)return e;throw new Error(`Parameter "${t}" not found.`)}static newEntity(){const t=new p.DEntity(this.entities.length);return this.entities.push(t),t}static findEntity(t){const e=parseInt(t);return isNaN(e)?this.entities.find((e=>""!=e.entity.key&&e.entity.key==t)):this.entities[e]}static getEntity(t){const e=this.findEntity(t);if(e)return e;throw new Error(`Entity "${t}" not found.`)}static newEntityTemplate(t,e){const i=new b.DEntityTemplate(this.entityTemplates.length,t,e);return this.entityTemplates.push(i),i}static findEntityTemplate(t){return this.findHelper(this.entityTemplates,t,(e=>e.key===t))}static getEntityTemplate(t){const e=this.findEntityTemplate(t);if(e)return e;throw new Error(`EntityTemplate "${t}" not found.`)}static newPrefab(){const t=this.prefabs.length,e=new h.DPrefab(t);return this.prefabs.push(e),e}static newMap(){const t=this.maps.length,e=new R.DMap(t);return this.maps.push(e),e}static findMap(t){const e=parseInt(t);return isNaN(e)?this.maps.find((e=>""!=e.name&&e.name==t)):this.maps[e]}static getMap(t){const e=this.findMap(t);if(e)return e;throw new Error(`Map "${t}" not found.`)}static newEffect(t){const e=this.effects.length,i=new M.DEffect(e,t);return this.effects.push(i),i}static cloneEffect(t){const e=this.newEffect(t.key);return e.copyFrom(t),e}static findEffect(t){return this.findHelper(this.effects,t,(e=>e.key==t))}static getEffect(t){const e=this.findEffect(t);if(e)return e;throw new Error(`Effect "${t}" not found.`)}static newEmittor(t){const e=this.emittors.length,i=new y.DEmittor(e,t);return this.emittors.push(i),i}static cloneEmittor(t){const e=this.emittors.length,i=new y.DEmittor(e,t.effectSuite.selfEffect.effect.key);return i.copyFrom(t),this.emittors.push(i),i}static findEmittor(t){return this.findHelper(this.emittors,t,(e=>e.key==t))}static getEmittor(t){const e=this.findEmittor(t);if(e)return e;throw new Error(`Emittor "${t}" not found.`)}static getEmittorById(t){const e=this.emittors[t];if(e)return e;throw new Error(`Effect "${t}" not found.`)}static newTerrainShape(t){const e=this.terrainShapes.length,i=new v.DTerrainShape(e);return i.key=t,this.terrainShapes.push(i),i}static findTerrainShape(t){const e=parseInt(t);return isNaN(e)?this.terrainShapes.find((e=>""!=e.key&&e.key==t)):this.terrainShapes[e]}static getTerrainShape(t){const e=this.findTerrainShape(t);if(e)return e;throw new Error(`TerrainShape "${t}" not found.`)}static newTerrainSetting(t){const e=this.terrainSettings.length,i=new v.DTerrainSetting(e);return i.key=t,this.terrainSettings.push(i),i}static findTerrainSetting(t){const e=parseInt(t);return isNaN(e)?this.terrainSettings.find((e=>""!=e.key&&e.key==t)):this.terrainSettings[e]}static getTerrainSetting(t){const e=this.findTerrainSetting(t);if(e)return e;throw new Error(`TerrainSetting "${t}" not found.`)}static newFloorPreset(t){const e=this.floorPresets.length,i=new v.DFloorPreset(e);return i.key=t,this.floorPresets.push(i),i}static findFloorPreset(t){const e=parseInt(t);return isNaN(e)?this.floorPresets.find((e=>""!=e.key&&e.key==t)):this.floorPresets[e]}static getFloorPreset(t){const e=this.findFloorPreset(t);if(e)return e;throw new Error(`TerrainPreset "${t}" not found.`)}static newActor(){const t=x.newEntity(),e=new c.DActor(x.actors.length);return x.actors.push(e.id),t.actor=e,[t,e]}static actorEntity(t){return this.entities[this.enemies[t]]}static actorData(t){return this.actorEntity(t).actorData()}static findActor(t){const e=parseInt(t);if(isNaN(e)){const e=this.enemies.find((e=>{const i=this.entities[e];return i.display.name==t||""!=i.entity.key&&i.entity.key==t}));return e?this.entities[e].actorData():void 0}return this.entities[this.actors[e]].actorData()}static getActor(t){const e=this.findActor(t);if(e)return e;throw new Error(`Actor "${t}" not found.`)}static newEffectBehavior(t){const e=new E.DSpecialEffect(this.effectBehaviors.length,t);return this.effectBehaviors.push(e),e}static findSpecialEffect(t){return this.findHelper(this.effectBehaviors,t,(e=>e.key==t))}static getSpecialEffect(t){const e=this.findSpecialEffect(t);if(e)return e;throw new Error(`SpecialEffect "${t}" not found.`)}static newItem(){const t=x.newEntity(),e=new a.DItem(x.items.length,t.id);return x.items.push(t.id),t.itemData=e,[t,e]}static itemEntity(t){return this.entities[this.items[t]]}static itemData(t){return this.itemEntity(t).item()}static findItem(t){const e=parseInt(t);if(isNaN(e)){const e=this.items.find((e=>{const i=this.entities[e];return i.display.name==t||""!=i.entity.key&&i.entity.key==t}));return e?this.entities[e].item():void 0}return this.entities[this.items[e]].item()}static getItem(t){const e=this.findItem(t);if(e)return this.entities[e.entityId];throw new Error(`Item "${t}" not found.`)}static getItemFromRmmzWeaponId(t){const e=x.items[x.weaponDataIdOffset+t];return this.entities[e]}static getItemFromRmmzArmorId(t){const e=x.items[x.armorDataIdOffset+t];return this.entities[e]}static newEnemy(){const t=x.newEntity(),e=new o.DEnemy(x.enemies.length,t.id);return x.enemies.push(t.id),t.enemy=e,[t,e]}static enemyEntity(t){return this.entities[this.enemies[t]]}static enemyData(t){return this.enemyEntity(t).enemyData()}static findEnemy(t){const e=parseInt(t);if(isNaN(e)){const e=this.enemies.find((e=>{const i=this.entities[e];return i.display.name==t||""!=i.entity.key&&i.entity.key==t}));return e?this.entities[e].enemyData():void 0}return this.entities[this.enemies[e]].enemyData()}static getEnemy(t){const e=this.findEnemy(t);if(e)return e;throw new Error(`Enemy "${t}" not found.`)}static newTrait(t){const e=new u.DTrait(this.traits.length,t);return x.traits.push(e),e}static getTrait(t){const e=x.traits.find((e=>e&&e.key==t));if(e)return e;throw new Error(`Trait "${t}" not found.`)}static findPrefab(t){return this.prefabs.find((e=>e.key==t))}static getPrefab(t){const e=this.findPrefab(t);if(e)return e;throw new Error(`Prefab "${t}" not found.`)}static findState(t){const e=parseInt(t);return isNaN(e)?this.states.find((e=>e.displayName==t||""!=e.key&&e.key==t)):this.states[e]}static getState(t){const e=this.findState(t);if(e)return e;throw new Error(`State "${t}" not found.`)}static findMonsterHouse(t){const e=parseInt(t);return isNaN(e)?this.monsterHouses.find((e=>e.name==t)):this.monsterHouses[e]}static getMonsterHouse(t){const e=this.findMonsterHouse(t);if(e)return e;throw new Error(`MonsterHouse "${t}" not found.`)}static newSkillAsActivity(t,e,i){const s=new r.DSkill(this.skills.length,t);return s.name=e,s.priority=null!=i?i:0,s.isActivity=!0,x.skills.push(s),s}static findSkill(t){const e=parseInt(t);return isNaN(e)?this.skills.find((e=>e.name==t||""!=e.key&&e.key==t)):this.skills[e]}static getSkill(t){const e=this.findSkill(t);if(e)return e;throw new Error(`Skill "${t}" not found.`)}static verify(){this.entities.forEach((t=>t.verify()))}static findHelper(t,e,i){const r=parseInt(e);return isNaN(r)?t.find(i):t[r]}}e.MRData=x,x.MAX_DUNGEON_FLOORS=100,x.testMode=!1,x.NormalAttackSkillId=1,x.ext=new m.MRDataExtension,x.elements=[],x.equipmentParts=[],x.categories=[],x.classes=[],x.races=[],x.actors=[],x.enemies=[],x.lands=[],x.maps=[],x.templateMaps=[],x.factions=[],x.commands=[],x.sequels=[{id:0,name:"null",parallel:!1,fluidSequence:!1}],x.parameters=[],x.effectBehaviors=[],x.skills=[],x.items=[],x.traits=[],x.states=[],x.stateGroups=[],x.abilities=[],x.monsterHouses=[],x.itemShops=[],x.prefabs=[],x.entities=[],x.entityTemplates=[],x.troops=[],x.emittors=[],x.effects=[],x.terrainShapes=[],x.terrainSettings=[],x.floorPresets=[],x.pseudonymous=new f.DPseudonymous,x.itemDataIdOffset=0,x.weaponDataIdOffset=0,x.armorDataIdOffset=0,x._behaviorFactories=[]},4127:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MRDataExtension=void 0;e.MRDataExtension=class{onDatabaseLoaded(){}}},3758:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.MRDataManager=void 0;const s=r(i(7147)),a=i(9115),n=i(1298),o=i(9185),c=i(4836),l=i(6189),h=i(9394),u=i(9782),d=i(8516),p=i(2255),f=i(2213),m=i(8428),y=i(1855),_=i(177),g=i(4561),v=i(6543),S=i(6413),M=i(8914),R=i(3201),b=i(9547),E=i(6539),I=i(9873),x=i(2633),w=i(3654),T=i(927),D=i(8767),P=i(7979),A=i(5712),k=i(3609),C=i(6882),L=i(2779),B=i(5739),F=i(9929),O=i(5545),N=i(5117);class j{static load(){if(this._loadTasks=[],this._loadTasks.push((t=>this.setupCommonData(t))),this._loadTasks.push((t=>this.loadData(t))),this._loadTasks.push((t=>this.importTerrainSettings(t))),this._loadTasks.push((t=>this.importFloorPreset(t))),this._loadTasks.push((t=>this.importLandAndFloors(t))),this._loadTasks.push((t=>this.importPseudonymous(t))),this._loadTasks.push((t=>this.importPrefabs(t))),this._loadTasks.push((t=>this.importLandDatabase(t))),this._loadTasks.push((t=>this.importTemplateMaps(t))),this._loadTasks.push((t=>this.importSetupScript(t))),f.DHelpers.isNode())for(this._currentTask=this._loadTasks.shift();this._currentTask;){const t=this._currentTask;this._currentTask=void 0,t((()=>this.nextFunc()))}else this._currentTask=this._loadTasks.shift(),(0,n.assert)(this._currentTask),this._currentTask(this.nextFunc)}static isImportCompleted(){return null==this._currentTask&&this._loadingDataFileCount==this._loadedDataFileCount}static nextFunc(){this._loadTasks.length>0?this._currentTask=this._loadTasks.shift():this._currentTask=void 0}static setupCommonData(t){o.MRData.reset(),c.MRBasics.events={roomEnterd:1,roomLeaved:2,preWalk:3,walked:4,prePut:5,effectReacted:6,skillEmitted:7,itemRemovedFromInventory:8},o.MRData.parameters=[E.DParameter.makeBuiltin(0,"null","null","null",-1,0,0,1/0,!1),E.DParameter.makeBuiltin(1,"hp","HP",(0,n.tr2)("最大HP"),0,0,0,1/0,!0),E.DParameter.makeBuiltin(2,"mp","MP",(0,n.tr2)("最大MP"),1,0,0,1/0,!0),E.DParameter.makeBuiltin(3,"atk","ATK",(0,n.tr2)("最大ATK"),2,0,0,1/0,!0),E.DParameter.makeBuiltin(4,"def","DEF",(0,n.tr2)("最大DEF"),3,0,0,1/0,!0),E.DParameter.makeBuiltin(5,"mat","MAT",(0,n.tr2)("最大MAT"),4,0,0,1/0,!0),E.DParameter.makeBuiltin(6,"mdf","MDF",(0,n.tr2)("最大MDF"),5,0,0,1/0,!0),E.DParameter.makeBuiltin(7,"agi","AGI",(0,n.tr2)("最大AGI"),6,0,-100,200,!0),E.DParameter.makeBuiltin(8,"luk","LUK",(0,n.tr2)("最大LUK"),7,0,0,1/0,!0),E.DParameter.makeBuiltin(9,"tp","TP",(0,n.tr2)("最大TP"),8,0,0,1/0,!0),E.DParameter.makeBuiltin(10,"fp",(0,n.tr2)("満腹度"),(0,n.tr2)("最大満腹度"),-1,1e4,0,1/0,!0),E.DParameter.makeBuiltin(11,"pow",(0,n.tr2)("ちから"),(0,n.tr2)("ちからの最大値"),-1,8,0,1/0,!0),E.DParameter.makeBuiltin(12,"upg",(0,n.tr2)("つよさ"),(0,n.tr2)("つよさの最大値"),-1,99,-1/0,1/0,!1),E.DParameter.makeBuiltin(13,"rem",(0,n.tr2)("回数"),(0,n.tr2)("最大回数"),-1,99,0,1/0,!1),E.DParameter.makeBuiltin(14,"cap","Capacity",(0,n.tr2)("最大容量"),-1,8,0,1/0,!1),E.DParameter.makeBuiltin(15,"gold","Gold",(0,n.tr2)("最大ゴールド"),-1,999999,10,1/0,!1),E.DParameter.makeBuiltin(16,"level",(0,n.tr2)("レベル"),(0,n.tr2)("レベル"),-1,99,1,1/0,!1),E.DParameter.makeBuiltin(17,"exp",(0,n.tr2)("経験値"),(0,n.tr2)("最大経験値"),-1,9999999,0,1/0,!1)],c.MRBasics.params={hp:o.MRData.parameters.findIndex((t=>"hp"==t.code)),mp:o.MRData.parameters.findIndex((t=>"mp"==t.code)),atk:o.MRData.parameters.findIndex((t=>"atk"==t.code)),def:o.MRData.parameters.findIndex((t=>"def"==t.code)),mat:o.MRData.parameters.findIndex((t=>"mat"==t.code)),mdf:o.MRData.parameters.findIndex((t=>"mdf"==t.code)),agi:o.MRData.parameters.findIndex((t=>"agi"==t.code)),luk:o.MRData.parameters.findIndex((t=>"luk"==t.code)),tp:o.MRData.parameters.findIndex((t=>"tp"==t.code)),fp:o.MRData.parameters.findIndex((t=>"fp"==t.code)),pow:o.MRData.parameters.findIndex((t=>"pow"==t.code)),upgradeValue:o.MRData.parameters.findIndex((t=>"upg"==t.code)),remaining:o.MRData.parameters.findIndex((t=>"rem"==t.code)),capacity:o.MRData.parameters.findIndex((t=>"cap"==t.code)),gold:o.MRData.parameters.findIndex((t=>"gold"==t.code)),level:o.MRData.parameters.findIndex((t=>"level"==t.code)),exp:o.MRData.parameters.findIndex((t=>"exp"==t.code))},(0,n.assert)(0===o.MRData.parameters[c.MRBasics.params.hp].battlerParamId),(0,n.assert)(1===o.MRData.parameters[c.MRBasics.params.mp].battlerParamId),(0,n.assert)(2===o.MRData.parameters[c.MRBasics.params.atk].battlerParamId),(0,n.assert)(3===o.MRData.parameters[c.MRBasics.params.def].battlerParamId),(0,n.assert)(4===o.MRData.parameters[c.MRBasics.params.mat].battlerParamId),(0,n.assert)(5===o.MRData.parameters[c.MRBasics.params.mdf].battlerParamId),(0,n.assert)(6===o.MRData.parameters[c.MRBasics.params.agi].battlerParamId),(0,n.assert)(7===o.MRData.parameters[c.MRBasics.params.luk].battlerParamId),o.MRData.parameters[c.MRBasics.params.fp].magnification=.01,o.MRData.parameters[c.MRBasics.params.fp].friendlySideMessages=[{condition:"value >= max",message:(0,n.tr)("%1はおなかがいっぱいになった。")},{condition:"value < max",message:(0,n.tr)("%1はおなかがふくれた。")}],o.MRData.parameters[c.MRBasics.params.pow].selfGainMessage=w.DTextManager.actorGain,o.MRData.parameters[c.MRBasics.params.pow].selfLossMessage=w.DTextManager.actorLoss,o.MRData.parameters[c.MRBasics.params.pow].targetGainMessage=w.DTextManager.actorGain,o.MRData.parameters[c.MRBasics.params.pow].targetLossMessage=w.DTextManager.enemyLoss,o.MRData.parameters[c.MRBasics.params.upgradeValue].selfGainMessage=w.DTextManager.actorGain,o.MRData.parameters[c.MRBasics.params.upgradeValue].selfLossMessage=w.DTextManager.actorLoss,o.MRData.parameters[c.MRBasics.params.upgradeValue].targetGainMessage=w.DTextManager.actorGain,o.MRData.parameters[c.MRBasics.params.upgradeValue].targetLossMessage=w.DTextManager.enemyLoss,o.MRData.parameters[c.MRBasics.params.level].initialValue=1,o.MRData.parameters[c.MRBasics.params.level].allowDamage=!1,o.MRData.parameters[c.MRBasics.params.level].initialIdealValue=0,o.MRData.parameters[c.MRBasics.params.level].maxEffortLimit=99,o.MRData.parameters[c.MRBasics.params.exp].initialValue=0,o.MRData.parameters[c.MRBasics.params.level].selfGainMessage=w.DTextManager.levelUp,o.MRData.parameters[c.MRBasics.params.level].targetGainMessage=w.DTextManager.levelUp,o.MRData.parameters[c.MRBasics.params.level].messageValueSource=E.DParamMessageValueSource.Absolute;for(const t of o.MRData.parameters)b.MRSetup.setupParameter(t);c.MRBasics.entityCategories={actor:o.MRData.newEntityCategory("kEntityCategory_Actor","Actor").id,WeaponKindId:o.MRData.newEntityCategory("kEntityCategory_Weapon","武器").id,ShieldKindId:o.MRData.newEntityCategory("kEntityCategory_Shield","盾").id,armor:o.MRData.newEntityCategory("kEntityCategory_Armor","盾").id,ArrowKindId:o.MRData.newEntityCategory("kEntityCategory_Arrow","矢").id,BraceletKindId:o.MRData.newEntityCategory("kEntityCategory_Ring","腕輪").id,FoodKindId:o.MRData.newEntityCategory("kEntityCategory_Food","食料").id,grass:o.MRData.newEntityCategory("kEntityCategory_Grass","草").id,ScrollKindId:o.MRData.newEntityCategory("kEntityCategory_Scroll","巻物").id,WandKindId:o.MRData.newEntityCategory("kEntityCategory_Staff","杖").id,PotKindId:o.MRData.newEntityCategory("kEntityCategory_Pot","壺").id,DiscountTicketKindId:o.MRData.newEntityCategory("kEntityCategory_DiscountTicket","割引券").id,BuildingMaterialKindId:o.MRData.newEntityCategory("kEntityCategory_BuildingMaterial","材料").id,TrapKindId:o.MRData.newEntityCategory("kEntityCategory_Trap","罠").id,FigurineKindId:o.MRData.newEntityCategory("kEntityCategory_Figurine","土偶").id,MonsterKindId:o.MRData.newEntityCategory("kEntityCategory_Enemy","モンスター").id,entryPoint:o.MRData.newEntityCategory("kEntityCategory_EntryPoint","入り口").id,exitPoint:o.MRData.newEntityCategory("kEntityCategory_ExitPoint","出口").id,Ornament:o.MRData.newEntityCategory("kEntityCategory_Ornament","Ornament").id},c.MRBasics.xparams={hit:0,eva:1,cri:2,cev:3,mev:4,mrf:5,cnt:6,hrg:7,mrg:8,trg:9},c.MRBasics.sparams={tgr:0,grd:1,rec:2,pha:3,mcr:4,tcr:5,pdr:6,mdr:7,fdr:8,exr:9},o.MRData.traits=[],c.MRBasics.traits={},o.MRData.traits[11]=new _.DTrait(11,"TRAIT_ELEMENT_RATE"),c.MRBasics.traits.TRAIT_ELEMENT_RATE=11,o.MRData.traits[12]=new _.DTrait(12,"TRAIT_DEBUFF_RATE"),c.MRBasics.traits.TRAIT_DEBUFF_RATE=12,o.MRData.traits[13]=new _.DTrait(13,"TRAIT_STATE_RATE"),c.MRBasics.traits.TRAIT_STATE_RATE=13,o.MRData.traits[14]=new _.DTrait(14,"TRAIT_STATE_RESIST"),c.MRBasics.traits.TRAIT_STATE_RESIST=14,o.MRData.traits[21]=new _.DTrait(21,"TRAIT_PARAM"),c.MRBasics.traits.TRAIT_PARAM=21,o.MRData.traits[22]=new _.DTrait(22,"TRAIT_XPARAM"),c.MRBasics.traits.TRAIT_XPARAM=22,o.MRData.traits[23]=new _.DTrait(23,"TRAIT_SPARAM"),c.MRBasics.traits.TRAIT_SPARAM=23,o.MRData.traits[31]=new _.DTrait(31,"TRAIT_ATTACK_ELEMENT"),c.MRBasics.traits.TRAIT_ATTACK_ELEMENT=31,o.MRData.traits[32]=new _.DTrait(32,"TRAIT_ATTACK_STATE"),c.MRBasics.traits.TRAIT_ATTACK_STATE=32,o.MRData.traits[33]=new _.DTrait(33,"TRAIT_ATTACK_SPEED"),c.MRBasics.traits.TRAIT_ATTACK_SPEED=33,o.MRData.traits[34]=new _.DTrait(34,"TRAIT_ATTACK_TIMES"),c.MRBasics.traits.TRAIT_ATTACK_TIMES=34,o.MRData.traits[35]=new _.DTrait(35,"TRAIT_ATTACK_SKILL"),c.MRBasics.traits.TRAIT_ATTACK_SKILL=35,o.MRData.traits[41]=new _.DTrait(41,"TRAIT_STYPE_ADD"),c.MRBasics.traits.TRAIT_STYPE_ADD=41,o.MRData.traits[42]=new _.DTrait(42,"TRAIT_STYPE_SEAL"),c.MRBasics.traits.TRAIT_STYPE_SEAL=42,o.MRData.traits[43]=new _.DTrait(43,"TRAIT_SKILL_ADD"),c.MRBasics.traits.TRAIT_SKILL_ADD=43,o.MRData.traits[44]=new _.DTrait(44,"TRAIT_SKILL_SEAL"),c.MRBasics.traits.TRAIT_SKILL_SEAL=44,o.MRData.traits[51]=new _.DTrait(51,"TRAIT_EQUIP_WTYPE"),c.MRBasics.traits.TRAIT_EQUIP_WTYPE=51,o.MRData.traits[52]=new _.DTrait(52,"TRAIT_EQUIP_ATYPE"),c.MRBasics.traits.TRAIT_EQUIP_ATYPE=52,o.MRData.traits[53]=new _.DTrait(53,"TRAIT_EQUIP_LOCK"),c.MRBasics.traits.TRAIT_EQUIP_LOCK=53,o.MRData.traits[54]=new _.DTrait(54,"TRAIT_EQUIP_SEAL"),c.MRBasics.traits.TRAIT_EQUIP_SEAL=54,o.MRData.traits[55]=new _.DTrait(55,"TRAIT_SLOT_TYPE"),c.MRBasics.traits.TRAIT_SLOT_TYPE=55,o.MRData.traits[61]=new _.DTrait(61,"TRAIT_ACTION_PLUS"),c.MRBasics.traits.TRAIT_ACTION_PLUS=61,o.MRData.traits[62]=new _.DTrait(62,"TRAIT_SPECIAL_FLAG"),c.MRBasics.traits.TRAIT_SPECIAL_FLAG=62,o.MRData.traits[63]=new _.DTrait(63,"TRAIT_COLLAPSE_TYPE"),c.MRBasics.traits.TRAIT_COLLAPSE_TYPE=63,o.MRData.traits[64]=new _.DTrait(64,"TRAIT_PARTY_ABILITY"),c.MRBasics.traits.TRAIT_PARTY_ABILITY=64,c.MRBasics.traits._separator=o.MRData.newTrait("_separator").id,c.MRBasics.traits.CertainDirectAttack=o.MRData.newTrait("CertainDirectAttack").id,c.MRBasics.traits.DodgePhysicalIndirectAttack=o.MRData.newTrait("CartailDodgePhysicalAttack").id,c.MRBasics.traits.AwfulPhysicalIndirectAttack=o.MRData.newTrait("AwfulPhysicalIndirectAttack").id,c.MRBasics.traits.UnitVisitor=o.MRData.newTrait("UnitVisitor").id,c.MRBasics.traits.StateRemoveByEffect=o.MRData.newTrait("StateRemoveByEffect").id,c.MRBasics.traits.Stackable=o.MRData.newTrait("Stackable").id,c.MRBasics.traits.EffectProficiency=o.MRData.newTrait("EffectProficiency").id,c.MRBasics.traits.EquipmentProficiency=o.MRData.newTrait("EquipmentProficiency").id,c.MRBasics.traits.SealActivity=o.MRData.newTrait("SealActivity").id,c.MRBasics.traits.SealSpecialAbility=o.MRData.newTrait("SealSpecialAbility").id,c.MRBasics.traits.Invisible=o.MRData.newTrait("Invisible").id,c.MRBasics.traits.ForceVisible=o.MRData.newTrait("ForceVisible").id,c.MRBasics.traits.ItemDropRate=o.MRData.newTrait("ItemDropRate").id,c.MRBasics.traits.FixedDamage=o.MRData.newTrait("FixedDamage").id,c.MRBasics.traits.DrawInTrap=o.MRData.newTrait("DrawInTrap").id,c.MRBasics.traits.AwakeStep=o.MRData.newTrait("AwakeStep").id,c.MRBasics.traits.SilentStep=o.MRData.newTrait("SilentStep").id,c.MRBasics.traits.SuddenSkillEffect=o.MRData.newTrait("AutoSkillEffect").id,c.MRBasics.traits.SurvivalParamLossRate=o.MRData.newTrait("SurvivalParamLossRate").id,c.MRBasics.traits.ParamDamageRate=o.MRData.newTrait("ParamDamageRate").id,c.MRBasics.traits.SkillGuard=o.MRData.newTrait("SkillGuard").id,c.MRBasics.traits.DisableTrap=o.MRData.newTrait("DisableTrap").id,c.MRBasics.traits.ElementedRecoveryRate=o.MRData.newTrait("ElementedRecoverRate").id,c.MRBasics.traits.RaceRate=o.MRData.newTrait("RaceRate").id,c.MRBasics.traits.PhysicalProjectileReflector=o.MRData.newTrait("PhysicalProjectileReflector").id,c.MRBasics.traits.PenetrationItem=o.MRData.newTrait("PenetrationItem").id,c.MRBasics.traits.PenetrationThrower=o.MRData.newTrait("PenetrationThrower").id,c.MRBasics.traits.DeathVulnerableElement=o.MRData.newTrait("DeathVulnerableElement").id,c.MRBasics.traits.ForceParameter=o.MRData.newTrait("ForceParameter").id,o.MRData.factions=[{id:0,name:"",schedulingOrder:9999,hostileBits:0,friendBits:0},{id:1,name:"Friends",schedulingOrder:1,hostileBits:4,friendBits:0},{id:2,name:"Enemy",schedulingOrder:2,hostileBits:2,friendBits:0},{id:3,name:"Neutral",schedulingOrder:3,hostileBits:0,friendBits:0}],c.MRBasics.commands={testPickOutItem:o.MRData.newCommand("testPickOutItem").id,testPutInItem:o.MRData.newCommand("testPutInItem").id},c.MRBasics.sequels={idle:o.MRData.addSequel("idle"),MoveSequel:o.MRData.addSequel("Move"),blowMoveSequel:o.MRData.addSequel("BlowMove"),dropSequel:o.MRData.addSequel("BlowMove"),attack:o.MRData.addSequel("attack"),CollapseSequel:o.MRData.addSequel("Collapse"),commonStopped:o.MRData.addSequel("commonStopped"),asleep:o.MRData.addSequel("asleep"),escape:o.MRData.addSequel("escape"),earthquake2:o.MRData.addSequel("earthquake2"),useItem:o.MRData.addSequel("useItem"),explosion:o.MRData.addSequel("explosion"),down:o.MRData.addSequel("down"),warp:o.MRData.addSequel("warp"),stumble:o.MRData.addSequel("stumble"),jump:o.MRData.addSequel("stumble")},o.MRData.sequels[c.MRBasics.sequels.MoveSequel].parallel=!0,o.MRData.sequels[c.MRBasics.sequels.MoveSequel].fluidSequence=!0,o.MRData.sequels[c.MRBasics.sequels.CollapseSequel].parallel=!0,o.MRData.sequels[c.MRBasics.sequels.stumble].parallel=!0,o.MRData.sequels[c.MRBasics.sequels.dropSequel].parallel=!0,o.MRData.sequels[c.MRBasics.sequels.jump].parallel=!0,o.MRData.monsterHouses=[{id:0,name:"null",bgm:{name:"",pan:0,pitch:100,volume:90}},{id:1,name:"Fixed",bgm:{name:"Battle4",pan:0,pitch:100,volume:90}},{id:2,name:"Default",bgm:{name:"Battle4",pan:0,pitch:100,volume:90}}],c.MRBasics.monsterHouses={fixed:1,normal:2},o.MRData.itemShops=[{id:0,name:"null",bgm:{name:"",pan:0,pitch:100,volume:90}},{id:1,name:"Fixed",bgm:{name:"Battle4",pan:0,pitch:100,volume:90}},{id:2,name:"Default",bgm:{name:"Battle4",pan:0,pitch:100,volume:90}}],c.MRBasics.itemShops={fixed:1,normal:2},c.MRBasics.effectBehaviors={itemSteal:o.MRData.newEffectBehavior("ItemSteal").id,goldSteal:o.MRData.newEffectBehavior("GoldSteal").id,levelDown:o.MRData.newEffectBehavior("LevelDown").id,randomWarp:o.MRData.newEffectBehavior("RandomWarp").id,stumble:o.MRData.newEffectBehavior("Stumble").id,transferToNextFloor:o.MRData.newEffectBehavior("TransferToNextFloor").id,transferToLowerFloor:o.MRData.newEffectBehavior("TransferToLowerFloor").id,trapProliferation:o.MRData.newEffectBehavior("TrapProliferation").id,dispelEquipments:o.MRData.newEffectBehavior("DispelEquipments").id,changeInstance:o.MRData.newEffectBehavior("ChangeInstance").id,restartFloor:o.MRData.newEffectBehavior("RestartFloor").id,clarification:o.MRData.newEffectBehavior("Clarification").id,division:o.MRData.newEffectBehavior("Division").id,addState:o.MRData.newEffectBehavior("AddState").id,removeState:o.MRData.newEffectBehavior("RemoveState").id,removeStatesByIntentions:o.MRData.newEffectBehavior("RemoveStatesByIntentions").id,performeSkill:o.MRData.newEffectBehavior("PerformeSkill").id},o.MRData.newEntityTemplate("kEntityTemplate_Weapon",{type:"Weapon"}),o.MRData.newEntityTemplate("kEntityTemplate_Shield",{type:"Shield"}),o.MRData.newEntityTemplate("kEntityTemplate_Armor",{type:"Armor"}),o.MRData.newEntityTemplate("kEntityTemplate_Accessory",{type:"Accessory"}),o.MRData.newEntityTemplate("kEntityTemplate_Grass",{type:"Grass",recoverFP:500}),o.MRData.newEntityTemplate("kEntityTemplate_Food",{type:"Food"});o.MRData.newTerrainShape("kTerrainShape_Default").wayConnectionMode=A.FGenericRandomMapWayConnectionMode.SectionEdge;o.MRData.newTerrainShape("kTerrainShape_SimpleDefault").wayConnectionMode=A.FGenericRandomMapWayConnectionMode.RoomEdge;{const t=o.MRData.newTerrainShape("kTerrainShape_Small2x2");t.width=Math.floor(k.paramRandomMapDefaultWidth*(2/3)),t.height=Math.floor(k.paramRandomMapDefaultHeight*(2/3)),t.divisionCountX=2,t.divisionCountY=2,t.roomCountMin=3,t.roomCountMax=4}{const t=o.MRData.newTerrainShape("kTerrainShape_GreatHall");t.divisionCountX=1,t.divisionCountY=1,t.forceRoomShapes=[{typeName:"FullPlane"}]}{const t=o.MRData.newTerrainShape("kTerrainShape_HalfHall");t.divisionCountX=1,t.divisionCountY=1,t.forceRoomShapes=[{typeName:"HalfPlane"}]}{const t=o.MRData.newTerrainShape("kTerrainShape_C");t.divisionCountX=3,t.divisionCountY=3,t.connectionPreset=A.DSectorConnectionPreset.C}{const t=o.MRData.newTerrainShape("kTerrainShape_H");t.divisionCountX=3,t.divisionCountY=3,t.connectionPreset=A.DSectorConnectionPreset.H}c.MRBasics.defaultTerrainPresetId=1,t()}static loadData(t){var e,i,r,s,p;o.MRData.system=new v.DSystem,o.MRData.elements=[];for(const t of $dataSystem.elements){const e=t.split("##");let i=t,r=t;2==e.length&&(r=e[0],i=e[1]);o.MRData.newElement(i).name=r}c.MRBasics.variables={result:$dataSystem.variables.findIndex((t=>"MR-CommndResult1"==t)),landExitResult:$dataSystem.variables.findIndex((t=>"MR-ExitResult"==t)),landExitResultDetail:$dataSystem.variables.findIndex((t=>"MR-ExitResultDetail"==t))},c.MRBasics.elements={explosion:o.MRData.getElement("kElement_Explosion").id},$dataSystem.equipTypes&&(o.MRData.equipmentParts=$dataSystem.equipTypes.map(((t,e)=>t?{id:e,name:t}:h.DEquipmentType_Default))),o.MRData.stateGroups=[new R.DStateGroup(0)];for(const t of $dataStates){const a=new l.DState(o.MRData.states.length);if(o.MRData.states.push(a),t){const n=D.DMetadataParser.parse(t.meta);if("StateGroup"==n.type){const e=new R.DStateGroup(o.MRData.stateGroups.length);e.name=t.name,e.key=n.key,o.MRData.stateGroups.push(e),b.MRSetup.setupDirectly_StateGroup(e)}else a.key=n.key,a.displayName=t.name,a.effect.restriction=l.DStateRestriction.fromRmmzRestriction(t.restriction),a.iconIndex=null!==(e=t.iconIndex)&&void 0!==e?e:0,a.priority=t.priority,a.message1=null!==(i=t.message1)&&void 0!==i?i:"",a.message2=null!==(r=t.message2)&&void 0!==r?r:"",a.message3=null!==(s=t.message3)&&void 0!==s?s:"",a.message4=null!==(p=t.message4)&&void 0!==p?p:"",a.effect.behaviors=n.behaviors,a.effect.traits=t.traits.concat(n.traits),t.removeByDamage&&a.effect.damageRemovels.push({paramId:c.MRBasics.params.hp,chance:t.chanceByDamage}),a.import(t)}}c.MRBasics.states={dead:1,nap:o.MRData.getState("kState_System_kNap").id,trapPerformed:o.MRData.getState("kState_System_TrapPerformed").id,monsterHouseSleepStateId:o.MRData.getState("kState_System_kNap").id},o.MRData.abilities=$dataStates.filter((t=>!t||t.meta&&"Ability"==t.meta["MR-Type"])).map(((t,e)=>{if(t){const i={id:e,key:t.meta["MR-Key"].trim(),reactions:[]};return Object.keys(t.meta).forEach((e=>{e.startsWith("RE-Reaction.")&&i.reactions.push({command:e.substr(12),script:t.meta[e]})})),i}return(0,u.DAbility_Default)()})),$dataClasses.forEach((t=>{var e,i,r,s,a;if(t){const n=D.DMetadataParser.parse(t.meta);if("Race"==n.type){const i=o.MRData.newRace();i.key=n.key,i.name=t.name,i.traits=null!==(e=t.traits)&&void 0!==e?e:[]}else{const e=o.MRData.newClass(null!==(i=t.name)&&void 0!==i?i:"null"),n=o.MRData.classes[e];n.expParams=null!==(r=t.expParams)&&void 0!==r?r:[],n.params=null!==(s=t.params)&&void 0!==s?s:[],n.traits=null!==(a=t.traits)&&void 0!==a?a:[],n.learnings=t.learnings}}})),c.MRBasics.defaultEnemyClass=o.MRData.classes[9].id;for(const t of o.MRData.races)b.MRSetup.setupRace(t);$dataActors.forEach((t=>{if(t){const[e,i]=o.MRData.newActor();e.display.name=t.name,e.entity=(0,d.parseMetaToEntityProperties)(t.meta),e.factionId=o.MRData.system.factions.neutral,e.selfTraits=t.traits.slice(),e.classId=t.classId,i.setup(t)}})),o.MRData.entities[o.MRData.actors[1]].factionId=o.MRData.system.factions.player,o.MRData.skills=[new S.DSkill(0,"null")],$dataSkills.forEach((t=>{var e,i;if(t){const r=D.DMetadataParser.parse(t.meta),s=new S.DSkill(o.MRData.skills.length,r.key);o.MRData.skills.push(s),(0,n.assert)(t.id==s.id),"Activity"==r.type&&(s.isActivity=!0);const a=o.MRData.newEmittor(s.key),l=o.MRData.newEffect(s.key);l.critical=!1,l.successRate=t.successRate,l.hitType=t.hitType,l.rmmzSpecialEffectQualifyings=t.effects,a.targetAreaAnimationId=t.animationId,a.costs.setParamCost(g.DSkillCostSource.Actor,c.MRBasics.params.mp,{type:g.DParamCostType.Decrease,value:t.mpCost}),a.costs.setParamCost(g.DSkillCostSource.Actor,c.MRBasics.params.tp,{type:g.DParamCostType.Decrease,value:t.tpCost}),t.damage.type>0&&l.parameterQualifyings.push(this.makeParameterQualifying(t.damage)),a.effectSuite.addTargetEffect(new N.DEffectRef(l.id)),s.name=t.name,s.emittorId=a.id,s.rmmzEffectScope=null!==(e=t.scope)&&void 0!==e?e:g.DRmmzEffectScope.None;const h=[];t.message1&&h.push(t.message1),t.message2&&h.push(t.message2);(new B.DFlavorEffect).text=h,a.setupFromRmmzScope(null!==(i=t.scope)&&void 0!==i?i:g.DRmmzEffectScope.None)}})),c.MRBasics.actions={DirectionChangeActionId:o.MRData.newSkillAsActivity("kAction_DirectionChange","DirectionChange").id,MoveToAdjacentActionId:o.MRData.getSkill("kSkill_System_Move").id,PickActionId:o.MRData.newSkillAsActivity("kAction_Pick","拾う").id,PutActionId:o.MRData.newSkillAsActivity("kAction_Put","置く").id,ExchangeActionId:o.MRData.newSkillAsActivity("kAction_Exchange","交換").id,ThrowActionId:o.MRData.newSkillAsActivity("kAction_Throw","投げる").id,FlungActionId:o.MRData.newSkillAsActivity("kAction_Flung","Flung").id,ShootActionId:o.MRData.newSkillAsActivity("kAction_Shoot","撃つ",1e3).id,AffectActionId:o.MRData.newSkillAsActivity("kAction_Affect","Affect").id,RollActionId:o.MRData.newSkillAsActivity("kAction_Roll","Roll").id,FallActionId:o.MRData.newSkillAsActivity("kAction_Fall","Fall").id,DropActionId:o.MRData.newSkillAsActivity("kAction_Drop","Drop").id,trample:o.MRData.newSkillAsActivity("kAction_Trample","踏む").id,TrashActionId:o.MRData.newSkillAsActivity("kAction_Trash","Trash").id,ForwardFloorActionId:o.MRData.newSkillAsActivity("kAction_ForwardFloor","すすむ").id,BackwardFloorActionId:o.MRData.newSkillAsActivity("kAction_BackwardFloor","戻る").id,EquipActionId:o.MRData.newSkillAsActivity("kAction_Equip","装備",1e3).id,EquipOffActionId:o.MRData.newSkillAsActivity("kAction_EquipOff","はずす").id,EatActionId:o.MRData.newSkillAsActivity("kAction_Eat","食べる",1e3).id,TakeActionId:o.MRData.newSkillAsActivity("kAction_Take","Take").id,BiteActionId:o.MRData.newSkillAsActivity("kAction_Bite","Bite").id,ReadActionId:o.MRData.newSkillAsActivity("kAction_Read","読む",1e3).id,WaveActionId:o.MRData.newSkillAsActivity("kAction_Wave","振る",1e3).id,PushActionId:o.MRData.newSkillAsActivity("kAction_Push","Push").id,PutInActionId:o.MRData.newSkillAsActivity("kAction_PutIn","PickIn").id,PickOutActionId:o.MRData.newSkillAsActivity("kAction_PickOut","PickOut").id,IdentifyActionId:o.MRData.newSkillAsActivity("kAction_Identify","Identify").id,talk:o.MRData.newSkillAsActivity("kAction_Talk","talk").id,collide:o.MRData.newSkillAsActivity("kAction_Collide","collide").id,dialogResult:o.MRData.newSkillAsActivity("kAction_DialogResult","dialogResult").id,stumble:o.MRData.newSkillAsActivity("kAction_Stumble","stumble").id,dead:o.MRData.newSkillAsActivity("kAction_Dead","dead").id,performSkill:o.MRData.newSkillAsActivity("kAction_PerformSkill","PerformSkill").id,AttackActionId:o.MRData.getSkill("kSkill_System_NormalAttack").id},o.MRData.items=[],o.MRData.itemDataIdOffset=o.MRData.items.length,$dataItems.forEach((t=>{var e,i,r,s;const[a,n]=o.MRData.newItem();if(t){n.rmmzItemId=t.id;const c=D.DMetadataParser.parse(t.meta);a.entity=(0,d.parseMetaToEntityProperties)(t.meta),a.entityTemplateKey=c.entityTemplateKey,a.display.name=t.name,a.display.iconIndex=null!==(e=t.iconIndex)&&void 0!==e?e:0,a.description=t.description,a.sellingPrice2=t.price,a.purchasePrice=Math.max(a.sellingPrice2/2,1);const l=o.MRData.newEmittor(null!==(i=c.emittorKey)&&void 0!==i?i:a.entity.key),h=o.MRData.newEffect(null!==(r=c.effectKey)&&void 0!==r?r:a.entity.key);h.critical=!1,h.successRate=t.successRate,h.hitType=t.hitType,t.animationId<0?h.flavorEffect=void 0:0===t.animationId?h.flavorEffect=null:h.flavorEffect=B.DFlavorEffect.fromRmmzAnimationId(t.animationId),h.rmmzSpecialEffectQualifyings=t.effects,t.damage.type>0&&h.parameterQualifyings.push(this.makeParameterQualifying(t.damage)),l.effectSuite.addTargetEffect(new N.DEffectRef(h.id)),a.setMainEmittor(l),l.setupFromRmmzScope(null!==(s=t.scope)&&void 0!==s?s:g.DRmmzEffectScope.None)}})),o.MRData.weaponDataIdOffset=o.MRData.items.length,$dataWeapons.forEach((t=>{var e,i;const[r,s]=o.MRData.newItem();if(t){s.rmmzWeaponId=t.id;const a=D.DMetadataParser.parse(t.meta);r.display.name=f.DHelpers.parseDisplayName(t.name),r.display.iconIndex=null!==(e=t.iconIndex)&&void 0!==e?e:0,r.description=t.description,r.sellingPrice2=t.price,r.purchasePrice=Math.max(r.sellingPrice2/2,1),r.equipment=new y.DEquipment,r.equipment.equipmentPart=t.etypeId,r.equipment.parameters[c.MRBasics.params.hp]={value:t.params[0],upgradeRate:0},r.equipment.parameters[c.MRBasics.params.mp]={value:t.params[1],upgradeRate:0},r.equipment.parameters[c.MRBasics.params.atk]={value:t.params[2],upgradeRate:1},r.equipment.parameters[c.MRBasics.params.def]={value:t.params[3],upgradeRate:0},r.equipment.parameters[c.MRBasics.params.mat]={value:t.params[4],upgradeRate:0},r.equipment.parameters[c.MRBasics.params.mdf]={value:t.params[5],upgradeRate:0},r.equipment.parameters[c.MRBasics.params.agi]={value:t.params[6],upgradeRate:0},r.equipment.parameters[c.MRBasics.params.luk]={value:t.params[7],upgradeRate:0},r.equipment.targetRmmzAnimationId=null!==(i=t.animationId)&&void 0!==i?i:0,r.equipmentTraits=t.traits.slice(),r.equipmentTraits=r.equipmentTraits.concat(_.DTrait.parseTraitMetadata(t.meta)),r.entity=(0,d.parseMetaToEntityProperties)(t.meta),r.entityTemplateKey=a.entityTemplateKey}})),o.MRData.armorDataIdOffset=o.MRData.items.length,$dataArmors.forEach((t=>{var e;const[i,r]=o.MRData.newItem();if(t){r.rmmzArmorId=t.id;const s=D.DMetadataParser.parse(t.meta);i.display.name=t.name,i.display.iconIndex=null!==(e=t.iconIndex)&&void 0!==e?e:0,i.description=t.description,i.sellingPrice2=t.price,i.purchasePrice=Math.max(i.sellingPrice2/2,1),i.equipment=new y.DEquipment,i.equipment.equipmentPart=t.etypeId,i.equipment.parameters[c.MRBasics.params.hp]={value:t.params[0],upgradeRate:0},i.equipment.parameters[c.MRBasics.params.mp]={value:t.params[1],upgradeRate:0},i.equipment.parameters[c.MRBasics.params.atk]={value:t.params[2],upgradeRate:0},i.equipment.parameters[c.MRBasics.params.def]={value:t.params[3],upgradeRate:1},i.equipment.parameters[c.MRBasics.params.mat]={value:t.params[4],upgradeRate:0},i.equipment.parameters[c.MRBasics.params.mdf]={value:t.params[5],upgradeRate:0},i.equipment.parameters[c.MRBasics.params.agi]={value:t.params[6],upgradeRate:0},i.equipment.parameters[c.MRBasics.params.luk]={value:t.params[7],upgradeRate:0},i.equipmentTraits=t.traits.slice(),i.equipmentTraits=i.equipmentTraits.concat(_.DTrait.parseTraitMetadata(t.meta)),i.entity=(0,d.parseMetaToEntityProperties)(t.meta),i.entityTemplateKey=s.entityTemplateKey}})),a.MRSystem.items={autoSupplyFood:2},o.MRData.system.initialPartyMembers=[];for(const t of $dataSystem.partyMembers){const e=o.MRData.entities.find((e=>e.actor&&e.actor.rmmzActorId==t));(0,n.assert)(e),o.MRData.system.initialPartyMembers.push(e.id)}$dataEnemies.forEach((t=>{const[e,i]=o.MRData.newEnemy();if(t){e.display.name=t.name,e.display.iconIndex=71,i.exp=t.exp,t.params&&(e.idealParams[c.MRBasics.params.hp]=t.params[0],e.idealParams[c.MRBasics.params.mp]=t.params[1],e.idealParams[c.MRBasics.params.atk]=t.params[2],e.idealParams[c.MRBasics.params.def]=t.params[3],e.idealParams[c.MRBasics.params.mat]=t.params[4],e.idealParams[c.MRBasics.params.mdf]=t.params[5],e.idealParams[c.MRBasics.params.agi]=t.params[6],e.idealParams[c.MRBasics.params.luk]=t.params[7]),i.traits=t.traits,i.actions=t.actions,i.dropItems=x.DDropItem.makeFromRmmzDropItemList(t.dropItems,t.gold),e.entity=(0,d.parseMetaToEntityProperties)(t.meta),e.entity.kindId=c.MRBasics.entityCategories.MonsterKindId,e.factionId=o.MRData.system.factions.enemy,e.classId=c.MRBasics.defaultEnemyClass,i.traits=i.traits.concat(_.DTrait.parseTraitMetadata(t.meta));const r=D.DMetadataParser.parse(t.meta);e.raceIds=r.races.map((t=>o.MRData.getRace(t).id)),b.MRSetup.setupEnemy(e)}})),o.MRData.troops=[];for(const t of $dataTroops){const e=new M.DTroop(o.MRData.troops.length);if(o.MRData.troops.push(e),t){const i=T.DAnnotationReader.readTroopAttributeFromPage(t.pages[0]);if(i){e.key=i.key,e.members=[];for(const i of t.members){const t=o.MRData.enemies[i.enemyId];if(!o.MRData.entities[t].isValidKey)throw new Error((0,n.tr2)("%1 には、 MR-Key が設定されていない %2 が含まれています。").format(F.DValidationHelper.makeRmmzTroopName(e.id),F.DValidationHelper.makeRmmzEnemyName(i.enemyId)));e.members.push(t)}}}}o.MRData.system.link(this.testMode);for(const t of o.MRData.states)for(const e of t.stateGroupKeys){const i=o.MRData.stateGroups.findIndex((t=>t.key==e));if(!(i>0))throw new Error(`StateGroup not found. ${e}`);t.stateGroupIds.push(i)}t()}static importTerrainSettings(t){this.loadTextFile("mr/TerrainSettings.js",(e=>{new C.DTerrainSettingImporter(e),t()}))}static importFloorPreset(t){this.loadTextFile("mr/FloorPresets.js",(e=>{new L.DFloorPresetImporter(e),t()}))}static importLandAndFloors(t){var e,i,r;o.MRData.lands=[],o.MRData.lands.push(new p.DLand(0,!1));const s=new p.DLand(1,!1);o.MRData.lands.push(s);{const t=p.DLandIdentificationLevel.Entity;for(const e of o.MRData.categories)s.identifiedKinds[e.id]=t}for(var a=0;a<$dataMapInfos.length;a++){const t=$dataMapInfos[a];if(t&&this.isLandMap(a)){const e=new p.DLand(o.MRData.lands.length,t.name.startsWith("MR-World:"));e.name=t.name,e.rmmzMapId=a,o.MRData.lands.push(e)}}for(let t=1;t<$dataMapInfos.length;t++){const s=$dataMapInfos[t],a=o.MRData.newMap();if(a.landId=f.DHelpers.VanillaLandId,s){if(a.mapId=t,(0,n.assert)(a.id==t),this.isDatabaseMap(t))this.databaseMapId=t;else{(null===(e=s.name)||void 0===e?void 0:e.startsWith("MR-Safety:"))&&(a.safetyMap=!0);const c=$dataMapInfos[s.parentId];if(c){if(s.parentId>0&&c.name.includes("MR-MapTemplates")){a.mapKind=O.REFloorMapKind.TemplateMap;const t=o.MRData.newTemplateMap();t.name=s.name,t.mapId=a.id}else if((null===(i=s.name)||void 0===i?void 0:i.startsWith("MR-Land:"))||(null===(r=s.name)||void 0===r?void 0:r.startsWith("MR-World:"))){const e=o.MRData.lands.find((e=>e.rmmzMapId==t));(0,n.assert)(e),a.landId=e.id,a.mapKind=O.REFloorMapKind.Land}else if(s.parentId){const t=o.MRData.lands.find((t=>c&&c.parentId&&t.rmmzMapId==c.parentId));t&&(a.landId=t.id,c.name.includes("[Random]")?a.mapKind=O.REFloorMapKind.RandomMap:c.name.includes("[Shuffle]")?a.mapKind=O.REFloorMapKind.ShuffleMap:c.name.includes("[Fixed]")&&(a.mapKind=O.REFloorMapKind.FixedMap,t.fixedMapIds.push(a.id)))}I.DDataImporter.importMapData(a,s,c,c.parentId>0?$dataMapInfos[c.parentId]:void 0)}}a.landId==f.DHelpers.VanillaLandId&&(o.MRData.lands[a.landId].floorInfos[a.mapId]={key:"",template:void 0,displayName:void 0,fixedMapName:"",safetyActions:!0,bgmName:"",bgmVolume:90,bgmPitch:100,presetId:0})}}for(const t of o.MRData.lands);t()}static importPseudonymous(t){this.loadDataFile("mr/Pseudonymous.json",(e=>{o.MRData.pseudonymous.setup(e),t()}))}static importPrefabs(t){(0,n.assert)(this.databaseMapId>0),this.beginLoadMapData(this.databaseMapId,(e=>{const i=e;for(const t of i.events){if(!t)continue;const e=T.DAnnotationReader.readPrefabMetadata(t,this.databaseMapId);if(!e)continue;const i=o.MRData.newPrefab();i.key=t.name,i.rmmzMapId=this.databaseMapId,i.rmmzEventData=t,i.image.characterName=t.pages[0].image.characterName,i.image.direction=t.pages[0].image.direction,i.image.pattern=t.pages[0].image.pattern,i.image.characterIndex=t.pages[0].image.characterIndex,i.image.directionFix=t.pages[0].directionFix,i.image.stepAnime=t.pages[0].stepAnime,i.image.walkAnime=t.pages[0].walkAnime,e.stateImages&&(i.stateImages=e.stateImages.map((t=>({stateId:o.MRData.getState(t[0]).id,characterName:t[1],characterIndex:t[2]})))),3==t.pages[0].moveType&&(i.moveType=m.DPrefabMoveType.Fix),o.MRData.prefabs.push(i);for(let e=1;e<t.pages.length;e++){const r=T.DAnnotationReader.readPrefabSubPageMetadata(t.pages[e]);if(r){if(void 0===r.state)throw new Error("@MR-PrefabSubPage requires state field.");i.subPages.push({stateId:o.MRData.getState(r.state).id,rmmzEventPageIndex:e})}}}for(const t of o.MRData.entities)if(""!=t.entity.key&&t.entity.meta_prefabName){const e=o.MRData.prefabs.find((e=>e.key==t.entity.meta_prefabName));if(!(e&&e.id>0))throw new Error(`Unknown Prefab "${t.entity.meta_prefabName}".`);t.prefabId=e.id,b.MRSetup.setupPrefab(e)}c.MRBasics.prefabs={illusionActor:o.MRData.getPrefab("pまどわしUnit").id,illusionItem:o.MRData.getPrefab("pまどわしItem").id},t()}))}static importLandDatabase(t){const e=o.MRData.lands.filter((t=>t.rmmzMapId>0));for(let i=0;i<e.length;i++){const r=e[i];j.beginLoadMapData(r.rmmzMapId,(s=>{r.import(s),r.enemyTableMapId>0&&j.beginLoadMapData(r.enemyTableMapId,(t=>{p.DLand.buildSubAppearanceTable(r,t,r.enemyTableMapId,r.appearanceTable,r.appearanceTable.enemies)})),r.itemTableMapId>0&&j.beginLoadMapData(r.itemTableMapId,(t=>{p.DLand.buildSubAppearanceTable(r,t,r.itemTableMapId,r.appearanceTable,r.appearanceTable.items)})),r.trapTableMapId>0&&j.beginLoadMapData(r.trapTableMapId,(t=>{p.DLand.buildSubAppearanceTable(r,t,r.trapTableMapId,r.appearanceTable,r.appearanceTable.traps)})),r.shopTableMapId>0&&j.beginLoadMapData(r.shopTableMapId,(t=>{p.DLand.buildSubAppearanceTable(r,t,r.shopTableMapId,r.appearanceTable,r.appearanceTable.shop)})),i==e.length-1&&t()}))}}static importTemplateMaps(t){const e=o.MRData.templateMaps.filter((t=>t.mapId>0));for(let i=0;i<e.length;i++){const r=e[i];this.beginLoadMapData(r.mapId,(s=>{r.import(s),i==e.length-1&&t()}))}}static importSetupScript(t){const e=["mr/EntityCategories.js","mr/EntityTemplates.js","mr/Setup.js","mr/Actions.js","mr/Parameters.js","mr/Effects.js","mr/Emittors.js","mr/Entities.js"],i=new P.DSetupScript;for(let r=0;r<e.length;r++){const s=e[r];this.loadTextFile(s,(s=>{if(i.addScript(s),r==e.length-1){i.registerData(),i.setupData();for(const t of o.MRData.states)b.MRSetup.setupDirectly_State(t);for(const t of o.MRData.skills)b.MRSetup.setupDirectly_Skill(t);o.MRData.skills.forEach((t=>b.MRSetup.linkSkill(t)));for(const t of o.MRData.items)b.MRSetup.setupDirectly_DItem(o.MRData.entities[t]);for(const t of o.MRData.actors)t>0&&b.MRSetup.setupActor(o.MRData.entities[t]);for(const t of o.MRData.items)b.MRSetup.linkItem(o.MRData.entities[t]);for(const t of o.MRData.items)i.setupItem(o.MRData.entities[t]);t()}}))}}static beginLoadMapData(t,e){const i=`Map${this.padZero(t,3)}.json`;this.loadDataFile(i,e)}static padZero(t,e){return String(t).padStart(e,"0")}static makeParameterQualifying(t){var e,i,r;let s=0,a=g.DParameterEffectApplyType.None;switch(t.type){case 1:s=c.MRBasics.params.hp,a=g.DParameterEffectApplyType.Damage;break;case 2:s=c.MRBasics.params.mp,a=g.DParameterEffectApplyType.Damage;break;case 3:s=c.MRBasics.params.hp,a=g.DParameterEffectApplyType.Recover;break;case 4:s=c.MRBasics.params.mp,a=g.DParameterEffectApplyType.Recover;break;case 5:s=c.MRBasics.params.hp,a=g.DParameterEffectApplyType.Drain;break;case 6:s=c.MRBasics.params.mp,a=g.DParameterEffectApplyType.Drain;break;default:throw new Error}const n=new g.DParameterQualifying(s,null!==(e=t.formula)&&void 0!==e?e:"0",a);return n.elementIds[0]=null!==(i=t.elementId)&&void 0!==i?i:0,n.variance=null!==(r=t.variance)&&void 0!==r?r:0,n}static isDatabaseMap(t){const e=$dataMapInfos[t];return!!(e&&e.name&&e.name.startsWith("MR-Prefabs"))}static isLandMap(t){const e=$dataMapInfos[t];return!(!e||!e.name||!e.name.startsWith("MR-Land:")&&!e.name.startsWith("MR-World:"))}static isRESystemMap(t){const e=o.MRData.maps[t];return!e.eventMap&&e.landId>f.DHelpers.VanillaLandId}static loadDataFile(t,e){if(f.DHelpers.isNode()){const i="data/",r=JSON.parse(s.default.readFileSync(i+t).toString());e(r)}else{this._loadingDataFileCount++;const i=new XMLHttpRequest,r="data/"+t;i.open("GET",r),i.overrideMimeType("application/json"),i.onload=()=>this.onXhrLoad(i,t,r,(t=>{e(t),this._loadedDataFileCount++})),i.onerror=()=>DataManager.onXhrError(t,t,r),i.send()}}static loadTextFile(t,e){if(!f.DHelpers.isNode())throw new Error("Not implemented.");{const i="data/";e(s.default.readFileSync(i+t).toString())}}static onXhrLoad(t,e,i,r){t.status<400?r(JSON.parse(t.responseText)):DataManager.onXhrError(e,e,i)}}e.MRDataManager=j,j.databaseMapId=0,j._loadingDataFileCount=0,j._loadedDataFileCount=0},9547:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MRSetup=void 0;const r=i(4836),s=i(5967),a=i(4561),n=i(6291),o=i(2890),c=i(6189),l=i(9185),h=i(1298),u=i(6539),d=i(5739),p=i(3654),f=i(6901),m=i(5117);e.MRSetup=class{static setupParameter(t){const e=t=>{{const e=new u.DParameterFlavorEffect;e.flavorEffect=new d.DFlavorEffect,e.flavorEffect.text=[p.DTextManager.actorDamage.replace("%2","%3")],e.looksFaction=f.DFactionType.Neutral,e.point=a.DValuePoint.Actual,e.addition=u.DValueAddition.Loss,t.parameterFlavorEffects.push(e)}{const e=new u.DParameterFlavorEffect;e.flavorEffect=new d.DFlavorEffect,e.flavorEffect.text=[p.DTextManager.enemyDamage.replace("%2","%3")],e.looksFaction=f.DFactionType.Hostile,e.point=a.DValuePoint.Actual,e.addition=u.DValueAddition.Loss,t.parameterFlavorEffects.push(e)}{const e=new u.DParameterFlavorEffect;e.flavorEffect=new d.DFlavorEffect,e.flavorEffect.text=[p.DTextManager.actorRecovery],e.looksFaction=f.DFactionType.Neutral,e.point=a.DValuePoint.Actual,e.addition=u.DValueAddition.Gain,t.parameterFlavorEffects.push(e)}{const e=new u.DParameterFlavorEffect;e.flavorEffect=new d.DFlavorEffect,e.flavorEffect.text=[p.DTextManager.enemyRecovery],e.looksFaction=f.DFactionType.Hostile,e.point=a.DValuePoint.Actual,e.addition=u.DValueAddition.Gain,t.parameterFlavorEffects.push(e)}{const e=new u.DParameterFlavorEffect;e.flavorEffect=new d.DFlavorEffect,e.flavorEffect.text=[p.DTextManager.actorGain],e.looksFaction=f.DFactionType.Neutral,e.point=a.DValuePoint.Growth,e.addition=u.DValueAddition.Gain,t.parameterFlavorEffects.push(e)}if(t.id==r.MRBasics.params.hp){{const e=new u.DParameterFlavorEffect;e.flavorEffect=new d.DFlavorEffect,e.flavorEffect.text=[p.DTextManager.actorNoDamage],e.looksFaction=f.DFactionType.Neutral,e.point=a.DValuePoint.Actual,e.addition=u.DValueAddition.None,t.parameterFlavorEffects.push(e)}{const e=new u.DParameterFlavorEffect;e.flavorEffect=new d.DFlavorEffect,e.flavorEffect.text=[p.DTextManager.enemyNoDamage],e.looksFaction=f.DFactionType.Hostile,e.point=a.DValuePoint.Actual,e.addition=u.DValueAddition.None,t.parameterFlavorEffects.push(e)}}else{const e=new u.DParameterFlavorEffect;e.flavorEffect=new d.DFlavorEffect,e.flavorEffect.text=[(0,h.tr2)("%1の%2は変化しなかった。")],e.looksFaction=f.DFactionType.Neutral,e.point=a.DValuePoint.Actual,e.addition=u.DValueAddition.None,t.parameterFlavorEffects.push(e)}};switch(t.id){case r.MRBasics.params.hp:case r.MRBasics.params.mp:case r.MRBasics.params.atk:case r.MRBasics.params.def:case r.MRBasics.params.mat:case r.MRBasics.params.mdf:case r.MRBasics.params.agi:case r.MRBasics.params.luk:case r.MRBasics.params.tp:case r.MRBasics.params.remaining:case r.MRBasics.params.capacity:case r.MRBasics.params.gold:case r.MRBasics.params.exp:e(t);break;case r.MRBasics.params.fp:break;case r.MRBasics.params.pow:e(t),t.parameterFlavorEffects=t.parameterFlavorEffects.filter((t=>t.looksFaction==f.DFactionType.Neutral));{const e=new u.DParameterFlavorEffect;e.flavorEffect=new d.DFlavorEffect,e.flavorEffect.text=[p.DTextManager.actorLoss],e.looksFaction=f.DFactionType.Neutral,e.point=a.DValuePoint.Actual,e.addition=u.DValueAddition.Loss,t.parameterFlavorEffects.push(e)}break;case r.MRBasics.params.upgradeValue:e(t),t.parameterFlavorEffects=t.parameterFlavorEffects.filter((t=>t.looksFaction==f.DFactionType.Neutral));{const e=new u.DParameterFlavorEffect;e.flavorEffect=new d.DFlavorEffect,e.flavorEffect.text=[p.DTextManager.actorGain],e.looksFaction=f.DFactionType.Neutral,e.point=a.DValuePoint.Actual,e.addition=u.DValueAddition.Gain,t.parameterFlavorEffects.push(e)}{const e=new u.DParameterFlavorEffect;e.flavorEffect=new d.DFlavorEffect,e.flavorEffect.text=[p.DTextManager.actorLoss],e.looksFaction=f.DFactionType.Neutral,e.point=a.DValuePoint.Actual,e.addition=u.DValueAddition.Loss,t.parameterFlavorEffects.push(e)}}}static setupPrefab(t){if("kPrefab_ActorA"===t.key)t.downImage.characterName="Damage1",t.downImage.characterIndex=0,t.downImage.direction=4,t.downImage.pattern=0,t.downImage.directionFix=!0,t.downImage.stepAnime=!1,t.downImage.walkAnime=!1}static setupRace(t){if("kRace_アンデッド系"===t.key)t.traits.push({code:r.MRBasics.traits.ElementedRecoveryRate,dataId:0,value:-1})}static setupActor(t){t.actorData().id}static setupDirectly_DItem(t){t.item();switch(t.entity.key){case"kEntity_目覚めの指輪A":case"kEntity_睡眠よけの指輪A":case"kEntity_忍び足の指輪A":case"kEntity_きれいな指輪A":this.setupRingCommon(t);break;case"kEntity_ちからの指輪A":this.setupRingCommon(t),(0,h.assert)(t.equipment),t.equipment.parameters[r.MRBasics.params.pow]={value:3,upgradeRate:0};break;case"kEntity_高跳びの指輪A":this.setupRingCommon(t),t.equipmentTraits.push({code:r.MRBasics.traits.SuddenSkillEffect,dataId:l.MRData.getSkill("kSkill_Warp").id,value:1/16});break;case"kEntity_ハラヘリの指輪A":this.setupRingCommon(t),t.equipmentTraits.push({code:r.MRBasics.traits.SurvivalParamLossRate,dataId:r.MRBasics.params.fp,value:2});break;case"kEntity_毒消しの指輪A":this.setupRingCommon(t),t.equipmentTraits.push({code:r.MRBasics.traits.ParamDamageRate,dataId:r.MRBasics.params.pow,value:0});break;case"kEntity_影読みの指輪A":this.setupRingCommon(t),t.equipmentTraits.push({code:r.MRBasics.traits.ForceVisible,dataId:0,value:0});break;case"kEntity_インプよけの指輪A":this.setupRingCommon(t),t.equipmentTraits.push({code:r.MRBasics.traits.SkillGuard,dataId:l.MRData.getSkill("kSkill_レベルダウン").id,value:0}),t.equipmentTraits.push({code:r.MRBasics.traits.SkillGuard,dataId:l.MRData.getSkill("kSkill_毒攻撃_強").id,value:0});break;case"kEntity_罠よけの指輪A":this.setupRingCommon(t),t.equipmentTraits.push({code:r.MRBasics.traits.DisableTrap,dataId:0,value:0});break;case"kEntity_ハラヘラズの指輪A":this.setupRingCommon(t),t.equipmentTraits.push({code:r.MRBasics.traits.SurvivalParamLossRate,dataId:r.MRBasics.params.fp,value:0});break;case"kEntity_木の矢A":case"kEntity_鉄の矢A":case"kEntity_毒矢A":this.setupArrowCommon(t),t.shortcut=!0,t.display.stackedName="%1本の"+t.display.name,t.selfTraits.push({code:r.MRBasics.traits.Stackable,dataId:0,value:0}),t.addReaction(r.MRBasics.actions.ShootActionId,void 0,!0),t.initialStackCount={minValue:2,maxValue:7};break;case"kEntity_銀の矢A":this.setupArrowCommon(t),t.shortcut=!0,t.display.stackedName="%1本の"+t.display.name,t.selfTraits.push({code:r.MRBasics.traits.Stackable,dataId:0,value:0}),t.selfTraits.push({code:r.MRBasics.traits.PenetrationItem,dataId:0,value:0}),t.addReaction(r.MRBasics.actions.ShootActionId,void 0,!0),t.initialStackCount={minValue:2,maxValue:7};break;case"kEntity_GoldA":this.setupItemCommon(t),t.addReaction(r.MRBasics.actions.collide,t.mainEmittor());break;case"kEntity_弟切草A":case"kEntity_錆ワナA":break;case"kEntity_ドラゴン草A":this.setupGrassCommon(t),t.addReaction(r.MRBasics.actions.EatActionId,l.MRData.getSkill("kSkill_炎のブレス_直線").emittor());break;case"kEntity_しびれ草A":case"kEntity_きえさり草A":this.setupGrassCommon(t);break;case"kEntity_RevivalGrassA":this.setupGrassCommon(t),t.entity.behaviors.push({name:"RevivalItem"}),t.addReaction(r.MRBasics.actions.dead,t.mainEmittor());break;case"kEntity_System_炎のブレスA":case"kEntity_System_MagicBulletA":t.volatilityProjectile=!0;break;case"kEntity_ふきとばしの杖A":t.addReaction(r.MRBasics.actions.collide,l.MRData.getSkill("kSkill_ふきとばし").emittor()),t.addReaction(r.MRBasics.actions.WaveActionId,l.MRData.getSkill("kSkill_魔法弾発射_一般").emittor()),t.idealParams[r.MRBasics.params.remaining]=5,t.identificationDifficulty=n.DIdentificationDifficulty.Obscure;break;case"kEntity_大損の杖A":{this.setupStaffCommon(t),t.addReaction(r.MRBasics.actions.WaveActionId,l.MRData.getSkill("kSkill_魔法弾発射_一般").emittor()),t.idealParams[r.MRBasics.params.remaining]=5;const e=t.mainEmittor().effectSuite.targetEffect(0);e.effect.parameterQualifyings.push(new a.DParameterQualifying(r.MRBasics.params.hp,"b.hp / 2",a.DParameterEffectApplyType.Damage)),e.effect.flavorEffect=d.DFlavorEffect.fromRmmzAnimationId(55);break}case"kEntity_透明の杖A":{this.setupStaffCommon(t),t.addReaction(r.MRBasics.actions.WaveActionId,l.MRData.getSkill("kSkill_魔法弾発射_一般").emittor()),t.idealParams[r.MRBasics.params.remaining]=5;const e=t.mainEmittor().effectSuite.targetEffect(0);e.effect.rmmzSpecialEffectQualifyings.push({code:o.DItemEffect.EFFECT_ADD_STATE,dataId:l.MRData.getState("kState_UT透明").id,value1:1,value2:0}),e.effect.flavorEffect=d.DFlavorEffect.fromRmmzAnimationId(101);break}case"kEntity_倍速の杖A":{this.setupStaffCommon(t),t.addReaction(r.MRBasics.actions.WaveActionId,l.MRData.getSkill("kSkill_魔法弾発射_一般").emittor()),t.idealParams[r.MRBasics.params.remaining]=5;const e=t.mainEmittor().effectSuite.targetEffect(0);e.effect.buffQualifying.push({paramId:r.MRBasics.params.agi,level:1,levelType:a.DBuffLevelOp.Add,type:a.DBuffType.Add,turn:10}),e.effect.flavorEffect=d.DFlavorEffect.fromRmmzAnimationId(12);break}case"kEntity_いかずちの杖A":{this.setupStaffCommon(t),t.addReaction(r.MRBasics.actions.WaveActionId,l.MRData.getSkill("kSkill_魔法弾発射_一般").emittor()),t.idealParams[r.MRBasics.params.remaining]=5;const e=t.mainEmittor().effectSuite.targetEffect(0);e.effect.parameterQualifyings.push(new a.DParameterQualifying(r.MRBasics.params.hp,"35",a.DParameterEffectApplyType.Damage).withVariance(20)),e.effect.flavorEffect=d.DFlavorEffect.fromRmmzAnimationId(77);break}case"kEntity_混乱の杖A":{this.setupStaffCommon(t),t.addReaction(r.MRBasics.actions.WaveActionId,l.MRData.getSkill("kSkill_魔法弾発射_一般").emittor()),t.idealParams[r.MRBasics.params.remaining]=5;const e=t.mainEmittor().effectSuite.targetEffect(0);e.effect.rmmzSpecialEffectQualifyings.push({code:o.DItemEffect.EFFECT_ADD_STATE,dataId:l.MRData.getState("kState_UT混乱").id,value1:1,value2:0}),e.effect.flavorEffect=d.DFlavorEffect.fromRmmzAnimationId(63);break}case"kEntity_分裂の杖A":{this.setupStaffCommon(t),t.addReaction(r.MRBasics.actions.WaveActionId,l.MRData.getSkill("kSkill_魔法弾発射_一般").emittor()),t.idealParams[r.MRBasics.params.remaining]=5;const e=t.mainEmittor().effectSuite.targetEffect(0);e.effect.effectBehaviors.push({specialEffectId:r.MRBasics.effectBehaviors.division,entityId:0,dataId:0,value:0}),e.effect.flavorEffect=d.DFlavorEffect.fromRmmzAnimationId(106);break}case"kEntity_睡眠の杖A":{this.setupStaffCommon(t),t.addReaction(r.MRBasics.actions.WaveActionId,l.MRData.getSkill("kSkill_魔法弾発射_一般").emittor()),t.idealParams[r.MRBasics.params.remaining]=5;const e=t.mainEmittor().effectSuite.targetEffect(0);e.effect.rmmzSpecialEffectQualifyings.push({code:o.DItemEffect.EFFECT_ADD_STATE,dataId:l.MRData.getState("kState_睡眠").id,value1:1,value2:0}),e.effect.flavorEffect=d.DFlavorEffect.fromRmmzAnimationId(62);break}case"kEntity_封印の杖A":this.setupStaffCommon(t),t.addReaction(r.MRBasics.actions.WaveActionId,l.MRData.getSkill("kSkill_魔法弾発射_一般").emittor()),t.idealParams[r.MRBasics.params.remaining]=5;break;case"kEntity_変化の杖A":t.addReaction(r.MRBasics.actions.collide,l.MRData.getSkill("kSkill_変化").emittor()),t.addReaction(r.MRBasics.actions.WaveActionId,l.MRData.getSkill("kSkill_魔法弾発射_一般").emittor()),t.idealParams[r.MRBasics.params.remaining]=3,t.identificationDifficulty=n.DIdentificationDifficulty.Obscure;break;case"kEntity_高跳びの杖A":this.setupStaffCommon(t),t.addReaction(r.MRBasics.actions.WaveActionId,l.MRData.getSkill("kSkill_魔法弾発射_一般").emittor()),t.idealParams[r.MRBasics.params.remaining]=5;t.mainEmittor().effectSuite.targetEffect(0).effect.effectBehaviors.push({specialEffectId:r.MRBasics.effectBehaviors.randomWarp,entityId:0,dataId:0,value:0});break;case"kEntity_鈍足の杖A":{this.setupStaffCommon(t),t.addReaction(r.MRBasics.actions.WaveActionId,l.MRData.getSkill("kSkill_魔法弾発射_一般").emittor()),t.idealParams[r.MRBasics.params.remaining]=5;const e=t.mainEmittor().effectSuite.targetEffect(0);e.effect.buffQualifying.push({paramId:r.MRBasics.params.agi,level:-1,levelType:a.DBuffLevelOp.Add,type:a.DBuffType.Add,turn:10}),e.effect.flavorEffect=d.DFlavorEffect.fromRmmzAnimationId(54);break}case"kEntity_もろはの杖A":{this.setupStaffCommon(t),t.addReaction(r.MRBasics.actions.WaveActionId,l.MRData.getSkill("kSkill_魔法弾発射_一般").emittor()),t.idealParams[r.MRBasics.params.remaining]=5;const e=t.mainEmittor();e.effectSuite.targetEffect(0).effect.flavorEffect=d.DFlavorEffect.fromRmmzAnimationId(60);const i=l.MRData.getItem("kEntity_もろはの杖A_使用者側効果").mainEmittor().effectSuite.targetEffect(0);i.effect.flavorEffect=d.DFlavorEffect.fromRmmzAnimationId(60),e.effectSuite.succeededSelfEffect=i;break}case"kEntity_転ばぬ先の杖A":this.setupStaffCommon(t),t.mainEmittor().effectSuite.targetEffect(0).effect.effectBehaviors.push({specialEffectId:r.MRBasics.effectBehaviors.stumble,entityId:0,dataId:0,value:0}),t.addReaction(r.MRBasics.actions.WaveActionId,l.MRData.getSkill("kSkill_魔法弾発射_一般").emittor()),t.idealParams[r.MRBasics.params.remaining]=5,t.isTraitCharmItem=!0;break;case"kEntity_死の杖A":this.setupStaffCommon(t),t.addReaction(r.MRBasics.actions.WaveActionId,l.MRData.getSkill("kSkill_魔法弾発射_一般").emittor()),t.idealParams[r.MRBasics.params.remaining]=5;t.mainEmittor().effectSuite.targetEffect(0).effect.flavorEffect=d.DFlavorEffect.fromRmmzAnimationId(65);break;case"kEntity_眠りガスA":{const e=t.mainEmittor();e.selfAnimationId=35,e.scope.range=a.DEffectFieldScopeType.Center;break}case"kEntity_地雷A":{const e=t.mainEmittor(),i=e.effectSuite.targetEffect(0);e.scope.range=a.DEffectFieldScopeType.AroundAndCenter,e.scope.length=1,e.selfAnimationId=109;const s=new a.DParameterQualifying(r.MRBasics.params.hp,"b.hp / 2",a.DParameterEffectApplyType.Damage).withElementId(r.MRBasics.elements.explosion);s.elementIds.push(l.MRData.getElement("kElement_DeathExplosion").id),i.effect.parameterQualifyings.push(s),i.effect.hitType=a.DEffectHitType.Magical,t.counterActions.push({conditionAttackType:r.MRBasics.elements.explosion,emitSelf:!0});break}case"kEntity_トラバサミA":{const e=t.mainEmittor(),i=e.effectSuite.targetEffect(0);e.scope.range=a.DEffectFieldScopeType.Center,i.effect.rmmzSpecialEffectQualifyings.push({code:o.DItemEffect.EFFECT_ADD_STATE,dataId:l.MRData.getState("kState_UTトラバサミ").id,value1:1,value2:0});break}case"kEntity_バネA":{const e=t.mainEmittor(),i=e.effectSuite.targetEffect(0);e.scope.range=a.DEffectFieldScopeType.Center,i.effect.effectBehaviors.push({specialEffectId:r.MRBasics.effectBehaviors.randomWarp,entityId:0,dataId:0,value:0});break}case"kEntity_転び石A":t.mainEmittor().scope.range=a.DEffectFieldScopeType.Center,t.mainEmittor().effectSuite.targetEffect(0).effect.effectBehaviors.push({specialEffectId:r.MRBasics.effectBehaviors.stumble,entityId:0,dataId:0,value:0});break;case"kEntity_木の矢の罠A":{const e=t.mainEmittor();e.scope.range=a.DEffectFieldScopeType.ReceiveProjectile,e.scope.length=1/0,e.scope.projectilePrefabKey="kEntity_木の矢A";break}case"kEntity_毒矢の罠A":{const e=t.mainEmittor();e.scope.range=a.DEffectFieldScopeType.ReceiveProjectile,e.scope.length=1/0,e.scope.projectilePrefabKey="kEntity_毒矢A",e.effectSuite.targetEffect(0).effect.parameterQualifyings.push(new a.DParameterQualifying(r.MRBasics.params.pow,"1",a.DParameterEffectApplyType.Damage));break}case"kEntity_落とし穴A":{const e=t.mainEmittor();e.scope.range=a.DEffectFieldScopeType.Center,e.effectSuite.targetEffect(0).effect.effectBehaviors.push({specialEffectId:r.MRBasics.effectBehaviors.transferToLowerFloor,entityId:0,dataId:0,value:0});break}case"kEntity_突風の罠A":{const e=t.mainEmittor();e.scope.range=a.DEffectFieldScopeType.Center,e.effectSuite.targetEffect(0).effect.effectBehaviors.push({specialEffectId:r.MRBasics.effectBehaviors.transferToNextFloor,entityId:0,dataId:0,value:0}),e.selfAnimationId=94;break}case"kEntity_保存の壺A":t.addReaction(r.MRBasics.actions.PutInActionId),t.addReaction(r.MRBasics.actions.PickOutActionId);break;case"kEntity_くちなしの巻物A":this.setupScrollCommon(t),t.addReaction(r.MRBasics.actions.ReadActionId,t.mainEmittor());break;case"kEntity_ワナの巻物A":{this.setupScrollCommon(t);const e=t.mainEmittor();e.effectSuite.targetEffect(0).effect.effectBehaviors.push({specialEffectId:r.MRBasics.effectBehaviors.trapProliferation,entityId:0,dataId:0,value:0}),e.selfAnimationId=54,t.addReaction(r.MRBasics.actions.ReadActionId,e);break}case"kEntity_メッキの巻物A":{this.setupScrollCommon(t);const e=t.mainEmittor();e.scope.range=a.DEffectFieldScopeType.Selection,e.effectSuite.targetEffect(0).effect.rmmzSpecialEffectQualifyings.push({code:o.DItemEffect.EFFECT_ADD_STATE,dataId:l.MRData.getState("kState_System_Plating").id,value1:1,value2:0}),e.effectSuite.targetEffect(0).effect.flavorEffect=d.DFlavorEffect.fromRmmzAnimationId(12),t.addReaction(r.MRBasics.actions.ReadActionId,e);break}case"kEntity_地獄耳の巻物A":{this.setupScrollCommon(t);const e=t.mainEmittor();e.scope.range=a.DEffectFieldScopeType.Performer,e.effectSuite.targetEffect(0).effect.effectBehaviors.push({specialEffectId:r.MRBasics.effectBehaviors.clarification,entityId:0,dataId:0,value:r.DClarificationType.Unit}),e.effectSuite.targetEffect(0).effect.effectBehaviors.push({specialEffectId:r.MRBasics.effectBehaviors.performeSkill,entityId:0,dataId:l.MRData.getSkill("kSkill_アイテム擬態解除_全体").id,value:0}),e.effectSuite.targetEffect(0).effect.flavorEffect=d.DFlavorEffect.fromRmmzAnimationId(44),t.addReaction(r.MRBasics.actions.ReadActionId,e);break}case"kEntity_千里眼の巻物A":{this.setupScrollCommon(t);const e=t.mainEmittor();e.scope.range=a.DEffectFieldScopeType.Performer,e.effectSuite.targetEffect(0).effect.effectBehaviors.push({specialEffectId:r.MRBasics.effectBehaviors.clarification,entityId:0,dataId:0,value:r.DClarificationType.Item}),e.effectSuite.targetEffect(0).effect.flavorEffect=d.DFlavorEffect.fromRmmzAnimationId(44),t.addReaction(r.MRBasics.actions.ReadActionId,e);break}case"kEntity_あかりの巻物A":{this.setupScrollCommon(t);const e=t.mainEmittor();e.scope.range=a.DEffectFieldScopeType.Performer,e.effectSuite.targetEffect(0).effect.effectBehaviors.push({specialEffectId:r.MRBasics.effectBehaviors.clarification,entityId:0,dataId:0,value:r.DClarificationType.Unit}),e.effectSuite.targetEffect(0).effect.effectBehaviors.push({specialEffectId:r.MRBasics.effectBehaviors.clarification,entityId:0,dataId:0,value:r.DClarificationType.Trap}),e.effectSuite.targetEffect(0).effect.effectBehaviors.push({specialEffectId:r.MRBasics.effectBehaviors.clarification,entityId:0,dataId:0,value:r.DClarificationType.Terrain}),e.effectSuite.targetEffect(0).effect.effectBehaviors.push({specialEffectId:r.MRBasics.effectBehaviors.clarification,entityId:0,dataId:0,value:r.DClarificationType.Sight}),e.effectSuite.targetEffect(0).effect.flavorEffect=d.DFlavorEffect.fromRmmzAnimationId(44),t.addReaction(r.MRBasics.actions.ReadActionId,e);break}case"kEntity_天の恵みの巻物A":{this.setupScrollCommon(t);const e=l.MRData.cloneEmittor(l.MRData.getSkill("kSkill_武器強化").emittor());e.scope.range=a.DEffectFieldScopeType.Performer,t.addReaction(r.MRBasics.actions.ReadActionId,e);break}case"kEntity_地の恵みの巻物A":{this.setupScrollCommon(t);const e=l.MRData.cloneEmittor(l.MRData.getSkill("kSkill_防具強化").emittor());e.scope.range=a.DEffectFieldScopeType.Performer,t.addReaction(r.MRBasics.actions.ReadActionId,e);break}case"kEntity_おはらいの巻物A":{this.setupScrollCommon(t);const e=t.mainEmittor();e.scope.range=a.DEffectFieldScopeType.Performer,e.effectSuite.targetEffect(0).effect.flavorEffect=d.DFlavorEffect.fromRmmzAnimationId(46);const i=l.MRData.cloneEffect(l.MRData.getSkill("kSkill_解呪").emittor().effectSuite.targetEffect(0).effect),n=l.MRData.cloneEffect(l.MRData.getSkill("kSkill_解呪").emittor().effectSuite.targetEffect(0).effect);i.subEntityFindKey.key=s.DSubComponentEffectTargetKey.make("Equipped",r.MRBasics.entityCategories.WeaponKindId),n.subEntityFindKey.key=s.DSubComponentEffectTargetKey.make("Equipped",r.MRBasics.entityCategories.ShieldKindId),e.effectSuite.addTargetEffect(new m.DEffectRef(i.id)),e.effectSuite.addTargetEffect(new m.DEffectRef(n.id)),t.addReaction(r.MRBasics.actions.ReadActionId,e);break}case"kEntity_食料の巻物A":{this.setupScrollCommon(t);const e=t.mainEmittor();e.scope.range=a.DEffectFieldScopeType.Selection,e.effectSuite.targetEffect(0).effect.effectBehaviors.push({specialEffectId:r.MRBasics.effectBehaviors.changeInstance,entityId:l.MRData.getItem("kEntity_大きなおにぎりA").id,dataId:0,value:0}),e.effectSuite.targetEffect(0).effect.flavorEffect=d.DFlavorEffect.fromRmmzAnimationId(2),t.addReaction(r.MRBasics.actions.ReadActionId,e);break}case"kEntity_祈りの巻物A":{this.setupScrollCommon(t);const e=t.mainEmittor();e.scope.range=a.DEffectFieldScopeType.Selection,e.effectSuite.targetEffect(0).effect.parameterQualifyings.push(new a.DParameterQualifying(r.MRBasics.params.remaining,"5",a.DParameterEffectApplyType.Recover)),e.effectSuite.targetEffect(0).effect.flavorEffect=d.DFlavorEffect.fromRmmzAnimationId(46),t.addReaction(r.MRBasics.actions.ReadActionId,e);break}case"kEntity_かなしばりの巻物A":{this.setupScrollCommon(t);const e=t.mainEmittor();e.scope.range=a.DEffectFieldScopeType.Around,e.scope.length=1,e.effectSuite.targetEffect(0).effect.rmmzSpecialEffectQualifyings.push({code:o.DItemEffect.EFFECT_ADD_STATE,dataId:l.MRData.getState("kState_UTかなしばり").id,value1:1,value2:0}),e.effectSuite.targetEffect(0).effect.flavorEffect=d.DFlavorEffect.fromRmmzAnimationId(15),t.addReaction(r.MRBasics.actions.ReadActionId,e);break}case"kEntity_真空切りの巻物A":{this.setupScrollCommon(t);const e=t.mainEmittor();e.scope.range=a.DEffectFieldScopeType.Room,e.effectSuite.targetEffect(0).effect.parameterQualifyings.push(new a.DParameterQualifying(r.MRBasics.params.hp,"35",a.DParameterEffectApplyType.Damage).withVariance(20)),e.selfAnimationId=94,t.addReaction(r.MRBasics.actions.ReadActionId,e);break}case"kEntity_時の砂の巻物A":{this.setupScrollCommon(t);const e=t.mainEmittor();e.scope.range=a.DEffectFieldScopeType.Performer,e.effectSuite.targetEffect(0).effect.effectBehaviors.push({specialEffectId:r.MRBasics.effectBehaviors.restartFloor,entityId:0,dataId:0,value:0}),t.addReaction(r.MRBasics.actions.ReadActionId,e),e.selfAnimationId=118;break}case"kEntity_脱出の巻物A":this.setupScrollCommon(t),t.mainEmittor().effectSuite.targetEffect(0).effect.otherEffectQualifyings.push({key:"kSystemEffect_脱出"}),t.addReaction(r.MRBasics.actions.ReadActionId,t.mainEmittor()),t.addReaction(r.MRBasics.actions.collide,l.MRData.getSkill("kSkill_投げ当て_1ダメ").emittor()),t.identificationDifficulty=n.DIdentificationDifficulty.NameGuessed;break;case"kEntity_聖域の巻物A":this.setupScrollCommon(t),t.addReaction(r.MRBasics.actions.ReadActionId),t.addReaction(r.MRBasics.actions.collide,l.MRData.getSkill("kSkill_投げ当て_1ダメ").emittor());break;case"kEntity_識別の巻物A":this.setupScrollCommon(t),t.mainEmittor().scope.range=a.DEffectFieldScopeType.Selection,t.mainEmittor().effectSuite.targetEffect(0).effect.otherEffectQualifyings.push({key:"kSystemEffect_識別"}),t.addReaction(r.MRBasics.actions.ReadActionId,t.mainEmittor());break;case"kEntity_投擲反射石A":t.selfTraits.push({code:r.MRBasics.traits.PhysicalProjectileReflector,dataId:0,value:0})}}static setupDirectly_Skill(t){const e=t.emittor();switch(t.key){case"kSkill_炎のブレス_直線":e.scope.range=a.DEffectFieldScopeType.StraightProjectile,e.scope.length=1/0,e.scope.projectilePrefabKey="kEntity_System_炎のブレスA";break;case"kSkill_魔法弾発射_一般":e.scope.range=a.DEffectFieldScopeType.StraightProjectile,e.scope.length=1/0,e.scope.projectilePrefabKey="kEntity_System_MagicBulletA",t.emittor().costs.setParamCost(a.DSkillCostSource.Item,r.MRBasics.params.remaining,{type:a.DParamCostType.Decrease,value:1});break;case"kSkill_ふきとばし":{const t=e.effectSuite.targetEffect(0);t.effect.otherEffectQualifyings.push({key:"kSystemEffect_ふきとばし"}),t.effect.parameterQualifyings.push(new a.DParameterQualifying(r.MRBasics.params.hp,"5",a.DParameterEffectApplyType.Damage));break}case"kSkill_変化":e.effectSuite.targetEffect(0).effect.effectBehaviors.push({specialEffectId:r.MRBasics.effectBehaviors.changeInstance,entityId:0,dataId:0,value:0}),e.effectSuite.targetEffect(0).effect.flavorEffect=d.DFlavorEffect.fromRmmzAnimationId(40);break;case"kSkill_投げ当て_1ダメ":e.scope.range=a.DEffectFieldScopeType.Performer;break;case"kSkill_火炎草ブレス":case"kSkill_装備サビ":e.scope.range=a.DEffectFieldScopeType.Front1;break;case"kSkill_射撃_矢":e.scope.range=a.DEffectFieldScopeType.StraightProjectile,e.scope.length=1/0,e.scope.projectilePrefabKey="kEntity_木の矢A";break;case"kSkill_足つかみ":e.scope.range=a.DEffectFieldScopeType.Front1,e.effectSuite.selfEffect.effect.rmmzSpecialEffectQualifyings.push({code:o.DItemEffect.EFFECT_ADD_STATE,dataId:l.MRData.getState("kState_UT足つかみ").id,value1:100,value2:0});break;case"kSkill_大爆発":e.scope.range=a.DEffectFieldScopeType.Around,e.scope.length=1,e.effectSuite.targetEffect(0).effect.parameterQualifyings[0].elementIds.push(l.MRData.getElement("kElement_DeathExplosion").id),e.selfSequelId=r.MRBasics.sequels.explosion,e.effectSuite.targetEffect(0).effect.hitType=a.DEffectHitType.Magical;break;case"kSkill_アイテム盗み":e.scope.range=a.DEffectFieldScopeType.Front1,e.scope.layers.push(s.DBlockLayerKind.Ground),e.effectSuite.targetEffect(0).effect.effectBehaviors.push({specialEffectId:r.MRBasics.effectBehaviors.itemSteal,entityId:0,dataId:0,value:0});break;case"kSkill_ゴールド盗み":e.scope.range=a.DEffectFieldScopeType.Front1,e.effectSuite.targetEffect(0).effect.effectBehaviors.push({specialEffectId:r.MRBasics.effectBehaviors.goldSteal,entityId:0,dataId:0,value:0});break;case"kSkill_装備サビ_武器":case"kSkill_装備サビ_盾":e.scope.range=a.DEffectFieldScopeType.Front1;const i=new a.DParameterQualifying(r.MRBasics.params.upgradeValue,"1",a.DParameterEffectApplyType.Damage);i.alliesSideGainMessage=(0,h.tr2)("%1はサビてしまった。"),i.alliesSideLossMessage=(0,h.tr2)("%1はサビてしまった。"),i.opponentGainMessage=(0,h.tr2)("%1はサビてしまった。"),i.opponentLossMessage=(0,h.tr2)("%1はサビてしまった。"),e.effectSuite.targetEffect(0).effect.parameterQualifyings.push(i),"kSkill_装備サビ_武器"==t.key?e.effectSuite.targetEffect(0).effect.subEntityFindKey.key=s.DSubComponentEffectTargetKey.make("Equipped",r.MRBasics.entityCategories.WeaponKindId):e.effectSuite.targetEffect(0).effect.subEntityFindKey.key=s.DSubComponentEffectTargetKey.make("Equipped",r.MRBasics.entityCategories.ShieldKindId);break;case"kSkill_混乱魔法_部屋内":e.scope.range=a.DEffectFieldScopeType.Room,e.selfAnimationId=97;break;case"kSkill_毒攻撃":e.scope.range=a.DEffectFieldScopeType.Front1,e.effectSuite.targetEffect(0).effect.parameterQualifyings.push(new a.DParameterQualifying(r.MRBasics.params.pow,"1",a.DParameterEffectApplyType.Damage));break;case"kSkill_毒攻撃_強":e.scope.range=a.DEffectFieldScopeType.Front1,e.effectSuite.targetEffect(0).effect.parameterQualifyings.push(new a.DParameterQualifying(r.MRBasics.params.pow,"3",a.DParameterEffectApplyType.Damage));break;case"kSkill_レベルダウン":e.effectSuite.targetEffect(0).effect.effectBehaviors.push({specialEffectId:r.MRBasics.effectBehaviors.levelDown,entityId:0,dataId:0,value:0});break;case"kSkill_ワープ魔法":e.effectSuite.targetEffect(0).effect.effectBehaviors.push({specialEffectId:r.MRBasics.effectBehaviors.randomWarp,entityId:0,dataId:0,value:0});break;case"kSkill_Warp":e.effectSuite.targetEffect(0).effect.effectBehaviors.push({specialEffectId:r.MRBasics.effectBehaviors.randomWarp,entityId:0,dataId:0,value:0}),e.scope.range=a.DEffectFieldScopeType.Performer;break;case"kSkill_KnockbackAttack":e.effectSuite.targetEffect(0).effect.otherEffectQualifyings.push({key:"kSystemEffect_ふきとばし"}),e.scope.range=a.DEffectFieldScopeType.Front1;break;case"kSkill_武器強化":{const t=e.effectSuite.targetEffect(0);t.effect.parameterQualifyings.push(new a.DParameterQualifying(r.MRBasics.params.upgradeValue,"1",a.DParameterEffectApplyType.Recover)),t.effect.rmmzSpecialEffectQualifyings.push({code:o.DItemEffect.EFFECT_REMOVE_STATE,dataId:l.MRData.system.states.curse,value1:1,value2:0}),t.effect.subEntityFindKey.key=s.DSubComponentEffectTargetKey.make("Equipped",r.MRBasics.entityCategories.WeaponKindId),t.conditions.applyRating=7,t.effect.flavorEffect=d.DFlavorEffect.fromRmmzAnimationId(51);break}case"kSkill_武器強化_強":{const t=e.effectSuite.targetEffect(0);t.effect.parameterQualifyings.push(new a.DParameterQualifying(r.MRBasics.params.upgradeValue,"3",a.DParameterEffectApplyType.Recover)),t.effect.rmmzSpecialEffectQualifyings.push({code:o.DItemEffect.EFFECT_REMOVE_STATE,dataId:l.MRData.system.states.curse,value1:1,value2:0}),t.effect.subEntityFindKey.key=s.DSubComponentEffectTargetKey.make("Equipped",r.MRBasics.entityCategories.WeaponKindId),t.conditions.applyRating=3,t.effect.flavorEffect=d.DFlavorEffect.fromRmmzAnimationId(52);break}case"kSkill_防具強化":{const t=e.effectSuite.targetEffect(0);t.effect.parameterQualifyings.push(new a.DParameterQualifying(r.MRBasics.params.upgradeValue,"1",a.DParameterEffectApplyType.Recover)),t.effect.rmmzSpecialEffectQualifyings.push({code:o.DItemEffect.EFFECT_REMOVE_STATE,dataId:l.MRData.system.states.curse,value1:1,value2:0}),t.effect.subEntityFindKey.key=s.DSubComponentEffectTargetKey.make("Equipped",r.MRBasics.entityCategories.ShieldKindId),t.conditions.applyRating=7,t.effect.flavorEffect=d.DFlavorEffect.fromRmmzAnimationId(51);break}case"kSkill_防具強化_強":{const t=e.effectSuite.targetEffect(0);t.effect.parameterQualifyings.push(new a.DParameterQualifying(r.MRBasics.params.upgradeValue,"3",a.DParameterEffectApplyType.Recover)),t.effect.rmmzSpecialEffectQualifyings.push({code:o.DItemEffect.EFFECT_REMOVE_STATE,dataId:l.MRData.system.states.curse,value1:1,value2:0}),t.effect.subEntityFindKey.key=s.DSubComponentEffectTargetKey.make("Equipped",r.MRBasics.entityCategories.ShieldKindId),t.conditions.applyRating=3,t.effect.flavorEffect=d.DFlavorEffect.fromRmmzAnimationId(52);break}case"kSkill_アイテム擬態解除_全体":e.scope.range=a.DEffectFieldScopeType.Map}}static linkSkill(t){const e=t.emittor();switch(t.key){case"kSkill_装備サビ":{const t=l.MRData.cloneEffect(l.MRData.getSkill("kSkill_装備サビ_武器").emittor().effectSuite.targetEffect(0).effect),i=l.MRData.cloneEffect(l.MRData.getSkill("kSkill_装備サビ_盾").emittor().effectSuite.targetEffect(0).effect);t.subEntityFindKey.key=s.DSubComponentEffectTargetKey.make("Equipped",r.MRBasics.entityCategories.WeaponKindId),i.subEntityFindKey.key=s.DSubComponentEffectTargetKey.make("Equipped",r.MRBasics.entityCategories.ShieldKindId),e.effectSuite.addTargetEffect(new m.DEffectRef(t.id)),e.effectSuite.addTargetEffect(new m.DEffectRef(i.id));break}case"kSkill_武器強化":{const t=l.MRData.getSkill("kSkill_武器強化_強").emittor().effectSuite.targetEffect(0);e.effectSuite.addTargetEffect(t);break}case"kSkill_防具強化":{const t=l.MRData.getSkill("kSkill_防具強化_強").emittor().effectSuite.targetEffect(0);e.effectSuite.addTargetEffect(t);break}}}static linkItem(t){t.item();switch(t.entity.key){case"kEntity_錆ワナA":{const e=t.mainEmittor(),i=l.MRData.cloneEffect(l.MRData.getSkill("kSkill_装備サビ_武器").emittor().effectSuite.targetEffect(0).effect),n=l.MRData.cloneEffect(l.MRData.getSkill("kSkill_装備サビ_盾").emittor().effectSuite.targetEffect(0).effect);i.subEntityFindKey.key=s.DSubComponentEffectTargetKey.make("Equipped",r.MRBasics.entityCategories.WeaponKindId),n.subEntityFindKey.key=s.DSubComponentEffectTargetKey.make("Equipped",r.MRBasics.entityCategories.ShieldKindId),e.effectSuite.addTargetEffect(new m.DEffectRef(i.id)),e.effectSuite.addTargetEffect(new m.DEffectRef(n.id)),e.scope.range=a.DEffectFieldScopeType.Center,e.selfAnimationId=82;break}}}static setupEnemy(t){const e=t.enemyData();switch(e.traits.push({code:r.MRBasics.traits.DeathVulnerableElement,dataId:l.MRData.getElement("kElement_DeathExplosion").id,value:l.MRData.getState("kState_System_ExplosionDeath").id}),t.entity.key){case"kEnemy_ボムA":t.entity.behaviors.push({name:"SelfExplosion"});break;case"kEnemy_ウルフA":case"kEnemy_金剛猫A":t.majorActionDeclines=1;break;case"kEnemy_ゾンビA":case"kEnemy_瑠璃猫A":break;case"kEnemy_黒幕バットA":e.traits.push({code:r.MRBasics.traits.Invisible,dataId:0,value:0});break;case"kEnemy_店主A":t.factionId=l.MRData.system.factions.neutral}}static setupDirectly_State(t){switch(t.key){case"kState_System_ItemStanding":t.effect.behaviors.push({name:"LItemStandingBehavior"});break;case"kState_System_ExplosionDeath":t.deadState=!0;break;case"kState_睡眠":t.idleSequel=r.MRBasics.sequels.asleep;break;case"kState_UT気配察知":t.effect.traits.push({code:r.MRBasics.traits.UnitVisitor,dataId:0,value:0});break;case"kState_UTよくみえ":t.effect.traits.push({code:r.MRBasics.traits.ForceVisible,dataId:0,value:0}),t.effect.autoRemovals.push({kind:c.DAutoRemovalTiming.FloorTransfer});break;case"kState_UnitTest_攻撃必中":t.effect.traits.push({code:r.MRBasics.traits.CertainDirectAttack,dataId:0,value:0});break;case"kState_UnitTest_投擲必中":t.effect.traits.push({code:r.MRBasics.traits.CertainIndirectAttack,dataId:0,value:0});break;case"kState_System_kNap":t.effect.autoRemovals.push({kind:c.DAutoRemovalTiming.DamageTesting,paramId:r.MRBasics.params.hp});break;case"kState_仮眠2":t.effect.traits.push({code:r.MRBasics.traits.StateRemoveByEffect,dataId:0,value:0}),t.idleSequel=r.MRBasics.sequels.asleep;break;case"kState_UTアイテム擬態":t.effect.behaviors.push({name:"LItemImitatorBehavior"});break;case"kState_UT魔法使い":t.effect.traits.push({code:r.MRBasics.traits.EquipmentProficiency,dataId:r.MRBasics.entityCategories.WeaponKindId,value:.5}),t.effect.traits.push({code:r.MRBasics.traits.EquipmentProficiency,dataId:r.MRBasics.entityCategories.ShieldKindId,value:.5}),t.effect.traits.push({code:r.MRBasics.traits.EffectProficiency,dataId:r.MRBasics.entityCategories.grass,value:2});break;case"kState_UT鈍足":t.autoAdditionCondition="a.agi<0";break;case"kState_UT倍速":t.autoAdditionCondition="a.agi>=100";break;case"kState_UT3倍速":t.autoAdditionCondition="a.agi>=200";break;case"kState_UT混乱":t.intentions=c.DStateIntentions.Negative;break;case"kState_UT目つぶし":t.intentions=c.DStateIntentions.Negative,t.effect.restriction=c.DStateRestriction.Blind;break;case"kState_UTまどわし":t.effect.behaviors.push({name:"LIllusionStateBehavior"});break;case"kState_UTからぶり":break;case"kState_UTくちなし":t.effect.traits.push({code:r.MRBasics.traits.SealActivity,dataId:r.MRBasics.actions.EatActionId,value:0}),t.effect.traits.push({code:r.MRBasics.traits.SealActivity,dataId:r.MRBasics.actions.ReadActionId,value:0}),t.effect.autoRemovals.push({kind:c.DAutoRemovalTiming.FloorTransfer});break;case"kState_UTかなしばり":t.effect.autoRemovals.push({kind:c.DAutoRemovalTiming.DamageTesting,paramId:r.MRBasics.params.hp}),t.effect.autoRemovals.push({kind:c.DAutoRemovalTiming.ActualParam,formula:"a.fp <= 0"});break;case"kState_System_Seal":t.effect.traits.push({code:r.MRBasics.traits.SealSpecialAbility,dataId:r.MRBasics.actions.EatActionId,value:0});break;case"kState_UT透明":t.effect.traits.push({code:r.MRBasics.traits.Invisible,dataId:0,value:0}),t.submatchStates.push(l.MRData.getState("kState_UT透明_モンスター").id);break;case"kState_UT透明_モンスター":t.effect.traits.push({code:r.MRBasics.traits.Invisible,dataId:0,value:0}),t.effect.matchConditions.kindId=r.MRBasics.entityCategories.MonsterKindId;break;case"kState_UT足つかみ":t.effect.behaviors.push({name:"LGrabFootBehavior"});break;case"kState_物理投擲回避":t.effect.traits.push({code:r.MRBasics.traits.DodgePhysicalIndirectAttack,dataId:0,value:0});break;case"kState_UT下手投げ":t.effect.traits.push({code:r.MRBasics.traits.AwfulPhysicalIndirectAttack,dataId:0,value:0});break;case"kState_Anger":t.effect.traits.push({code:r.MRBasics.traits.UseSkillForced,dataId:0,value:0});break;case"kState_ATK0":t.effect.traits.push({code:r.MRBasics.traits.ForceParameter,dataId:r.MRBasics.params.atk,value:0});break;case"kState_UTトラバサミ":t.effect.traits.push({code:r.MRBasics.traits.SealActivity,dataId:r.MRBasics.actions.MoveToAdjacentActionId,value:0});break;case"kState_System_Plating":t.effect.traits.push({code:r.MRBasics.traits.ParamDamageRate,dataId:r.MRBasics.params.upgradeValue,value:0}),t.applyConditions.kindIds=[r.MRBasics.entityCategories.WeaponKindId,r.MRBasics.entityCategories.ShieldKindId]}}static setupDirectly_StateGroup(t){switch(t.key){case"kStateGroup_睡眠系":case"kStateGroup_SG速度変化":t.exclusive=!0}}static setupItemCommon(t){this.addVulnerableDeathExplosion(t)}static setupWeaponCommon(t){this.setupItemCommon(t),t.upgradeMin=-99,t.upgradeMax=99,t.idealParams[r.MRBasics.params.upgradeValue]=0,t.identificationDifficulty=n.DIdentificationDifficulty.NameGuessed,t.identificationReaction=l.MRData.getSkill("kAction_Equip").id,this.setupArrowCommon(t),t.entity.kindId=r.MRBasics.entityCategories.WeaponKindId}static setupShieldCommon(t){var e;this.setupItemCommon(t),t.entity.kindId=r.MRBasics.entityCategories.ShieldKindId,t.upgradeMin=-99,t.upgradeMax=99,t.idealParams[r.MRBasics.params.upgradeValue]=0,t.identificationDifficulty=n.DIdentificationDifficulty.NameGuessed,t.identificationReaction=l.MRData.getSkill("kAction_Equip").id;const i=null===(e=t.equipment)||void 0===e?void 0:e.parameters[r.MRBasics.params.def];(0,h.assert)(i);const s=l.MRData.newEmittor(t.entity.key);s.scope.range=a.DEffectFieldScopeType.Performer;const o=l.MRData.newEffect(t.entity.key);o.critical=!1,o.successRate=100,o.hitType=a.DEffectHitType.Physical;const c=new a.DParameterQualifying(r.MRBasics.params.hp,i.value.toString(),a.DParameterEffectApplyType.Damage);o.parameterQualifyings.push(c),s.effectSuite.addTargetEffect(new m.DEffectRef(o.id)),t.addReaction(r.MRBasics.actions.collide,s)}static setupArrowCommon(t){this.setupItemCommon(t),t.entity.kindId=r.MRBasics.entityCategories.ArrowKindId;const e=l.MRData.newEmittor(t.entity.key);e.scope.range=a.DEffectFieldScopeType.Performer;const i=l.MRData.newEffect(t.entity.key);i.critical=!1,i.successRate=100,i.hitType=a.DEffectHitType.Physical;const s=new a.DParameterQualifying(r.MRBasics.params.hp,"a.atk * 4 - b.def * 2",a.DParameterEffectApplyType.Damage).withVariance(20);i.parameterQualifyings.push(s),t.equipment&&(i.flavorEffect=d.DFlavorEffect.fromRmmzAnimationId(t.equipment.targetRmmzAnimationId)),e.effectSuite.addTargetEffect(new m.DEffectRef(i.id)),t.addReaction(r.MRBasics.actions.collide,e)}static setupRingCommon(t){this.setupItemCommon(t),t.entity.behaviors.push({name:"Equipment"})}static setupFoodCommon(t,e){this.setupItemCommon(t),t.entity.kindId=r.MRBasics.entityCategories.FoodKindId;const i=t.mainEmittor();t.addReaction(r.MRBasics.actions.EatActionId,i)}static setupGrassCommon(t,e){this.setupItemCommon(t),t.entity.kindId=r.MRBasics.entityCategories.grass,e=null!=e?e:500;const i=t.mainEmittor();i.scope.range=a.DEffectFieldScopeType.Performer;const s=l.MRData.cloneEmittor(i);t.addReaction(r.MRBasics.actions.collide,s);const o=i,c=l.MRData.newEffect(t.entity.key);c.parameterQualifyings.push(new a.DParameterQualifying(r.MRBasics.params.fp,e.toString(),a.DParameterEffectApplyType.Recover).withSilent()),o.effectSuite.addTargetEffect(new m.DEffectRef(c.id));return t.addReaction(r.MRBasics.actions.EatActionId,o).overrideDisplayCommandName=(0,h.tr2)("飲む"),t.identificationDifficulty=n.DIdentificationDifficulty.Obscure,t.identificationReaction=l.MRData.getSkill("kAction_Eat").id,t.allowModifierState=!1,[o,s]}static setupStaffCommon(t){this.setupItemCommon(t);const e=t.mainEmittor();t.addReaction(r.MRBasics.actions.collide,e)}static setupScrollCommon(t){this.setupItemCommon(t),t.identificationDifficulty=n.DIdentificationDifficulty.Obscure,t.identificationReaction=l.MRData.getSkill("kAction_Read").id}static addVulnerableDeathExplosion(t){t.selfTraits.push({code:r.MRBasics.traits.DeathVulnerableElement,dataId:l.MRData.getElement("kElement_DeathExplosion").id,value:l.MRData.getState("kState_System_ExplosionDeath").id})}}},927:(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DAnnotationReader=void 0;const Common_1=__webpack_require__(1298),MRData_1=__webpack_require__(9185);class DAnnotationReader{static findFirstAnnotationFromEvent(t,e){return this.findFirstAnnotationFromPage(t,e.pages[0].list)}static findFirstAnnotationFromPage(t,e){if(e){let i="",r=!1,s=!1;for(let a=0;a<e.length;a++)if(r)108==e[a].code?r=!1:408==e[a].code&&(i+=e[a].parameters);else if(108==e[a].code){e[a].parameters[0].includes(t)&&(r=!0,s=!0)}if(s)return`{${i}}`}}static tryGetAnnotationFromEvent(annotation,event,rmmzMapId){const block=this.findFirstAnnotationFromPage(annotation,event.pages[0].list);if(!block)return;let rawData;try{eval(`rawData = ${block}`),(0,Common_1.assert)(rawData)}catch(t){throw new Error((0,Common_1.tr2)("%1の構文エラーです。").format(annotation)+`\nMap:${rmmzMapId},Event:${event.id},${event.name}\n`+t.toString())}return rawData}static readLandMetadata(event){const block=this.findFirstAnnotationFromEvent("@MR-Land",event);if(!block)return;let rawData;return eval(`rawData = ${block}`),(0,Common_1.assert)(rawData),rawData}static readStructuresMetadata(event){const block=this.findFirstAnnotationFromEvent("@MR-Structures",event);if(!block)return;let rawData;return eval(`rawData = ${block}`),(0,Common_1.assert)(rawData),rawData}static readPrefabMetadata(t,e){const i=this.tryGetAnnotationFromEvent("@MR-Prefab",t,e);if(i)return(0,Common_1.assert)(i),i}static readPrefabSubPageMetadata(page){const block=this.findFirstAnnotationFromPage("@MR-PrefabSubPage",page.list);if(!block)return;let rawData;return eval(`rawData = ${block}`),(0,Common_1.assert)(rawData),rawData}static readEntityMetadataFromPage(page){var _a,_b,_c,_d,_e,_f,_g,_h;const block=this.findFirstAnnotationFromPage("@MR-Spawner",page.list);if(!block)return;let rawData;eval(`rawData = ${block}`),(0,Common_1.assert)(rawData);const rawData_=rawData;return{entity:rawData.entity?null!==(_a=rawData.entity)&&void 0!==_a?_a:"":null!==(_b=rawData.data)&&void 0!==_b?_b:"",states:null!==(_c=rawData.states)&&void 0!==_c?_c:[],troopId:rawData.troop?MRData_1.MRData.troops.findIndex((t=>t.key==rawData_.troop)):0,stackCount:rawData.stack,override:null!==(_d=rawData.override)&&void 0!==_d&&_d,overrideEvent:null!==(_e=rawData.overrideEvent)&&void 0!==_e&&_e,keeper:null!==(_f=rawData.keeper)&&void 0!==_f&&_f,gold:null!==(_g=rawData.gold)&&void 0!==_g?_g:0,rate:null!==(_h=rawData.rate)&&void 0!==_h?_h:100}}static readFloorMetadataFromPage(page){const block=this.findFirstAnnotationFromPage("@MR-Floor",page.list);if(!block)return;let rawData;return eval(`rawData = ${block}`),(0,Common_1.assert)(rawData),{template:rawData.template,displayName:rawData.displayName,fixedMap:rawData.fixedMap,safety:rawData.safety,bgm:rawData.bgm,preset:rawData.preset}}static readREEventMetadataFromPage(page){const block=this.findFirstAnnotationFromPage("@MR-Event",page.list);if(!block)return;let rawData;eval(`rawData = ${block}`),(0,Common_1.assert)(rawData);const rawData_=rawData;return{trigger:rawData_.trigger,condition_state:rawData_.condition_state}}static readTemplatePartAttributeFromPage(page){const block=this.findFirstAnnotationFromPage("@MR-TemplatePart",page.list);if(!block)return;let rawData;return eval(`rawData = ${block}`),(0,Common_1.assert)(rawData),rawData}static readTroopAttributeFromPage(page){const block=this.findFirstAnnotationFromPage("@MR-Troop",page.list);if(!block)return;let rawData;return eval(`rawData = ${block}`),(0,Common_1.assert)(rawData),rawData}}exports.DAnnotationReader=DAnnotationReader},2779:(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DFloorPresetImporter=void 0;const Common_1=__webpack_require__(1298),DLand_1=__webpack_require__(2255),MRData_1=__webpack_require__(9185);class DFloorPresetImporter{constructor(script){let db={};eval(script),(0,Common_1.assert)(db),this._db=db,this.import()}import(){for(const t of Object.entries(this._db.floorPresets)){const e=t[0],i=t[1],r=MRData_1.MRData.newFloorPreset(e);for(const[t,e]of Object.entries(i.terrains)){const i=MRData_1.MRData.getTerrainSetting(t).id;r.terrains.push(new DLand_1.DTerrainSettingRef(i,e))}if(i.monsterHouses)for(const[t,e]of Object.entries(i.monsterHouses))r.monsterHouses.push({name:t,rating:e})}}}exports.DFloorPresetImporter=DFloorPresetImporter},8767:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DMetadataParser=e.DMetadata=void 0;const r=i(1298),s=i(2213),a=i(9185);class n{constructor(){this.key="",this.effectKey=void 0,this.emittorKey=void 0,this.type="",this.category="",this.behaviors=[],this.traits=[],this.races=[]}}e.DMetadata=n;e.DMetadataParser=class{static parse(t){const e=new n;if(!t)return e;const i=t["MR-Type"];i&&(e.type=i.trim());const r=t["MR-Category"];r&&(e.category=r.trim());const o=t["MR-Key"];o&&(e.key=o.trim());const c=t["MR-EntityTemplate"];c&&(e.entityTemplateKey=c.trim());const l=t["MR-EffectKey"];l&&(e.effectKey=l.trim());const h=t["MR-EmittorKey"];h&&(e.emittorKey=h.trim());const u=t["RE-Capacity"];u&&(e.capacity=u.trim());const d=t["MR-Behavior"];d&&(e.behaviors="string"==typeof d?this.parseMetadata_Behavior([d]):this.parseMetadata_Behavior(d));const p=t["MR-Trait"];if(p){const t=p instanceof Array?p:[p];for(const i of t){const t=s.DHelpers.parseConstructionExpr(i);e.traits.push({code:a.MRData.getTrait(t.name).id,dataId:this.parseTraitDataId(t.args[0]),value:Number(t.args[1])})}}const f=t["MR-Race"];if(f){const t=f instanceof Array?f:[f];for(const i of t)e.races.push(i.trim())}return e}static parseMetadata_Behavior(t){const e=[];for(const i of t)e.push(s.DHelpers.parseConstructionExpr(i));return e}static parseTraitDataId(t){if("string"==typeof t){const e=t.toLowerCase(),i=a.MRData.parameters.find((t=>t.code==e));if(i)return i.id;throw new Error((0,r.tr2)("Trait に指定されているパラメータ名 %1 は不正です。").format(t))}return Number(t)}}},2391:function(__unused_webpack_module,exports,__webpack_require__){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),__importStar=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&__createBinding(e,t,i);return __setModuleDefault(e,t),e};Object.defineProperty(exports,"__esModule",{value:!0}),exports.evalScript=void 0;const DSetupScript_1=__webpack_require__(7979),index=__importStar(__webpack_require__(2163)),Common_1=__webpack_require__(1298);function EntityCategory(t){return t}function Effect(t){return t}function ParameterFlavorEffect(t){return t}function ParameterValue(t){return t}function ParameterBuff(t){return t}function SpecialEffect(t){return t}function Trait(t){return t}function FlavorEffect(t){return t}function Emittor(t){return t}function EffectRef(t){return t}function Entity(t){return t}function Reaction(t){return t}function EntityTemplate(t){return t}function evalScript(obj,script){const require=function(t){return index},tr=Common_1.tr2;(0,DSetupScript_1.setDB)(obj),eval(script),(0,DSetupScript_1.setDB)(void 0)}exports.evalScript=evalScript},7979:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DSetupScript=e.setDB=e.db=e.DSetupScriptDatabase=void 0;const r=i(9185),s=i(2391);class a{constructor(){this.parameters={},this.entityCategories={},this.entityTemplates={},this.entities3={},this.actions={},this.effects={},this.emittors={},this.entities={}}mergeFrom(t){Object.assign(this.parameters,t.parameters),Object.assign(this.entityCategories,t.entityCategories),Object.assign(this.entityTemplates,t.entityTemplates),Object.assign(this.entities3,t.entities3),Object.assign(this.actions,t.actions),Object.assign(this.effects,t.effects),Object.assign(this.emittors,t.emittors),Object.assign(this.entities,t.entities)}}e.DSetupScriptDatabase=a,e.setDB=function(t){e.db=t};e.DSetupScript=class{constructor(){this._mainDB=new a}addScript(t){const e=new a;(0,s.evalScript)(e,t),this._mainDB.mergeFrom(e)}registerData(){for(const t in this._mainDB.parameters)r.MRData.parameters.find((e=>e.key==t))||r.MRData.addParams(t,"")}setupData(){this.createEntityCategories(),this.createActions(),this.createEffects(),this.createEmittors(),this.createEntityTemplates(),this.createEntities();for(const t of r.MRData.parameters){const e=this._mainDB.parameters[t.key];e&&e.setup(t)}this.setupEntityCategories(),this.setupActions(),this.setupEffects(),this.setupEmittors(),this.setupEntityTemplates(),this.setupEntities()}createEntityCategories(){for(const[t,e]of Object.entries(this._mainDB.entityCategories))r.MRData.categories.find((e=>e.key==t))||r.MRData.newEntityCategory(t)}setupEntityCategories(){for(const t of r.MRData.categories){const e=this._mainDB.entityCategories[t.key];e&&t.applyProps(e)}}createEffects(){for(const[t,e]of Object.entries(this._mainDB.effects))r.MRData.effects.find((e=>e.key==t))||r.MRData.newEffect(t)}setupEffects(){for(const t of r.MRData.effects){const e=this._mainDB.effects[t.key];e&&t.applyProps(e)}}createEmittors(){if(this._mainDB.emittors)for(const[t,e]of Object.entries(this._mainDB.emittors))r.MRData.emittors.find((e=>e.key==t))||r.MRData.newEmittor(t)}setupEmittors(){if(this._mainDB.emittors)for(const t of r.MRData.emittors){const e=this._mainDB.emittors[t.key];e&&t.applyProps(e)}}createActions(){if(this._mainDB.actions)for(const[t,e]of Object.entries(this._mainDB.actions))r.MRData.skills.find((e=>e.key==t))||r.MRData.newEmittor(t)}setupActions(){if(this._mainDB.actions)for(const t of r.MRData.skills){const e=this._mainDB.actions[t.key];e&&t.applyProps(e)}}createEntityTemplates(){if(this._mainDB.entityTemplates)for(const[t,e]of Object.entries(this._mainDB.entityTemplates))r.MRData.entityTemplates.find((e=>e.key==t))||r.MRData.newEntityTemplate(t,e)}setupEntityTemplates(){if(this._mainDB.entityTemplates)for(const t of r.MRData.entityTemplates){const e=this._mainDB.entityTemplates[t.key];e&&t.resetProps(e)}}createEntities(){if(this._mainDB.entities)for(const[t,e]of Object.entries(this._mainDB.entities))if(!r.MRData.entities.find((e=>e.entity.key==t))){r.MRData.newEntity().entity.key=t}}setupEntities(){if(this._mainDB.entities)for(const t of r.MRData.entities){if(t.entityTemplateKey){r.MRData.getEntityTemplate(t.entityTemplateKey).applyTo(t)}const e=this._mainDB.entities[t.entity.key];e&&t.applyProps(e)}}setupItem(t){{const e=this._mainDB.entities3[t.entity.key];e&&e.setup(t)}}}},6882:(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DTerrainSettingImporter=void 0;const Common_1=__webpack_require__(1298),MRData_1=__webpack_require__(9185);class DTerrainSettingImporter{constructor(script){let db={};eval(script),(0,Common_1.assert)(db),this._db=db,this.import()}import(){for(const t of Object.entries(this._db.terrainSettings)){const e=t[0],i=t[1],r=MRData_1.MRData.newTerrainSetting(e);for(const[t,e]of Object.entries(i.shapes)){const i=MRData_1.MRData.getTerrainShape(t).id;r.shapeRefs.push({dataId:i,rate:e})}if(i.structures)for(const[t,e]of Object.entries(i.structures))r.forceStructures.push({typeName:t,rate:100*e})}}}exports.DTerrainSettingImporter=DTerrainSettingImporter},2163:function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),s=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),s(i(4561),e),s(i(6901),e),s(i(5739),e),s(i(6539),e),s(i(7979),e),s(i(2391),e),s(i(3654),e),s(i(9185),e),s(i(4836),e)},6251:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FGenericRandomMapGenerator=void 0;const r=i(1298),s=i(5712),a=i(6294),n=i(5449),o=i(302),c=i(9185),l=i(3609);e.FGenericRandomMapGenerator=class{constructor(t,e){this._map=t,this._setting=e;const i=a.UEffect.selectRating(this.random,e.shapeRefs,(t=>t.rate));this._shape=i?c.MRData.terrainShapes[i.dataId]:c.MRData.getTerrainShape("kTerrainShape_Default"),t.resetFromInnerSize(this._shape.width,this._shape.height,l.paramRandomMapPaddingX,l.paramRandomMapPaddingY)}get random(){return this._map.random()}generate(){this.makeSectors()&&(this.makeSectorAdjacency(),this.makeSectorConnections(),this.makeRoomShapeDefinitions(),this.makeStructureDefinitions(),this.makeRooms(),this.makePivots(),this.makeEdgePins(),this.makePinConnections(),this.makePassageWay(),this.makeBlocks())}reportError(t){throw new Error(t)}makeSectors(){const t=this._shape.divisionCountX,e=this._shape.divisionCountY;{const i=this._map.innerWidth/t,r=this._map.innerHeight/e;if(i<7||r<7)return this.reportError("Map size too small for number of area divisions."),!1;for(let s=0;s<e;s++)for(let a=0;a<t;a++){const n=this._map.newSector(),o=a<t-1?i:this._map.innerWidth-i*(t-1),c=s<e-1?r:this._map.innerHeight-r*(e-1);n.setRect(this._map.ox+i*a,this._map.oy+r*s,o,c)}}return!0}makeSectorAdjacency(){for(const t of this._map.sectors())for(const e of this._map.sectors())t!=e&&(t.my1<=e.my2&&t.my2>=e.my1?t.mx1-1==e.mx2?this._map.attemptNewAdjacency(t,n.FDirection.L,e,n.FDirection.R):t.mx2+1==e.mx1&&this._map.attemptNewAdjacency(t,n.FDirection.R,e,n.FDirection.L):t.mx1<=e.mx2&&t.mx2>=e.mx1&&(t.my1-1==e.my2?this._map.attemptNewAdjacency(t,n.FDirection.T,e,n.FDirection.B):t.my2+1==e.my1&&this._map.attemptNewAdjacency(t,n.FDirection.B,e,n.FDirection.T)))}makeSectorConnections(){o.FSectorConnectionBuilder.connect(this._map,this.random,this._shape)}makeRoomShapeDefinitions(){const t=this._map.sectors(),e=t.length;let i=this._shape.forceRoomShapes.length;i>=e&&(i=e);{const r=new Array(e);for(let t=0;t<i;t++)r[t]=this._shape.forceRoomShapes[t].typeName;this.random.mutableShuffleArray(r);for(let i=0;i<e;i++)r[i]&&(t[i].roomShapeType=r[i])}}makeStructureDefinitions(){const t=this._map.sectors(),e=t.length;let i=this._setting.forceStructures.length;i>=e&&(i=e);{const i=[];for(const t of this._setting.forceStructures)this.random.nextIntWithMax(100)<t.rate&&i.push(t.typeName);const r=new Array(e);for(let t=0;t<i.length;t++)r[t]=i[t];this.random.mutableShuffleArray(r);for(let i=0;i<e;i++)r[i]&&(t[i].structureType=r[i])}}makeRooms(){const t=1==this._map.sectors().length,e=[];for(const i of this._map.sectors())(t||i.hasAnyConnection())&&e.push(i);const i=e.length,r=new Array(i);let s=0;this._shape.roomCountMax==1/0?s=i:(s=this.random.nextIntWithMinMax(this._shape.roomCountMin,this._shape.roomCountMax+1),s=Math.min(Math.max(s,2),i));for(let t=0;t<s;t++)r[t]=!0;s<r.length&&this.random.mutableShuffleArray(r);for(let t=0;t<i;t++){const i=e[t];if(r[t]){const t=this._map.newRoom(i),[e,r,s,a]=i.getRoomCandidateRelativeRect(),n=s-e+1,o=a-r+1;if("FullPlane"==i.roomShapeType)t.setRect(i.mx1+e,i.my1+r,n,o),t.poorVisibility=!0;else if("HalfPlane"==i.roomShapeType){const e=i.width(),r=i.height(),s=e/2,a=r/2,n=(e-s)/2,o=(r-a)/2;t.setRect(i.mx1+n,i.my1+o,s,a),t.poorVisibility=!0}else{const s=this.random.nextIntWithMinMax(4,n),a=this.random.nextIntWithMinMax(4,o),c=e+(s!=n?this.random.nextIntWithMax(n-s):0),l=r+(a!=o?this.random.nextIntWithMax(o-a):0);t.setRect(i.mx1+c,i.my1+l,s,a)}}}}makePivots(){for(const t of this._map.sectors()){const e=t.room();if(e){const i=e.mx1-t.mx1,s=e.my1-t.my1;(0,r.assert)(i>=0),(0,r.assert)(s>=0),t.setPivot(i+this.random.nextIntWithMax(e.width),s+this.random.nextIntWithMax(e.height))}else{const[e,i,r,s]=t.getRoomCandidateRelativeRect();t.setPivot(e+this.random.nextIntWithMax(r-e),i+this.random.nextIntWithMax(s-i))}}}makeEdgePins(){for(const t of this._map.sectors()){const e=t.room();let i,r,a,o,c,l,h,u;if(e?(i=e.width,r=e.height,a=e.mx1-t.mx1,o=e.my1-t.my1,c=e.mx1-1,l=e.mx2+1,h=e.my1-1,u=e.my2+1):(i=t.width(),r=t.height(),a=0,o=0,c=-1,l=-1,h=-1,u=-1),this._shape.wayConnectionMode==s.FGenericRandomMapWayConnectionMode.RoomEdge){for(let e=0;e<i;e++)t.edge(n.FDirection.T).addPin(a+e),t.edge(n.FDirection.B).addPin(a+e);for(let e=0;e<r;e++)t.edge(n.FDirection.L).addPin(o+e),t.edge(n.FDirection.R).addPin(o+e)}else{if(this._shape.wayConnectionMode!=s.FGenericRandomMapWayConnectionMode.SectionEdge)throw new Error("Unreachable.");{const e=t.mx1,i=t.my1;for(let i=0;i<t.width()-1;i++)e+i!=c&&e+i!=l&&(t.edge(n.FDirection.T).addPin(i),t.edge(n.FDirection.B).addPin(i));for(let e=0;e<t.height()-1;e++)i+e!=h&&i+e!=u&&(t.edge(n.FDirection.L).addPin(e),t.edge(n.FDirection.R).addPin(e))}}}}makePinConnections(){for(const t of this._map.connections()){const e=t.edge1().pins(),i=t.edge2().pins(),r=t.edge1().sector(),s=t.edge2().sector(),a=[],o=[];if(t.alignedAxis()==n.FAxis.H){for(const t of e)s.isRoomBesideY(t.my())||a.push(t);for(const t of i)r.isRoomBesideY(t.my())||o.push(t)}else{for(const t of e)s.isRoomBesideX(t.mx())||a.push(t);for(const t of i)r.isRoomBesideX(t.mx())||o.push(t)}t.setConnectedPins(a[this.random.nextIntWithMax(a.length)],o[this.random.nextIntWithMax(o.length)])}}makePassageWay(){for(const t of this._map.connections()){const e=t.pin1(),i=t.pin2();if(!e||!i)continue;const s=e.edge().sector(),a=i.edge().sector();switch(t.alignedAxis()){case n.FAxis.H:{let t,o;s.mx1<a.mx2?(t=s,o=a):(t=a,o=s);t.edge(n.FDirection.R),o.edge(n.FDirection.L);const c=t.room(),l=o.room(),h=c?c.mx2+1:-100,u=l?l.mx1-1:-100,d=[],p=t.mx1+t.px()+2,f=o.mx1+o.px()-2;for(let t=p;t<=f;t++)t!=h&&t!=u&&d.push(t);(0,r.assert)(d.length>0);const m=d[this.random.nextIntWithMax(d.length)],y=Math.min(e.my(),i.my()),_=Math.max(e.my(),i.my());for(let t=y;t<=_;t++){this._map.block(m,t).setComponent(n.FBlockComponent.Passageway)}this.plotSecondaryWay(m,e.my(),s,n.FAxis.H),this.plotSecondaryWay(m,i.my(),a,n.FAxis.H);break}case n.FAxis.V:{let t,o;s.mx1<a.mx2?(t=s,o=a):(t=a,o=s);const c=t.room(),l=o.room(),h=c?c.my2+1:-100,u=l?l.my1-1:-100,d=[],p=t.my1+t.py()+2,f=o.my1+o.py()-2;for(let t=p;t<=f;t++)t!=h&&t!=u&&d.push(t);d.length<=0&&(0,r.assert)(d.length>0);const m=d[this.random.nextIntWithMax(d.length)],y=Math.min(e.mx(),i.mx()),_=Math.max(e.mx(),i.mx());for(let t=y;t<=_;t++){this._map.block(t,m).setComponent(n.FBlockComponent.Passageway)}this.plotSecondaryWay(e.mx(),m,s,n.FAxis.V),this.plotSecondaryWay(i.mx(),m,a,n.FAxis.V);break}default:throw new Error("Unreachable.")}}}plotSecondaryWay(t,e,i,r){const s=i.mx1+i.px(),a=i.my1+i.py();switch(r){case n.FAxis.H:{const i=Math.min(t,s),r=Math.max(t,s);for(let t=i;t<=r;t++)this._map.block(t,e).setComponent(n.FBlockComponent.Passageway);const o=Math.min(e,a),c=Math.max(e,a);for(let t=o;t<=c;t++)this._map.block(s,t).setComponent(n.FBlockComponent.Passageway);break}case n.FAxis.V:{const i=Math.min(e,a),r=Math.max(e,a);for(let e=i;e<=r;e++)this._map.block(t,e).setComponent(n.FBlockComponent.Passageway);const o=Math.min(t,s),c=Math.max(t,s);for(let t=o;t<=c;t++)this._map.block(t,a).setComponent(n.FBlockComponent.Passageway);break}default:throw new Error("Unreachable.")}}makeBlocks(){for(const t of this._map.rooms())for(let e=t.my1;e<=t.my2;e++)for(let i=t.mx1;i<=t.mx2;i++){const r=this._map.block(i,e);r.setComponent(n.FBlockComponent.Room),r.setRoomId(t.id())}}}},894:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FMapBuildPass_ResolveRoomShapes=e.FMapBuildPass_MakeRoomId=e.FMapBuilder=void 0;const r=i(4718),s=i(8457),a=i(9030),n=i(57),o=i(1275),c=i(1654),l=i(9717),h=i(3719);e.FMapBuilder=class{buildForRandomMap(t){[new u,new s.FMarkContinuationPass,new n.FMakeTileKindPass,new a.FEntryPointAndExitPointPass,new o.FMakeMonsterHouseForRandomMapPass,new c.FMakeItemShopPass,new h.FBackgroundWaterPass,new l.FDecorationPass].forEach((e=>e.execute(t)))}buildForFixedMap(t){[new u,new d,new s.FMarkContinuationPass,new o.FMakeMonsterHouseForFixedMapPass,new c.FMakeItemShopPass].forEach((e=>e.execute(t)))}};class u extends r.FMapBuildPass{execute(t){for(;;){const e=t.innerBlocks.filter((t=>t.isRoom()&&0==t.roomId()));if(0==e.length)break;const i=t.newSector(),r=t.newRoom(i);let s=[e[0]],a=[];for(;s.length>0;)s.forEach((e=>{if(0==e.roomId()){e.setRoomId(r.id());const i=t.blockTry(e.mx-1,e.my);i&&i.isRoom()&&0==i.roomId()&&a.push(i);const s=t.blockTry(e.mx,e.my-1);s&&s.isRoom()&&0==s.roomId()&&a.push(s);const n=t.blockTry(e.mx+1,e.my);n&&n.isRoom()&&0==n.roomId()&&a.push(n);const o=t.blockTry(e.mx,e.my+1);o&&o.isRoom()&&0==o.roomId()&&a.push(o)}})),[s,a]=[a,s],a=[]}}}e.FMapBuildPass_MakeRoomId=u;class d extends r.FMapBuildPass{execute(t){for(const e of t.blocks()){t.room(e.roomId()).tryInfrateRect(e.mx,e.my)}}}e.FMapBuildPass_ResolveRoomShapes=d},5449:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FMap=e.FExitPont=e.FEntryPont=e.FRoom=e.FSectorEdge=e.FEdgePin=e.FBlockComponent=e.FAxis=e.FDirection=void 0;const r=i(1298),s=i(1130),a=i(4879),n=i(7687),o=i(3608),c=i(9185);var l,h;!function(t){t[t.T=0]="T",t[t.B=1]="B",t[t.L=2]="L",t[t.R=3]="R"}(l=e.FDirection||(e.FDirection={})),function(t){t[t.H=0]="H",t[t.V=1]="V"}(e.FAxis||(e.FAxis={})),function(t){t[t.None=0]="None",t[t.Room=1]="Room",t[t.Passageway=2]="Passageway"}(h=e.FBlockComponent||(e.FBlockComponent={}));class u{constructor(t,e){this._edge=t,this._pos=e}edge(){return this._edge}pos(){return this._pos}mx(){const t=this._edge.sector(),e=this._edge.direction();return e==l.L?t.mx1:e==l.R?t.mx2:t.mx1+this._pos}my(){const t=this._edge.sector(),e=this._edge.direction();return e==l.T?t.my1:e==l.B?t.my2:t.my1+this._pos}}e.FEdgePin=u;e.FSectorEdge=class{constructor(t,e){this._sector=t,this._direction=e,this._adjacencies=[],this._connections=[],this._pins=[]}sector(){return this._sector}direction(){return this._direction}resetLength(t){this._pins=[]}addAdjacency(t){this._adjacencies.push(t)}hasAdjacency(){return this._adjacencies.length>0}adjacencies(){return this._adjacencies}addConnection(t){this._connections.push(t)}hasConnection(){return this._connections.length>0}hasConnectionFully(){return this._connections.length==this._adjacencies.length}addPin(t){const e=new u(this,t);this._pins.push(e)}pins(){return this._pins}isValidPinPos(t){return null!=this._pins.find((e=>e.pos()==t))}};class d{constructor(t,e,i){this._mx1=-1,this._my1=-1,this._mx2=-1,this._my2=-1,this._structures=[],this.poorVisibility=!1,this._map=t,this._id=e,this._sector=i}id(){return this._id}sector(){return this._sector}get mx1(){return this._mx1}get my1(){return this._my1}get mx2(){return this._mx2}get my2(){return this._my2}get width(){return this._mx2-this._mx1+1}get height(){return this._my2-this._my1+1}tryInfrateRect(t,e){0!=this._id&&(this._mx1<0?(this._mx1=t,this._my1=e,this._mx2=t,this._my2=e):(this._mx1=Math.min(this._mx1,t),this._my1=Math.min(this._my1,e),this._mx2=Math.max(this._mx2,t),this._my2=Math.max(this._my2,e)))}forEachBlocks(t){if(0!=this._id)for(let e=this._my1;e<=this._my2;e++)for(let i=this._mx1;i<=this._mx2;i++)t(this._map.block(i,e))}setRect(t,e,i,r){this._mx1=t,this._my1=e,this._mx2=t+i-1,this._my2=e+r-1}blocks(){const t=[];for(let e=this._my1;e<=this._my2;e++)for(let i=this._mx1;i<=this._mx2;i++)t.push(this._map.block(i,e));return t}addStructureRef(t){this._structures.push(t)}structures(){return this._structures}}e.FRoom=d;e.FEntryPont=class{constructor(t,e){this._mx=t,this._my=e}mx(){return this._mx}my(){return this._my}};e.FExitPont=class{constructor(t,e){this._mx=t,this._my=e}mx(){return this._mx}my(){return this._my}};e.FMap=class{constructor(t,e){this._floorId=t,this._randSeed=e,this._rand=new s.LRandom(this._randSeed),this._innerWidth=0,this._innerHeight=0,this._fullWidth=0,this._fullHeight=0,this._paddingX=0,this._paddingY=0,this._blocks=[],this._innerBlocks=[],this._sectorAdjacencies=[],this._sectorConnections=[],this._sectors=[],this._rooms=[],this._structures=[];const i=t.floorInfo(),r=i.template?c.MRData.templateMaps.find((t=>t.name==i.template)):void 0;this._templateId=(null!=r?r:c.MRData.templateMaps[1]).id}resetFromInnerSize(t,e,i,r){this.resetFromFullSize(t+2*i,e+2*r,i,r)}resetFromFullSize(t,e,i,r){this._fullWidth=t,this._fullHeight=e,this._innerWidth=t-2*i,this._innerHeight=e-2*r,this._paddingX=i,this._paddingY=r,this._blocks=new Array(t*e),this._innerBlocks=[];for(let t=0;t<this._blocks.length;t++){const e=Math.trunc(t%this._fullWidth),i=Math.trunc(t/this._fullWidth),r=new o.FMapBlock(e,i);this._blocks[t]=r,this.ox<=e&&e<this.ox+this._innerWidth&&this.oy<=i&&i<this.oy+this._innerHeight?this._innerBlocks.push(r):r.setTileShape(a.LTileShape.Wall)}this._sectors=[new n.FSector(this,0)],this._rooms=[new d(this,0,this._sectors[0])]}floorId(){return this._floorId}random(){return this._rand}get ox(){return this._paddingX}get oy(){return this._paddingY}get fullWidth(){return this._fullWidth}get fullHeight(){return this._fullHeight}get innerWidth(){return this._innerWidth}get innerHeight(){return this._innerHeight}blocks(){return this._blocks}get innerBlocks(){return this._innerBlocks}innerBlock(t,e){return this.block(this._paddingX+t,this._paddingY+e)}blockTry(t,e){return this.isValid(t,e)?this._blocks[e*this._fullWidth+t]:void 0}block(t,e){const i=this._blocks[e*this._fullWidth+t];return(0,r.assert)(i),i}sectors(){return this._sectors.filter((t=>t.id()>0))}newSector(){const t=new n.FSector(this,this._sectors.length);return this._sectors.push(t),t}attemptNewAdjacency(t,e,i,r){const s=t.edge(e),a=i.edge(r),o=this._sectorAdjacencies.find((t=>t.hasPair(s,a)));if(o)return o;const c=new n.FSectorAdjacency(s,a);return this._sectorAdjacencies.push(c),s.addAdjacency(c),a.addAdjacency(c),c}connectSectors(t,e){(0,r.assert)(t!=e);const i=new n.FSectorConnection(this._sectorConnections.length,t,e);return this._sectorConnections.push(i),t.addConnection(i),e.addConnection(i),i}adjacencies(){return this._sectorAdjacencies}connections(){return this._sectorConnections}room(t){return this._rooms[t]}rooms_raw(){return this._rooms}rooms(){return this._rooms.filter((t=>t.id()>0))}newRoom(t){const e=new d(this,this._rooms.length,t);return this._rooms.push(e),t.setRoom(e),e}structures(){return this._structures}addStructure(t){this._structures.push(t)}isValid(t,e){return 0<=t&&t<this._fullWidth&&0<=e&&e<this._fullHeight}setEntryPont(t){this._entryPoint=t}entryPoint(){return this._entryPoint}setExitPont(t){this._exitPont=t}exitPont(){return this._exitPont}rmmzFixedMapData(){return(0,r.assert)(this._floorId.isFixedMap()),$dataMap}get templateId(){return this._templateId}print(){let t="";for(let e=0;e<this._fullHeight;e++){for(let i=0;i<this._fullWidth;i++)if(this._exitPont&&this._exitPont.mx()==i&&this._exitPont.my()==e)t+="!";else if(this._sectors.find((t=>t.mx1+t.px()==i&&t.my1+t.py()==e)))t+="@";else if(this.block(i,e).isContinuation())t+="o";else if(this.block(i,e).isDoorway())t+="&";else switch(this.block(i,e).component()){case h.None:t+=".";break;case h.Room:t+="*";break;case h.Passageway:t+="#"}t+="\n"}console.log(t),console.log("Seed:",this._randSeed)}}},302:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FSectorConnectionBuilder=void 0;const r=i(1298),s=i(5712),a=i(5449);e.FSectorConnectionBuilder=class{static connect(t,e,i){switch(i.connectionPreset){case s.DSectorConnectionPreset.Default:this.connectDefault(t,e);break;case s.DSectorConnectionPreset.C:this.connectC(t,e,i);break;case s.DSectorConnectionPreset.H:this.connectH(t,e,i);break;default:throw new Error("Not implemented.")}}static connectDefault(t,e){const i=[],r=[],s=t.sectors().length;{let a=t.sectors()[e.nextIntWithMax(s)];for(let n=0;n<s;n++){const s=[];for(const t of a.edges())for(const e of t.adjacencies()){const i=e.otherSide(t);r.includes(i.sector().id())||s.push(e)}if(!(s.length>0))break;{const n=s[e.nextIntWithMax(s.length)];t.connectSectors(n.edge1(),n.edge2()),i.push(a.id()),r.push(a.id()),a=n.otherSideBySector(a).sector()}}}for(let r=0;r<s;r++){for(const r of t.sectors())if(!i.includes(r.id())){const s=[];for(const t of r.edges())for(const e of t.adjacencies()){const r=e.otherSide(t);i.includes(r.sector().id())&&s.push(e)}if(s.length>0){const a=s[e.nextIntWithMax(s.length)];t.connectSectors(a.edge1(),a.edge2()),i.push(r.id())}}if(i.length==s)break}}static sector(t,e,i,r){const s=e.divisionCountX;return t.sectors()[s*r+i]}static connectC(t,e,i){(0,r.assert)(i.divisionCountX>=3),(0,r.assert)(i.divisionCountY>=3);const s=i.divisionCountX-1,n=i.divisionCountY-1;for(let e=0;e<s;e++){const r=this.sector(t,i,e,0),s=this.sector(t,i,e+1,0);t.connectSectors(r.edge(a.FDirection.R),s.edge(a.FDirection.L))}for(let e=0;e<n;e++){const r=this.sector(t,i,0,e),s=this.sector(t,i,0,e+1);t.connectSectors(r.edge(a.FDirection.B),s.edge(a.FDirection.T))}for(let e=0;e<s;e++){const r=this.sector(t,i,e,n),s=this.sector(t,i,e+1,n);t.connectSectors(r.edge(a.FDirection.R),s.edge(a.FDirection.L))}}static connectH(t,e,i){(0,r.assert)(i.divisionCountX>=3),(0,r.assert)(i.divisionCountY>=3);const s=i.divisionCountX-1,n=i.divisionCountY-1,o=Math.floor(i.divisionCountY/2);for(let e=0;e<n;e++){const r=this.sector(t,i,0,e),s=this.sector(t,i,0,e+1);t.connectSectors(r.edge(a.FDirection.B),s.edge(a.FDirection.T))}for(let e=0;e<n;e++){const r=this.sector(t,i,s,e),n=this.sector(t,i,s,e+1);t.connectSectors(r.edge(a.FDirection.B),n.edge(a.FDirection.T))}for(let e=0;e<s;e++){const r=this.sector(t,i,e,o),s=this.sector(t,i,e+1,o);t.connectSectors(r.edge(a.FDirection.R),s.edge(a.FDirection.L))}}}},5306:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FItemShopStructure=e.FMonsterHouseStructure=e.FStructure=void 0;class i{}e.FStructure=i;e.FMonsterHouseStructure=class extends i{constructor(t,e){super(),this._roomId=t,this._monsterHouseTypeId=e}roomId(){return this._roomId}setMonsterHouseTypeId(t){this._monsterHouseTypeId=t}monsterHouseTypeId(){return this._monsterHouseTypeId}};e.FItemShopStructure=class extends i{constructor(t,e){super(),this._roomId=t,this._itemShopTypeId=e}roomId(){return this._roomId}setItemShopTypeId(t){this._itemShopTypeId=t}itemShopTypeId(){return this._itemShopTypeId}}},3608:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FMapBlock=void 0;const r=i(4879),s=i(5449);e.FMapBlock=class{constructor(t,e){this._mx=t,this._my=e,this._tileShape=r.LTileShape.Wall,this._blockComponent=s.FBlockComponent.None,this._sectorId=0,this._roomId=0,this._doorway=!1,this._continuation=!1,this._shapeVisualPartIndex=0,this._decorationVisualPartIndex=0,this._fixedMapMonsterHouseTypeId=0,this._fixedMapItemShopTypeId=0}get mx(){return this._mx}get my(){return this._my}setTileShape(t){this._tileShape=t}tileShape(){return this._tileShape}setComponent(t){this._blockComponent=t}component(){return this._blockComponent}setFixedMapMonsterHouseTypeId(t){this._fixedMapMonsterHouseTypeId=t}fixedMapMonsterHouseTypeId(){return this._fixedMapMonsterHouseTypeId}setFixedMapItemShopTypeId(t){this._fixedMapItemShopTypeId=t}fixedMapItemShopTypeId(){return this._fixedMapItemShopTypeId}setSectorId(t){this._sectorId=t}sectorId(){return this._sectorId}setRoomId(t){this._roomId=t}isRoom(){return this._blockComponent==s.FBlockComponent.Room}isPassagableComponent(){return this._blockComponent==s.FBlockComponent.Room||this._blockComponent==s.FBlockComponent.Passageway}roomId(){return this._roomId}setDoorway(t){this._doorway=t}isDoorway(){return this._doorway}setContinuation(t){this._continuation=t}isContinuation(){return this._continuation}get shapeVisualPartIndex(){return this._shapeVisualPartIndex}setShapeVisualPartIndex(t){this._shapeVisualPartIndex=t}get decorationVisualPartIndex(){return this._decorationVisualPartIndex}setDecorationVisualPartIndex(t){this._decorationVisualPartIndex=t}}},7687:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FSectorConnection=e.FSectorAdjacency=e.FSector=void 0;const r=i(1298),s=i(5449);e.FSector=class{constructor(t,e){this._mx1=-1,this._my1=-1,this._mx2=-1,this._my2=-1,this._px=0,this._py=0,this._map=t,this._id=e,this._edges=[new s.FSectorEdge(this,s.FDirection.T),new s.FSectorEdge(this,s.FDirection.B),new s.FSectorEdge(this,s.FDirection.L),new s.FSectorEdge(this,s.FDirection.R)],this._roomShapeType="",this._structureType=""}setRect(t,e,i,r){this._mx1=t,this._my1=e,this._mx2=t+i-1,this._my2=e+r-1;for(let t=this._my1;t<=this._my2;t++)for(let e=this._mx1;e<=this._mx2;e++)this._map.block(e,t).setSectorId(this._id);this._edges[s.FDirection.T].resetLength(this.width()),this._edges[s.FDirection.B].resetLength(this.width()),this._edges[s.FDirection.L].resetLength(this.height()),this._edges[s.FDirection.R].resetLength(this.height())}id(){return this._id}get mx1(){return this._mx1}get my1(){return this._my1}get mx2(){return this._mx2}get my2(){return this._my2}px(){return this._px}py(){return this._py}get pivotMX(){return this._mx1+this._px}get pivotMY(){return this._my1+this._py}width(){return this._mx2-this._mx1+1}height(){return this._my2-this._my1+1}setPivot(t,e){this._px=t,this._py=e}edge(t){return this._edges[t]}edges(){return this._edges}get roomShapeType(){return this._roomShapeType}set roomShapeType(t){this._roomShapeType=t}get structureType(){return this._structureType}set structureType(t){this._structureType=t}room(){return this._room}setRoom(t){this._room=t}isRoomBesideX(t){return!!this._room&&(this._room.mx1-1==t||this._room.mx2+1==t)}isRoomBesideY(t){return!!this._room&&(this._room.my1-1==t||this._room.my2+1==t)}GlobalToLocalX(t){return t-this.mx1}GlobalToLocalY(t){return t-this.my1}contains(t,e){return this._mx1<=t&&t<this._mx2&&this._my1<=e&&e<this._my2}hasAnyConnection(){return this._edges.some((t=>t.hasConnection()))}getRoomCandidateRelativeRect(){let t=0,e=0,i=this.width()-1,r=this.height()-1;return this.edge(s.FDirection.L).hasConnection()&&(t+=1),this.edge(s.FDirection.R).hasConnection()&&(i-=2),this.edge(s.FDirection.T).hasConnection()&&(e+=1),this.edge(s.FDirection.B).hasConnection()&&(r-=2),[t,e,i,r]}};e.FSectorAdjacency=class{constructor(t,e){this._edge1=t,this._edge2=e}edge1(){return this._edge1}edge2(){return this._edge2}hasPair(t,e){return t==this._edge1&&e==this._edge2||e==this._edge1&&t==this._edge2}otherSide(t){if(t==this._edge1)return this._edge2;if(t==this._edge2)return this._edge1;throw new Error}otherSideBySector(t){if(t==this._edge1.sector())return this._edge2;if(t==this._edge2.sector())return this._edge1;throw new Error}};e.FSectorConnection=class{constructor(t,e,i){this._id=t,this._edge1=e,this._edge2=i}id(){return this._id}edge1(){return this._edge1}edge2(){return this._edge2}pin1(){return this._pin1}pin2(){return this._pin2}alignedAxis(){return this._edge1.direction()==s.FDirection.L||this._edge1.direction()==s.FDirection.R?s.FAxis.H:s.FAxis.V}setConnectedPins(t,e){(0,r.assert)(this._edge1.pins().find((e=>e==t))),(0,r.assert)(this._edge2.pins().find((t=>t==e))),this._pin1=t,this._pin2=e}}},3719:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FBackgroundWaterPass=void 0;const r=i(4718),s=i(9185);i(2020),i(4879);class a extends r.FMapBuildPass{execute(t){s.MRData.templateMaps[t.templateId]}}e.FBackgroundWaterPass=a},9717:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FDecorationPass=void 0;const r=i(4718),s=i(5449),a=i(9185),n=i(9708),o=i(2020);class c extends r.FMapBuildPass{execute(t){const e=a.MRData.templateMaps[t.templateId];this.makeFloorDecoration(t,e),this.makeWallDecoration(t,e)}makeFloorDecoration(t,e){const i=e.partIndex[o.DBlockVisualPartType.FloorDecoration].map((t=>e.parts[t])),r=i.map((e=>new n.SimplexNoise(t.random().nextInt())));for(const e of t.blocks())if(e.component()==s.FBlockComponent.Room)for(const[t,s]of i.entries()){let i=Math.abs(r[t].noise2D(.1*e.mx,.1*e.my));i=Math.floor(100*i),i>50&&e.setDecorationVisualPartIndex(s.index)}}makeWallDecoration(t,e){const i=e.partIndex[o.DBlockVisualPartType.WallDecoration].map((t=>e.parts[t])),r=i.map((e=>new n.SimplexNoise(t.random().nextInt())));for(const e of t.blocks())if(e.component()==s.FBlockComponent.None&&this.isAroundWalls(t,e))for(const[t,s]of i.entries()){let i=Math.abs(r[t].noise2D(.1*e.mx,.1*e.my));i=Math.floor(100*i),i>50&&e.setDecorationVisualPartIndex(s.index)}}isAroundWalls(t,e){let i;return i=t.blockTry(e.mx-1,e.my-1),(!i||i.component()==s.FBlockComponent.None)&&(i=t.blockTry(e.mx,e.my-1),(!i||i.component()==s.FBlockComponent.None)&&(i=t.blockTry(e.mx+1,e.my-1),(!i||i.component()==s.FBlockComponent.None)&&(i=t.blockTry(e.mx-1,e.my),(!i||i.component()==s.FBlockComponent.None)&&(i=t.blockTry(e.mx+1,e.my),(!i||i.component()==s.FBlockComponent.None)&&(i=t.blockTry(e.mx-1,e.my+1),(!i||i.component()==s.FBlockComponent.None)&&(i=t.blockTry(e.mx,e.my+1),(!i||i.component()==s.FBlockComponent.None)&&(i=t.blockTry(e.mx+1,e.my+1),!i||i.component()==s.FBlockComponent.None)))))))}}e.FDecorationPass=c},9030:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FEntryPointAndExitPointPass=void 0;const r=i(1298),s=i(4718),a=i(5449);class n extends s.FMapBuildPass{execute(t){const e=null!=t.exitPont();(0,r.assert)(!e);{const e=t.innerBlocks.filter((t=>t.isRoom()&&t.isContinuation()));(0,r.assert)(e.length>0);const i=e[t.random().nextIntWithMax(e.length)];t.setExitPont(new a.FExitPont(i.mx,i.my))}}}e.FEntryPointAndExitPointPass=n},1654:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FMakeItemShopPass=void 0;const r=i(5306),s=i(4718);class a extends s.FMapBuildPass{execute(t){for(const e of t.rooms())e.forEachBlocks((i=>{const s=i.fixedMapItemShopTypeId();if(s>0){if(t.structures().find((t=>t instanceof r.FItemShopStructure&&t.itemShopTypeId()==s)));else{const i=new r.FItemShopStructure(e.id(),s);t.addStructure(i),e.addStructureRef(i)}}}))}}e.FMakeItemShopPass=a},1275:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FMakeMonsterHouseForRandomMapPass=e.FMakeMonsterHouseForFixedMapPass=void 0;const r=i(9185),s=i(6294),a=i(5306),n=i(4718);class o extends n.FMapBuildPass{execute(t){for(const e of t.rooms())e.forEachBlocks((i=>{const r=i.fixedMapMonsterHouseTypeId();if(r>0){if(t.structures().find((t=>t instanceof a.FMonsterHouseStructure&&t.monsterHouseTypeId()==r)));else{const i=new a.FMonsterHouseStructure(e.id(),r);t.addStructure(i),e.addStructureRef(i)}}}))}selectPattern(t,e){const i=t.reduce(((t,e)=>t+e.rating),0);if(i>0){let r=e.nextIntWithMax(i);for(const e of t)if(r-=e.rating,r<0)return e}}}e.FMakeMonsterHouseForFixedMapPass=o;class c extends n.FMapBuildPass{execute(t){for(const e of t.sectors())if("MonsterHouse"==e.structureType){const e=t.floorId().preset,i=s.UEffect.selectRating(t.random(),e.monsterHouses,(t=>t.rating));if(i){const e=t.rooms().filter((t=>0==t.structures().length)),s=t.random().selectOrUndefined(e);if(s){const e=r.MRData.getMonsterHouse(i.name),n=new a.FMonsterHouseStructure(s.id(),e.id);t.addStructure(n),s.addStructureRef(n)}}}}}e.FMakeMonsterHouseForRandomMapPass=c},57:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FMakeTileKindPass=void 0;const r=i(4879),s=i(4718);class a extends s.FMapBuildPass{execute(t){for(const e of t.innerBlocks)e.isPassagableComponent()?e.setTileShape(r.LTileShape.Floor):e.setTileShape(r.LTileShape.Wall)}}e.FMakeTileKindPass=a},4718:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FMapBuildPass=void 0;e.FMapBuildPass=class{}},8457:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FMarkContinuationPass=void 0;const r=i(1298),s=i(4718),a=i(5449),n=i(2213),o=i(9185),c=i(927),l=i(1289);class h extends s.FMapBuildPass{execute(t){for(const e of t.rooms())if(e){for(let i=e.mx1;i<=e.mx2;i++)t.isValid(i,e.my1-1)&&t.block(i,e.my1-1).component()==a.FBlockComponent.Passageway&&t.block(i,e.my1).setDoorway(!0),t.isValid(i,e.my2+1)&&t.block(i,e.my2+1).component()==a.FBlockComponent.Passageway&&t.block(i,e.my2).setDoorway(!0);for(let i=e.my1;i<=e.my2;i++)t.isValid(e.mx1-1,i)&&t.block(e.mx1-1,i).component()==a.FBlockComponent.Passageway&&t.block(e.mx1,i).setDoorway(!0),t.isValid(e.mx2+1,i)&&t.block(e.mx2+1,i).component()==a.FBlockComponent.Passageway&&t.block(e.mx2,i).setDoorway(!0)}{const e=this.selectSeekStartBlock(t);(0,r.assert)(e);let i=[e],s=[];for(;i.length>0;)i.forEach((e=>{if(!e.isContinuation()){e.setContinuation(!0);const i=t.blockTry(e.mx-1,e.my);i&&i.isPassagableComponent()&&!i.isContinuation()&&s.push(i);const r=t.blockTry(e.mx,e.my-1);r&&r.isPassagableComponent()&&!r.isContinuation()&&s.push(r);const a=t.blockTry(e.mx+1,e.my);a&&a.isPassagableComponent()&&!a.isContinuation()&&s.push(a);const n=t.blockTry(e.mx,e.my+1);n&&n.isPassagableComponent()&&!n.isContinuation()&&s.push(n)}})),[i,s]=[s,i],s=[]}}selectSeekStartBlock(t){if(t.floorId().isRandomMap()){const e=t.sectors();(0,r.assert)(e.length>0);const i=e.filter((t=>t.edges().find((t=>t.hasConnection()))&&t.room()));let s;s=i.length>0?i[t.random().nextIntWithMax(i.length)]:e[t.random().nextIntWithMax(e.length)];const n=s.room();(0,r.assert)(n);const o=n.blocks().find((t=>t.component()==a.FBlockComponent.Room));return(0,r.assert)(o),o}{const e=t.rmmzFixedMapData().events.find((t=>{if(!t)return!1;const e=c.DAnnotationReader.readEntityMetadataFromPage(t.pages[0]);if(!e)return!1;const i=o.MRData.findEntity(e.entity);return!!i&&l.DEntityCategory.isEntryPoint(i)}));if(e)return t.setEntryPont(new a.FEntryPont(e.x,e.y)),t.block(e.x,e.y);throw new Error(`"RE-SystemPrefab:EntryPoint" not found. (in ${n.DHelpers.makeRmmzMapDebugName(t.floorId().rmmzFixedMapId())})`)}}}e.FMarkContinuationPass=h},3983:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(1298);Array.prototype.pushArray=function(t){for(const e of t)this.push(e)},Array.prototype.mutableResize=function(t,e){for(;this.length>t;)this.pop();for(;this.length<t;)this.push(e)},Array.prototype.mutableRemoveAt=function(t){return t>=0&&(this.splice(t,1),!0)},Array.prototype.mutableRemove=function(t){const e=this.findIndex(t);return e>=0&&(this.splice(e,1),!0)},Array.prototype.mutableRemoveAll=function(t){let e=0;for(let i=this.length-1;i>=0;i--)t(this[i])&&(this.splice(i,1),e++);return e>0},Array.prototype.mutableShuffle=function(){for(var t=this.length-1;0<t;t--){var e=Math.floor(Math.random()*(t+1)),i=this[t];this[t]=this[e],this[e]=i}},Array.prototype.distinct=function(){return Array.from(new Set(this))},Array.prototype.distinctObjects=function(t){const e=new Map;for(const i of this)e.set(t(i),i);return Array.from(e.values())},Array.prototype.immutableSort=function(t){return Object.assign([],this).sort(t)},Array.prototype.selectMin=function(t){if(this.length<=0)return;let e=this[0];for(let i=1;i<this.length;i++)t(e,this[i])&&(e=this[i]);return e},Array.prototype.count=function(t){let e=0;for(const i of this)t(i)&&e++;return e},Array.prototype.isEmpty=function(){return 0==this.length},Array.prototype.front=function(){return(0,r.assert)(this.length>0),this[0]},Array.prototype.back=function(){return(0,r.assert)(this.length>0),this[this.length-1]},Array.prototype.backOrUndefined=function(){if(!(this.length<=0))return this[this.length-1]},Array.prototype.binarySearchIndex=function(t){let e=-1,i=0,r=this.length-1;for(;i<=r;){let s=Math.floor((i+r)/2);if(this[s]===t){e=s;break}this[s]<t?i=s+1:r=s-1}return e}},8053:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LActionToken=e.LActionTokenType=void 0;const a=i(1298),n=i(2593);var o;!function(t){t[t.Minor=0]="Minor",t[t.Major=1]="Major"}(o=e.LActionTokenType||(e.LActionTokenType={}));let c=r=class{constructor(){this._minorActionTokenCount=0,this._majorActionTokenCount=0}clone(){const t=new r;return t._minorActionTokenCount=0,t._majorActionTokenCount=0,t}clearActionTokenCount(){this._minorActionTokenCount=0,this._majorActionTokenCount=0}canMinorAction(){return this._minorActionTokenCount>0}canMajorAction(){return this._minorActionTokenCount>0&&this._majorActionTokenCount>0}actionCount(){return Math.max(this._minorActionTokenCount,this._majorActionTokenCount)}reset(t,e){const i=t.data;this._minorActionTokenCount=e,this._majorActionTokenCount=Math.max(e-i.majorActionDeclines,1)}charge(t){this._minorActionTokenCount+=t,this._majorActionTokenCount+=t}consume(t){return this.verify(t),t==n.LActionTokenConsumeType.MinorActed?(this._minorActionTokenCount=Math.max(this._minorActionTokenCount-1,0),o.Minor):t==n.LActionTokenConsumeType.MajorActed?(this._minorActionTokenCount=Math.max(this._minorActionTokenCount-1,0),this._majorActionTokenCount=Math.max(this._majorActionTokenCount-1,0),o.Major):this.canMajorAction()?this.consume(n.LActionTokenConsumeType.MajorActed):this.consume(n.LActionTokenConsumeType.MinorActed)}verify(t){t==n.LActionTokenConsumeType.MinorActed?(0,a.assert)(this._minorActionTokenCount>0):t==n.LActionTokenConsumeType.MajorActed?((0,a.assert)(this._minorActionTokenCount>0),(0,a.assert)(this._majorActionTokenCount>0)):(0,a.assert)(this._minorActionTokenCount>=0||this._majorActionTokenCount>=0)}};c=r=s([a.MRSerializable],c),e.LActionToken=c},4879:function(t,e,i){"use strict";var r=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LBlock=e.LBlockSystemDecoration=e.LTileShape=void 0;const s=i(1298),a=i(5449),n=i(7352),o=i(933),c=i(9115),l=i(5967);var h,u;!function(t){t[t.Void=0]="Void",t[t.Floor=1]="Floor",t[t.Wall=2]="Wall",t[t.HardWall=3]="HardWall",t[t.Water=4]="Water"}(h=e.LTileShape||(e.LTileShape={})),function(t){t[t.None=0]="None",t[t.ItemShop=1]="ItemShop"}(u=e.LBlockSystemDecoration||(e.LBlockSystemDecoration={}));let d=class{constructor(t,e){this._roomId=0,this._blockComponent=a.FBlockComponent.None,this._continuation=!1,this._roomInnerEntrance=!1,this._shopkeeperLine=!1,this._passed=!1,this._tileShape=h.Floor,this._systemDecoration=u.None,this._mx=t,this._my=e,this._layers=[new o.REBlockLayer,new o.REBlockLayer,new o.REBlockLayer,new o.REBlockLayer,new o.REBlockLayer],this._shapeVisualPartIndex=0,this._decorationVisualPartIndex=0}get mx(){return this._mx}get my(){return this._my}room(){return this._roomId>0?n.MRLively.map.room(this._roomId):void 0}tileShape(){return this._tileShape}get shapeVisualPartIndex(){return this._shapeVisualPartIndex}get decorationVisualPartIndex(){return this._decorationVisualPartIndex}setSystemDecoration(t){this._systemDecoration=t,c.MRSystem.integration.onUpdateBlock(this)}systemDecoration(){return this._systemDecoration}isFloorLikeShape(){return this._tileShape==h.Floor}isWallLikeShape(){return this._tileShape==h.Wall||this._tileShape==h.HardWall}isRoom(){return this._roomId>0}isPassageway(){return!this.isRoom()}isContinuation(){return this._continuation}isRoomInnerEntrance(){return this._roomInnerEntrance}layers(){return this._layers}layer(t){return this._layers[t]}addEntity(t,e){const i=this._layers[t];(0,s.assert)(!i.isContains(e)),t==l.DBlockLayerKind.Terrain&&(0,s.assert)(0==this._layers[t].entities().length),i.addEntity(e)}removeEntity(t){for(let e=0;e<this._layers.length;e++)if(this._layers[e].removeEntity(t))return!0;return!1}removeAllEntites(){for(let t=0;t<this._layers.length;t++)this._layers[t].removeAllEntites()}aliveEntity(t){return this._layers[t].entities().find((t=>t.isAlive()))}getEntities(t){const e=[];if(t){const i=this._layers[t];for(const t of i.entities())e.push(t)}else for(const t of this._layers)for(const i of t.entities())e.push(i);return e}getFirstEntity(t){const e=this.getEntities(t);return e.length>0?e[0]:void 0}findEntityLayerKind(t){const e=this._layers.findIndex((e=>e.isContains(t)));return e>=0?e:void 0}findEntity(t){for(const e of this._layers)for(const i of e.entityIds()){const e=n.MRLively.world.entity(i);if(t(e))return e}}containsEntity(t){return null!=this.findEntityLayerKind(t)}};d=r([s.MRSerializable],d),e.LBlock=d},933:function(t,e,i){"use strict";var r=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.REBlockLayer=void 0;const s=i(1298),a=i(7352);let n=class{constructor(){this._entityIds=[]}entityIds(){return this._entityIds}entities(){return this._entityIds.map((t=>a.MRLively.world.entity(t)))}firstEntity(){return this._entityIds.length>0?a.MRLively.world.entity(this._entityIds[0]):void 0}isContainsAnyEntity(){return this._entityIds.length>0}isContains(t){return this._entityIds.findIndex((e=>e.equals(t.entityId())))>=0}isOccupied(){return this._entityIds.some((t=>a.MRLively.world.entity(t).blockOccupied))}addEntity(t){this._entityIds.push(t.entityId())}removeEntity(t){const e=this._entityIds.findIndex((e=>e.equals(t.entityId())));return e>=0&&(this._entityIds.splice(e,1),!0)}removeAllEntites(){this._entityIds.splice(0)}};n=r([s.MRSerializable],n),e.REBlockLayer=n},8444:function(t,e,i){"use strict";var r=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LCamera=void 0;const s=i(7352),a=i(9115),n=i(1298),o=i(4977),c=i(4765),l=i(6501);let h=class{constructor(){this._focusedEntityId=o.LEntityId.makeEmpty(),this._transferingNewFloorId=c.LFloorId.makeEmpty(),this._transferingNewX=0,this._transferingNewY=0}focusedEntityId(){return this._focusedEntityId}focusedEntity(){if(this._focusedEntityId.hasAny())return s.MRLively.world.entity(this._focusedEntityId)}getFocusedEntity(){const t=this.focusedEntity();return(0,n.assert)(t),t}focus(t){const e=this.focusedEntity();if(e){const t=e.findEntityBehavior(l.LUnitBehavior);t&&t.setManualMovement(!1)}this._focusedEntityId=t.entityId();const i=t.findEntityBehavior(l.LUnitBehavior);i&&i.setManualMovement(!0)}clearFocus(){this._focusedEntityId=o.LEntityId.makeEmpty()}isFloorTransfering(){return this._transferingNewFloorId.hasAny()}transferingNewFloorId(){return this._transferingNewFloorId}_reserveFloorTransferToFocusedEntity(){const t=this.focusedEntity();t&&this.reserveFloorTransfer(t.floorId,t.mx,t.my,2)}reserveFloorTransfer(t,e,i,r){this._transferingNewFloorId=t,this._transferingNewX=e,this._transferingNewY=i,a.MRSystem.integration.onReserveTransferMap(t.rmmzMapId(),e,i,r)}clearFloorTransfering(){this._transferingNewFloorId=c.LFloorId.makeEmpty(),this._transferingNewX=0,this._transferingNewY=0}};h=r([n.MRSerializable],h),e.LCamera=h},5372:function(t,e,i){"use strict";var r=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LChronus=void 0;const s=i(1298),a=i(2163);let n=class{constructor(){this._totalSeconds=0,this._totalDays=0,this._currentTimeFrameIndex=0,this._revisionNumber=0,this._needsLivingTimeFrameRefresh=!1}get totalSeconds(){return this._totalSeconds}get totalDays(){return this._totalDays}get currentTimeFrameIndex(){return this._currentTimeFrameIndex}get currentTimeFrame(){return a.MRData.chronus.timeFrames[this._currentTimeFrameIndex]}get currentTimeFrameId(){return this.currentTimeFrame.timeFrameId}getTimeFrameIndex(){let t=0;const e=a.MRData.chronus.timeFrames;for(let i=0;i<e.length;i++){const r=e[i];this.isHourInRange(r.startHour,r.lastHouer)&&(t=i)}return t}isHourInRange(t,e){var i=this.hour;return i>=t&&i<=e}advanceRound(){this.advanceSeconds(a.MRData.chronus.secondsInRound)}advanceSeconds(t){if(!a.MRData.chronus.enabled)return;const e=a.MRData.chronus.secondsInDay;for(this._totalSeconds+=t;this._totalSeconds>=e;)this.advanceDay(1),this._totalSeconds-=e;this.requireRefresh()}advanceDay(t){this._totalDays+=t,this.requireRefresh()}requireRefresh(){this._revisionNumber++;const t=this.currentTimeFrame.kind;this._currentTimeFrameIndex=this.getTimeFrameIndex(),console.log("this.currentTimeFrame",this.currentTimeFrame),t!==this.currentTimeFrame.kind&&(console.log("reserveLivingTimeFrameRefresh"),this.reserveLivingTimeFrameRefresh())}reserveLivingTimeFrameRefresh(){this._needsLivingTimeFrameRefresh=!0}clearLivingTimeFrameRefresh(){this._needsLivingTimeFrameRefresh=!1}get needsLivingTimeFrameRefresh(){return this._needsLivingTimeFrameRefresh}get weekIndex(){return this._totalDays%a.MRData.chronus.getDaysOfWeek()}get hour(){return Math.floor(this._totalSeconds/a.MRData.chronus.secondsInHour)}};n=r([s.MRSerializable],n),e.LChronus=n},2593:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LActionTokenConsumeType=e.LMinimapMarkerClass=e.phaseCount=void 0,e.phaseCount=4,function(t){t[t.None=0]="None",t[t.Unit=1]="Unit",t[t.Item=2]="Item",t[t.Trap=3]="Trap",t[t.ExitPoint=4]="ExitPoint"}(e.LMinimapMarkerClass||(e.LMinimapMarkerClass={})),function(t){t[t.MinorActed=0]="MinorActed",t[t.MajorActed=1]="MajorActed",t[t.WaitActed=2]="WaitActed"}(e.LActionTokenConsumeType||(e.LActionTokenConsumeType={}))},8856:function(t,e,i){"use strict";var r=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LDeathResult=void 0;const s=i(1298);let a=class{constructor(){this._states=[]}clear(){this._states=[]}clearStates(){this._states=[]}addState(t){this._states.push(t)}states(){return this._states}};a=r([s.MRSerializable],a),e.LDeathResult=a},3367:function(__unused_webpack_module,exports,__webpack_require__){"use strict";var __decorate=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(exports,"__esModule",{value:!0}),exports.LEffectResult=exports.LParamEffectResult=void 0;const Common_1=__webpack_require__(1298),MRData_1=__webpack_require__(9185),LIdentifyer_1=__webpack_require__(1019),DParameter_1=__webpack_require__(6539),SSoundManager_1=__webpack_require__(9019),UName_1=__webpack_require__(3482),DTextManager_1=__webpack_require__(3654),DEffect_1=__webpack_require__(4561),MRBasics_1=__webpack_require__(4836),DFaction_1=__webpack_require__(6901);let LParamEffectResult=class{constructor(t){this.damage=0,this.oldValue=0,this.newValue=0,this.drain=!1,this.paramId=t,this.applyTarget=DEffect_1.DValuePoint.Actual}paramDisplayName(){const t=MRData_1.MRData.parameters[this.paramId];return this.applyTarget==DEffect_1.DValuePoint.Growth?t.displayNameMaximum:t.displayName}getValue(t,e){const i=MRData_1.MRData.parameters[this.paramId];if(i.messageValueSource==DParameter_1.DParamMessageValueSource.Relative)return e?-this.damage:this.damage;if(i.messageValueSource==DParameter_1.DParamMessageValueSource.Absolute)return t.getActualParam(this.paramId);throw new Error("Unreachable.")}};LParamEffectResult=__decorate([Common_1.MRSerializable],LParamEffectResult),exports.LParamEffectResult=LParamEffectResult;let LEffectResult=class LEffectResult{constructor(){this.used=!1,this.missed=!1,this.evaded=!1,this.physical=!1,this.critical=!1,this.success=!1,this.hpAffected=!1,this.paramEffects2=[],this.addedStates=[],this.removedStates=[],this.addedBuffs=[],this.addedDebuffs=[],this.removedBuffs=[],this.focusedFriendly=!0,this.levelup=!1,this.leveldown=!1,this.gainedExp=0,this._revision=0,this._commitedRevision=0,this._dirty=!1}get looksFactionType(){return this.focusedFriendly?DFaction_1.DFactionType.Friendly:DFaction_1.DFactionType.Hostile}isHit(){return this.used&&!this.missed&&!this.evaded}clear(){this.used=!1,this.missed=!1,this.evaded=!1,this.physical=!1,this.critical=!1,this.success=!1,this.hpAffected=!1,this.paramEffects2=[],this.addedStates=[],this.removedStates=[],this.addedBuffs=[],this.addedDebuffs=[],this.removedBuffs=[],this.focusedFriendly=!0,this.levelup=!1,this.leveldown=!1,this.gainedExp=0,this.instanceChangedFrom=void 0,this._dirty=!1}clearParamEffects(){this.paramEffects2=[]}hasResult(){return!0}get sourceEffect(){return(0,Common_1.assert)(this.sourceEffectId),MRData_1.MRData.effects[this.sourceEffectId]}isStateAdded(t){return this.addedStates.includes(t)}pushAddedState(t){this.isStateAdded(t)||(this.addedStates.push(t),this._dirty=!0)}isStateRemoved(t){return this.removedStates.includes(t)}pushRemovedState(t){this.isStateRemoved(t)||this.removedStates.push(t),this._dirty=!0}isBuffAdded(t){return this.addedBuffs.includes(t)}pushAddedBuff(t){this.isBuffAdded(t)||(this.addedBuffs.push(t),this._dirty=!0)}isDebuffAdded(t){return this.addedDebuffs.includes(t)}pushAddedDebuff(t){this.isDebuffAdded(t)||(this.addedDebuffs.push(t),this._dirty=!0)}isBuffRemoved(t){return this.removedBuffs.includes(t)}pushRemovedBuff(t){this.isBuffRemoved(t)||(this.removedBuffs.push(t),this._dirty=!0)}addedStateObjects(){return this.addedStates.map((t=>MRData_1.MRData.states[t]))}makeSuccess(){this.success=!0,this._dirty=!0}shouldShowMessage(){return this._revision!=this._commitedRevision}refreshRevision(){this._commitedRevision=this._revision,this._revision>1e4&&(this._revision=0,this._commitedRevision=0),this._dirty=!1}showResultMessages(t,e){if(this.shouldShowMessage()){this.refreshRevision();const i=UName_1.UName.makeUnitName(e);if(this.instanceChangedFrom&&t.postMessage((0,Common_1.tr2)("%1は%2に変化した。").format(MRData_1.MRData.entities[this.instanceChangedFrom].makeDisplayName(0),i)),this.missed)t.postMessage(DTextManager_1.DTextManager.enemyNoHit.format(i)),this.physical&&SSoundManager_1.SSoundManager.playMiss();else for(const r of this.paramEffects2)this.displayParameterFlavorEffect(t,e,i,r);const r=this.focusedFriendly;for(const e of this.addedStates){const s=MRData_1.MRData.states[e],a=r?s.message1:s.message2;a&&t.postMessage(a.format(i))}for(const e of this.removedStates){const r=MRData_1.MRData.states[e];r.message4&&t.postMessage(r.message4.format(i))}for(const e of this.addedBuffs){const r=DTextManager_1.DTextManager.buffAdd.format(i,DTextManager_1.DTextManager.param(MRData_1.MRData.parameters[e].battlerParamId));t.postMessage(r)}for(const e of this.addedDebuffs){const r=DTextManager_1.DTextManager.debuffAdd.format(i,DTextManager_1.DTextManager.param(MRData_1.MRData.parameters[e].battlerParamId));t.postMessage(r)}for(const e of this.removedBuffs){const r=DTextManager_1.DTextManager.buffRemove.format(i,DTextManager_1.DTextManager.param(MRData_1.MRData.parameters[e].battlerParamId));t.postMessage(r)}this.isHit()&&!this.success&&t.postMessage(DTextManager_1.DTextManager.actionFailure.format(i));{const i=LIdentifyer_1.LEntityDescription.makeDisplayText(UName_1.UName.makeUnitName(e),LIdentifyer_1.DescriptionHighlightColor.UnitName);if(this.gainedExp>0){const e=DTextManager_1.DTextManager.obtainExp.format(this.gainedExp,DTextManager_1.DTextManager.exp);t.postMessage(e)}if(this.levelup||this.leveldown){if(this.levelup){const r=DTextManager_1.DTextManager.levelUp.format(i,DTextManager_1.DTextManager.level,e.getActualParam(MRBasics_1.MRBasics.params.level));t.postMessage(r),SSoundManager_1.SSoundManager.playLevelUp()}if(this.leveldown){const e=(0,Common_1.tr2)("%1は%2が下がった！").format(i,DTextManager_1.DTextManager.level);t.postMessage(e),SSoundManager_1.SSoundManager.playLevelUp()}}}}}displayParameterFlavorEffect(t,e,i,r){const s=MRData_1.MRData.parameters[r.paramId];let a;r.parameterDamageEffect&&(a=this.selectParameterFlavorEffect(e,r,r.parameterDamageEffect.getParameterFlavorEffectByLooksFaction(this.looksFactionType)),a||this.looksFactionType==DFaction_1.DFactionType.Neutral||(a=this.selectParameterFlavorEffect(e,r,r.parameterDamageEffect.getParameterFlavorEffectByLooksFaction(DFaction_1.DFactionType.Neutral)))),a||(a=this.selectParameterFlavorEffect(e,r,s.getParameterFlavorEffectByLooksFaction(this.looksFactionType))),a||this.looksFactionType==DFaction_1.DFactionType.Neutral||(a=this.selectParameterFlavorEffect(e,r,s.getParameterFlavorEffectByLooksFaction(DFaction_1.DFactionType.Neutral)));let n=[];if(a&&a.text.length>0){const t=r.paramDisplayName(),a=Math.abs(r.damage),o=e.getActualParam(r.paramId),c=o-r.damage;n=[i,t,s.makeDisplayValue(a),s.makeDisplayValue(c),s.makeDisplayValue(o)]}t.displayFlavorEffect(e,a,{messageFormatArgs:n})}selectParameterFlavorEffect(t,e,i){for(let r=i.length-1;r>=0;r--){const s=i[r];if(s&&this.meetsConditionParameterFlavorEffect(t,e,s))return s.flavorEffect}}meetsConditionParameterFlavorEffect(entity,paramResult,effect){if(effect.point!=paramResult.applyTarget)return!1;if(paramResult.damage>0&&effect.addition!=DParameter_1.DValueAddition.Loss)return!1;if(paramResult.damage<0&&effect.addition!=DParameter_1.DValueAddition.Gain)return!1;if(0==paramResult.damage&&effect.addition!=DParameter_1.DValueAddition.None)return!1;if(effect.conditionFormula){const param=MRData_1.MRData.parameters[paramResult.paramId],value=paramResult.newValue,old=paramResult.oldValue,min=entity.params.getActualMin(entity,param.id),max=entity.getParamActualMax(param.id),r=eval(effect.conditionFormula);if(!r)return!1}return!0}};LEffectResult=__decorate([Common_1.MRSerializable],LEffectResult),exports.LEffectResult=LEffectResult},4685:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LEntity=e.LParamChangedAction=void 0;const a=i(7534),n=i(7352),o=i(1325),c=i(9115),l=i(1298),h=i(4836),u=i(4977),d=i(3367),p=i(4765),f=i(6539),m=i(7737),y=i(9185),_=i(6291),g=i(5150),v=i(6497),S=i(4882),M=i(4561),R=i(586),b=i(5967),E=i(8053),I=i(2593),x=i(8720),w=i(975),T=i(8856),D=i(6501),P=i(3609);var A,k;!function(t){t[t.Terrain=0]="Terrain",t[t.Surface=1]="Surface",t[t.Unit=2]="Unit",t[t.Projectile=3]="Projectile"}(A||(A={})),function(t){t[t.None=0]="None",t[t.WithRefresh=2]="WithRefresh",t[t.WithNotification=4]="WithNotification",t[t.All=6]="All"}(k=e.LParamChangedAction||(e.LParamChangedAction={}));let C=r=class extends u.LObject{constructor(){super(u.LObjectType.Entity),this._entityDataId=0,this._basicBehaviors=[],this._individualIdentified=!1,this._partyId=0,this._name="",this._displayName="",this._iconName="",this.rmmzEventId=0,this.inhabitsCurrentFloor=!1,this.keeper=!1,this.floorId=p.LFloorId.makeEmpty(),this.mx=0,this.my=0,this.dir=2,this.blockOccupied=!0,this.immediatelyAfterAdjacentMoving=!1,this._states=[],this._needVisualRefresh=!1,this._abilities=[],this._effectResult=new d.LEffectResult,this._schedulingResult=new w.LSchedulingResult,this._deathResult=new T.LDeathResult,this._reward=new R.LReward,this._located=!1,this._actionToken=new E.LActionToken,this._dropItemGenerated=!1,this._shopArticle=new x.LShopArticle,this._stackCount=1,this._params=new v.LParamSet}setupInstance(t){this._entityDataId>0?(this.clearInstance(),this._effectResult.instanceChangedFrom=this._entityDataId,this._entityDataId=t,g.SEntityFactory.buildEntity(this),this.floorId.equals(n.MRLively.map.floorId())&&c.MRSystem.integration.entityReEnterMap(this)):this._entityDataId=t,this._individualIdentified=this.data.identificationDifficulty==_.DIdentificationDifficulty.Clearly,this._params.clear();const e=this.data.idealParams;for(let t=0;t<e.length;t++){const i=e[t];if(void 0!==i){this._params.acquireParam(t).setActualDamgeParam(this._params.getActualMax(this,t)-i)}}this.resetInitialActualParam()}get dataId(){return this._entityDataId}get data(){return y.MRData.entities[this._entityDataId]}kindDataId(){return this.data.entity.kindId}kindData(){return y.MRData.categories[this.data.entity.kindId]}entityId(){return this.__objectId()}equals(t){return this.entityId().equals(t.entityId())}isGCReady(){return!this.floorId.hasAny()&&super.isGCReady()}clone(){const t=n.MRLively.world.spawnEntity(this._entityDataId);t._partyId=this._partyId,t._individualIdentified=this._individualIdentified,t._name=this._name,t._displayName=this._displayName,t._iconName=this._iconName,t.rmmzEventId=0,t.inhabitsCurrentFloor=!1,t.floorId=p.LFloorId.makeEmpty(),t.mx=0,t.my=0,t.dir=this.dir,t._actionToken=this._actionToken.clone(),t._stackCount=this._stackCount,this._params.copyTo(t._params),t._needVisualRefresh=!0,t._dropItemGenerated=!1;for(const e of this.basicBehaviors()){const i=e.clone(t);t._basicBehaviors.push(i.id()),i.setParent(t)}for(const e of this.states()){const i=e.clone(t);t._states.push(i.id()),i.setParent(t)}for(const e of this.abilities()){const i=e.clone(t);t._abilities.push(i.id()),i.setParent(t)}return t}onFinalize(){this.floorId.equals(n.MRLively.map.floorId())&&n.MRLively.map._removeEntity(this),this.clearInstance(),n.MRLively.scheduler.invalidateEntity(this)}clearInstance(){this.removeAllBehaviors(),this.removeAllStates(!1)}onRemoveChild(t){if(!(t instanceof r))throw new Error("Not implemented.");for(const e of this.basicBehaviors())e.onRemoveChild(t)}onRemoveFromParent(){for(const t of this.basicBehaviors())t.onOwnerRemoveFromParent(this)}parentEntity(){return this.parentObjectId().hasAny()?n.MRLively.world.entity(this.parentObjectId()):void 0}isPlayer(){return this.entityId().equals(n.MRLively.camera.focusedEntityId())}isUnit(){return!!this.findEntityBehavior(D.LUnitBehavior)}partyId(){return this._partyId}party(){return 0==this._partyId?void 0:n.MRLively.world.party(this._partyId)}individualIdentified(){return this._individualIdentified}setIndividualIdentified(t){this._individualIdentified=t}resetStatus(){this._params.resetAllConditions(),this.removeAllStates(!1),this.iterateBehaviorsReverse((t=>{t.onResetStatus(this)}))}get params(){return this._params}getParamActualMax(t){return this._params.getActualMax(this,t)}getEffortValue(t){const e=this.params.param(t);return e?e.effortValue():0}setEffortValue(t,e,i=k.All){const r=this.params.param(t);if(r){let s=0,a=0;if(i&k.WithNotification&&(s=this.getEffortValue(t),a=this.getActualParam(t)),r.setEffortValue(e),i&k.WithNotification){const e=this.getEffortValue(t),i=this.getActualParam(t);e!==s&&this.notifyParamIdealPlusChanged(t,e,s),i!==a&&this.notifyParamChanged(t,i,a)}i&k.WithRefresh&&this.refreshConditions()}}getActualParam(t){const e=this._params.param(t);let i=0;const r=this.traitMaxOrDefault(h.MRBasics.traits.ForceParameter,t,void 0);void 0!==r?i=r:e&&(i=e.data.type==f.DParameterType.Dependent?this.getDependentParameterCurrentValue(t):this._params.getActualMax(this,t)-e.actualParamDamge());const s=this._params.getMinLimit(t),a=this._params.getMaxLimit(t);return Math.round(i.clamp(s,a))}setParamCurrentValue(t,e){const i=y.MRData.parameters[t],r=this._params.getActualMax(this,t);i.type==f.DParameterType.Dependent?this.setDependentParameterCurrentValue(t,e):this.setActualDamgeParam(t,r-e)}notifyParamIdealPlusChanged(t,e,i){this.iterateBehaviorsReverse((r=>r.onParamIdealPlusChanged(this,t,e,i)))}notifyParamChanged(t,e,i){this.iterateBehaviorsReverse((r=>r.onParamChanged(this,t,e,i)))}getDependentParameterCurrentValue(t){let e;return this.iterateBehaviorsReverse((i=>(e=i.onGetDependentParameterIdealBaseValue(this,t),void 0===e))),null!=e?e:0}setDependentParameterCurrentValue(t,e){this.iterateBehaviorsReverse((i=>(i.onSetDependentParameterIdealBaseValue(this,t,e),!0))),this.refreshConditions()}setActualDamgeParam(t,e){const i=this._params.param(t);if(!i)throw new Error(`LParam not registerd (paramId:${t})`);if(i.actualParamDamge()!=e){const r=this.getActualParam(t);i.setActualDamgeParam(e),this.notifyParamChanged(t,this.getActualParam(t),r),this.refreshConditions()}}gainActualParam(t,e,i){if(0===e)return;const r=this._params.param(t);if(!r)throw new Error(`LParam not registerd (paramId:${t})`);if(r.data.type==f.DParameterType.Dependent){this.getActualParam(t);this.setDependentParameterCurrentValue(t,this.getActualParam(t)+e)}else{const s=this.getActualParam(t);r.gainActualParam(e),this.notifyParamChanged(t,this.getActualParam(t),s),i&&this.refreshConditions()}}resetInitialActualParam(){for(const t of this._params.params())t&&t.resetInitialActualValue(this.getActualParam(t.parameterId))}refreshConditions(){let t=!1;const e=this._params.param(h.MRBasics.params.hp);if(e){t=!e.isDamageValueChanged;const i=!!this.states().find((t=>t.stateDataId()==h.MRBasics.states.dead||t.stateData().deadState)),r=this.getActualParam(h.MRBasics.params.hp);i&&0!=r&&(e.setActualDamgeParam(this._params.getActualMax(this,h.MRBasics.params.hp)),this.removeAllStates(!0))}this._params.refresh(this),this.basicBehaviors().forEach((t=>t.onRefreshConditions(this)));const i=this._params.getActualMax(this,h.MRBasics.params.hp);if(0!==i){this.getActualParam(h.MRBasics.params.hp)<=0?e&&t?e.setActualDamgeParam(i-1):this.isDeathStateAffected()||this.addState(h.MRBasics.states.dead,!1):this.isDeathStateAffected()&&this.removeState(h.MRBasics.states.dead)}this._states=S.UState.resolveStates(this,[],[]).map((t=>t.id()))}addBuff(t){const e=this._params.param(t.paramId);e&&(e.addBuff(t),this.refreshConditions(),t.level<0?this._effectResult.pushAddedDebuff(t.paramId):this._effectResult.pushAddedBuff(t.paramId))}removeBuff(t){const e=this._params.param(t);e&&(e.removeBuff(),this.refreshConditions(),this._effectResult.pushRemovedBuff(t))}allTraits(){return this.collectTraits()}traits(t){return this.allTraits().filter((e=>e.code===t))}hasTrait(t){return void 0!==this.allTraits().find((e=>e.code==t))}traitsWithId(t,e){return this.allTraits().filter((i=>i.code===t&&i.dataId===e))}traitsPi(t,e){return this.traitsWithId(t,e).reduce(((t,e)=>t*e.value),1)}traitsSum(t,e){return this.traitsWithId(t,e).reduce(((t,e)=>t+e.value),0)}traitsSumOrDefault(t,e,i){const r=this.traitsWithId(t,e);return 0==r.length?i:r.reduce(((t,e)=>t+e.value),0)}traitMaxOrDefault(t,e,i){const r=this.traitsWithId(t,e);return 0==r.length?i:r.reduce(((t,e)=>Math.max(t,e.value)),0)}traitsSumAll(t){return this.traits(t).reduce(((t,e)=>t+e.value),0)}traitsSet(t){const e=[];for(const i of this.traits(t))e.push(i.dataId);return e}xparam(t){return this.traitsSum(h.MRBasics.traits.TRAIT_XPARAM,t)}xparamOrDefault(t,e){return this.traitsSumOrDefault(h.MRBasics.traits.TRAIT_XPARAM,t,e)}sparam(t){return this.traitsPi(h.MRBasics.traits.TRAIT_SPARAM,t)}elementRate(t){return this.traitsPi(h.MRBasics.traits.TRAIT_ELEMENT_RATE,t)}stateRate(t){return this.traitsPi(h.MRBasics.traits.TRAIT_STATE_RATE,t)}attackElements(){return this.traitsSet(h.MRBasics.traits.TRAIT_ATTACK_ELEMENT)}*fieldEffects(){const t=[];this.iterateBehaviorsReverse((e=>{t.push(e)}),!0);for(const e of t)yield*e.onCollectFieldEffect(this)}getDisplayName(){for(const t of this.collectBehaviors().reverse()){const e=t.queryDisplayName();if(e)return e}const t=this.data;const e={name:t.makeDisplayName(this._stackCount),iconIndex:t.display.iconIndex,upgrades:0};this._params.param(h.MRBasics.params.upgradeValue)&&(e.upgrades=this.getActualParam(h.MRBasics.params.upgradeValue));const i=this._params.param(h.MRBasics.params.remaining);return i&&(e.capacity=this.getActualParam(h.MRBasics.params.remaining),e.initialCapacity=i.initialActualValue()),e}getPrefabId(){for(const t of this.collectBehaviors().reverse()){const e=t.queryPrefabId();if(e)return e}return this.data.prefabId}getInnermostFactionId(){for(const t of this.collectBehaviors().reverse()){const e=t.queryInnermostFactionId();if(e)return e}return y.MRData.system.factions.neutral}getOutwardFactionId(){for(const t of this.collectBehaviors().reverse()){const e=t.queryOutwardFactionId();if(e)return e}return y.MRData.system.factions.neutral}getHomeLayer(){for(const t of this.collectBehaviors().reverse()){const e=t.queryHomeLayer();if(e)return e}return b.DBlockLayerKind.Ground}queryMinimapMarkerClass(){let t;return this.iterateBehaviorsReverse((e=>(t=e.queryMinimapMarkerClass(),void 0===t))),null!=t?t:I.LMinimapMarkerClass.None}getIdealParamBase(t){let e=0;return this.iterateBehaviorsReverse((i=>(e=i.onQueryIdealParamBase(t,e),!0))),e}querySubEntities(t){const e=[];return this.iterateBehaviorsReverse((i=>(i.onQuerySubEntities(t,e),!0))),e}queryParamMinMax(t){const e=y.MRData.parameters[t],i={min:e.minLimit,max:e.maxLimit};if(t==h.MRBasics.params.upgradeValue){const t=this.data;i.min=t.upgradeMin,i.max=t.upgradeMax}return i}queryPrice(){const t=this.data,e={sellingPrice:t.sellingPrice2,purchasePrice:t.purchasePrice};return this.iterateBehaviorsReverse((t=>(t.onQueryPrice(e),!0))),e}queryRaceIds(){return this.data.raceIds}getAttackAnimationId(t){let e;return this.iterateBehaviorsReverse((i=>(e=i.onQueryAttackAnimationId(this,t),void 0===e))),null!=e?e:1}behavior(t){return this.findEntityBehaviorByName(t)}basicBehaviors(){return this._basicBehaviors.map((t=>n.MRLively.world.behavior(t)))}addBehavior(t,...e){const i=new t;return i.setup(...e),n.MRLively.world._registerObject(i),this._addBehavior(i),i}_addBehavior(t){return(0,l.assert)(t.hasId()),(0,l.assert)(this.entityId().hasAny()),this._basicBehaviors.push(t.id()),t.setParent(this),t.onAttached(this),t}removeBehavior(t){const e=this._basicBehaviors.findIndex((e=>e.equals(t.id())));e>=0&&(this._basicBehaviors.splice(e,1),t.clearParent(),t.onDetached(this),t.destroy())}removeAllBehaviors(){this.basicBehaviors().forEach((t=>{t.clearParent(),t.onDetached(this),t.destroy()})),this._basicBehaviors=[]}addState(t,e=!0,i=1,r=M.LStateLevelType.RelativeValue){r==M.LStateLevelType.AbsoluteValue&&0==i||(this._states=S.UState.resolveStates(this,[{stateId:t,level:i,levelType:r}],[]).map((t=>t.id())),this._states=S.UState.resolveStates(this,[],[]).map((t=>t.id())),this._needVisualRefresh=!0,this.isDeathStateAffected()&&this.makeDeathResultStates())}states(){return this._states.map((t=>n.MRLively.world.object(t)))}isStateAffected(t){return this.states().findIndex((e=>e.stateDataId()==t))>=0}removeStates(t){0!=t.length&&(this._states=S.UState.resolveStates(this,[],t).map((t=>t.id())),this._states=S.UState.resolveStates(this,[],[]).map((t=>t.id())),this._needVisualRefresh=!0)}removeState(t){this.removeStates([t])}removeAllStates(t){if(t){const t=this.states().filter((t=>!t.isDeathState)).map((t=>t.stateDataId()));this.removeStates(t)}else this.states().forEach((t=>{t.clearParent(),t.onDetached(this)})),this._states=[];this._needVisualRefresh=!0}findState(t){let e;return this.iterateStates((i=>i.stateDataId()!=t||(e=i,!1))),e}hasState(t){return!!this.findState(t)}isBlessed(){return this.isStateAffected(y.MRData.system.states.bless)}isCursed(){return this.isStateAffected(y.MRData.system.states.curse)}isSealed(){return this.isStateAffected(y.MRData.system.states.seal)}isDeathStateAffected(){return!!this.states().find((t=>t.isDeathState))}removeDeadStates(){const t=this.states().filter((t=>t.stateDataId()==h.MRBasics.states.dead||t.stateData().deadState)).map((t=>t.stateDataId()));this.removeStates(t)}isStateAddable(t){return!this.isStateResist(t)}stateResistSet(){return this.traitsSet(h.MRBasics.traits.TRAIT_STATE_RESIST)}isStateResist(t){return this.stateResistSet().includes(t)}addAbility(t){if(this._abilities.findIndex((e=>n.MRLively.world.ability(e).abilityId()==t))>=0);else{const e=m.SAbilityFactory.newAbility(t);e.setParent(this),(0,l.assert)(e.hasId()),this._abilities.push(e.id()),e.onAttached(this)}}removeAbility(t){const e=this._abilities.findIndex((e=>n.MRLively.world.ability(e).abilityId()==t));e>=0&&(n.MRLively.world.ability(this._abilities[e]).onDetached(this),this._abilities.splice(e,1))}removeAllAbilities(){this.abilities().forEach((t=>{t.onDetached(this)})),this._abilities=[]}abilities(){return this._abilities.map((t=>n.MRLively.world.object(t)))}isUnique(){return n.MRLively.system.uniqueActorUnits.findIndex((t=>t.equals(this.entityId())))>=0}isFocused(){return n.MRLively.camera.focusedEntityId().equals(this.entityId())}isAlive(){return!this.isDestroyed()||this.isDeathStateAffected()}findEntityBehavior(t){for(let e=0;e<this._basicBehaviors.length;e++){const i=n.MRLively.world.behavior(this._basicBehaviors[e]);if(i instanceof t)return i}}findEntityBehaviorByName(t){const e=t.toLocaleLowerCase();for(const t of this._basicBehaviors){const i=n.MRLively.world.behavior(t);let r=i.constructor.name;const s=r.lastIndexOf("Behavior");if(s>=0&&(r=r.substring(0,s)),r.toLocaleLowerCase().endsWith(e))return i}}getEntityBehavior(t){const e=this.findEntityBehavior(t);if(!e)throw new Error;return e}_iterateBehaviors(t){const e=this.states();for(let i=e.length-1;i>=0;i--){const r=e[i].stateBehabiors();for(let e=r.length-1;e>=0;e--)if(!t(r[e]))return}for(let e=this._basicBehaviors.length-1;e>=0;e--)if(!t(n.MRLively.world.behavior(this._basicBehaviors[e])))return}queryProperty(t){let e;return this._iterateBehaviors((i=>(e=i.onQueryProperty(t),null==e))),null!=e?e:c.MRSystem.propertyData[t].defaultValue}queryIdleSequelId(){let t=0;return this.iterateBehaviorsReverse((e=>(t=e.onQueryIdleSequelId(),!t))),t||h.MRBasics.sequels.idle}queryActions(){let t=[];for(let e=0;e<this._basicBehaviors.length;e++)t=n.MRLively.world.behavior(this._basicBehaviors[e]).onQueryActions(t);return t}queryReactions(){let t=this.data.reactions.map((t=>({actionId:t.actionId,displayName:t.overrideDisplayCommandName})));t=t.concat([{actionId:h.MRBasics.actions.ThrowActionId},{actionId:h.MRBasics.actions.FallActionId},{actionId:h.MRBasics.actions.DropActionId}]),this.isOnGround()?t.push({actionId:h.MRBasics.actions.PickActionId}):t.push({actionId:h.MRBasics.actions.PutActionId});for(const e of this.collectBehaviors())e.onQueryReactions(this,t);return t}collectTraits(){const t=[];return this.iterateBehaviorsReverse((e=>{e.onCollectTraits(this,t)}),!0),this.iterateStates((e=>{e.stateEffect().traits.forEach((e=>t.push(e)))})),t}collectSkillActions(){const t=[];for(const e of this.collectBehaviors())e.onCollectSkillActions(t);return t}queryIdealParameterPlus(t){return this.collectBehaviors().reduce(((e,i)=>e+i.onQueryIdealParameterPlus(t)),0)}_callBehaviorIterationHelper(t){const e=this.abilities();let i=o.SCommandResponse.Pass;for(let r=e.length-1;r>=0;r--)for(const s of e[r].behabiors()){let e=t(s);e!=o.SCommandResponse.Pass&&(i=e)}for(let e=this._basicBehaviors.length-1;e>=0;e--){let r=t(n.MRLively.world.behavior(this._basicBehaviors[e]));if(r!=o.SCommandResponse.Pass){i=r;break}}return i}_callStateIterationHelper(t){const e=this.states();let i=o.SCommandResponse.Pass;for(let r=e.length-1;r>=0;r--)i=e[r]._callStateIterationHelper(t);return i}static _iterateBehavior(t,e,i){let r;for(let s=t.length-1;s>=0;s--){if(r=e(n.MRLively.world.behavior(t[s])),!i(r))return r}return r}iterateBehaviors(t){for(const e of this._basicBehaviors)t(n.MRLively.world.behavior(e))}iterateStates(t){for(const e of this._states)if(!1===t(n.MRLively.world.object(e)))return!1;return!0}iterateBehaviors2(t){const e=this.traits(h.MRBasics.traits.SealSpecialAbility).length>0;for(let i=0;i<this._basicBehaviors.length;i++){const r=n.MRLively.world.behavior(this._basicBehaviors[i]);if(e&&r.behaviorGroup()==a.LBehaviorGroup.SpecialAbility)continue;if(!t(r))return!1;const s=[];r.onCollectCharmdBehaviors(this,s);for(let e=0;e<s.length;e++)if(!1===t(s[e]))return!1}for(let e=0;e<this._states.length;e++){if(!n.MRLively.world.object(this._states[e]).iterateBehaviors((e=>t(e))))return!1}for(let e=0;e<this._abilities.length;e++){if(!n.MRLively.world.object(this._abilities[e]).iterateBehaviors((e=>t(e))))return!1}return!0}iterateBehaviorsReverse(t,e=!1){for(let e=this._states.length-1;e>=0;e--){if(!n.MRLively.world.object(this._states[e]).iterateBehaviors((e=>t(e))))return!1}for(let e=this._abilities.length-1;e>=0;e--){if(!n.MRLively.world.object(this._abilities[e]).iterateBehaviors((e=>t(e))))return!1}const i=!e&&this.traits(h.MRBasics.traits.SealSpecialAbility).length>0;for(let e=this._basicBehaviors.length-1;e>=0;e--){const r=n.MRLively.world.behavior(this._basicBehaviors[e]);if(i&&r.behaviorGroup()==a.LBehaviorGroup.SpecialAbility)continue;if(!1===t(r))return!1;const s=[];r.onCollectCharmdBehaviors(this,s);for(let e=s.length-1;e>=0;e--)if(!1===t(s[e]))return!1}return!0}collectBehaviors(){const t=[];return this.iterateBehaviors2((e=>(t.push(e),!0))),t}_callDecisionPhase(t,e){let i=o.SPhaseResult.Pass;return this.iterateBehaviorsReverse((r=>(i=r.onDecisionPhase(this,t,e),i==o.SPhaseResult.Pass))),i}_sendActivity(t,e){let i=o.SCommandResponse.Pass;return this.iterateBehaviorsReverse((r=>(i=r.onPreActivity(this,t,e),i==o.SCommandResponse.Pass))),i!=o.SCommandResponse.Pass||this.iterateBehaviorsReverse((r=>(i=r.onActivity(this,t,e),i==o.SCommandResponse.Pass))),i}_sendActivityReaction(t,e){return this._callBehaviorIterationHelper((i=>i.onActivityReaction(this,t,e)))}makeSaveContents(){let t={};return t.id=this.entityId(),t.floorId=this.floorId,t.x=this.mx,t.y=this.my,t.behaviors=this._basicBehaviors,t}extractSaveContents(t){this._setObjectId(t.id),this.floorId=t.floorId,this.mx=t.x,this.my=t.y,this._basicBehaviors=t.behaviors}isOnGround(){if(this.floorId.hasAny()){return n.MRLively.map.block(this.mx,this.my).findEntityLayerKind(this)==b.DBlockLayerKind.Ground}return!1}roomId(){return n.MRLively.map.block(this.mx,this.my)._roomId}isOnRoom(){return this.roomId()>0}isOnPassageWay(){return this.roomId()<=0}layer(){const t=n.MRLively.map.block(this.mx,this.my).findEntityLayerKind(this);return(0,l.assert)(t),t}isOnOffstage(){return this.mx<0}isAppearedOnMap(){if(!n.MRLively.map.isValidPosition(this.mx,this.my))return!1;return n.MRLively.map.block(this.mx,this.my).containsEntity(this)}generateDropItems(t){const e=[];return this.iterateBehaviorsReverse((i=>(i.onGenerateDropItems(this,t,e),!0))),e}recoverAll(){this.removeAllStates(!1),this.params.params().forEach((t=>{t&&t.data.recoverTarget&&t.clearDamage(this)}))}previewRejection(t,e){let i=o.SCommandResponse.Pass;return this.iterateBehaviorsReverse((r=>(i=r.onPreviewRejection(this,t,e),i==o.SCommandResponse.Pass))),i!=o.SCommandResponse.Canceled}sendPartyEvent(t,e){return!(this._partyId>0)||n.MRLively.world.party(this._partyId).send(t,e)}checkLooksLikeItem(){for(const t of this.collectBehaviors().reverse()){const e=t.onCheckLooksLikeItem();if(e)return e}return!1}checkLooksLikeGold(){for(const t of this.collectBehaviors().reverse()){const e=t.onCheckLooksLikeGold();if(e)return e}return!1}makeDeathResultStates(){this._deathResult.clearStates(),this.iterateStates((t=>this._deathResult.addState(t.stateDataId())))}canStack(){return!!this.collectTraits().find((t=>t.code==h.MRBasics.traits.Stackable))}checkStackable(t){return!!this.collectTraits().find((t=>t.code==h.MRBasics.traits.Stackable))&&(!!t.collectTraits().find((t=>t.code==h.MRBasics.traits.Stackable))&&this.dataId==t.dataId)}isStacked(){return(0,l.assert)(this._stackCount>=1),this._stackCount>=2}increaseStack(t){(0,l.assert)(this.checkStackable(t)),this._stackCount=Math.min(this._stackCount+t._stackCount,P.paramMaxEntityStackCount),t.destroy()}decreaseStack(){(0,l.assert)(this._stackCount>=2),this._stackCount--;const t=this.clone();return t._stackCount=1,t}debugDisplayName(){return`Entity:${this._name}(${this.entityId().index2()}:${this.entityId().key2()})-(${this.data.entity.key})`}get hp(){return this.getActualParam(h.MRBasics.params.hp)}get atk(){return this.getActualParam(h.MRBasics.params.atk)}get def(){return this.getActualParam(h.MRBasics.params.def)}get agi(){return this.getActualParam(h.MRBasics.params.agi)}get fp(){return this.getActualParam(h.MRBasics.params.fp)}};C=r=s([l.MRSerializable],C),e.LEntity=C},5557:function(t,e,i){"use strict";var r=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LEventServer=e.LEventResult=void 0;const s=i(1298),a=i(9115),n=i(7352);var o;!function(t){t[t.Pass=0]="Pass",t[t.Handled=1]="Handled"}(o=e.LEventResult||(e.LEventResult={}));let c=class{constructor(){this._entries=[]}subscribe(t,e){(0,s.assert)(e.hasId()),this._entries.push({eventId:t,behaviorId:e.id()})}unsubscribe(t,e){const i=e.id(),r=this._entries.findIndex((e=>e.eventId==t&&e.behaviorId.equals(i)));r>=0&&this._entries.splice(r,1)}publish(t,e,i){for(const r of this._entries)if(r.eventId==e){if(n.MRLively.world.behavior(r.behaviorId).onEvent(t,e,i)!=o.Pass)return a.MRSystem.integration.onEventPublished(e,i,!0),!1}return a.MRSystem.integration.onEventPublished(e,i,!1),!0}};c=r([s.MRSerializable],c),e.LEventServer=c},1452:function(t,e,i){"use strict";var r=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LSanctuaryFieldEffect=e.LFieldEffect=void 0;const s=i(1298),a=i(4836),n=i(1325),o=i(5705),c=i(7352);class l{onCheckIncludes(t,e){return!1}onCheckPossibleMovement(t,e,i){return!1}onStabilizeSituation(t){return n.SCommandResponse.Pass}}e.LFieldEffect=l;let h=class extends l{constructor(t){super(),this._ownerEntityId=t.entityId().clone()}get owner(){return c.MRLively.world.entity(this._ownerEntityId)}onCheckIncludes(t,e){const i=this.owner;return t==i.mx&&e==i.my}onCheckPossibleMovement(t,e,i){const r=this.owner;return!t.findEntityBehavior(o.LEnemyBehavior)||!(e==r.mx&&i==r.my)}onStabilizeSituation(t){const e=this.owner,i=c.MRLively.map.tryGetBlock(e.mx,e.my);if(i)for(const t of i.getEntities())t.findEntityBehavior(o.LEnemyBehavior)&&t.addState(a.MRBasics.states.dead);return n.SCommandResponse.Pass}};h=r([s.MRSerializable],h),e.LSanctuaryFieldEffect=h},4765:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LFloorId=void 0;const a=i(1298),n=i(2213),o=i(2255),c=i(9185);let l=r=class{constructor(t,e,i){this._landId=t,this._floorClass=e,this._floorNumber=i}landId(){return this._landId}landData(){return c.MRData.lands[this._landId]}floorNumber(){return(0,a.assert)(this._floorClass==o.DFloorClass.FloorMap),this._floorNumber}get eventMapIndex(){return(0,a.assert)(this._floorClass==o.DFloorClass.EventMap),this._floorNumber}eventMapData(){const t=this.landData().eventMapIds[this.eventMapIndex];return c.MRData.maps[t]}get preset(){const t=this.floorInfo().presetId;return(0,a.assert)(t>0),c.MRData.floorPresets[t]}isEmpty(){return!this.hasAny()}hasAny(){return!(this._landId<=0)&&(this._floorClass==o.DFloorClass.FloorMap?0!=this._floorNumber:this._floorNumber>=0)}equals(t){return this._landId==t._landId&&this._floorNumber==t._floorNumber}clone(){return new r(this._landId,this._floorClass,this._floorNumber)}static makeEmpty(){return new r(0,o.DFloorClass.FloorMap,0)}static make(t,e,i){return new r(t,e,i)}static makeFromKeys(t,e){const i=c.MRData.lands.find((e=>e.name==t));if(!i)throw new Error(`Land "${t}" not found.`);const s=i.floorInfos.findIndex((t=>t&&t.key==e));if(s<=0)throw new Error(`Floor "${e}" not found.`);return new r(i.id,o.DFloorClass.FloorMap,s)}static makeFromEventMapData(t){const e=c.MRData.lands[t.landId],i=e.getFloorClass(t);return(0,a.assert)(i==o.DFloorClass.EventMap),new r(t.landId,i,e.eventMapIds.findIndex((e=>e==t.id)))}static makeByRmmzFixedMapName(t){const e=$dataMapInfos.findIndex((e=>e&&e.name==t)),i=c.MRData.maps[e].landId,s=c.MRData.lands[i].floorInfos.findIndex((e=>e&&e.fixedMapName==t));return(0,a.assert)(s>0),new r(i,o.DFloorClass.FloorMap,s)}static makeByRmmzNormalMapId(t){const e=c.MRData.maps[t].landId;return(0,a.assert)(e>0),new r(e,o.DFloorClass.EventMap,t)}floorInfo(){(0,a.assert)(this.hasAny());const t=c.MRData.lands[this._landId].floorInfos[this._floorNumber];return(0,a.assert)(t),t}rmmzMapId(){if((0,a.assert)(this._landId>0),this._landId==n.DHelpers.VanillaLandId)return this._floorNumber;if(this._floorClass==o.DFloorClass.EventMap)return this.eventMapData().mapId;{const t=this.rmmzFixedMapId();return t>0?t:c.MRData.lands[this._landId].rmmzMapId}}rmmzFixedMapId(){const t=this.landData(),e=this.floorInfo(),i=t.findFixedMapByName(e.fixedMapName);return i?i.mapId:0}isEventMap(){return this._floorClass==o.DFloorClass.EventMap}isNormalMap(){return this._landId==n.DHelpers.VanillaLandId}isRandomMap(){return!!this.isTacticsMap()&&(!this.isEventMap()&&this.rmmzFixedMapId()<=0)}isFixedMap(){return!!this.isTacticsMap()&&this.rmmzFixedMapId()>0}isSafetyMap(){if(this._landId==n.DHelpers.VanillaLandId){const t=this.rmmzMapId();if(c.MRData.maps[t].safetyMap)return!0}return!1}isTacticsMap(){return this._landId!=n.DHelpers.VanillaLandId&&this._floorClass==o.DFloorClass.FloorMap}isDungeonMap(){return this._floorClass==o.DFloorClass.FloorMap}isRMMZDefaultSystemMap(){return this._landId==n.DHelpers.VanillaLandId&&c.MRData.maps[this._floorNumber].defaultSystem}};l=r=s([a.MRSerializable],l),e.LFloorId=l},1019:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LIdentifyer=e.EntityIdentificationLevel=e.LEntityDescription=e.DescriptionHighlightColor=void 0;const a=i(1298),n=i(6291),o=i(9185),c=i(9901);var l;!function(t){t[t.Identified=0]="Identified",t[t.Unidentified=1]="Unidentified",t[t.UserIdentified=2]="UserIdentified",t[t.UnitName=3]="UnitName"}(l=e.DescriptionHighlightColor||(e.DescriptionHighlightColor={}));let h=r=class{constructor(t,e,i,r,s){this._iconIndex=t,this._name=e,this._highlightLevel=i,this._upgrades=r,this._capacity=s}iconIndex(){return this._iconIndex}name(){return this._name}displayText(){const t=r.getColorNumber(this._highlightLevel);let e=`\\I[${this._iconIndex}]\\C[${t}]${this._name}`;return 0!=this._upgrades&&(e+=this._upgrades>0?`+${this._upgrades}`:this._upgrades.toString()),void 0!==this._capacity&&(e+=`[${this._capacity}]`),e+="\\C[0]",e}static getColorNumber(t){return this._levelColorTable[t]}static makeDisplayText(t,e){return`\\C[${this.getColorNumber(e)}]${t}\\C[0]`}};var u;h._levelColorTable=[0,14,3,14,23],h=r=s([a.MRSerializable],h),e.LEntityDescription=h,function(t){t[t.Unidentified=0]="Unidentified",t[t.KindIdentified=1]="KindIdentified",t[t.IndividualIdentified=2]="IndividualIdentified"}(u=e.EntityIdentificationLevel||(e.EntityIdentificationLevel={}));let d=class{constructor(){this._identificationStates=[]}reset(t){this._identificationStates=[];for(const e of o.MRData.pseudonymous.kinds())if(t.checkIdentifiedKind(e));else{const t=o.MRData.pseudonymous.getNameList(e.id),i=o.MRData.entities.filter((t=>t.entity.kindId==e.id&&t.identificationDifficulty==n.DIdentificationDifficulty.Obscure));if(t.length<i.length)throw new Error((0,a.tr2)(`Kind:${e.key} の pseudonym が不足しています。(c: ${t.length})`));t.mutableShuffle();for(let e=0;e<i.length;e++){const r=i[e];this._identificationStates[r.id]={nameIdentified:!1,pseudonym:t[e],nickname:void 0}}}}identifyGlobal(t){const e=this._identificationStates[t];e&&(e.nameIdentified=!0)}getEntityIdentificationLevel(t,e){const i=e.dataId,r=e.data,s=this._identificationStates[i];return s?e.individualIdentified()?u.IndividualIdentified:s.nameIdentified?r.allowModifierState?u.KindIdentified:u.IndividualIdentified:u.Unidentified:e.individualIdentified()?u.IndividualIdentified:r.allowModifierState?u.KindIdentified:u.IndividualIdentified}resolveDescription(t,e){const i=e.dataId,r=(e.data,this._identificationStates[i]);let s="",a=l.Identified;const n=this.getEntityIdentificationLevel(t,e);n==u.IndividualIdentified&&(a=l.Identified),n<=u.KindIdentified&&(a=l.Unidentified,r&&(r.nickname?(a=l.UserIdentified,s=r.nickname):s=r.pseudonym));const o=c.SView.getLookNames(t,e);let d=s;n>=u.KindIdentified&&(d=o.name);let p,f=0;n>=u.IndividualIdentified&&(f=o.upgrades),void 0!==o.capacity&&o.initialCapacity&&(n<=u.KindIdentified?(p=o.capacity-o.initialCapacity,0===p&&(p=void 0)):p=o.capacity);let m=o.iconIndex;if(n<=u.KindIdentified);else if(n>=u.IndividualIdentified){const t=e.states();if(t.length>0){const e=t.find((t=>t.stateData().displayNameIcon));e&&(m=e.stateData().iconIndex)}}return new h(m,d,a,f,p)}checkGlobalIdentified(t){const e=t.dataId,i=this._identificationStates[e];return!i||i.nameIdentified}setNickname(t,e){const i=this._identificationStates[t];i&&(i.nickname=e)}makeDisplayText(t,e){return this.resolveDescription(t,e).displayText()}};d=s([a.MRSerializable],d),e.LIdentifyer=d},4237:function(t,e,i){"use strict";var r=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LJournal=e.LChallengingStatus=void 0;const s=i(1298),a=i(9185),n=i(9115);var o;!function(t){t[t.None=0]="None",t[t.Challenging=1]="Challenging"}(o=e.LChallengingStatus||(e.LChallengingStatus={}));let c=class{constructor(){this._status=o.None,this._exitResult=a.LandExitResult.Challenging}get exitResult(){return this._exitResult}get exitResultSummary(){return this._exitResult/100}get isChallenging(){return this._status==o.Challenging}get isPenaltyResult(){return a.LandExitResult.Gameover<=this._exitResult}startChallenging(){this._exitResult=a.LandExitResult.Challenging,this._status=o.Challenging}finishChallenging(){this._status=o.None}commitLandResult(t){this._exitResult=t,n.MRSystem.integration.onSetLandExitResult(t)}};c=r([s.MRSerializable],c),e.LJournal=c},9412:function(t,e,i){"use strict";var r=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LLand=void 0;const s=i(9185),a=i(1298),n=i(1019);let o=class{constructor(t){this._landDataId=0,this.identifyer=new n.LIdentifyer,this._landDataId=t.id}landData(){return s.MRData.lands[this._landDataId]}maxFloorNumber(){return this.landData().floorInfos.length-1}resetIdentifyer(){this.identifyer.reset(this.landData())}};o=r([a.MRSerializable],o),e.LLand=o},6229:function(t,e,i){"use strict";var r=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LMap=e.MovingMethod=void 0;const s=i(1298),a=i(4879),n=i(4685),o=i(7352),c=i(8254),l=i(9115),h=i(8245),u=i(4977),d=i(1893),p=i(7569),f=i(5306),m=i(4325),y=i(4765),_=i(6316),g=i(7991),v=i(5967),S=i(8153),M=i(1301);var R;!function(t){t[t.Walk=0]="Walk",t[t.Projectile=1]="Projectile",t[t.Penetration=2]="Penetration"}(R=e.MovingMethod||(e.MovingMethod={}));let b=class extends u.LObject{constructor(){super(u.LObjectType.Map),this._floorId=y.LFloorId.makeEmpty(),this._width=0,this._height=0,this._blocks=[],this._entityIds=[],this._rooms=[],this._structures=[],this._mapdataRevision=1,this._roundCount=0,this.unitClarity=!1,this.itemClarity=!1,this.trapClarity=!1,this.sightClarity=!1,this.keeperCount=0,this.lastKeeperCount=0}isGCReady(){return!1}setup(t,e){(0,s.assert)(0==this._entityIds.length),this._floorId=t,this.unitClarity=!1,this.itemClarity=!1,this.trapClarity=!1,this.sightClarity=!1,this.build(e)}setupForRMMZDefaultMap(t){(0,s.assert)(0==this._entityIds.length),this._floorId=t,this.setupEmptyMap(1,1)}mapdataRevision(){return this._mapdataRevision}increaseRevision(){this._mapdataRevision++}roundCount(){return this._roundCount}increaseRoundCount(){this._roundCount++}setupEmptyMap(t,e){this._width=t,this._height=e;const i=this._width*this._height;this._blocks=new Array(i);for(let t=0;t<i;t++){const e=Math.trunc(t%this._width),i=Math.trunc(t/this._width);this._blocks[t]=new a.LBlock(e,i),this._blocks[t]._tileShape=a.LTileShape.Floor}}build(t){this._roundCount=0;{const e=t.fullWidth,i=t.fullHeight;this.setupEmptyMap(e,i);for(let r=0;r<i;r++)for(let i=0;i<e;i++){const e=t.block(i,r),s=this.block(i,r),a=e.tileShape();s._tileShape=a,s._roomId=e.roomId(),s._blockComponent=e.component(),s._continuation=e.isContinuation(),s._roomInnerEntrance=e.isDoorway(),s._shapeVisualPartIndex=e.shapeVisualPartIndex,s._decorationVisualPartIndex=e.decorationVisualPartIndex}this._rooms=t.rooms_raw().map((t=>{const e=new d.LRoom;return e.setup(t),e})),this._structures=[new p.LStructure(0)];for(const e of t.structures())if(e instanceof f.FMonsterHouseStructure){const t=new m.LMonsterHouseStructure(this._structures.length);t.setup(e.roomId(),e.monsterHouseTypeId()),this._structures.push(t)}else{if(!(e instanceof f.FItemShopStructure))throw new Error("Invalid Structure type.");{const t=new g.LItemShopStructure(this._structures.length);t.setup(e.roomId(),e.itemShopTypeId()),this._structures.push(t)}}}}releaseMap(){this._removeAllEntities(),this._width=0,this._height=0,this._blocks=[]}isValid(){return this._floorId.hasAny()&&this._width>0}floorId(){return this._floorId}rooms(){return this._rooms}room(t){return this._rooms[t]}get isSingleRoomMap(){return 2==this._rooms.length}structures(){return this._structures}land2(){return o.MRLively.world.land(this._floorId.landId())}floorData(){return this.land2().landData().floorInfos[this._floorId.floorNumber()]}width(){return this._width}height(){return this._height}blocks(){return this._blocks}block(t,e){let i,r;return t instanceof h.Vector2?(i=t.x,r=t.y):(i=t,r=e),i<0||this._width<=i||r<0||this._height<=r?o.MRLively.borderWall:this._blocks[r*this._width+i]}tryGetBlock(t,e){return t<0||this._width<=t||e<0||this._height<=e?void 0:this._blocks[e*this._width+t]}getEdgeBlocks(t,e,i){(0,s.assert)(i>=0);const r=[];if(0==i){const i=this.tryGetBlock(t,e);i&&r.push(i)}else{const s=t-i,a=e-i,n=t+i,o=e+i,c=2*i;for(let t=0;t<c;t++){const e=this.tryGetBlock(s+t,a);e&&r.push(e)}for(let t=0;t<c;t++){const e=this.tryGetBlock(n,a+t);e&&r.push(e)}for(let t=0;t<c;t++){const e=this.tryGetBlock(n-t,o);e&&r.push(e)}for(let t=0;t<c;t++){const e=this.tryGetBlock(s,o-t);e&&r.push(e)}}return r}roomFloorBlocks(){return this._blocks.filter((t=>t.isRoom()&&t.tileShape()==a.LTileShape.Floor))}getSpawnableBlocks(t){return this.roomFloorBlocks().filter((e=>!e.layer(t).isContainsAnyEntity()))}isValidPosition(t,e){return 0<=t||t<this._width||0<=e||e<this._height}roomId(t,e){return t instanceof n.LEntity?this.roomId(t.mx,t.my):this.block(t,e)._roomId}entities(){return this._entityIds.map((t=>o.MRLively.world.entity(t))).filter((t=>null!=t))}iterateEntities(t,e=!1){for(const e of this._entityIds){if(!1===t(o.MRLively.world.entity(e)))return!1}return!0}getInsightEntities(t){return this.entities().filter((e=>M.USearch.checkInSightEntity(t,e)))}_addEntityInternal(t){(0,s.assert)(t.floorId.equals(this.floorId())),(0,s.assert)(t.entityId().hasAny()),(0,s.assert)(!t.hasParent()),this._entityIds.push(t.entityId()),t.setParent(this),t.iterateBehaviorsReverse((e=>(e.onEnteredMap(t,this),!0))),l.MRSystem.integration.entityEnteredMap(t)}appearEntity(t,e,i,r){(0,s.assert)(t.floorId.isEmpty()),t.floorId=this.floorId(),_.UMovement.locateEntity(t,e,i,r),this._addEntityInternal(t)}_reappearEntity(t){if((0,s.assert)(t.floorId.equals(this.floorId())),t.isOnOffstage())this._addEntityInternal(t);else{const e=this.block(t.mx,t.my),i=t.getHomeLayer();e.addEntity(i,t),_.UMovement._postLocate(t,void 0,e,this,void 0),this._addEntityInternal(t)}}_removeEntity(t){this._entityIds=this._entityIds.filter((e=>!e.equals(t.entityId()))),this._removeEntityHelper(t)}_removeAllEntities(){this._entityIds.forEach((t=>{const e=o.MRLively.world.entity(t);this._removeEntityHelper(e)})),this._entityIds=[]}_removeEntityHelper(t){if((0,s.assert)(t.floorId.equals(this.floorId())),t.floorId.isTacticsMap()){const e=this.block(t.mx,t.my).removeEntity(t);(0,s.assert)(e)}t.floorId=y.LFloorId.makeEmpty(),t.clearParent(),l.MRSystem.integration.entityLeavedMap(t)}onRemoveChild(t){t instanceof n.LEntity&&this._removeEntity(t)}canMoveEntering(t,e,i,r){if(i==R.Walk&&S.UBlock.checkPurifier(t,e))return!1;switch(i){case R.Walk:return!t.layers()[r].isOccupied()&&t.tileShape()==a.LTileShape.Floor;case R.Projectile:return!t.layers()[r].isOccupied()&&!t.isWallLikeShape();case R.Penetration:return!t.layers()[r].isOccupied();default:throw new Error("Not implemented.")}}canLeaving(t,e){return t.tileShape()==a.LTileShape.Floor}checkPassage(t,e,i,r){const s=c.Helpers.dirToTileOffset(e),a=this.block(t.mx,t.my),n=this.block(t.mx+s.x,t.my+s.y),o=r||t.getHomeLayer();return!(!this.canLeaving(a,t)||!this.canMoveEntering(n,t,i,o))}checkAppearing(t){return this._floorId.equals(t.floorId)&&!t.isOnOffstage()}updateLocatedResults(t){for(const e of this.entities())if(e._located){for(const i of this._structures)i.onEntityLocated(t,e);e._located=!1}}firstFeetEntity(t){return o.MRLively.map.block(t.mx,t.my).layer(v.DBlockLayerKind.Ground).firstEntity()}};b=r([s.MRSerializable],b),e.LMap=b},3587:function(t,e,i){"use strict";var r=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LMessageHistory=void 0;const s=i(1298),a=i(7352);let n=class{constructor(){this._lastViewLineIndex=-1,this._texts=[]}clear(){this._texts=[],this._lastViewLineIndex=-1}add(t){this._texts.push(t),a.MRLively.recorder.isSilentPlayback()&&(this._lastViewLineIndex=this._texts.length)}hasText(){return this._texts.length>0}texts(){return this._texts}includesText(t){return!!this._texts.find((e=>e.includes(t)))}countIncludesText(t){return this._texts.count((e=>e.includes(t)))}};n=r([s.MRSerializable],n),e.LMessageHistory=n},4977:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LObject=e.LObjectType=e.LEntityId=void 0;const a=i(1298),n=i(7352);let o=r=class{constructor(t,e){this._index=t,this._key=e}index2(){return this._index}key2(){return this._key}isEmpty(){return 0==this._index&&0==this._key}hasAny(){return this._index>0&&0!=this._key}equals(t){return this._index==t._index&&this._key==t._key}clear(){this._index=0,this._key=0}clone(){return new r(this._index,this._key)}static makeEmpty(){return new r(0,0)}get object(){return n.MRLively.world.object(this)}};o=r=s([a.MRSerializable],o),e.LEntityId=o,function(t){t[t.Entity=0]="Entity",t[t.State=1]="State",t[t.Ability=2]="Ability",t[t.Behavior=3]="Behavior",t[t.Map=4]="Map"}(e.LObjectType||(e.LObjectType={}));e.LObject=class{constructor(t){this._objectId=o.makeEmpty(),this._destroyed=!1,this._parentObjectId=o.makeEmpty(),this._objectType=t}objectType(){return this._objectType}__objectId(){return this._objectId}hasId(){return this._objectId.hasAny()}_setObjectId(t){(0,a.assert)(t.hasAny()),(0,a.assert)(!this.hasId()),this._objectId=t}_clearObjectId(){this._objectId=o.makeEmpty()}isUnique(){return!1}hasParent(){return this._parentObjectId.hasAny()}isGCReady(){return!this.isUnique()&&!this.hasParent()}parentObjectId(){return this._parentObjectId}parentObject(){return n.MRLively.world.object(this._parentObjectId)}parentAs(t){if(!this.hasParent())return;const e=this.parentObject();return e instanceof t?e:void 0}setParent(t){this.hasParent()&&(console.error("this",this),console.error("current parent",this.parentObject()),console.error("new parent",t),(0,a.assert)(!this.hasParent()));const e=t.__objectId();(0,a.assert)(e.hasAny()),this._parentObjectId=e}clearParent(){this._parentObjectId=o.makeEmpty()}removeFromParent(){this.hasParent()&&(this.onRemoveFromParent(),this.parentObject().onRemoveChild(this),(0,a.assert)(this._parentObjectId.isEmpty()))}isDestroyed(){return this._destroyed}destroy(){(0,a.assert)(!this.isUnique()),this.removeFromParent(),this._destroyed=!0}onFinalize(){}behaviorIds(){return[]}onRemoveChild(t){throw new Error("Unreachable.")}onRemoveFromParent(){}}},6497:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LParamSet=e.LParam=void 0;const a=i(1298),n=i(4561),o=i(6539),c=i(9185),l=i(4836);let h=r=class{constructor(t){this.parameterId=t,this._damageValue=0,this._effortValue=0,this._buff=0,this._initialActualValue=0,this._constantBuff={level:0,turn:0},this._ratioBuff={level:0,turn:0},this._damageValueChanged=!1,this.reset()}reset(){var t;const e=this.data;this.isAllowDamage?this._damageValue=e.initialIdealValue-(null!==(t=e.initialValue)&&void 0!==t?t:0):this._damageValue=0,this._effortValue=0,this._buff=0}clone(){const t=new r(this.parameterId);return t._damageValue=this._damageValue,t._effortValue=this._effortValue,t._buff=this._buff,t._initialActualValue=this._initialActualValue,t._constantBuff=Object.assign({},this._constantBuff),t._ratioBuff=Object.assign({},this._ratioBuff),t._damageValueChanged=this._damageValueChanged,t}get data(){return c.MRData.parameters[this.parameterId]}get isDependent(){return this.data.type==o.DParameterType.Dependent}get isAllowDamage(){const t=this.data;return t.allowDamage&&t.type!=o.DParameterType.Dependent}getMinLimit(){return this.data.minLimit}getMaxLimit(){return this.data.maxLimit}effortValue(){return this._effortValue}setEffortValue(t){const e=this.data;this._effortValue=Math.round(t.clamp(e.minEffortLimit,e.maxEffortLimit))}gainEffortValue(t){const e=this.data;this._effortValue=Math.round((this._effortValue+t).clamp(e.minEffortLimit,e.maxEffortLimit))}clearEffortValue(){this._effortValue=0}getIdealMinValue(t){return this.data.minLimit}getIdealMaxValue(t){return this.getIdealMaxBase(t)+this.getIdealMaxPlus(t)}getIdealMaxBase(t){const e=this.data;return e.battlerParamId>=0?t.getIdealParamBase(this.parameterId):e.initialIdealValue}getIdealMaxPlus(t){return this.effortValue()+t.queryIdealParameterPlus(this.parameterId)}getActualMin(t){return this.getIdealMinValue(t)}getActualMax(t){const e=this.getIdealMaxValue(t)*this.idealParamRate(t)*this.paramBuffRate(t)+this.buffPlus(),i=this.getMinLimit(),r=this.getMaxLimit();return Math.round(e.clamp(i,r))}idealParamRate(t){return t.traitsPi(l.MRBasics.traits.TRAIT_PARAM,this.parameterId)}paramBuffRate(t){return(.25*this.buff()+1)*this.buffRate()}actualParamDamge(){return this.data.type==o.DParameterType.Dependent&&(0,a.assert)(0===this._damageValue),this._damageValue}get isDamageValueChanged(){return this._damageValueChanged}clearDamageValueChanged(){this._damageValueChanged=!1}setActualDamgeParam(t){(0,a.assert)(this.isAllowDamage),this._damageValue!==t&&(this._damageValue=t,this._damageValueChanged=!0)}gainActualParam(t){(0,a.assert)(this.isAllowDamage),0!==t&&(this._damageValue-=t,this._damageValueChanged=!0)}getConstantBuff(){return this._constantBuff}getRatioBuff(){return this._ratioBuff}buff(){return this._buff}buffPlus(){return this._constantBuff.level*c.MRData.parameters[this.parameterId].addBuffCoe}buffRate(){return this._ratioBuff.level*c.MRData.parameters[this.parameterId].mulBuffCore+1}clearDamage(t){const e=this.data;void 0===e.initialValue?this._damageValue=0:t.setParamCurrentValue(this.parameterId,e.initialValue)}resetInitialActualValue(t){this._initialActualValue=t}initialActualValue(){return this._initialActualValue}addBuff(t){const e=t.type==n.DBuffType.Add?this._constantBuff:this._ratioBuff;switch(t.levelType){case n.DBuffLevelOp.Set:e.level=t.level;break;case n.DBuffLevelOp.Add:e.level+=t.level;break;default:throw new Error("Unreachable.")}e.turn=t.turn}removeBuff(){this._constantBuff.level=0,this._constantBuff.turn=0,this._ratioBuff.level=0,this._ratioBuff.turn=0}updateBuffs(t){this._constantBuff.turn>0&&(this._constantBuff.turn--,this._constantBuff.turn<=0&&(this._constantBuff.level=0,t._effectResult.pushRemovedBuff(this.parameterId))),this._ratioBuff.turn>0&&(this._ratioBuff.turn--,this._ratioBuff.turn<=0&&(this._ratioBuff.level=0,t._effectResult.pushRemovedBuff(this.parameterId)))}};h=r=s([a.MRSerializable],h),e.LParam=h;let u=class{constructor(){this._params=[]}getMinLimit(t){const e=this.param(t);return e?e.getMinLimit():0}getMaxLimit(t){const e=this.param(t);return e?e.getMaxLimit():1/0}getIdealMinValue(t,e){const i=this.param(e);return i?i.getIdealMinValue(t):0}getIdealMaxValue(t,e){const i=this.param(e);return i?i.getIdealMaxValue(t):0}getActualMin(t,e){const i=this.param(e);return i?i.getActualMin(t):0}getActualMax(t,e){const i=this.param(e);return i?i.getActualMax(t):0}copyTo(t){t._params=this._params.map((t=>t?t.clone():void 0))}clear(){this._params=[]}acquireParam(t){const e=this._params[t];if(e)return e;{const e=new h(t);return this._params[t]=e,e}}resetAllConditions(){this._params.forEach((t=>null==t?void 0:t.reset()))}clearParamPlus(){this._params.forEach((t=>null==t?void 0:t.clearEffortValue()))}params(){return this._params}param(t){return this._params[t]}hasParam(t){return void 0!==this._params[t]}updateBuffs(t){for(const e of this._params)e&&e.updateBuffs(t)}refresh(t){for(const e of this._params)if(e&&e.isAllowDamage){const i=this.getActualMax(t,e.parameterId);let r=i-e.actualParamDamge();const s=t.queryParamMinMax(e.parameterId);r<s.min&&(r=s.min),r>i&&(r=i),i<0?e.setActualDamgeParam(r-i):e.setActualDamgeParam(i-r),e.clearDamageValueChanged()}}};u=s([a.MRSerializable],u),e.LParamSet=u},2309:function(t,e,i){"use strict";var r=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LParty=void 0;const s=i(1298),a=i(7352),n=i(4977),o=i(5557),c=i(4237),l=i(9248);let h=class{constructor(){this._id=0,this._members=[],this._entries=[],this._leaderEntityId=n.LEntityId.makeEmpty(),this.journal=new c.LJournal,this.journal.startChallenging()}setup(t){this._id=t}id(){return this._id}isEmpty(){return 0==this._members.length}get members(){return this._members.map((t=>a.MRLively.world.entity(t)))}addMember(t){(0,s.assert)(0==t.partyId()),t._partyId=this._id,this._members.push(t.entityId()),1==this._members.length&&(this._leaderEntityId=t.entityId());for(const e of t.collectBehaviors())e.onPertyChanged(t)}removeMember(t){(0,s.assert)(t.partyId()==this._id),this._members.mutableRemove((e=>e.equals(t.entityId())));for(const e of t.collectBehaviors())e.onPertyChanged(t);this._entries.mutableRemoveAll((e=>a.MRLively.world.behavior(e.behaviorId).ownerEntity()==t))}subscribe(t,e){(0,s.assert)(e.hasId()),this._entries.push({eventId:t,behaviorId:e.id()})}unsubscribe(t,e){const i=e.id(),r=this._entries.findIndex((e=>e.eventId==t&&e.behaviorId==i));r>=0&&this._entries.splice(r,1)}send(t,e){for(const i of this._entries)if(i.eventId==t){if(a.MRLively.world.behavior(i.behaviorId).onPartyEvent(t,e)!=o.LEventResult.Pass)return!1}return!0}startChallenging(){this.journal.startChallenging()}finishChallenging(){for(const t of this.members)t.resetStatus();if(this.journal.isPenaltyResult)for(const t of this.members){const e=t.findEntityBehavior(l.LInventoryBehavior);e&&e.reset()}this.journal.finishChallenging(),this.journal.startChallenging()}onMemberMovedLand(t,e,i){}};h=r([s.MRSerializable],h),e.LParty=h},1130:function(t,e,i){"use strict";var r=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LRandom=void 0;const s=i(1298);let a=class{constructor(t){this._x=123456789,this._y=362436069,this._z=521288629,this._w=t}resetSeed(t){this._x=123456789,this._y=362436069,this._z=521288629,this._w=t}nextInt(){const t=this._x^this._x<<11;return this._x=this._y,this._y=this._z,this._z=this._w,this._w=this._w^this._w>>19^t^t>>8,this._w}nextIntWithMax(t){if(0==t)return 0;let e=this.nextInt();return e%=t,e}nextIntWithMinMax(t,e){if(e-t==0)return 0;let i=this.nextInt();return i%=e-t,i+=t,i}nextIntWithWidth(t,e){return this.nextIntWithMinMax(t-e,t+e)}select(t){return(0,s.assert)(t.length>0),t[this.nextIntWithMax(t.length)]}selectOrUndefined(t){return t.length>0?t[this.nextIntWithMax(t.length)]:void 0}mutableShuffleArray(t){for(var e=t.length-1;0<e;e--){var i=this.nextIntWithMax(e+2),r=t[e];t[e]=t[i],t[i]=r}}};a=r([s.MRSerializable],a),e.LRandom=a},586:function(t,e,i){"use strict";var r=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LReward=void 0;const s=i(1298),a=i(4836);let n=class{constructor(){this._exp=0}clear(){this._exp=0}exp(){return this._exp}addExp(t){this._exp+=t}apply(t){t.params.hasParam(a.MRBasics.params.exp)&&t.gainActualParam(a.MRBasics.params.exp,this._exp,!0),this.clear()}};n=r([s.MRSerializable],n),e.LReward=n},1893:function(t,e,i){"use strict";var r=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LRoom=e.MonsterHouseState=void 0;const s=i(7352),a=i(1298);!function(t){t[t.Sleeping=0]="Sleeping",t[t.Activated=1]="Activated"}(e.MonsterHouseState||(e.MonsterHouseState={}));let n=class{constructor(){this._roomId=0,this._mx1=-1,this._my1=-1,this._mx2=-1,this._my2=-1,this._poorVisibility=!1}setup(t){this._roomId=t.id(),this._mx1=t.mx1,this._my1=t.my1,this._mx2=t.mx2,this._my2=t.my2,this._poorVisibility=t.poorVisibility}get mx1(){return this._mx1}get my1(){return this._my1}get mx2(){return this._mx2}get my2(){return this._my2}get width(){return this._mx2-this._mx1+1}get height(){return this._my2-this._my1+1}get poorVisibility(){return this._poorVisibility}contains(t,e){return this._mx1<=t&&t<=this._mx2&&this._my1<=e&&e<=this._my2}containsWithEdge(t,e){return this._mx1-1<=t&&t<=this._mx2+1&&this._my1-1<=e&&e<=this._my2+1}forEachEntities(t){for(const e of s.MRLively.map.entities())this.contains(e.mx,e.my)&&t(e)}findEntityInRoom(t){for(const e of s.MRLively.map.entities())if(this.contains(e.mx,e.my)&&t(e))return e}forEachBlocks(t){const e=s.MRLively.map;for(let i=this._my1;i<=this._my2;i++)for(let r=this._mx1;r<=this._mx2;r++){t(e.block(r,i))}}forEachEdgeBlocks(t){const e=s.MRLively.map,i=Math.max(0,this._mx1-1),r=Math.min(this._mx2+1,e.width()-1);if(1<=this._my1)for(let s=i;s<=r;s++)t(e.block(s,this._my1-1));if(1<=this._mx1)for(let i=this._my1;i<=this._my2;i++)t(e.block(this._mx1-1,i));if(this._mx2<s.MRLively.map.width()-1)for(let i=this._my1;i<=this._my2;i++)t(e.block(this._mx2+1,i));if(this._my2<s.MRLively.map.height()-1)for(let s=i;s<=r;s++)t(e.block(s,this._my2+1))}forEachSightableBlocks(t){this.forEachBlocks(t),this.forEachEdgeBlocks(t)}getRoomInnerEntranceBlocks(){const t=[];return this.forEachBlocks((e=>{e.isRoomInnerEntrance()&&t.push(e)})),t}checkVisibilityBlock(t){return this._mx1-1<=t.mx&&t.mx<=this._mx2+1&&this._my1-1<=t.my&&t.my<=this._my2+1}};n=r([a.MRSerializable],n),e.LRoom=n},312:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LScheduler2=e.LSchedulingUnit=e.LSchedulerPhase=void 0;const a=i(1298),n=i(4836),o=i(9185),c=i(6501),l=i(4977),h=i(7352);var u;!function(t){t[t.RoundStarting=0]="RoundStarting",t[t.Processing=1]="Processing",t[t.RoundEnding=2]="RoundEnding"}(u=e.LSchedulerPhase||(e.LSchedulerPhase={}));let d=class{constructor(t,e,i){this._index=t,this._entityId=e.entityId(),this._unitBehaviorId=i.id(),this._factionId=e.getOutwardFactionId(),(0,a.assert)(this._factionId>0),this._iterationCountMax=0,this._iterationCount=0,this.speedLevel=0,this.speedLevel2=0}index(){return this._index}entityId(){return this._entityId}get entity2(){return this.entity()}entity(){return h.MRLively.world.entity(this._entityId)}factionId(){return this._factionId}unitBehavior(){return h.MRLively.world.behavior(this._unitBehaviorId)}calcActionCount(){const t=p.getSpeedLevel(this.entity());return t<=0?1:t}isManual(){return this.unitBehavior().manualMovement()}isActionCompleted(){const t=this.entity()._actionToken;return!t.canMinorAction()&&!t.canMajorAction()}isValid(){return this._entityId.hasAny()}invalidate(){this._entityId=l.LEntityId.makeEmpty()}resetEntity(t){this._entityId=t.entityId(),this._unitBehaviorId=t.getEntityBehavior(c.LUnitBehavior).id(),this._factionId=t.getOutwardFactionId(),(0,a.assert)(this._factionId>0)}resetIterationCount(){this._iterationCount=0}iterationCountMax(){return this._iterationCountMax}setIterationCountMax(t){this._iterationCountMax=t}remainIterationCount(){return(this._iterationCountMax-this._iterationCount).clamp(0,this._iterationCountMax)}isIterationClosed(){return this._iterationCount>=this._iterationCountMax}increaseIterationCount(){this._iterationCount++}};d=s([a.MRSerializable],d),e.LSchedulingUnit=d;let p=r=class{constructor(){this.chedulerPhase=u.RoundStarting,this._schedulingUnits=[],this.nextSearchIndex=0,this._currentPhaseIndex=0,this.maxRunCount=0,this.currentRunIndex=0,this._maxActionCount=0}buildSchedulingUnits(){this._schedulingUnits=[],this._maxActionCount=0,this.currentRunIndex=0;for(const t of h.MRLively.map.entities()){const e=t.findEntityBehavior(c.LUnitBehavior);if(e){const i=this.newUnit(t,e),s=i.calcActionCount();i.speedLevel=i.speedLevel2=r.getSpeedLevel(t),this._maxActionCount=Math.max(this._maxActionCount,s)}}this.maxRunCount=this._maxActionCount;this._schedulingUnits.immutableSort(((t,e)=>o.MRData.factions[t.factionId()].schedulingOrder-o.MRData.factions[e.factionId()].schedulingOrder))}schedulingUnits(){return this._schedulingUnits}currentPhaseIndex(){return this._currentPhaseIndex}newUnit(t,e){const i=new d(this._schedulingUnits.length,t,e);return this._schedulingUnits.push(i),i}static getSpeedLevel(t){const e=t.findEntityBehavior(c.LUnitBehavior);if(e&&0!=e._speedLevel)return e._speedLevel;const i=t.getActualParam(n.MRBasics.params.agi);return i>=0?Math.floor(i/100)+1:Math.floor(i/100)}dealActionTokens(){for(const t of this._schedulingUnits){const e=t.unitBehavior(),i=t.entity(),s=r.getSpeedLevel(i);s<0&&(0==e.waitTurnCount()?e.setWaitTurnCount(1):e.setWaitTurnCount(e.waitTurnCount()-1)),0==e.waitTurnCount()&&i._actionToken.reset(i,Math.max(1,s))}}resetSeek(){this.nextSearchIndex=0}nextUnit(t){if(!this.isSeeking())return!1;for(;;){const e=this._schedulingUnits[this.nextSearchIndex];if(this.nextSearchIndex++,this.pick(t,e))return e.resetIterationCount(),!0;if(this.nextSearchIndex>=this._schedulingUnits.length)return!1}}currentUnit(){const t=this.nextSearchIndex-1;return(0,a.assert)(0<=t&&t<this._schedulingUnits.length),this._schedulingUnits[t]}isSeeking(){return this.nextSearchIndex<this._schedulingUnits.length}pick(t,e){if(!e.isValid())return!1;if(!t.testProcessable(e.entity(),e.unitBehavior()))return!1;if(e.isManual())return e.setIterationCountMax(1),!0;const i=e.calcActionCount();if(1==i)return this.currentRunIndex>=this.maxRunCount-1&&(e.setIterationCountMax(i),!0);if(i>=2){let r=0;for(const t of this._schedulingUnits)t.isValid()&&t.isManual()&&!t.isActionCompleted()&&(r=Math.max(r,i));return t.isAllowIterationAtPrepare()?r>0?(e.setIterationCountMax(1),!0):(e.setIterationCountMax(i),!0):(e.setIterationCountMax(1),!0)}throw new Error("Unreachable.")}invalidateEntity(t){const e=this._schedulingUnits.findIndex((e=>e.entityId().equals(t.entityId())));e>=0&&this._schedulingUnits[e].invalidate()}resetEntity(t){const e=this._schedulingUnits.findIndex((e=>e.entityId().equals(t.entityId())));e>=0&&this._schedulingUnits[e].resetEntity(t)}hasReadyEntity(){for(const t of this._schedulingUnits){t.entity()._actionToken;if(!t.isActionCompleted())return!0}return!1}attemptRefreshSpeedLevel(){const t=[];let e=0;for(const i of this._schedulingUnits)if(i.isValid()){const s=i.entity();i.speedLevel2=r.getSpeedLevel(s);const a=i.speedLevel2-i.speedLevel;i.speedLevel2>i.speedLevel&&(t.push(i),e=Math.max(i.speedLevel2,e),i.speedLevel=i.speedLevel2,i==this.currentUnit()||(this.maxRunCount=Math.max(this.maxRunCount,i.speedLevel)),s._actionToken.charge(a),this.existsHighSpeedReadyEntity(i)||i.setIterationCountMax(i.iterationCountMax()+a)),i.speedLevel2<i.speedLevel&&(s._actionToken.charge(a),i.speedLevel=i.speedLevel2)}}existsHighSpeedReadyEntity(t){for(const e of this._schedulingUnits)if(e.isValid()&&e.index()!=t.index()&&e.speedLevel>1&&!e.isActionCompleted())return!0;return!1}};p=r=s([a.MRSerializable],p),e.LScheduler2=p},975:function(t,e,i){"use strict";var r=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LSchedulingResult=e.LPhaseResult=void 0;const s=i(1298),a=i(8053),n=i(7352);let o=class{clear(){this.consumedActionToken=void 0}};o=r([s.MRSerializable],o),e.LPhaseResult=o;let c=class{constructor(){this._phaseResults=[]}clear(){for(const t of this._phaseResults)t&&t.clear()}setConsumedActionToken(t,e){const i=this.acquirePhaseResult(t);(e==a.LActionTokenType.Major||e==a.LActionTokenType.Minor&&void 0===i.consumedActionToken)&&(i.consumedActionToken=e)}setConsumedActionTokeInCurrentPhase(t){this.setConsumedActionToken(n.MRLively.scheduler.currentPhaseIndex(),t)}consumedActionToken(t){const e=this._phaseResults[t];if(e)return e.consumedActionToken}acquirePhaseResult(t){if(t>=this._phaseResults.length||null==this._phaseResults[t]){const e=new o;return this._phaseResults[t]=e,e}const e=this._phaseResults[t];return(0,s.assert)(e),e}};c=r([s.MRSerializable],c),e.LSchedulingResult=c},8720:function(t,e,i){"use strict";var r=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LShopArticle=void 0;const s=i(1298);let a=class{constructor(){this._ownerShopStructureId=0}isSalling(){return this._ownerShopStructureId>0}};a=r([s.MRSerializable],a),e.LShopArticle=a},4168:function(t,e,i){"use strict";var r=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LSystem=void 0;const s=i(4977),a=i(1298),n=i(7352),o=i(1301);let c=class{constructor(){this.mainPlayerEntityId=s.LEntityId.makeEmpty(),this.uniqueActorUnits=[],this.eventInterpreterContextKey=void 0}get mainPlayerEntity(){return n.MRLively.world.entity(n.MRLively.system.mainPlayerEntityId)}getEventCommandTarget(){return this.eventInterpreterContextKey?"${Player}"==this.eventInterpreterContextKey?this.mainPlayerEntity:o.USearch.getEntityByKeyPattern(this.eventInterpreterContextKey):n.MRLively.map.floorId().isNormalMap()?void 0:this.mainPlayerEntity}};c=r([a.MRSerializable],c),e.LSystem=c},4997:function(t,e,i){"use strict";var r=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LWorld=void 0;const s=i(4685),a=i(1298),n=i(7352),o=i(1130),c=i(4977),l=i(9185),h=i(9412),u=i(2309),d=i(6316),p=i(9115),f=i(4882);let m=class{constructor(){this._objects=[],this._random=new o.LRandom(Math.floor(65535*Math.random())+1),this._objects=[void 0],this._lands=[];for(const t of l.MRData.lands){const e=new h.LLand(t);this._lands.push(e)}this._parties=[void 0]}object(t){const e=this._objects[t.index2()];if(e&&e.__objectId().key2()==t.key2())return e;throw e?new Error(`Destroyed entity. (id: [${t.index2()}, ${t.key2()}], actualy:[${e.__objectId().index2()}, ${e.__objectId().key2()}])`):new Error(`Unregisterd entity. (id: [${t.index2()}, ${t.key2()}])`)}findObject(t){const e=this._objects[t.index2()];return e&&e.__objectId().key2()==t.key2()?e:void 0}iterateEntity(t){for(const e of this._objects)if(e&&e.objectType()==c.LObjectType.Entity&&!1===t(e))return}findEntity(t){const e=this.findObject(t);return e&&e.objectType()==c.LObjectType.Entity?e:void 0}findFirstEntity(t){const e=n.MRLively.world.objects().find((e=>e instanceof s.LEntity&&t(e)));return e&&e instanceof s.LEntity?e:void 0}getFirstEntityByKey(t){const e=this.findFirstEntity((e=>e.data.entity.key==t));if(!e)throw new Error(`Entity not found (${t})`);return e}findBehavior(t){const e=this.findObject(t);return e&&e.objectType()==c.LObjectType.Behavior?e:void 0}objects(){return this._objects}entity(t){const e=this.findEntity(t);if(!e)throw new Error(`Invalid entity type. (id: [${t.index2()}, ${t.key2()}])`);return e}behavior(t){const e=this.findBehavior(t);if(!e)throw new Error(`Invalid behavior type. (id: [${t.index2()}, ${t.key2()}])`);return e}entityByIndex(t){const e=this._objects[t];return(0,a.assert)(e instanceof s.LEntity),e}ability(t){const e=this.object(t);if(e.objectType()==c.LObjectType.Ability)return e;throw new Error(`Invalid ability type. (id: [${t.index2()}, ${t.key2()}])`)}random(){return this._random}land(t){return this._lands[t]}party(t){const e=this._parties[t];return(0,a.assert)(e),e}spawnEntity(t){const e=new s.LEntity;return e.setupInstance(t),this._registerObject(e),e}spawn(t){const e=new t;return this._registerObject(e),e}newParty(){const t=new u.LParty,e=this._parties.findIndex(((t,e)=>e>0&&null==t));return e<0?(t.setup(this._parties.length),this._parties.push(t)):(t.setup(e),this._parties[e]=t),t}_registerObject(t){(0,a.assert)(!t.hasId());const e=this._objects.findIndex(((t,e)=>e>0&&null==t));e<0?(t._setObjectId(new c.LEntityId(this._objects.length,this._random.nextInt())),this._objects.push(t)):(t._setObjectId(new c.LEntityId(e,this._random.nextInt())),this._objects[e]=t)}transferEntity(t,e,i=-1,r=-1){const s=n.MRLively.map.floorId();!s.equals(e)&&e.isRandomMap()&&((0,a.assert)(i<0),(0,a.assert)(r<0));const o=t.floorId.landId();if(n.MRLively.map.isValid()&&!s.equals(e)&&s.equals(t.floorId)&&n.MRLively.map._removeEntity(t),t.floorId.equals(e)||f.UState.attemptRemoveStateAtFloorTransfer(t),s.equals(e)?t.floorId.equals(e)?d.UMovement.locateEntity(t,i,r):(t.floorId=e,d.UMovement.locateEntity(t,i,r),n.MRLively.map._addEntityInternal(t)):d.UMovement.locateEntityAtFloorMoved(t,e,i,r),n.MRLively.camera.focusedEntityId().equals(t.entityId())&&!s.equals(t.floorId)&&n.MRLively.camera._reserveFloorTransferToFocusedEntity(),o!=e.landId()){p.MRSystem.groundRules.onEntityLandLeaved(t);const i=t.party();i&&i.onMemberMovedLand(t,e.landId(),o)}return!0}_removeDestroyedObjects(){for(let t=1;t<this._objects.length;t++){const e=this._objects[t];e&&(e.isGCReady()&&e.destroy(),e.isDestroyed()&&(e.onFinalize(),this._objects[t]=void 0,n.MRLively.camera.focusedEntityId().equals(e.__objectId())&&n.MRLively.camera.clearFocus()))}for(let t=1;t<this._parties.length;t++){const e=this._parties[t];e&&e.isEmpty()&&(this._parties[t]=void 0)}}getEntityByRmmzActorId(t){let e;return n.MRLively.world.iterateEntity((i=>{const r=i.data.actor;return!r||r.rmmzActorId!=t||(e=i,!1)})),(0,a.assert)(e),e}};m=r([a.MRSerializable],m),e.LWorld=m},4893:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MRGameExtension=void 0;e.MRGameExtension=class{}},7352:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MRLively=void 0;const r=i(4893);class s{static getCurrentLand(){return this.map.land2()}static getCurrentIdentifyer(){return this.getCurrentLand().identifyer}}e.MRLively=s,s.TILE_LAYER_COUNT=6,s.ext=new r.MRGameExtension,s.challengeResultShowing=!1},1048:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LAbility=void 0;const a=i(4977),n=i(7352),o=i(2205),c=i(1298);let l=r=class extends a.LObject{constructor(){super(a.LObjectType.Ability),this._abilityId=0,this._behabiorIds=[]}clone(t){const e=new r;n.MRLively.world._registerObject(e),e._abilityId=this._abilityId;for(const i of this.behabiors()){const r=i.clone(t);e._behabiorIds.push(r.id()),r.setParent(this)}return e}id(){return this.__objectId()}setup(t){this._abilityId=t,n.MRLively.world._registerObject(this);const e=o.SBehaviorFactory.createBehavior("LKnockbackBehavior");(0,c.assert)(e),this.addBehavior(e)}abilityId(){return this._abilityId}addBehavior(t){(0,c.assert)(t.hasId()),this._behabiorIds.push(t.id())}behabiors(){return this._behabiorIds.map((t=>n.MRLively.world.behavior(t)))}iterateBehaviors(t){for(const e of this._behabiorIds)if(!1===t(n.MRLively.world.behavior(e)))return!1;return!0}onAttached(t){this.behabiors().forEach((e=>{e.setParent(this),e.onAttached(t)}))}onDetached(t){this.behabiors().forEach((e=>{e.onDetached(t),e.destroy()}))}onRemoveChild(t){}};l=r=s([c.MRSerializable],l),e.LAbility=l},4146:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LEntityDivisionBehavior=void 0;const a=i(4836),n=i(1325),o=i(6316),c=i(846),l=i(7534),h=i(6229),u=i(7352),d=i(1298);let p=r=class extends l.LBehavior{clone(t){return u.MRLively.world.spawn(r)}[l.onDirectAttackDamaged](t,e){const i=t.self;i.getEntityBehavior(c.LBattlerBehavior);if(i.isDeathStateAffected())return n.SCommandResponse.Pass;const r=u.MRLively.map.block(i.mx,i.my),s=o.UMovement.getAdjacentBlocks(i).filter((t=>o.UMovement.checkPassageBlockToBlock(i,r,t,h.MovingMethod.Walk)));if(s.length>1){const t=s[e.random().nextIntWithMax(s.length)],r=i.clone();u.MRLively.world.transferEntity(r,i.floorId,t.mx,t.my),e.postSequel(r,a.MRBasics.sequels.MoveSequel).setStartPosition(i.mx,i.my),e.postWaitSequel()}return n.SCommandResponse.Pass}};p=r=s([d.MRSerializable],p),e.LEntityDivisionBehavior=p},3542:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LGrabFootBehavior=void 0;const a=i(1298),n=i(3482),o=i(7352),c=i(7534),l=i(6316),h=i(4977),u=i(4836),d=i(5557),p=i(8254);let f=r=class extends c.LBehavior{constructor(){super(),this._targetId=h.LEntityId.makeEmpty()}clone(t){return o.MRLively.world.spawn(r)}onAttached(t){o.MRLively.eventServer.subscribe(u.MRBasics.events.preWalk,this)}onDetached(t){o.MRLively.eventServer.unsubscribe(u.MRBasics.events.preWalk,this)}onEvent(t,e,i){const r=this.ownerEntity();if(e==u.MRBasics.events.preWalk){const e=i;if(this._targetId.isEmpty()?l.UMovement.checkDirectlyAdjacentEntity(r,e.walker)&&p.Helpers.isHostile(r,e.walker)&&(this._targetId=e.walker.entityId()):l.UMovement.checkDirectlyAdjacentEntity(r,e.walker)||(this._targetId=h.LEntityId.makeEmpty()),e.walker.entityId().equals(this._targetId))return r.dir=l.UMovement.getLookAtDir(r,e.walker),t.postSequel(r,u.MRBasics.sequels.attack),t.postMessage((0,a.tr2)("%1は身動きが取れない！").format(n.UName.makeUnitName(e.walker))),d.LEventResult.Handled}return d.LEventResult.Pass}};f=r=s([a.MRSerializable],f),e.LGrabFootBehavior=f},5960:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LKnockbackBehavior=void 0;const a=i(1298),n=i(7534),o=i(7352);let c=r=class extends n.LBehavior{clone(t){return o.MRLively.world.spawn(r)}};c=r=s([a.MRSerializable],c),e.LKnockbackBehavior=c},4621:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LActivity=void 0;const a=i(1298),n=i(4836),o=i(8475),c=i(6316),l=i(4977),h=i(7352),u=i(9185),d=i(2593);let p=r=class{constructor(){this._actionId=0,this._actor=l.LEntityId.makeEmpty(),this._subject=l.LEntityId.makeEmpty(),this._object=l.LEntityId.makeEmpty(),this._objects2=[],this._skillId=0,this._effectDirection=0,this._entityDirection=0,this._actionTokenConsumeType=void 0,this._fastForward=!1,this._selectedAction=""}setup(t,e,i,r){return this._actionId=t,this._actor=e.entityId().clone(),this._subject=e.entityId().clone(),this._object=i?i.entityId():l.LEntityId.makeEmpty(),this._objects2=[],this._effectDirection=null!=r?r:0,this._entityDirection=0,this._actionTokenConsumeType=void 0,this._fastForward=!1,this._selectedAction="",this}actionId(){return this._actionId}get action(){return u.MRData.skills[this._actionId]}actor(){return h.MRLively.world.entity(this._actor)}subject(){return h.MRLively.world.entity(this._subject)}hasObject(){return this._object.hasAny()}object(){return h.MRLively.world.entity(this._object)}setObject(t){this._object=t.entityId()}objects2(){return this._objects2.map((t=>h.MRLively.world.entity(t)))}setObjects2(t){this._objects2=t.map((t=>t.entityId()))}skillId(){return this._skillId}withOtherSubject(t){return this._subject=t.entityId().clone(),this}withEffectDirection(t){return this._effectDirection=t,this}effectDirection(){return this._effectDirection}hasEffectDirection(){return 0!=this._effectDirection}entityDirection(){return this._entityDirection}withEntityDirection(t){return this._entityDirection=t,this}withConsumeAction(t){return void 0!==t?this._actionTokenConsumeType=t:this._actionId==n.MRBasics.actions.MoveToAdjacentActionId?this._actionTokenConsumeType=d.LActionTokenConsumeType.MinorActed:this._actionTokenConsumeType=d.LActionTokenConsumeType.MajorActed,this}isConsumeAction(){return null!=this._actionTokenConsumeType}consumeActionTokenType(){return this._actionTokenConsumeType}getConsumeActionTokenType(){return(0,a.assert)(void 0!==this._actionTokenConsumeType),this._actionTokenConsumeType}withFastForward(){return this._fastForward=!0,this}isFastForward(){return this._fastForward}selectedAction(){return this._selectedAction}toData(){return{actionId:this._actionId,actor:{index:this._actor.index2(),key:this._actor.key2()},subject:{index:this._subject.index2(),key:this._subject.key2()},object:{index:this._object.index2(),key:this._object.key2()},objects2:this._objects2.map((t=>({index:t.index2(),key:t.key2()}))),skillId:this._skillId,direction:this._effectDirection,entityDirection:this._entityDirection,actionTokenConsumeType:this._actionTokenConsumeType,fastForward:this._fastForward,selectedAction:this._selectedAction}}static makeFromData(t){const e=new r;return e._actionId=t.actionId,e._actor=new l.LEntityId(t.actor.index,t.actor.key),e._subject=new l.LEntityId(t.subject.index,t.subject.key),e._object=new l.LEntityId(t.object.index,t.object.key),e._objects2=t.objects2.map((t=>new l.LEntityId(t.index,t.key))),e._skillId=t.skillId,e._effectDirection=t.direction,e._entityDirection=t.entityDirection,e._actionTokenConsumeType=t.actionTokenConsumeType,e._fastForward=t.fastForward,e._selectedAction=t.selectedAction,e}static make(t){return(new r).setup(0,t)}static makeDirectionChange(t,e){return(new r).setup(n.MRBasics.actions.DirectionChangeActionId,t,void 0,e).withEntityDirection(e)}static makeMoveToAdjacent(t,e){return(new r).setup(n.MRBasics.actions.MoveToAdjacentActionId,t,void 0,e)}static makeMoveToAdjacentBlock(t,e){(0,a.assert)(c.UMovement.checkAdjacentPositions(t.mx,t.my,e.mx,e.my));const i=o.SAIHelper.distanceToDir(t.mx,t.my,e.mx,e.my);return(new r).setup(n.MRBasics.actions.MoveToAdjacentActionId,t,void 0,i)}static makePrimaryUse(t,e){const i=e.data.reactions.find((t=>t.primariyUse));if(i){return(new r).setup(i.actionId,t,e)}return this.make(t)}static makePick(t){return(new r).setup(n.MRBasics.actions.PickActionId,t)}static makePut(t,e){return(new r).setup(n.MRBasics.actions.PutActionId,t,e)}static makeThrow(t,e){return(new r).setup(n.MRBasics.actions.ThrowActionId,t,e)}static makeShooting(t,e){return(new r).setup(n.MRBasics.actions.ShootActionId,t,e)}static makeFall(t){return(new r).setup(n.MRBasics.actions.FallActionId,t)}static makeTrample(t){return(new r).setup(n.MRBasics.actions.trample,t)}static makeExchange(t,e){return(new r).setup(n.MRBasics.actions.ExchangeActionId,t,e)}static makeEquip(t,e){return(new r).setup(n.MRBasics.actions.EquipActionId,t,e)}static makeEquipOff(t,e){return(new r).setup(n.MRBasics.actions.EquipOffActionId,t,e)}static makeEat(t,e){return(new r).setup(n.MRBasics.actions.EatActionId,t,e)}static makeWave(t,e){return(new r).setup(n.MRBasics.actions.WaveActionId,t,e)}static makeRead(t,e,i){const s=(new r).setup(n.MRBasics.actions.ReadActionId,t,e);return i&&s.setObjects2(i),s}static makePutIn(t,e,i){const s=(new r).setup(n.MRBasics.actions.PutInActionId,t,e);return s._objects2=[i.entityId()],s}static makeTalk(t){return(new r).setup(n.MRBasics.actions.talk,t)}static makeCollide(t,e){const i=(new r).setup(n.MRBasics.actions.collide,t);return i.setObjects2([e]),i}static makePerformSkill(t,e,i){(0,a.assert)(e>0);const s=(new r).setup(n.MRBasics.actions.performSkill,t);return void 0!==i&&(s._effectDirection=i),s._skillId=e,s}static makeDialogResult(t,e,i){const s=(new r).setup(n.MRBasics.actions.dialogResult,t,e);return s._selectedAction=i,s}};p=r=s([a.MRSerializable],p),e.LActivity=p},2656:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LActionDeterminer=void 0;const a=i(1298),n=i(9185),o=i(8475),c=i(8510),l=i(4598),h=i(6316),u=i(2593),d=i(4977),p=i(7352);let f=r=class{constructor(){this._primaryTargetEntityId=d.LEntityId.makeEmpty()}clone(){var t;const e=new r;return e._primaryTargetEntityId=this._primaryTargetEntityId.clone(),this._requiredSkillAction&&(e._requiredSkillAction={action:this._requiredSkillAction.action,targets:null===(t=this._requiredSkillAction)||void 0===t?void 0:t.targets}),e}setPrimaryTargetEntityId(t){this._primaryTargetEntityId=t}setRequiredSkillAction(t){this._requiredSkillAction=t}decide(t,e){{const t=l.UAction.findInSightNearlyHostileEntity(e);if(t){this._primaryTargetEntityId=t.entityId().clone();const i=o.SAIHelper.entityDistanceToDir(e,t);e.dir=i}else this._primaryTargetEntityId=d.LEntityId.makeEmpty()}this._requiredSkillAction=void 0;const i=l.UAction.makeCandidateSkillActions(e,this._primaryTargetEntityId),r=t.random().selectOrUndefined(i);r&&(r.action.skillId==n.MRData.system.skills.move||(this._requiredSkillAction=r))}isMoveRequested(){return!this._requiredSkillAction}isMajorActionRequested(){return!!this._requiredSkillAction}hasPrimaryTarget(){return this._primaryTargetEntityId.hasAny()}primaryTarget(){return p.MRLively.world.entity(this._primaryTargetEntityId)}perform(t,e){if(this._requiredSkillAction){const i=this._requiredSkillAction.targets.map((t=>p.MRLively.world.entity(t)));if(l.UAction.checkEntityWithinSkillActionRange(e,n.MRData.skills[this._requiredSkillAction.action.skillId],!1,i)){const r=h.UMovement.getCenter(i);return e.dir=h.UMovement.getLookAtDirFromPos(e.mx,e.my,r.x,r.y),c.SEmittorPerformer.makeWithSkill(e,e,this._requiredSkillAction.action.skillId).perform(t),t.postConsumeActionToken(e,u.LActionTokenConsumeType.MajorActed),!0}return t.postConsumeActionToken(e,u.LActionTokenConsumeType.MajorActed),!0}return!1}};f=r=s([a.MRSerializable],f),e.LActionDeterminer=f},5727:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LBlindAI=void 0;const a=i(9185),n=i(1325),o=i(4598),c=i(6316),l=i(4621),h=i(6519),u=i(7352),d=i(1298),p=i(2593);let f=r=class extends h.LCharacterAI{constructor(){super(),this._candidateSkillActions=[]}clone(){return new r}thinkMoving(t,e){const i=e.dir;if(c.UMovement.checkPassageToDir(e,i))return t.postActivity(l.LActivity.makeMoveToAdjacent(e,i).withConsumeAction(p.LActionTokenConsumeType.MinorActed)),n.SPhaseResult.Handled;const r=c.UMovement.getAdjacentBlock(e,i),s=o.UAction.getSkillEffectiveTargets(e,a.MRData.skills[a.MRData.system.skills.normalAttack],!1).filter((t=>t.mx==r.mx&&t.my==r.my));if(s.length>0)return this._candidateSkillActions.push({skillId:a.MRData.system.skills.normalAttack,target:s[0].entityId()}),n.SPhaseResult.Handled;const h=t.random().select(c.UMovement.directions.filter((t=>t!=i)));return c.UMovement.checkPassageToDir(e,h)?(t.postActivity(l.LActivity.makeMoveToAdjacent(e,h).withEntityDirection(h).withConsumeAction(p.LActionTokenConsumeType.MinorActed)),n.SPhaseResult.Handled):(t.postActivity(l.LActivity.makeDirectionChange(e,h).withConsumeAction(p.LActionTokenConsumeType.MajorActed)),n.SPhaseResult.Handled)}thinkAction(t,e){if(this._candidateSkillActions.length>0){const i=this._candidateSkillActions[0],r=u.MRLively.world.entity(i.target);o.UAction.checkEntityWithinSkillActionRange(e,a.MRData.skills[i.skillId],!1,[r])&&(t.postActivity(l.LActivity.makeDirectionChange(e,c.UMovement.getLookAtDir(e,r))),t.postActivity(l.LActivity.makePerformSkill(e,a.MRData.system.skills.normalAttack))),this._candidateSkillActions.shift()}return t.postConsumeActionToken(e,p.LActionTokenConsumeType.MajorActed),n.SPhaseResult.Handled}};f=r=s([d.MRSerializable],f),e.LBlindAI=f},6519:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LCharacterAI=void 0;e.LCharacterAI=class{}},7955:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LConfusionAI=e.LConfusionAIRestriction=void 0;const a=i(9185),n=i(1325),o=i(4598),c=i(6316),l=i(4621),h=i(6519),u=i(7352),d=i(1298),p=i(8254),f=i(2593);var m;!function(t){t[t.None=0]="None",t[t.AttcakToOpponent=1]="AttcakToOpponent",t[t.AttackToOther=2]="AttackToOther",t[t.AttcakToFriend=3]="AttcakToFriend"}(m=e.LConfusionAIRestriction||(e.LConfusionAIRestriction={}));let y=r=class extends h.LCharacterAI{constructor(t){super(),this._restriction=t,this._candidateSkillActions=[]}clone(){const t=new r(this._restriction);for(const e of this._candidateSkillActions)t._candidateSkillActions.push({skillId:e.skillId,target:e.target});return t}thinkMoving(t,e){const i=t.random().select(c.UMovement.directions);if(t.postActivity(l.LActivity.makeDirectionChange(e,i)),c.UMovement.checkPassageToDir(e,i))return t.postActivity(l.LActivity.makeMoveToAdjacent(e,i)),t.postConsumeActionToken(e,f.LActionTokenConsumeType.MinorActed),n.SPhaseResult.Handled;if(this._restriction!=m.None){const t=c.UMovement.getAdjacentBlock(e,i);let r=o.UAction.getSkillEffectiveTargets(e,a.MRData.skills[a.MRData.system.skills.normalAttack],!1).filter((e=>e.mx==t.mx&&e.my==t.my));if(this._restriction==m.AttcakToFriend?r=r.filter((t=>p.Helpers.isFriend(e,t))):this._restriction==m.AttcakToOpponent&&(r=r.filter((t=>p.Helpers.isHostile(e,t)))),r.length>0)return this._candidateSkillActions.push({skillId:a.MRData.system.skills.normalAttack,target:r[0].entityId()}),n.SPhaseResult.Handled}return t.postConsumeActionToken(e,f.LActionTokenConsumeType.MajorActed),n.SPhaseResult.Handled}thinkAction(t,e){if(this._candidateSkillActions.length>0){const i=this._candidateSkillActions[0],r=u.MRLively.world.entity(i.target);o.UAction.checkEntityWithinSkillActionRange(e,a.MRData.skills[i.skillId],!1,[r])&&(t.postActivity(l.LActivity.makeDirectionChange(e,c.UMovement.getLookAtDir(e,r))),t.postActivity(l.LActivity.makePerformSkill(e,a.MRData.system.skills.normalAttack))),this._candidateSkillActions.shift()}return t.postConsumeActionToken(e,f.LActionTokenConsumeType.MajorActed),n.SPhaseResult.Handled}};y=r=s([d.MRSerializable],y),e.LConfusionAI=y},1451:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LEscapeAI=void 0;const a=i(1325),n=i(8475),o=i(4598),c=i(6316),l=i(4621),h=i(6519),u=i(6229),d=i(7352),p=i(1298),f=i(3249),m=i(2593),y=i(8153);let _=r=class extends h.LCharacterAI{constructor(){super(),this._moveDeterminer=new f.LMoveDeterminer}clone(){return new r}checkDeadInArea(t,e,i,r){const s=t.mx,a=t.my,n=e.mx,o=e.my,l=Math.abs(s-n),h=Math.abs(a-o),u=()=>{if(s<n){if(n<=i)return!0}else if(n<s&&i<=n)return!0},d=()=>{if(a<o){if(o<=r)return!0}else if(o<a&&r<=o)return!0};if(c.UMovement.distanceSq(s,a,i,r)<=c.UMovement.distanceSq(n,o,i,r))return!1;if(l>h){if(u())return!0}else if(l<h){if(d())return!0}else{if(u())return!0;if(d())return!0}return!1}thinkMoving(t,e){return this._moveDeterminer.decide(t,e),this.decideTargetPosition(t,e)||this._moveDeterminer.perform(t,e)||t.postActivity(l.LActivity.make(e).withConsumeAction(m.LActionTokenConsumeType.WaitActed)),a.SPhaseResult.Handled}decideTargetPosition(t,e){const i=o.UAction.findInSightNearlyHostileEntity(e);if(i){const r=d.MRLively.map.block(e.mx,e.my),s=d.MRLively.map.room(r._roomId);if(r.isRoomInnerEntrance()){const t=y.UBlock.adjacentBlocks4(d.MRLively.map,r.mx,r.my).find((t=>t.isPassageway()));if(t&&!this.checkDeadInArea(e,i,t.mx,t.my))return this._moveDeterminer.setTargetPosition(t.mx,t.my),!1}const a=s.getRoomInnerEntranceBlocks().filter((t=>!this.checkDeadInArea(e,i,t.mx,t.my)&&(t.mx!=e.mx||t.my!=e.my))).selectMin(((t,e)=>c.UMovement.distanceSq(t.mx,t.my,e.mx,e.my)));if(a)this._moveDeterminer.setTargetPosition(a.mx,a.my);else{const a=n.SAIHelper.entityDistanceToDir(i,e),o=n.SAIHelper.entityDistanceToDir(e,i);if(c.UMovement.getWay3FrontBlocks(e,a).find((t=>c.UMovement.checkPassageBlockToBlock(e,r,t,u.MovingMethod.Walk)))){const i=c.UMovement.getMovingCandidateBlockAsLHRule(e,a);if(i)return t.postActivity(l.LActivity.makeMoveToAdjacentBlock(e,i).withEntityDirection(a).withConsumeAction(m.LActionTokenConsumeType.MinorActed)),!0;throw new Error("Unreachable")}if(!c.UMovement.checkAdjacentPositions(e.mx,e.my,i.mx,i.my))return t.postActivity(l.LActivity.make(e).withEntityDirection(o).withConsumeAction(m.LActionTokenConsumeType.MinorActed)),!0;{const e=t.random().selectOrUndefined(s.getRoomInnerEntranceBlocks());e&&this._moveDeterminer.setTargetPosition(e.mx,e.my)}}}return!1}thinkAction(t,e){return a.SPhaseResult.Pass}};_=r=s([p.MRSerializable],_),e.LEscapeAI=_},3249:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LMoveDeterminer=e.LMovingMethod=void 0;const a=i(1298),n=i(8254),o=i(8475),c=i(6316),l=i(4621),h=i(2593),u=i(7352);var d;!function(t){t[t.ToTarget=0]="ToTarget",t[t.LHRule=1]="LHRule"}(d=e.LMovingMethod||(e.LMovingMethod={}));let p=r=class{constructor(){this._targetPositionX=-1,this._targetPositionY=-1,this._noActionTurnCount=0,this._decired={method:d.LHRule}}clone(){const t=new r;return t._targetPositionX=this._targetPositionX,t._targetPositionY=this._targetPositionY,t._noActionTurnCount=this._noActionTurnCount,t}setTargetPosition(t,e){this._targetPositionX=t,this._targetPositionY=e}decide(t,e){const i=t.random(),r=u.MRLively.map.block(e.mx,e.my);if(this.hasDestination()){if(this.canModeToTarget(e))return void(this._decired={method:d.ToTarget});{this._targetPositionX=-1,this._targetPositionY=-1;const t=c.UMovement.getMovableAdjacentTiles(e).filter((t=>t.isPassageway()));return t.length>0?void(this._decired={method:d.ToTarget,passageway:t[i.nextIntWithMax(t.length)]}):void(this._decired={method:d.LHRule})}}if(r.isRoom()){const t=u.MRLively.map.room(r._roomId);if(r.isRoomInnerEntrance()){const r=t.getRoomInnerEntranceBlocks().filter((t=>t.mx!=e.mx&&t.my!=e.my));if(r.length>0){const t=r[i.nextIntWithMax(r.length)];this._targetPositionX=t.mx,this._targetPositionY=t.my}else e.dir=c.UMovement.reverseDir(e.dir);return void(this._decired={method:d.LHRule})}{const e=t.getRoomInnerEntranceBlocks();if(e.length>0){const t=e[i.nextIntWithMax(e.length)];return this._targetPositionX=t.mx,this._targetPositionY=t.my,void(this._decired={method:d.ToTarget})}return void(this._decired={method:d.LHRule})}}this._decired={method:d.LHRule}}perform(t,e){return!!this.performInternal(t,e)&&(this._noActionTurnCount=0,!0)}performInternal(t,e){if(this.canModeToTarget(e)){if(this.moveToTarget(e,t))return!0;this._decired.method=d.LHRule}if(this._decired.passageway)return this.postMoveToAdjacent(e,this._decired.passageway,t),!0;if(this._decired.method==d.LHRule){const i=c.UMovement.getMovingCandidateBlockAsLHRule(e,e.dir);if(i){this.postMoveToAdjacent(e,i,t);const r=this.hasDestination()?o.SAIHelper.distanceToDir(e.mx,e.my,this._targetPositionX,this._targetPositionY):c.UMovement.getLookAtDirFromPos(e.mx,e.my,i.mx,i.my);return t.postActivity(l.LActivity.makeDirectionChange(e,r)),!0}}if(this.hasDestination()&&e.mx==this._targetPositionX&&e.my==this._targetPositionY)return!0;if(this._noActionTurnCount++,this._noActionTurnCount>=6){const i=c.UMovement.getMovableAdjacentTiles(e);if(i.length>0){const r=i[t.random().nextIntWithMax(i.length)];return this.postMoveToAdjacent(e,r,t),!0}}return!1}canModeToTarget(t){return this.hasDestination()&&(t.mx!=this._targetPositionX||t.my!=this._targetPositionY)}moveToTarget(t,e){(0,a.assert)(this.canModeToTarget(t));const i=o.SAIHelper.distanceToDir(t.mx,t.my,this._targetPositionX,this._targetPositionY);return!(0==i||!c.UMovement.checkPassageToDir(t,i))&&(e.postActivity(l.LActivity.makeDirectionChange(t,i)),e.postActivity(l.LActivity.makeMoveToAdjacent(t,i)),e.postConsumeActionToken(t,h.LActionTokenConsumeType.MinorActed),!0)}postMoveToAdjacent(t,e,i){const r=n.Helpers.offsetToDir(e.mx-t.mx,e.my-t.my);i.postActivity(l.LActivity.makeDirectionChange(t,r)),i.postActivity(l.LActivity.makeMoveToAdjacent(t,r)),i.postConsumeActionToken(t,h.LActionTokenConsumeType.MinorActed)}hasDestination(){return this._targetPositionX>=0&&this._targetPositionY>=0}};p=r=s([a.MRSerializable],p),e.LMoveDeterminer=p},2069:function(t,e,i){"use strict";var r=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LMovingTargetFinder_Gold=e.LMovingTargetFinder_Item=e.LMovingTargetFinder=void 0;const s=i(1298),a=i(1301);let n=class{decide(t){}};n=r([s.MRSerializable],n),e.LMovingTargetFinder=n;let o=class{decide(t){const e=a.USearch.findLatestItemInVisibilityBlocks(t);if(e)return[e.mx,e.my]}};o=r([s.MRSerializable],o),e.LMovingTargetFinder_Item=o;let c=class{decide(t){const e=a.USearch.findLatestItemInVisibilityBlocks(t);if(e&&e.checkLooksLikeGold())return[e.mx,e.my]}};c=r([s.MRSerializable],c),e.LMovingTargetFinder_Gold=c},5568:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LRatedRandomAI=void 0;const a=i(6519),n=i(9441),o=i(7955),c=i(1298);let l=r=class extends a.LCharacterAI{constructor(){super(),this._randomRate=50,this._rundomTurn=!1,this._standardAI=new n.LCharacterAI_Normal,this._randomAI=new o.LConfusionAI(o.LConfusionAIRestriction.None)}clone(){const t=new r;return t._standardAI=this._standardAI.clone(),t._randomAI=this._randomAI.clone(),t}thinkMoving(t,e){return this._rundomTurn=t.random().nextIntWithMax(100)<this._randomRate,this._rundomTurn?this._randomAI.thinkMoving(t,e):this._standardAI.thinkMoving(t,e)}thinkAction(t,e){return(0,c.assert)(!this._rundomTurn),this._standardAI.thinkMoving(t,e)}};l=r=s([c.MRSerializable],l),e.LRatedRandomAI=l},9441:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LCharacterAI_Normal=void 0;const a=i(1325),n=i(6519),o=i(2656),c=i(3249),l=i(1298),h=i(8428),u=i(2593);let d=r=class extends n.LCharacterAI{constructor(){super(...arguments),this._moveDeterminer=new c.LMoveDeterminer,this._actionDeterminer=new o.LActionDeterminer}clone(){const t=new r;return t._moveDeterminer=this._moveDeterminer.clone(),t._actionDeterminer=this._actionDeterminer.clone(),t}setMovingTargetFinder(t){this._movingTargetFinder=t}thinkMoving(t,e){const i=this._actionDeterminer.hasPrimaryTarget();if(this._actionDeterminer.decide(t,e),this.applyTargetPosition(e,i),this._moveDeterminer.decide(t,e),this._actionDeterminer.isMoveRequested()&&this._movingTargetFinder){const t=this._movingTargetFinder.decide(e);t&&(this._moveDeterminer.setTargetPosition(t[0],t[1]),this._moveDeterminer._decired={method:c.LMovingMethod.ToTarget})}return this._actionDeterminer.isMajorActionRequested()?a.SPhaseResult.Pass:(e.data.prefab().moveType==h.DPrefabMoveType.Random&&this._moveDeterminer.perform(t,e)||t.postConsumeActionToken(e,u.LActionTokenConsumeType.WaitActed),a.SPhaseResult.Handled)}applyTargetPosition(t,e){if(this._actionDeterminer.hasPrimaryTarget()){const t=this._actionDeterminer.primaryTarget();this._moveDeterminer.setTargetPosition(t.mx,t.my)}else e!=this._actionDeterminer.hasPrimaryTarget()&&this._moveDeterminer.setTargetPosition(-1,-1)}thinkAction(t,e){return this._actionDeterminer.perform(t,e)?a.SPhaseResult.Handled:a.SPhaseResult.Pass}};d=r=s([l.MRSerializable],d),e.LCharacterAI_Normal=d},4419:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LActivityCharmBehavior=void 0;const a=i(1298),n=i(1325),o=i(9115),c=i(8510),l=i(7352),h=i(7534);let u=r=class extends h.LBehavior{clone(t){return l.MRLively.world.spawn(r)}isCharmBehavior(){return!0}onActivity(t,e,i){const r=this.ownerEntity(),s=i.activity(),a=r.data.findReaction(s.actionId());if(a){for(const i of a.emittors())c.SEmittorPerformer.makeWithEmitor(t,t,i).setItemEntity(t).perform(e);return o.MRSystem.scheduler.reset(),n.SCommandResponse.Handled}return n.SCommandResponse.Pass}onActivityReaction(t,e,i){return n.SCommandResponse.Pass}};u=r=s([a.MRSerializable],u),e.LActivityCharmBehavior=u},985:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LActorBehavior=void 0;const a=i(1298),n=i(4836),o=i(9185),c=i(7352),l=i(846);let h=r=class extends l.LBattlerBehavior{constructor(){super(),this._classId=0,this._skills=[]}clone(t){c.MRLively.world.spawn(r);throw new Error("Not implemented.")}onAttached(t){super.onAttached(t),this._classId=t.data.classId,this.initSkills();t.getActualParam(n.MRBasics.params.level),t.getActualParam(n.MRBasics.params.exp);t.recoverAll()}get rmmzActorId(){return this.ownerEntity().data.actorData().rmmzActorId}actor(){const t=this.ownerEntity().data;return(0,a.assert)(t.actor),t.actor}currentClass(){return o.MRData.classes[this._classId]}initSkills(){const t=this.ownerEntity().getActualParam(n.MRBasics.params.level);this._skills=[];for(const e of this.currentClass().learnings)e.level<=t&&this.learnSkill(e.skillId)}learnSkill(t){this.isLearnedSkill(t)||(this._skills.push(t),this._skills.sort(((t,e)=>t-e)))}isLearnedSkill(t){return this._skills.includes(t)}onQueryIdealParamBase(t,e){const i=this.ownerEntity().getActualParam(n.MRBasics.params.level),r=this.currentClass().params[o.MRData.parameters[t].battlerParamId],s=r?r[i]:0;return(0,a.assert)(void 0!==s),e+s}onQueryActions(t){return t.push(n.MRBasics.actions.ShootActionId),t.push(n.MRBasics.actions.EatActionId),t.push(n.MRBasics.actions.WaveActionId),t}onCollectTraits(t,e){super.onCollectTraits(t,e);for(const i of t.data.selfTraits)e.push(i);for(const t of this.currentClass().traits)e.push(t)}};h=r=s([a.MRSerializable],h),e.LActorBehavior=h},846:function(t,e,i){"use strict";var r=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LBattlerBehavior=void 0;const s=i(9185),a=i(7352),n=i(7534),o=i(1325),c=i(4836),l=i(3721),h=i(4598),u=i(1298);let d=class extends n.LBehavior{constructor(){super()}clone(t){throw new Error}paramSet(){return this.ownerEntity().params}onAttached(t){const e=this.paramSet();e.acquireParam(c.MRBasics.params.hp),e.acquireParam(c.MRBasics.params.mp),e.acquireParam(c.MRBasics.params.atk),e.acquireParam(c.MRBasics.params.def),e.acquireParam(c.MRBasics.params.mat),e.acquireParam(c.MRBasics.params.mdf),e.acquireParam(c.MRBasics.params.agi),e.acquireParam(c.MRBasics.params.luk),e.acquireParam(c.MRBasics.params.tp),e.acquireParam(c.MRBasics.params.fp),e.acquireParam(c.MRBasics.params.pow)}onQueryReactions(t,e){e.push({actionId:c.MRBasics.actions.talk})}isGuard(){return!1}attackAnimationId(){return this.bareHandsAnimationId()}bareHandsAnimationId(){return s.MRData.system.bareHandsFlavorEffect}onCollectEffector(t,e){}onPermanentDeath(t,e){const i=this.ownerEntity();if(i.isUnique()){if(i!=a.MRLively.camera.focusedEntity())throw new Error("Not implemented.");return e.postSequel(i,c.MRBasics.sequels.CollapseSequel),e.postWait(i,100),e.postWaitSequel(),h.UAction.postDropItems(e,i,n.LGenerateDropItemCause.Dead),l.UTransfer.exitLand(e,i,s.LandExitResult.Gameover),o.SCommandResponse.Handled}return o.SCommandResponse.Pass}};d=r([u.MRSerializable],d),e.LBattlerBehavior=d},7534:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LBehavior=e.onGrounded=e.onEffectResult=e.onDirectAttackDamaged=e.onAttackReaction=e.onProceedFloorReaction=e.onWaveReaction=e.onEatReaction=e.onCollideAction=e.onCollidePreReaction=e.testPickOutItem=e.onPerformStepFeetProcess=e.onPreStepFeetProcess=e.onPreStepFeetProcess_Actor=e.onWalkedOnTopReaction=e.onWalkedOnTopAction=e.onMoveAsProjectile=e.onThrowReaction=e.onPreThrowReaction=e.LGenerateDropItemCause=e.LBehaviorGroup=e.DecisionPhase=void 0;const r=i(1298),s=i(1325),a=i(4977),n=i(5557);var o;!function(t){t[t.Manual=0]="Manual",t[t.AIMinor=1]="AIMinor",t[t.UpdateState=2]="UpdateState",t[t.ResolveAdjacentAndMovingTarget=3]="ResolveAdjacentAndMovingTarget",t[t.AIMajor=4]="AIMajor"}(e.DecisionPhase||(e.DecisionPhase={})),function(t){t[t.Underlying=0]="Underlying",t[t.SpecialAbility=1]="SpecialAbility"}(o=e.LBehaviorGroup||(e.LBehaviorGroup={})),function(t){t[t.Dead=0]="Dead",t[t.Stumble=1]="Stumble"}(e.LGenerateDropItemCause||(e.LGenerateDropItemCause={})),e.onPreThrowReaction=Symbol("onPreThrowReaction"),e.onThrowReaction=Symbol("onThrowReaction"),e.onMoveAsProjectile=Symbol("onMoveAsProjectile"),e.onWalkedOnTopAction=Symbol("onWalkedOnTopAction"),e.onWalkedOnTopReaction=Symbol("onWalkedOnTopReaction"),e.onPreStepFeetProcess_Actor=Symbol("onPreStepFeetProcess_Actor"),e.onPreStepFeetProcess=Symbol("onPreStepFeetProcess"),e.onPerformStepFeetProcess=Symbol("onPerformStepFeetProcess"),e.testPickOutItem=Symbol("testPickOutItem"),e.onCollidePreReaction=Symbol("onCollidePreReaction"),e.onCollideAction=Symbol("onCollideAction"),e.onEatReaction=Symbol("onEatReaction"),e.onWaveReaction=Symbol("onWaveReaction"),e.onProceedFloorReaction=Symbol("onProceedFloorReaction"),e.onAttackReaction=Symbol("onAttackReaction"),e.onDirectAttackDamaged=Symbol("onDirectAttackDamaged"),e.onEffectResult=Symbol("onEffectResult"),e.onGrounded=Symbol("onGrounded");class c extends a.LObject{constructor(){super(a.LObjectType.Behavior),this.dataId=0}setup(...t){}id(){return this.__objectId()}ownerEntity(){const t=this.parentObject();if(t.objectType()==a.LObjectType.Ability||t.objectType()==a.LObjectType.State){const e=t.parentObject();return(0,r.assert)(e.objectType()==a.LObjectType.Entity),e}if(t.objectType()==a.LObjectType.Entity)return t;throw new Error}onRemoveChild(t){}onOwnerRemoveFromParent(t){}onAttached(t){}onDetached(t){}onEvent(t,e,i){return n.LEventResult.Pass}onPartyEvent(t,e){return n.LEventResult.Pass}onResetStatus(t){}behaviorGroup(){return o.Underlying}isCharmBehavior(){return!1}queryDisplayName(){}queryPrefabId(){}queryInnermostFactionId(){}queryOutwardFactionId(){}queryHomeLayer(){}queryMinimapMarkerClass(){}onQueryIdealParamBase(t,e){return e}onQuerySubEntities(t,e){}onQueryPrice(t){}onQueryProperty(t){}onQueryIdealParameterPlus(t){return 0}onQueryIdleSequelId(){return 0}onQueryActions(t){return t}onQueryReactions(t,e){}onQueryCharacterAI(t){}onQueryAttackAnimationId(t,e){}onParamIdealPlusChanged(t,e,i,r){}onParamChanged(t,e,i,r){}onGetDependentParameterIdealBaseValue(t,e){}onSetDependentParameterIdealBaseValue(t,e,i){}onRefreshConditions(t){}onDecisionPhase(t,e,i){return s.SPhaseResult.Pass}onCommand(t,e,i,r){return s.SCommandResponse.Pass}onPreprocessActivity(t,e){return e}onPreActivity(t,e,i){return s.SCommandResponse.Pass}onActivity(t,e,i){return s.SCommandResponse.Pass}onActivityPreReaction(t,e,i){return s.SCommandResponse.Pass}onActivityReaction(t,e,i){return s.SCommandResponse.Pass}onPreApplyEffect(t,e,i){return s.SCommandResponse.Pass}onEmitEffect(t,e,i,r,a,n){return s.SCommandResponse.Pass}onEffectSensed(t,e){return s.SCommandResponse.Pass}onCollectEffector(t,e){}onCollectTraits(t,e){}onCollectCharmdBehaviors(t,e){}onCollectSkillActions(t){}*onCollectFieldEffect(t){}onPostMakeSkillActions(t){}onAfterStep(t,e){return s.SCommandResponse.Pass}onStepEnd(t){return s.SCommandResponse.Pass}onStabilizeSituation(t,e){return s.SCommandResponse.Pass}onPermanentDeath(t,e){return s.SCommandResponse.Pass}onPertyChanged(t){}onEnteredMap(t,e){}onTalk(t,e,i){return s.SCommandResponse.Pass}onGenerateDropItems(t,e,i){}onPreviewRejection(t,e,i){return s.SCommandResponse.Pass}onEffectPerformed(t,e,i){return s.SCommandResponse.Pass}onCounterAction(t,e,i){return s.SCommandResponse.Pass}onCheckLooksLikeItem(){return!1}onCheckLooksLikeGold(){return!1}}e.LBehavior=c},8727:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LCommonBehavior=void 0;const a=i(7352),n=i(7534),o=i(1325),c=i(4836),l=i(1301),h=i(8510),u=i(9185),d=i(1298);let p=r=class extends n.LBehavior{constructor(){super(...arguments),this.reservedCounterActionIndex=-1}clone(t){return a.MRLively.world.spawn(r)}onQueryActions(t){return t}onActivity(t,e,i){if(i.activity().actionId()==c.MRBasics.actions.FallActionId){const r=l.USearch.getFirstUnderFootEntity(t);if(r)return i.postHandleActivity(e,r),o.SCommandResponse.Handled}return o.SCommandResponse.Handled}onDecisionPhase(t,e,i){if(i==n.DecisionPhase.UpdateState){for(const i of t.traits(c.MRBasics.traits.SuddenSkillEffect)){const r=i.value;if(e.random().nextIntWithMax(100)<100*r){const r=u.MRData.skills[i.dataId];h.SEmittorPerformer.makeWithEmitor(t,t,r.emittor()).perform(e)}}return o.SPhaseResult.Pass}return o.SPhaseResult.Pass}onEffectPerformed(t,e,i){const r=t.data;if(this.reservedCounterActionIndex<0)for(const[e,i]of r.counterActions.entries())if(this.meetsCounterActionConditions(i,t._effectResult)){this.reservedCounterActionIndex=e;break}return o.SCommandResponse.Pass}onStabilizeSituation(t,e){if(this.reservedCounterActionIndex>=0){const i=t.data;t.iterateBehaviorsReverse((r=>r.onCounterAction(t,e,i.counterActions[this.reservedCounterActionIndex])==o.SCommandResponse.Pass)),this.reservedCounterActionIndex=-1}return o.SCommandResponse.Pass}meetsCounterActionConditions(t,e){if(t.conditionAttackType&&e.sourceEffect){const i=t.conditionAttackType;if(e.sourceEffect.parameterQualifyings.find((t=>t.elementIds.includes(i))))return!0}return!1}};p=r=s([d.MRSerializable],p),e.LCommonBehavior=p},639:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LDecisionBehavior=void 0;const a=i(1676),n=i(1325),o=i(7534),c=i(7352),l=i(6501),h=i(6316),u=i(4621),d=i(9441),p=i(1298),f=i(2593);let m=r=class extends o.LBehavior{constructor(){super(...arguments),this._characterAI=new d.LCharacterAI_Normal}clone(t){const e=c.MRLively.world.spawn(r);return e._characterAI=this._characterAI.clone(),e}characterAI(){return this._characterAI}onQueryCharacterAI(t){t.push(this._characterAI)}onDecisionPhase(t,e,i){if(i==o.DecisionPhase.Manual){const i=t.getEntityBehavior(l.LUnitBehavior);if(i._fastforwarding=!1,i._straightDashing&&h.UMovement.checkDashStopBlock(t))return e.postActivity(u.LActivity.makeMoveToAdjacent(t,t.dir).withConsumeAction(f.LActionTokenConsumeType.MinorActed)),n.SPhaseResult.Handled;{const r=new a.SPlayerDialog;return r.dashingEntry=i._straightDashing,e.openDialog(t,r,!1),i.clearStraightDashing(),n.SPhaseResult.Handled}}return i==o.DecisionPhase.AIMinor?this.forceMajorActivity?n.SPhaseResult.Pass:this._characterAI.thinkMoving(e,t):i==o.DecisionPhase.ResolveAdjacentAndMovingTarget?n.SPhaseResult.Pass:i==o.DecisionPhase.AIMajor?this.forceMajorActivity?(e.postActivity(this.forceMajorActivity),n.SPhaseResult.Handled):this._characterAI.thinkAction(e,t):n.SPhaseResult.Pass}};m=r=s([p.MRSerializable],m),e.LDecisionBehavior=m},5705:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LEnemyBehavior=void 0;const a=i(1298),n=i(4836),o=i(6291),c=i(1325),l=i(5150),h=i(1584),u=i(8665),d=i(7352),p=i(846),f=i(9248);let m=r=class extends p.LBattlerBehavior{clone(t){return d.MRLively.world.spawn(r)}constructor(){super()}onAttached(t){super.onAttached(t),t.recoverAll()}enemyData(){const t=this.ownerEntity().data;return(0,a.assert)(t.enemy),t.enemy}onQueryIdealParamBase(t,e){const i=this.enemyData().entity().idealParams[t];return e+(void 0===i?0:i)}exp(){return this.enemyData().exp}onCollectTraits(t,e){super.onCollectTraits(t,e);for(const t of this.enemyData().traits)e.push(t)}onCollectSkillActions(t){super.onCollectSkillActions(t);for(const e of this.enemyData().actions)t.push(e)}onGenerateDropItems(t,e,i){const r=t.findEntityBehavior(f.LInventoryBehavior);if(r&&r.hasAnyItem())for(const t of r.items)r.removeEntity(t),i.push(t);else if(!t._dropItemGenerated){t._dropItemGenerated=!0;const r=d.MRLively.world.random();switch(e){case u.LGenerateDropItemCause.Dead:const e=t.traitsSumOrDefault(n.MRBasics.traits.ItemDropRate,0,.05);if(r.nextIntWithMax(100)<100*e){const e=this.selectDropItem(d.MRLively.world.random());if(e){const r=o.DEntityCreateInfo.makeSingle(e.entityId);return r.gold=e.gold,void i.push(l.SEntityFactory.newEntity(r,t.floorId))}const s=h.USpawner.createItemFromSpawnTable(t.floorId,r);if(s)return void i.push(s)}break;case u.LGenerateDropItemCause.Stumble:{const e=h.USpawner.createItemFromSpawnTable(t.floorId,r);if(e)return void i.push(e);break}default:throw new Error("Unreachable.")}}}onDecisionPhase(t,e,i){return u.DecisionPhase.ResolveAdjacentAndMovingTarget,c.SPhaseResult.Pass}selectDropItem(t){const e=this.enemyData().dropItems,i=e.reduce(((t,e)=>t+e.denominator),0);let r=t.nextIntWithMax(i);for(const t of e){if(r-t.denominator<=0)return t;r-=t.denominator}}};m=r=s([a.MRSerializable],m),e.LEnemyBehavior=m},5748:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LEntryPointBehavior=void 0;const a=i(4836),n=i(5967),o=i(7534),c=i(2554),l=i(1325),h=i(7352),u=i(1298);let d=r=class extends o.LBehavior{clone(t){return h.MRLively.world.spawn(r)}queryHomeLayer(){return n.DBlockLayerKind.Ground}onQueryReactions(t,e){e.splice(0),e.push({actionId:a.MRBasics.actions.BackwardFloorActionId})}[o.onProceedFloorReaction](t,e){const i=t.self;return e.openDialog(i,new c.SEventExecutionDialog(i.rmmzEventId,i),!1),l.SCommandResponse.Handled}};d=r=s([u.MRSerializable],d),e.LEntryPointBehavior=d},5858:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LEquipmentBehavior=void 0;const a=i(1298),n=i(4836),o=i(1325),c=i(4685),l=i(7352),h=i(7534),u=i(913),d=i(9248),p=i(9543);let f=r=class extends h.LBehavior{clone(t){return l.MRLively.world.spawn(r)}onAttached(t){(0,a.assert)(t.findEntityBehavior(p.LItemBehavior));t.data.upgradeMax>0&&t.params.acquireParam(n.MRBasics.params.upgradeValue)}onQueryReactions(t,e){t.parentAs(d.LInventoryBehavior)&&(e.push({actionId:n.MRBasics.actions.EquipActionId}),e.push({actionId:n.MRBasics.actions.EquipOffActionId}))}onOwnerRemoveFromParent(t){if(!(t instanceof c.LEntity))return;const e=t.parentObject();if(e instanceof d.LInventoryBehavior){const i=e.ownerEntity().getEntityBehavior(u.LEquipmentUserBehavior);if(i.isEquipped(t)){const t=i.removeEquitment(this.ownerEntity());(0,a.assert)(t)}}}[h.testPickOutItem](t,e){return t.self.isCursed()?(e.postMessage((0,a.tr2)("呪われている！")),o.SCommandResponse.Canceled):o.SCommandResponse.Handled}onCommand(t,e,i,r){return r.id==n.MRBasics.commands.testPickOutItem&&t.isCursed()?(e.postMessage((0,a.tr2)("呪われている！")),i.reject(),o.SCommandResponse.Handled):o.SCommandResponse.Pass}};f=r=s([a.MRSerializable],f),e.LEquipmentBehavior=f},913:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LEquipmentUserBehavior=void 0;const a=i(1298),n=i(4836),o=i(9185),c=i(1325),l=i(9115),h=i(4977),u=i(7352),d=i(7534),p=i(9019),f=i(695),m=i(8665),y=i(6296),_=i(3482),g=i(5557);let v=r=class extends d.LBehavior{constructor(){super(),this._slots=[],this._shortcutItemEntityId=h.LEntityId.makeEmpty(),this._revisitonNumber=0}onAttached(t){u.MRLively.eventServer.subscribe(n.MRBasics.events.itemRemovedFromInventory,this)}onDetached(t){u.MRLively.eventServer.unsubscribe(n.MRBasics.events.itemRemovedFromInventory,this)}onEvent(t,e,i){return e==n.MRBasics.events.itemRemovedFromInventory&&this.onRemoveItemFromInventory(i.item),g.LEventResult.Pass}clone(t){u.MRLively.world.spawn(r);throw new Error("Not implemented.")}isEquipped(t){const e=t.entityId();return this._slots.findIndex((t=>t.itemEntityId.equals(e)))>=0}isShortcutEquipped(t){return this._shortcutItemEntityId.equals(t.entityId())}get shortcutItem(){if(this._shortcutItemEntityId.hasAny())return u.MRLively.world.entity(this._shortcutItemEntityId)}equippedItemEntities(){const t=[];for(const e of this._slots)e.itemEntityId.hasAny()&&t.push(u.MRLively.world.entity(e.itemEntityId));return t}revisitonNumber(){return this._revisitonNumber}onQuerySubEntities(t,e){if("Equipped"==t.path)for(const i of this.equippedItemEntities())t.kindId?t.kindId==i.kindDataId()&&e.push(i):e.push(i)}static calcEquipmentParam(t,e){const i=t.data.equipment;if(i){const r=t.getActualParam(n.MRBasics.params.upgradeValue),s=i.parameters[e];return s?s.value+r*s.upgradeRate:0}return 0}onQueryProperty(t){if(t==l.MRSystem.properties.equipmentSlots)return o.MRData.equipmentParts.filter((t=>0!=t.id)).map((t=>t.id));super.onQueryProperty(t)}onQueryIdealParameterPlus(t){const e=this.ownerEntity();return this.equippedItemEntities().reduce(((i,s)=>{const a=e.traitsPi(n.MRBasics.traits.EquipmentProficiency,s.kindDataId());return i+r.calcEquipmentParam(s,t)*a}),0)}onQueryActions(t){return t.push(n.MRBasics.actions.EquipActionId),t.push(n.MRBasics.actions.EquipOffActionId),t}onQueryAttackAnimationId(t,e){if(0==e)for(const t of this.equippedItemEntities())if(t.data.equipment)return t.data.equipment.targetRmmzAnimationId}onCollectTraits(t,e){super.onCollectTraits(t,e);for(const t of this.equippedItemEntities())for(const i of t.data.equippedTraits())e.push(i)}onActivity(t,e,i){const r=i.activity();if(r.actionId()==n.MRBasics.actions.EquipActionId){this.refreshSlots();const i=r.object();(0,a.assert)(i);const s=i.data.equipment;if(s){const r=s.equipmentPart;(0,a.assert)(r>0);let n=this._slots.find((t=>t.partId==r&&t.itemEntityId.isEmpty()));if(n)this.equipOn(e,t,n,i);else if(n=this._slots.find((t=>t.partId==r)),n){const r=n;this.postEquipOff(e,t,u.MRLively.world.entity(r.itemEntityId)).then((()=>(this.equipOn(e,t,r,i),!0)))}else e.postMessage((0,a.tr2)("%1 は装備できない。").format(_.UName.makeNameAsItem(i)))}else this.equipOnShortcut(e,i);return c.SCommandResponse.Handled}if(r.actionId()==n.MRBasics.actions.EquipOffActionId){const i=r.object();return this._shortcutItemEntityId.equals(i.entityId())?this.equipOffShortcut(e,i):this.postEquipOff(e,t,i),c.SCommandResponse.Handled}return c.SCommandResponse.Pass}equipOnUtil(t){this.refreshSlots();const e=t.data.equipment;(0,a.assert)(e);const i=e.equipmentPart,r=this._slots.find((t=>t.partId==i));(0,a.assert)(r),r.itemEntityId=t.entityId(),this.ownerEntity().refreshConditions()}equipOn(t,e,i,r){i.itemEntityId=r.entityId(),this.ownerEntity().refreshConditions(),y.UIdentify.identifyByTiming(t,e,r,n.MRBasics.actions.EquipActionId,!1),p.SSoundManager.playEquip(),t.postMessage((0,a.tr2)("%1 を装備した。").format(_.UName.makeNameAsItem(r))),r.isCursed()&&t.postMessage((0,a.tr2)("呪われていた！")),this.onEquipmentChanged(e)}postEquipOff(t,e,i){return t.post(i,e,new f.SEffectSubject(e),void 0,m.testPickOutItem).then((()=>(this.removeEquitment(i)?(p.SSoundManager.playEquip(),t.postMessage((0,a.tr2)("%1 をはずした。").format(_.UName.makeNameAsItem(i)))):t.postMessage((0,a.tr2)("何も起こらなかった。")),this.onEquipmentChanged(e),!0)))}removeEquitment(t){for(const e of this._slots)if(e.itemEntityId.hasAny()&&e.itemEntityId.equals(t.entityId()))return e.itemEntityId=h.LEntityId.makeEmpty(),this._revisitonNumber++,!0;return!1}removeShortcut(t){return!(!this._shortcutItemEntityId.hasAny()||!this._shortcutItemEntityId.equals(t.entityId()))&&(this._shortcutItemEntityId=h.LEntityId.makeEmpty(),!0)}equipOnShortcut(t,e){this._shortcutItemEntityId=e.entityId(),p.SSoundManager.playEquip(),t.postMessage((0,a.tr2)("%1 を装備した。").format(_.UName.makeNameAsItem(e)))}equipOffShortcut(t,e){this._shortcutItemEntityId.equals(e.entityId())&&(p.SSoundManager.playEquip(),t.postMessage((0,a.tr2)("%1 をはずした。").format(_.UName.makeNameAsItem(e))),this._shortcutItemEntityId=h.LEntityId.makeEmpty())}onRemoveItemFromInventory(t){t.entityId().equals(this._shortcutItemEntityId)?this._shortcutItemEntityId=h.LEntityId.makeEmpty():this.removeEquitment(t)}refreshSlots(){const t=this.ownerEntity().queryProperty(l.MRSystem.properties.equipmentSlots).map((t=>({partId:t,itemEntityId:h.LEntityId.makeEmpty()})));for(const e of t){const t=this._slots.find((t=>t.partId==e.partId&&t.itemEntityId.hasAny()));t&&([e.itemEntityId,t.itemEntityId]=[t.itemEntityId,e.itemEntityId])}this._slots=t,this._revisitonNumber++}onEquipmentChanged(t){l.MRSystem.integration.onEquipmentChanged(t)}};v=r=s([a.MRSerializable],v),e.LEquipmentUserBehavior=v},321:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LEscapeBehavior=void 0;const a=i(1298),n=i(1325),o=i(1451),c=i(8665),l=i(7352);let h=r=class extends c.LBehavior{constructor(){super(),this._escapeAI=new o.LEscapeAI}clone(t){return l.MRLively.world.spawn(r)}behaviorGroup(){return c.LBehaviorGroup.SpecialAbility}onDecisionPhase(t,e,i){return i==c.DecisionPhase.AIMinor?(this._escapeAI.thinkMoving(e,t),n.SPhaseResult.Handled):i==c.DecisionPhase.AIMajor?(this._escapeAI.thinkAction(e,t),n.SPhaseResult.Handled):n.SPhaseResult.Pass}};h=r=s([a.MRSerializable],h),e.LEscapeBehavior=h},7922:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LExitPointBehavior=void 0;const a=i(4836),n=i(7534),o=i(1325),c=i(2554),l=i(7352),h=i(1298),u=i(5967);let d=r=class extends n.LBehavior{clone(t){return l.MRLively.world.spawn(r)}queryHomeLayer(){return u.DBlockLayerKind.Ground}onQueryReactions(t,e){e.splice(0),e.push({actionId:a.MRBasics.actions.ForwardFloorActionId})}[n.onProceedFloorReaction](t,e){const i=t.self;return e.openDialog(i,new c.SEventExecutionDialog(i.rmmzEventId,i),!1),o.SCommandResponse.Handled}};d=r=s([h.MRSerializable],d),e.LExitPointBehavior=d},4797:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LExperienceBehavior=void 0;const a=i(9185),n=i(7352),o=i(7534),c=i(4685),l=i(4836),h=i(1298),u=i(3367),d=i(4561);let p=r=class extends o.LBehavior{constructor(){super()}clone(t){return n.MRLively.world.spawn(r)}onAttached(t){const e=t.params;e.acquireParam(l.MRBasics.params.level),e.acquireParam(l.MRBasics.params.exp),this.resetLevel(t)}onResetStatus(t){this.resetLevel(t)}onParamIdealPlusChanged(t,e,i,r){if(e==l.MRBasics.params.level)this.refreshExpFromLevel(t,i,r);else if(e==l.MRBasics.params.exp)throw new Error("Unreachable.")}onParamChanged(t,e,i,r){e==l.MRBasics.params.level||e==l.MRBasics.params.exp&&this.refreshLevelFromExp(t,i,r)}onRefreshConditions(t){}resetLevel(t){this.setLevel(t,this.actor(t).initialLevel)}level(t){return t.getEffortValue(l.MRBasics.params.level)}currentExp(t){return t.getActualParam(l.MRBasics.params.exp)}setLevel(t,e){e=e.clamp(1,this.maxLevel(t)),t.setEffortValue(l.MRBasics.params.level,e)}gainLevel(t,e){t.setEffortValue(l.MRBasics.params.level,t.getEffortValue(l.MRBasics.params.level)+e,c.LParamChangedAction.None)}nextLevelExp(t){return this.expForLevel(t,this.level(t)+1)}actor(t){const e=t.data.actor;return(0,h.assert)(e),e}maxLevel(t){return this.actor(t).maxLevel}isMaxLevel(t){return this.level(t)>=this.maxLevel(t)}currentClass(t){const e=t.data.classId;return a.MRData.classes[e]}expForLevel(t,e){const i=this.currentClass(t),r=i.expParams[0],s=i.expParams[1],a=i.expParams[2],n=i.expParams[3];return Math.round(r*Math.pow(e-1,.9+a/250)*e*(e+1)/(6+Math.pow(e,2)/50/n)+(e-1)*s)}currentLevelExp(t){return this.expForLevel(t,this.level(t))}setExp(t,e){t.setParamCurrentValue(l.MRBasics.params.exp,e)}refreshExpFromLevel(t,e,i){this.setExp(t,this.expForLevel(t,e))}refreshLevelFromExp(t,e,i){if(e!=i){for(;!this.isMaxLevel(t)&&e>=this.nextLevelExp(t);)this.onLevelUp(t);for(;e<this.currentLevelExp(t);)this.onLevelDown(t)}}onLevelUp(t){this.gainLevel(t,1);const e=this.ownerEntity()._effectResult,i=new u.LParamEffectResult(l.MRBasics.params.level);i.applyTarget=d.DValuePoint.Growth,i.damage=-1,e.paramEffects2.push(i),e._revision++}onLevelDown(t){this.gainLevel(t,-1)}};p=r=s([h.MRSerializable],p),e.LExperienceBehavior=p},7872:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LFlockBehavior=void 0;const a=i(1298),n=i(4836),o=i(9185),c=i(8665),l=i(5557),h=i(7352);let u=r=class extends c.LBehavior{clone(t){return h.MRLively.world.spawn(r)}onAttached(t){}onDetached(t){}onPertyChanged(t){t.partyId()>0&&h.MRLively.world.party(t.partyId()).subscribe(n.MRBasics.events.effectReacted,this)}onPartyEvent(t,e){return t==n.MRBasics.events.effectReacted&&this.ownerEntity().removeState(o.MRData.getState("kState_仮眠2").id),l.LEventResult.Pass}};u=r=s([a.MRSerializable],u),e.LFlockBehavior=u},943:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LGlueToGroundBehavior=void 0;const a=i(1298),n=i(4836),o=i(1325),c=i(3482),l=i(7352),h=i(7534);let u=r=class extends h.LBehavior{constructor(){super(...arguments),this._glued=!1}clone(t){l.MRLively.world.spawn(r);throw new Error("Not implemented.")}get glued(){return this._glued}set glued(t){this._glued=t}onActivityPreReaction(t,e,i){return i.actionId()==n.MRBasics.actions.PickActionId&&this._glued?(e.postMessage((0,a.tr2)("%1は地面にはりついている。").format(c.UName.makeNameAsItem(t))),o.SCommandResponse.Canceled):o.SCommandResponse.Pass}[h.testPickOutItem](t,e){const i=t.self;return this._glued?(e.postMessage((0,a.tr2)("%1は地面にはりついている。").format(c.UName.makeNameAsItem(i))),o.SCommandResponse.Canceled):o.SCommandResponse.Pass}[h.onGrounded](t,e){return this._glued=!0,o.SCommandResponse.Pass}};u=r=s([a.MRSerializable],u),e.LGlueToGroundBehavior=u},4245:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LGoldBehavior=void 0;const a=i(1298),n=i(3654),o=i(4836),c=i(7352),l=i(7534);let h=r=class extends l.LBehavior{clone(t){return c.MRLively.world.spawn(r)}constructor(){super()}onAttached(t){t.params.acquireParam(o.MRBasics.params.gold)}queryDisplayName(){const t=this.ownerEntity().data;return{name:this.gold().toString()+n.DTextManager.currencyUnit,iconIndex:t.display.iconIndex,upgrades:0}}onCheckLooksLikeGold(){return!0}gold(){return this.ownerEntity().getActualParam(o.MRBasics.params.gold)}setGold(t){this.ownerEntity().setParamCurrentValue(o.MRBasics.params.gold,t)}};h=r=s([a.MRSerializable],h),e.LGoldBehavior=h},2384:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LGoldThiefBehavior=void 0;const a=i(1298),n=i(5967),o=i(9185),c=i(8254),l=i(1325),h=i(6316),u=i(1451),d=i(2069),p=i(9441),f=i(7352),m=i(7534),y=i(9248);let _=r=class extends m.LBehavior{constructor(){super(),this._standardAI=new p.LCharacterAI_Normal,this._escapeAI=new u.LEscapeAI,this._standardAI.setMovingTargetFinder(new d.LMovingTargetFinder_Gold)}clone(t){return f.MRLively.world.spawn(r)}onPostMakeSkillActions(t){const e=this.ownerEntity(),i=h.UMovement.getAdjacentBlocks(e);for(const r of i){const i=r.getFirstEntity(n.DBlockLayerKind.Unit);if(i&&c.Helpers.isHostile(e,i)){const e=i.findEntityBehavior(y.LInventoryBehavior);return void(e&&e.gold()>0&&t.push({action:{rating:100,skillId:o.MRData.getSkill("kSkill_ゴールド盗み").id},targets:[i.entityId()]}))}}}onDecisionPhase(t,e,i){return i==m.DecisionPhase.AIMinor?(this.activeAI(t).thinkMoving(e,t),l.SPhaseResult.Handled):i==m.DecisionPhase.AIMajor?(this.activeAI(t).thinkAction(e,t),l.SPhaseResult.Handled):l.SPhaseResult.Pass}activeAI(t){return t.getEntityBehavior(y.LInventoryBehavior).hasAnyItem()?this._escapeAI:this._standardAI}};_=r=s([a.MRSerializable],_),e.LGoldThiefBehavior=_},9248:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LInventoryBehavior=void 0;const a=i(1298),n=i(7352),o=i(7534),c=i(1325),l=i(4836),h=i(9115),u=i(3609);let d=r=class extends o.LBehavior{constructor(){super(...arguments),this._entities=[],this._gold=0,this._capacity=u.paramInventoryCapacity}clone(t){const e=n.MRLively.world.spawn(r);return e._entities=[],e._gold=this._gold,e}clearItems(){const t=this.items;for(let e=t.length-1;e>=0;e--)t[e].removeFromParent()}reset(){for(const t of this.items)(0,a.assert)(t.parentObject()==this),t.clearParent(),t.destroy();this._entities.splice(0),this._gold=0,this._capacity=0}get capacity(){return this._capacity}set capacity(t){this._capacity=t}get itemCount(){return this._entities.length}get remaining(){return this._capacity-this._entities.length}get isFully(){return this._entities.length>=this._capacity}hasAnyItem(){return this._entities.length>0}get items(){return this._entities.map((t=>n.MRLively.world.entity(t)))}iterateItems(t){for(const e of this._entities){if(!1===t(n.MRLively.world.entity(e)))break}}contains(t){return this._entities.findIndex((e=>e.equals(t.entityId())))>=0}addEntity(t){(0,a.assert)(!t.parentEntity()),(0,a.assert)(!t.isDestroyed()),(0,a.assert)(!this.isFully);const e=t.entityId();(0,a.assert)(void 0===this._entities.find((t=>t.equals(e)))),this._entities.push(e),t.setParent(this)}canAddEntityWithStacking(t){if(t.hasTrait(l.MRBasics.traits.Stackable)){if(this.items.find((e=>e.checkStackable(t))))return!0}return!this.isFully}addEntityWithStacking(t){(0,a.assert)(!t.parentEntity());for(const e of this.items)if(e.checkStackable(t))return void e.increaseStack(t);(0,a.assert)(!this.isFully),this.addEntity(t)}removeEntity(t){(0,a.assert)(t.parentObject()==this);const e=t.entityId(),i=this._entities.findIndex((t=>t.equals(e)));(0,a.assert)(i>=0),this._entities.splice(i,1),t.clearParent();const r={item:t};n.MRLively.eventServer.publish(h.MRSystem.commandContext,l.MRBasics.events.itemRemovedFromInventory,r)}onRemoveChild(t){if(this._entities.mutableRemove((e=>e.equals(t.entityId())))){t.clearParent();const e={item:t};n.MRLively.eventServer.publish(h.MRSystem.commandContext,l.MRBasics.events.itemRemovedFromInventory,e)}}onCollectTraits(t,e){super.onCollectTraits(t,e),this.iterateItems((t=>{e.pushArray(t.data.charmedTraits())}))}onCollectCharmdBehaviors(t,e){this.iterateItems((t=>{t.iterateBehaviorsReverse((t=>{t.isCharmBehavior()&&e.push(t)}))}))}onPreviewRejection(t,e,i){let r=!0;return this.iterateItems((t=>!(t.data.isTraitCharmItem&&!t.previewRejection(e,i))||(r=!1,!1))),r?c.SCommandResponse.Pass:c.SCommandResponse.Canceled}gold(){return this._gold}gainGold(t){this._gold=(this._gold+t).clamp(0,this.maxGold())}loseGold(t){this.gainGold(-t)}maxGold(){return 99999999}};d=r=s([a.MRSerializable],d),e.LInventoryBehavior=d},9543:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LItemBehavior=void 0;const a=i(1298),n=i(4836),o=i(1325),c=i(7043),l=i(695),h=i(8510),u=i(6296),d=i(7352),p=i(7534),f=i(4598);let m=r=class extends p.LBehavior{constructor(){super(),this._shopStructureId=0}clone(t){return d.MRLively.world.spawn(r)}shopStructureId(){return this._shopStructureId}setShopStructureId(t){this._shopStructureId=t}onCollectTraits(t,e){super.onCollectTraits(t,e);for(const i of t.data.selfTraits)e.push(i)}onActivity(t,e,i){const r=i.activity();if(r.actionId()==n.MRBasics.actions.collide){const s=r.objects2()[0],a=new l.SEffectSubject(r.subject());return i.postHandleActivity(e,s).then((()=>(this.applyHitEffect(e,t,n.MRBasics.actions.collide,s,a.entity(),r.effectDirection(),(i=>{i.find((t=>!t._effectResult.missed))?t.destroy():f.UAction.postDropOrDestroy(e,t,t.mx,t.my)})),c.SHandleCommandResult.Resolved))).catch((()=>{throw new Error("Not implemented.")})),o.SCommandResponse.Handled}return o.SCommandResponse.Pass}onActivityReaction(t,e,i){if(i.actionId()==n.MRBasics.actions.WaveActionId){const r=i.actor(),s=t.data.getReaction(n.MRBasics.actions.WaveActionId);for(const i of s.emittors())h.SEmittorPerformer.makeWithEmitor(r,r,i).setItemEntity(t).perform(e)}else if(i.actionId()==n.MRBasics.actions.ReadActionId){const r=i.actor();u.UIdentify.identifyByTiming(e,r,t,i.actionId());const s=t.data.getReaction(n.MRBasics.actions.ReadActionId);for(const a of s.emittors())h.SEmittorPerformer.makeWithEmitor(r,r,a).setItemEntity(t).setSelectedTargetItems(i.objects2()).perform(e),e.postDestroy(t)}else if(i.actionId()==n.MRBasics.actions.EatActionId){const r=i.actor(),s=i.object();if(s){u.UIdentify.identifyByTiming(e,r,s,i.actionId());const a=t.data.getReaction(n.MRBasics.actions.EatActionId);for(const s of a.emittors())h.SEmittorPerformer.makeWithEmitor(r,r,s).setItemEntity(t).setSelectedTargetItems(i.objects2()).perform(e),e.postDestroy(t)}return o.SCommandResponse.Handled}return o.SCommandResponse.Pass}onEmitEffect(t,e,i,r,s,a){return this.applyHitEffect(e,t,i,s,r,a),o.SCommandResponse.Pass}applyHitEffect(t,e,i,r,s,a,n){const o=e.data.findReaction(i);if(o){const i=o.emittors();i.length>0&&t.postCall((()=>{for(const o of i)h.SEmittorPerformer.makeWithEmitor(s,r,o).setItemEntity(e).setDffectDirection(a).perform(t,n)}))}}[p.onAttackReaction](t,e){const i=t.self,r=t.args.effectContext;if(r){const t=[i];return r.applyWithWorth(e,t),o.SCommandResponse.Handled}return o.SCommandResponse.Pass}};m=r=s([a.MRSerializable],m),e.LItemBehavior=m},2436:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LItemImitatorBehavior=void 0;const a=i(1298),n=i(4836),o=i(9185),c=i(8254),l=i(1325),h=i(9115),u=i(4598),d=i(5150),p=i(5557),f=i(4977),m=i(7352),y=i(3806),_=i(7534),g=i(5967),v=i(6291),S=i(2593);let M=r=class extends _.LBehavior{constructor(){super(),this._itemEntityId=f.LEntityId.makeEmpty()}clone(t){const e=m.MRLively.world.spawn(r);return e._itemEntityId=this._itemEntityId.clone(),e}onAttached(t){(0,a.assert)(this._itemEntityId.isEmpty()),m.MRLively.eventServer.subscribe(n.MRBasics.events.preWalk,this),m.MRLively.eventServer.subscribe(n.MRBasics.events.prePut,this)}onDetached(t){(0,a.assert)(this._itemEntityId.hasAny()),m.MRLively.eventServer.unsubscribe(n.MRBasics.events.preWalk,this),m.MRLively.eventServer.unsubscribe(n.MRBasics.events.prePut,this),this.itemEntity().clearParent()}onEnteredMap(t,e){if(this._itemEntityId.isEmpty()){const t=m.MRLively.world.random(),i=e.floorId(),r=e.land2().landData().appearanceTable.items[i.floorNumber()],s=t.selectOrUndefined(r),a=s?d.SEntityFactory.newEntity(s.spawiInfo,i):d.SEntityFactory.newEntity(v.DEntityCreateInfo.makeSingle(o.MRData.system.fallbackItemEntityId));a.setParent(this),this._itemEntityId=a.entityId()}}queryDisplayName(){return this.itemEntity().getDisplayName()}queryPrefabId(){return this.itemEntity().data.prefabId}queryHomeLayer(){return g.DBlockLayerKind.Ground}queryMinimapMarkerClass(){return S.LMinimapMarkerClass.Item}onQueryReactions(t,e){for(const t of this.itemEntity().queryReactions())e.push(t)}itemEntity(){return m.MRLively.world.entity(this._itemEntityId)}queryOutwardFactionId(){return o.MRData.system.factions.neutral}[_.testPickOutItem](t,e){var i;const r=t.sender,s=t.self;return c.Helpers.isHostileFactionId(r.getOutwardFactionId(),s.getInnermostFactionId())?(null===(i=this.parentAs(y.LState))||void 0===i||i.removeThisState(),s.removeFromParent(),m.MRLively.map.appearEntity(s,r.mx,r.my),u.UAction.postDropOrDestroyOnCurrentPos(h.MRSystem.commandContext,s,s.getHomeLayer()),l.SCommandResponse.Canceled):l.SCommandResponse.Pass}onEvent(t,e,i){var r;const s=this.ownerEntity();if(e==n.MRBasics.events.preWalk){const t=i;if(c.Helpers.isHostileFactionId(t.walker.getOutwardFactionId(),s.getInnermostFactionId())&&t.targetX==s.mx&&t.targetY==s.my)return null===(r=this.parentAs(y.LState))||void 0===r||r.removeThisState(),p.LEventResult.Handled}else n.MRBasics.events.prePut;return p.LEventResult.Pass}};M=r=s([a.MRSerializable],M),e.LItemImitatorBehavior=M},1524:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LItemThiefBehavior=void 0;const a=i(1298),n=i(5967),o=i(9185),c=i(8254),l=i(1325),h=i(6316),u=i(1301),d=i(1451),p=i(2069),f=i(9441),m=i(7352),y=i(7534),_=i(9248),g=i(9543);let v=r=class extends y.LBehavior{constructor(){super(),this._standardAI=new f.LCharacterAI_Normal,this._escapeAI=new d.LEscapeAI,this._standardAI.setMovingTargetFinder(new p.LMovingTargetFinder_Item)}clone(t){return m.MRLively.world.spawn(r)}behaviorGroup(){return y.LBehaviorGroup.SpecialAbility}onPostMakeSkillActions(t){const e=this.ownerEntity(),i=h.UMovement.getAdjacentBlocks(e);for(const r of i){const i=r.getFirstEntity(n.DBlockLayerKind.Unit);if(i&&c.Helpers.isHostile(e,i)){const e=i.findEntityBehavior(_.LInventoryBehavior);return void(e&&e.items.length>0&&t.push({action:{rating:100,skillId:o.MRData.getSkill("kSkill_アイテム盗み").id},targets:[i.entityId()]}))}}for(const r of i){const i=r.getFirstEntity(n.DBlockLayerKind.Ground);if(i&&i.findEntityBehavior(g.LItemBehavior)){if(r.getFirstEntity(n.DBlockLayerKind.Unit))continue;return void(i==u.USearch.findLatestItemInVisibilityBlocks(e)&&t.push({action:{rating:100,skillId:o.MRData.getSkill("kSkill_アイテム盗み").id},targets:[i.entityId()]}))}}}onDecisionPhase(t,e,i){return i==y.DecisionPhase.AIMinor?(this.activeAI(t).thinkMoving(e,t),l.SPhaseResult.Handled):i==y.DecisionPhase.AIMajor?(this.activeAI(t).thinkAction(e,t),l.SPhaseResult.Handled):l.SPhaseResult.Pass}activeAI(t){return t.getEntityBehavior(_.LInventoryBehavior).hasAnyItem()?this._escapeAI:this._standardAI}};v=r=s([a.MRSerializable],v),e.LItemThiefBehavior=v},2479:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LItemUserBehavior=void 0;const r=i(7352),s=i(7534);class a extends s.LBehavior{clone(t){return r.MRLively.world.spawn(a)}}e.LItemUserBehavior=a},5870:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LParamBehavior=void 0;const a=i(1298),n=i(8665),o=i(7352);let c=r=class extends n.LBehavior{constructor(){super(),this._values=[]}clone(t){const e=o.MRLively.world.spawn(r);return e._values=this._values.slice(),e}setParamBase(t,e){this._values[t]=e}behaviorGroup(){return n.LBehaviorGroup.SpecialAbility}onQueryIdealParamBase(t,e){const i=this._values[t];return e+(void 0===i?0:i)}};c=r=s([a.MRSerializable],c),e.LParamBehavior=c},1292:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LStumblePreventionBehavior=void 0;const a=i(1298),n=i(4836),o=i(1325),c=i(3482),l=i(7352),h=i(7534);let u=r=class extends h.LBehavior{clone(t){return l.MRLively.world.spawn(r)}onPreviewRejection(t,e,i){if("Effect"==i.kind){if("kEntity_転び石A"==i.effect.effect.key)return this.rejectStumble(e,t)}else if("EffectBehavior"==i.kind&&i.id==n.MRBasics.effectBehaviors.stumble)return this.rejectStumble(e,t);return o.SCommandResponse.Pass}rejectStumble(t,e){return e.getActualParam(n.MRBasics.params.remaining)>0?(t.postMessage((0,a.tr2)("%1の効果で転ばなかった。").format(c.UName.makeNameAsItem(e))),e.gainActualParam(n.MRBasics.params.remaining,-1,!0),o.SCommandResponse.Canceled):o.SCommandResponse.Pass}};u=r=s([a.MRSerializable],u),e.LStumblePreventionBehavior=u},7673:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LRaceBehavior=void 0;const a=i(1298),n=i(9185),o=i(7352),c=i(846);let l=r=class extends c.LBattlerBehavior{clone(t){return o.MRLively.world.spawn(r)}races(t){return t.data.raceIds.map((t=>n.MRData.races[t]))}onCollectTraits(t,e){for(const i of this.races(t))for(const t of i.traits)e.push(t)}};l=r=s([a.MRSerializable],l),e.LRaceBehavior=l},2999:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LRatedRandomAIBehavior=void 0;const a=i(1298),n=i(1325),o=i(5568),c=i(7352),l=i(7534);let h=r=class extends l.LBehavior{constructor(){super(...arguments),this._characterAI=new o.LRatedRandomAI}clone(t){const e=c.MRLively.world.spawn(r);return e._characterAI=this._characterAI.clone(),e}behaviorGroup(){return l.LBehaviorGroup.SpecialAbility}onQueryCharacterAI(t){t.push(this._characterAI)}onDecisionPhase(t,e,i){if(i==l.DecisionPhase.Manual)throw new Error("Not implemented.");return i==l.DecisionPhase.AIMinor?this._characterAI.thinkMoving(e,t):i==l.DecisionPhase.ResolveAdjacentAndMovingTarget?n.SPhaseResult.Pass:i==l.DecisionPhase.AIMajor?this._characterAI.thinkAction(e,t):n.SPhaseResult.Pass}};h=r=s([a.MRSerializable],h),e.LRatedRandomAIBehavior=h},9684:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LRevivalItemBehavior=void 0;const a=i(1298),n=i(1325),o=i(7352),c=i(7534);let l=r=class extends c.LBehavior{clone(t){return o.MRLively.world.spawn(r)}isCharmBehavior(){return!0}onStabilizeSituation(t,e){return n.SCommandResponse.Pass}};l=r=s([a.MRSerializable],l),e.LRevivalItemBehavior=l},5346:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LSanctuaryBehavior=void 0;const a=i(1298),n=i(4836),o=i(1325),c=i(1452),l=i(7352),h=i(7534),u=i(943);let d=r=class extends h.LBehavior{constructor(){super()}clone(t){return l.MRLively.world.spawn(r)}onAttached(t){this._fieldEffect=new c.LSanctuaryFieldEffect(t)}onDetached(t){this._fieldEffect=void 0}onActivityReaction(t,e,i){return i.actionId()==n.MRBasics.actions.ReadActionId&&e.postMessage((0,a.tr2)("しかしなにもおこらなかった。")),o.SCommandResponse.Pass}*onCollectFieldEffect(t){t.getEntityBehavior(u.LGlueToGroundBehavior).glued&&this._fieldEffect&&(yield this._fieldEffect)}};d=r=s([a.MRSerializable],d),e.LSanctuaryBehavior=d},8198:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LSelfExplosionBehavior=void 0;const a=i(1298),n=i(1325),o=i(7352),c=i(7534),l=i(4836),h=i(4621),u=i(9185);let d=r=class extends c.LBehavior{constructor(){super()}clone(t){return o.MRLively.world.spawn(r)}[c.onEffectResult](t,e){const i=t.self;if(i.isDeathStateAffected())return n.SCommandResponse.Pass;const r=i.getParamActualMax(l.MRBasics.params.hp),s=i.getActualParam(l.MRBasics.params.hp);if(s<10){const t=u.MRData.getSkill("kSkill_大爆発");return e.postActivity(h.LActivity.makePerformSkill(i,t.id)),e.postCall((()=>e.postDestroy(i))),n.SCommandResponse.Handled}if(s<.5*r){const t=u.MRData.getState("kState_UT自爆着火").id;return i.hasState(t)||i.addState(t),n.SCommandResponse.Handled}return n.SCommandResponse.Pass}};d=r=s([a.MRSerializable],d),e.LSelfExplosionBehavior=d},2689:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LMovingTargetFinder_Shopkeeper=e.LShopkeeperBehavior=void 0;const a=i(7534),n=i(7352),o=i(1325),c=i(639),l=i(2069),h=i(2554),u=i(4836),d=i(9248),p=i(1298);let f=r=class extends a.LBehavior{constructor(){super(...arguments),this._shopStructureId=0,this._shopkeeperIndex=0}clone(t){return n.MRLively.world.spawn(r)}shopStructureId(){return this._shopStructureId}shopkeeperIndex(){return this._shopkeeperIndex}shop(){return n.MRLively.map.structures()[this._shopStructureId]}shopEntrance(){return this.shop().shopEntrance(this._shopkeeperIndex)}setup(t,e){this._shopStructureId=t,this._shopkeeperIndex=e}onAttached(t){t.getEntityBehavior(c.LDecisionBehavior).characterAI().setMovingTargetFinder(new m(this))}onDecisionPhase(t,e,i){return o.SPhaseResult.Pass}onTalk(t,e,i){const r=new h.SEventExecutionDialog(t.rmmzEventId,t);return r.billingPrice=this.shop().getBillingPrice(),r.depositPrice=this.shop().getDepositPriece(),e.openDialog(t,r,!1),o.SCommandResponse.Handled}onActivityReaction(t,e,i){if(i.actionId()==u.MRBasics.actions.dialogResult){if("yes"==i.selectedAction()){const t=this.shop().getBillingPrice(),e=i.subject().getEntityBehavior(d.LInventoryBehavior);if(!(e.gold()>=t))throw new Error("Not implemented.");e.loseGold(t),this.shop().commitBilling()}return o.SCommandResponse.Handled}return o.SCommandResponse.Pass}};f=r=s([p.MRSerializable],f),e.LShopkeeperBehavior=f;let m=class extends l.LMovingTargetFinder{constructor(t){super(),this._ownerShopkeeperId=t.id()}decide(t){const e=n.MRLively.world.behavior(this._ownerShopkeeperId),i=e.shop(),r=e.shopEntrance();return i.checkBilling()?[r.gateX(),r.gateY()]:[r.homeX(),r.homeY()]}};m=s([p.MRSerializable],m),e.LMovingTargetFinder_Shopkeeper=m},6668:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LStorageBehavior=void 0;const a=i(1298),n=i(7352),o=i(7534);let c=r=class extends o.LBehavior{constructor(){super()}clone(t){return n.MRLively.world.spawn(r)}};c=r=s([a.MRSerializable],c),e.LStorageBehavior=c},6464:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LSurvivorBehavior=void 0;const a=i(1298),n=i(4836),o=i(3609),c=i(1325),l=i(7352),h=i(7534);let u=r=class extends h.LBehavior{constructor(){super(),this._basicLoss=o.paramFPLoss,this._basicLoss=o.paramFPLoss,this._prevFP=1/0}clone(t){return l.MRLively.world.spawn(r)}onAttached(t){}onDecisionPhase(t,e,i){if(i==h.DecisionPhase.UpdateState){const i=t.getActualParam(n.MRBasics.params.fp);if(i>this._prevFP)this._prevFP=i;else{var r=this._basicLoss;r*=t.traitsPi(n.MRBasics.traits.SurvivalParamLossRate,n.MRBasics.params.fp),t.gainActualParam(n.MRBasics.params.fp,-r,!0);const s=t.getActualParam(n.MRBasics.params.fp);i>0&&s<=0&&e.postMessage((0,a.tr2)("だめだ、もう倒れそうだ！ 早くなにか食べないと！")),s<=0?(t.gainActualParam(n.MRBasics.params.hp,-1,!0),t.isDeathStateAffected()&&e.postMessage((0,a.tr2)("おなかがすいて倒れた・・・"))):t.gainActualParam(n.MRBasics.params.hp,1,!0),this._prevFP=s}return c.SPhaseResult.Pass}return c.SPhaseResult.Pass}};u=r=s([a.MRSerializable],u),e.LSurvivorBehavior=u},6559:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LTrapBehavior=void 0;const a=i(1298),n=i(4836),o=i(9185),c=i(1325),l=i(9115),h=i(7534),u=i(9543),d=i(7352),p=i(5557),f=i(6316),m=i(8510),y=i(3609);let _=r=class extends h.LBehavior{constructor(){super(),this._exposed=!1,this._recharging=!1,this._launching=!1}clone(t){const e=d.MRLively.world.spawn(r);return e._exposed=this._exposed,e}exposed(){return this._exposed}isExposedFor(t){return!!d.MRLively.map.trapClarity||(!!t.hasTrait(n.MRBasics.traits.ForceVisible)||this.exposed())}setExposed(t){this._exposed=t}onQueryReactions(t,e){e.mutableRemoveAll((t=>t.actionId==n.MRBasics.actions.PickActionId||t.actionId==n.MRBasics.actions.ThrowActionId)),e.push({actionId:n.MRBasics.actions.trample})}onAttached(t){(0,a.assert)(this.ownerEntity().findEntityBehavior(u.LItemBehavior)),d.MRLively.eventServer.subscribe(n.MRBasics.events.skillEmitted,this)}onDetached(t){d.MRLively.eventServer.unsubscribe(n.MRBasics.events.skillEmitted,this)}onEvent(t,e,i){if(e==n.MRBasics.events.skillEmitted){const t=this.ownerEntity(),e=i;this.checkValidTarget(e.performer)&&e.skillId==o.MRData.system.skills.normalAttack&&0==e.targets.length&&!f.UMovement.checkDiagonalWallCornerCrossing(e.performer,e.performer.dir)&&f.UMovement.getFrontBlock(e.performer).containsEntity(t)&&(this._exposed=!0)}return p.LEventResult.Pass}checkValidTarget(t){return t.getOutwardFactionId()===o.MRData.system.trapTargetFactionId}triggerRate(t){return this.isExposedFor(t)?y.paramExposedTrapTriggerRate:y.paramHiddenTrapTriggerRate}testTrigger(t,e){if(t.hasTrait(n.MRBasics.traits.DisableTrap))return!1;if(t.hasTrait(n.MRBasics.traits.DrawInTrap))return!0;return e.nextIntWithMax(100)<this.triggerRate(t)}[h.onPreStepFeetProcess](t,e){const i=this.ownerEntity(),r=t.sender;if(!this.checkValidTarget(r))return c.SCommandResponse.Pass;const s=this.testTrigger(r,e.random());return this.setExposed(!0),e.postMessage((0,a.tr)("{0} を踏んだ！",i.getDisplayName().name)),s?(this._launching=!0,l.MRSystem.sequelContext.trapPerforming=!0):e.postMessage((0,a.tr)("しかし罠にはかからなかった。")),c.SCommandResponse.Canceled}[h.onPerformStepFeetProcess](t,e){const i=this.ownerEntity(),r=t.sender;return this._launching?(this._launching=!1,this.performTrapEffect(i,e,r.dir),c.SCommandResponse.Handled):c.SCommandResponse.Canceled}onActivityReaction(t,e,i){return(i.actionId()==n.MRBasics.actions.trample||i.actionId()==n.MRBasics.actions.FallActionId)&&this.performTrapEffect(t,e,i.actor().dir),c.SCommandResponse.Pass}performTrapEffect(t,e,i){if(this._recharging)return;const r=t.data.mainEmittor();r&&m.SEmittorPerformer.makeWithEmitor(t,t,r).setDffectDirection(f.UMovement.getRightDir(i)).setProjectilePriorityEffectSet(r).perform(e),this._recharging=!0,this._exposed=!0,t.addState(n.MRBasics.states.trapPerformed)}onStepEnd(t){return this._recharging=!1,c.SCommandResponse.Pass}onEffectPerformed(t,e,i){return c.SCommandResponse.Pass}onCounterAction(t,e,i){return this._recharging||this.performTrapEffect(t,e,0),c.SCommandResponse.Handled}};_=r=s([a.MRSerializable],_),e.LTrapBehavior=_},6501:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LUnitBehavior=void 0;const a=i(1325),n=i(7043),o=i(7534),c=i(7352),l=i(8254),h=i(9248),u=i(1298),d=i(4836),p=i(6316),f=i(695),m=i(4621),y=i(1019),_=i(9019),g=i(9185),v=i(6229),S=i(8665),M=i(3482),R=i(8510),b=i(9901),E=i(4598),I=i(2554),x=i(5967),w=i(4245),T=i(1301),D=i(1695),P=i(6559),A=i(1722),k=i(9115);var C;!function(t){t[t.None=0]="None",t[t.Dialog=1]="Dialog",t[t.RideOnMessage=2]="RideOnMessage",t[t.AutoPick=3]="AutoPick"}(C||(C={}));let L=r=class extends o.LBehavior{constructor(){super(...arguments),this._factionId=g.MRData.system.factions.neutral,this._speedLevel=0,this._waitTurnCount=0,this._manualMovement=!1,this._targetingEntityId=0,this._straightDashing=!1,this._fastforwarding=!1,this._requiredFeetProcess=!1,this._requiredTrapProcess=!1}clone(t){const e=c.MRLively.world.spawn(r);return e._factionId=this._factionId,e._speedLevel=this._speedLevel,e._waitTurnCount=this._waitTurnCount,e._manualMovement=this._manualMovement,e._targetingEntityId=this._targetingEntityId,e._straightDashing=this._straightDashing,e._fastforwarding=this._fastforwarding,e}setFactionId(t){return this._factionId=t,this}setSpeedLevel(t){return this._speedLevel=t,this}waitTurnCount(){return this._waitTurnCount}setWaitTurnCount(t){return this._waitTurnCount=t,this}manualMovement(){return this._manualMovement}setManualMovement(t){return this._manualMovement=t,this}clearStraightDashing(){this._straightDashing=!1}queryInnermostFactionId(){return this._factionId}queryOutwardFactionId(){return this._factionId}requiredFeetProcess(){return this._requiredFeetProcess}clearFeetProcess(){this._requiredFeetProcess=!1}requiredTrapProcess(){return this._requiredTrapProcess}clearTrapProcess(){this._requiredTrapProcess=!1}queryHomeLayer(){return x.DBlockLayerKind.Unit}onQueryActions(t){return t.concat([d.MRBasics.actions.trample,d.MRBasics.actions.PickActionId,d.MRBasics.actions.PutActionId,d.MRBasics.actions.ThrowActionId,d.MRBasics.actions.ReadActionId,d.MRBasics.actions.ForwardFloorActionId,d.MRBasics.actions.BackwardFloorActionId])}onQueryReactions(t,e){e.push({actionId:d.MRBasics.actions.AttackActionId})}onEffectSensed(t,e){return this._straightDashing=!1,a.SCommandResponse.Pass}onActivity(t,e,i){const r=new f.SEffectSubject(t),s=i.activity();if(t.traitsWithId(d.MRBasics.traits.SealActivity,s.actionId()).length>0)return e.postMessage((0,u.tr2)("しかしなにもおこらなかった。")),a.SCommandResponse.Canceled;{const i=g.MRData.skills[s.actionId()],r=y.LEntityDescription.makeDisplayText(M.UName.makeUnitName(t),y.DescriptionHighlightColor.UnitName);e.displayFlavorEffect(t,i.flavorEffect,{messageFormatArgs:[r],motionObjectEntity:s.hasObject()?s.object():void 0})}if(s.entityDirection()>0&&(t.dir=s.entityDirection()),s.actionId()==d.MRBasics.actions.DirectionChangeActionId)return a.SCommandResponse.Handled;if(s.actionId()==d.MRBasics.actions.MoveToAdjacentActionId){const i=l.Helpers.dirToTileOffset(s.effectDirection()),r=t.mx,n=t.my,o={walker:t,targetX:t.mx+i.x,targetY:t.my+i.y};if(!c.MRLively.eventServer.publish(e,d.MRBasics.events.preWalk,o))return a.SCommandResponse.Canceled;s.isFastForward()&&(this._straightDashing=!0);const h=t.getHomeLayer();if(p.UMovement.moveEntity(e,t,t.mx+i.x,t.my+i.y,v.MovingMethod.Walk,h))return e.postSequel(t,d.MRBasics.sequels.MoveSequel).setStartPosition(r,n),c.MRLively.eventServer.publish(e,d.MRBasics.events.walked,o),t.immediatelyAfterAdjacentMoving=!0,this._requiredFeetProcess=!0,this._requiredTrapProcess=!0,a.SCommandResponse.Handled}else{if(s.actionId()==d.MRBasics.actions.performSkill)return s.hasEffectDirection()&&(t.dir=s.effectDirection()),R.SEmittorPerformer.makeWithSkill(t,t,s.skillId()).perform(e),a.SCommandResponse.Handled;if(s.actionId()==d.MRBasics.actions.ForwardFloorActionId||s.actionId()==d.MRBasics.actions.BackwardFloorActionId){const i=s.object();i&&e.post(i,t,r,void 0,o.onProceedFloorReaction)}else if(s.actionId()==d.MRBasics.actions.PickActionId){const r=t.findEntityBehavior(h.LInventoryBehavior);if(r){const s=c.MRLively.map.block(t.mx,t.my).layer(x.DBlockLayerKind.Ground).firstEntity();s&&i.postHandleActivity(e,s).then((()=>{const i=y.LEntityDescription.makeDisplayText(M.UName.makeUnitName(t),y.DescriptionHighlightColor.UnitName),a=s.findEntityBehavior(w.LGoldBehavior);return a?(r.gainGold(a.gold()),c.MRLively.map._removeEntity(s),e.postDestroy(s),e.postMessage((0,u.tr2)("%1は%2をひろった").format(i,M.UName.makeNameAsItem(s))),_.SSoundManager.playPickItem()):r.canAddEntityWithStacking(s)?(c.MRLively.map._removeEntity(s),r.addEntityWithStacking(s),e.postMessage((0,u.tr2)("%1は%2をひろった").format(i,M.UName.makeNameAsItem(s))),_.SSoundManager.playPickItem()):(e.postMessage((0,u.tr2)("持ち物がいっぱいで拾えない。")),e.postMessage((0,u.tr2)("%1に乗った。").format(M.UName.makeNameAsItem(s)))),n.SHandleCommandResult.Resolved}))}}else{if(s.actionId()==d.MRBasics.actions.PutActionId){const i={actor:t};if(!c.MRLively.eventServer.publish(e,d.MRBasics.events.prePut,i))return a.SCommandResponse.Canceled;const n=s.object(),o=t.findEntityBehavior(h.LInventoryBehavior);(0,u.assert)(n),(0,u.assert)(o);return c.MRLively.map.block(t.mx,t.my).layer(x.DBlockLayerKind.Ground).isContainsAnyEntity()?e.postMessage((0,u.tr)("置けなかった。")):e.postCommandTask(n,a.SCommand.make(d.MRBasics.commands.testPickOutItem)).then2((()=>{D.ULimitations.isItemCountFullyInMap()?e.postMessage((0,u.tr2)("不思議な力で行動できなかった。")):(n.removeFromParent(),c.MRLively.map.appearEntity(n,t.mx,t.my),e.postMessage((0,u.tr)("{0} を置いた。",M.UName.makeNameAsItem(n))),e.post(n,t,r,void 0,S.onGrounded))})),a.SCommandResponse.Handled}if(s.actionId()==d.MRBasics.actions.ThrowActionId){const i=s.object();return(0,u.assert)(i),e.post(i,t,r,void 0,o.onPreThrowReaction).then((()=>(i.removeFromParent(),i.mx=t.mx,i.my=t.my,e.post(i,t,r,void 0,o.onThrowReaction).then((()=>(e.postMessage((0,u.tr)("{0} を投げた。",M.UName.makeNameAsItem(i))),!0))),!0))),a.SCommandResponse.Handled}if(s.actionId()==d.MRBasics.actions.ShootActionId){const i=s.object();return(0,u.assert)(i),e.post(i,t,r,void 0,o.onPreThrowReaction).then((()=>{let s;return i.isStacked()?s=i.decreaseStack():(i.removeFromParent(),s=i),s.mx=t.mx,s.my=t.my,e.post(s,t,r,void 0,o.onThrowReaction).then((()=>(e.postMessage((0,u.tr)("{0} を撃った",M.UName.makeNameAsItem(s))),!0))),!0})),a.SCommandResponse.Handled}if(s.actionId()==d.MRBasics.actions.ExchangeActionId){const i=t.getEntityBehavior(h.LInventoryBehavior),r=s.object(),a=c.MRLively.map.block(t.mx,t.my).layer(x.DBlockLayerKind.Ground).firstEntity();a?(c.MRLively.map._removeEntity(a),i.removeEntity(r),c.MRLively.map.appearEntity(r,t.mx,t.my),i.addEntity(a),e.postMessage((0,u.tr)("{0} と {1} を交換した。",M.UName.makeNameAsItem(r),M.UName.makeNameAsItem(a))),_.SSoundManager.playPickItem()):e.postMessage((0,u.tr2)("足元には何もない。"))}else{if(s.actionId()==d.MRBasics.actions.WaveActionId){e.postSequel(t,d.MRBasics.sequels.attack);const n=s.object();return n&&e.post(n,t,r,void 0,o.onWaveReaction),i.postHandleActivity(e,s.object()),a.SCommandResponse.Handled}if(s.actionId()==d.MRBasics.actions.EatActionId)return e.postSequel(t,d.MRBasics.sequels.useItem,void 0,void 0,s.object()),i.postHandleActivity(e,s.object()),a.SCommandResponse.Handled;if(s.actionId()==d.MRBasics.actions.ReadActionId)return e.postSequel(t,d.MRBasics.sequels.useItem,void 0,void 0,s.object()),i.postHandleActivity(e,s.object()),a.SCommandResponse.Handled;if(s.actionId()==d.MRBasics.actions.PutInActionId){t.getEntityBehavior(h.LInventoryBehavior);const i=s.object().getEntityBehavior(h.LInventoryBehavior),r=s.objects2();for(const t of r)t.removeFromParent(),i.addEntity(t),e.postMessage((0,u.tr)("{0} を入れた。",M.UName.makeNameAsItem(t)))}else if(s.actionId()==d.MRBasics.actions.talk){const i=E.UAction.findTalkableFront(t);i&&e.postCall((()=>{i.iterateBehaviorsReverse((r=>r.onTalk(i,e,t)==a.SCommandResponse.Pass))}))}else{if(s.actionId()==d.MRBasics.actions.dialogResult)return i.postHandleActivity(e,s.object()),a.SCommandResponse.Handled;if(s.actionId()==d.MRBasics.actions.stumble)E.UAction.postStumble(e,t,t.dir);else if(s.actionId()==d.MRBasics.actions.trample){const r=T.USearch.getFirstUnderFootEntity(t);if(r)return i.postHandleActivity(e,r),a.SCommandResponse.Handled}}}}}return a.SCommandResponse.Pass}[o.onAttackReaction](t,e){const i=t.self,r=t.args.effectContext;if(r){const t=[i];return r.applyWithWorth(e,t).then((()=>{if(!T.USearch.hasBlindness(i)){const t=r.effectorFact().subject();b.SView.getEntityVisibility(t).visible&&(i.dir=p.UMovement.getLookAtDir(i,t))}for(const s of t)s._effectResult.isHit()&&e.post(s,i,new f.SEffectSubject(r.effectorFact().subject()),void 0,o.onDirectAttackDamaged);return e.postCall((()=>{i.sendPartyEvent(d.MRBasics.events.effectReacted,void 0)})),!0})),a.SCommandResponse.Handled}return a.SCommandResponse.Pass}[S.onPreStepFeetProcess_Actor](t,e){const i=this.ownerEntity(),[r,s]=this.judgeFeetProcess(i);return r==C.Dialog&&(k.MRSystem.sequelContext.trapPerforming=!0),a.SCommandResponse.Pass}[o.onWalkedOnTopAction](t,e){const i=this.ownerEntity(),[r,s]=this.judgeFeetProcess(i);switch(r){case C.None:break;case C.Dialog:s&&e.openDialog(i,new A.SFeetDialog(i,s),!1);break;case C.RideOnMessage:s&&e.postMessage((0,u.tr2)("%1 に乗った。").format(M.UName.makeNameAsItem(s)));break;case C.AutoPick:k.MRSystem.sequelContext.attemptFlush(!0),e.postActivity(m.LActivity.makePick(i));break;default:throw new Error("Unreachable.")}return a.SCommandResponse.Pass}judgeFeetProcess(t){if(this._manualMovement&&t.immediatelyAfterAdjacentMoving){const e=c.MRLively.map.firstFeetEntity(t);if(e&&!e.findEntityBehavior(P.LTrapBehavior)){const t=e.queryReactions();if(t.length>0)return t.find((t=>t.actionId==d.MRBasics.actions.PickActionId))&&!e._shopArticle.isSalling()?this._straightDashing?[C.RideOnMessage,e]:[C.AutoPick,e]:[C.Dialog,e]}}return[C.None,void 0]}onTalk(t,e,i){return e.openDialog(t,new I.SEventExecutionDialog(t.rmmzEventId,t),!1),a.SCommandResponse.Pass}onDecisionPhase(t,e,i){return S.DecisionPhase.ResolveAdjacentAndMovingTarget,a.SPhaseResult.Pass}};L=r=s([u.MRSerializable],L),e.LUnitBehavior=L},9651:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LProjectileBehavior=void 0;const a=i(1298),n=i(4836),o=i(4621),c=i(7352),l=i(8254),h=i(1325),u=i(695),d=i(6316),p=i(7534),f=i(6229),m=i(4598),y=i(9185),_=i(7933),g=i(4561),v=i(5967),S=i(1886),M=i(3609);let R=r=class extends p.LBehavior{constructor(){super(...arguments),this.blowDirection=0,this.blowMoveCount=0,this._effectSet=0,this._penetration=!1}clone(t){const e=c.MRLively.world.spawn(r);return e.blowDirection=this.blowDirection,e.blowMoveCount=this.blowMoveCount,e}static startMoveAsProjectile(t,e,i,s,o){const c=e.findEntityBehavior(r);(0,a.assert)(c),c.blowDirection=s,c.blowMoveCount=o,c._penetration=e.hasTrait(n.MRBasics.traits.PenetrationItem),c._penetration||(c._penetration=i.entity().hasTrait(n.MRBasics.traits.PenetrationThrower)),c._penetration&&(c.blowMoveCount=1/0),e.addState(y.MRData.getState("kState_System_Projectile").id,!1),t.post(e,e,i,void 0,p.onMoveAsProjectile)}static startMoveAsEffectProjectile(t,e,i,s,n,o){const c=e.findEntityBehavior(r);(0,a.assert)(c),c._effectSet=o.id,c.blowDirection=s,c.blowMoveCount=n,e.addState(y.MRData.getState("kState_System_Projectile").id,!1),t.post(e,e,i,void 0,p.onMoveAsProjectile)}clearKnockback(){this.blowDirection=0,this.blowMoveCount=0}hitType(){return this._effectSet?this.effectSet.hitType():g.DEffectHitType.Certain}get effectSet(){return(0,a.assert)(this._effectSet),y.MRData.emittors[this._effectSet].effectSuite}onQueryReactions(t,e){e.push({actionId:n.MRBasics.actions.ThrowActionId})}[p.onThrowReaction](t,e){const i=t.self;return c.MRLively.map.appearEntity(i,i.mx,i.my,v.DBlockLayerKind.Projectile),r.startMoveAsProjectile(e,i,t.subject,t.sender.dir,M.paramThrowingDistance),h.SCommandResponse.Pass}[p.onMoveAsProjectile](t,e){const i=t.self,s=i.findEntityBehavior(r);(0,a.assert)(s),(0,a.assert)(0!=this.blowDirection);const o=l.Helpers.dirToTileOffset(this.blowDirection),c=i.mx+o.x,u=i.my+o.y;if(i.dir=this.blowDirection,d.UMovement.moveEntity(e,i,c,u,this._penetration?f.MovingMethod.Penetration:f.MovingMethod.Projectile,v.DBlockLayerKind.Projectile)){e.postSequel(i,n.MRBasics.sequels.blowMoveSequel),s.blowMoveCount--;t.subject.entity();return this._penetration?this.processEffectForPenetration(e,i,c,u,t.subject):this.processEffectForNormal(e,i,c,u,t.subject),h.SCommandResponse.Handled}return this.endMoving(e,i),h.SCommandResponse.Pass}processEffectForNormal(t,e,i,r,s){const a=c.MRLively.map.block(i,r).aliveEntity(v.DBlockLayerKind.Unit);if(a){if(!a.hasTrait(n.MRBasics.traits.PhysicalProjectileReflector)){if(S.SActionHitTest.testProjectle(s.entity(),e,a,this.hitType(),t.random())){if(this._effectSet){const i=a;t.postDestroy(e);const r=new _.SEffectorFact(s.entity(),this.effectSet,u.SEffectIncidentType.IndirectAttack,this.blowDirection),n=new u.SEffectContext(r,t.random());return void t.postCall((()=>{n.applyWithWorth(t,[i])}))}return void t.postActivity(o.LActivity.makeCollide(e,a).withOtherSubject(s.entity()).withEffectDirection(this.blowDirection))}return void this.endMoving(t,e)}this.blowDirection=d.UMovement.reverseDir(this.blowDirection),this.blowMoveCount++,t.postAnimation(a,2,!1)}this.blowMoveCount<=0?this.endMoving(t,e):t.post(e,e,s,void 0,p.onMoveAsProjectile)}processEffectForPenetration(t,e,i,r,s){(0,a.assert)(this._penetration);const o=c.MRLively.map.block(i,r).aliveEntity(v.DBlockLayerKind.Unit);if(o)if(S.SActionHitTest.testProjectle(s.entity(),e,o,this.hitType(),t.random())){if(this._effectSet)throw new Error("Not implemented.");t.postEmitEffect(e,n.MRBasics.actions.collide,s.entity(),o,this.blowDirection)}else;t.post(e,e,s,void 0,p.onMoveAsProjectile)}endMoving(t,e){this.clearKnockback();e.data.volatilityProjectile||this._penetration?t.postDestroy(e):(e.removeState(y.MRData.getState("kState_System_Projectile").id),m.UAction.postFall(t,e))}};R=r=s([a.MRSerializable],R),e.LProjectileBehavior=R},5045:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LEaterBehavior=void 0;const a=i(4836),n=i(1325),o=i(7534),c=i(7352),l=i(1298);let h=r=class extends o.LBehavior{clone(t){return c.MRLively.world.spawn(r)}onQueryActions(t){return t.push(a.MRBasics.actions.EatActionId),t}onActivity(t,e,i){return n.SCommandResponse.Pass}};h=r=s([l.MRSerializable],h),e.LEaterBehavior=h},8665:function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),s=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),s(i(7534),e)},2971:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LDebugMoveRightBehavior=void 0;const a=i(7352),n=i(7534),o=i(1325),c=i(6229),l=i(4621),h=i(2593),u=i(1298);let d=r=class extends n.LBehavior{clone(t){return a.MRLively.world.spawn(r)}onDecisionPhase(t,e,i){if(i==n.DecisionPhase.AIMinor){let i=6;return 0!=i&&a.MRLively.map.checkPassage(t,i,c.MovingMethod.Walk)&&(e.postActivity(l.LActivity.makeDirectionChange(t,i)),e.postActivity(l.LActivity.makeMoveToAdjacent(t,i))),e.postConsumeActionToken(t,h.LActionTokenConsumeType.MinorActed),o.SPhaseResult.Handled}return super.onDecisionPhase(t,e,i)}};d=r=s([u.MRSerializable],d),e.LDebugMoveRightBehavior=d},7036:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LGenericRMMZStateBehavior=void 0;const a=i(1325),n=i(7534),o=i(3806),c=i(6189),l=i(1298),h=i(7352),u=i(7955),d=i(6501),p=i(4836),f=i(6316),m=i(5727),y=i(3482),_=i(9185);let g=r=class extends n.LBehavior{constructor(){super(),this._stateTurn=0}clone(t){const e=h.MRLively.world.spawn(r);return e._stateTurn=this._stateTurn,e}isStateExpired(){return null!==this._stateTurn&&this._stateTurn<=0}resetStateCounts(){const t=this.stateEffect();this._stateTurn=null;const e=t.autoRemovals.find((t=>t.kind==c.DAutoRemovalTiming.TurnEnd));if(e&&e.kind===c.DAutoRemovalTiming.TurnEnd)if(e.minTurns==e.maxTurns)this._stateTurn=e.maxTurns;else{const t=1+Math.max(e.maxTurns-e.minTurns,0);this._stateTurn=e.minTurns+h.MRLively.world.random().nextIntWithMax(t)}}updateStateTurns(){this._stateTurn&&this._stateTurn>0&&this._stateTurn--}removeStatesAuto(){var t;this.isStateExpired()&&(null===(t=this.parentAs(o.LState))||void 0===t||t.removeThisState())}state(){const t=this.parentAs(o.LState);return(0,l.assert)(t),t}stateData(){const t=this.parentAs(o.LState);return(0,l.assert)(t),t.stateData()}stateEffect(){const t=this.parentAs(o.LState);return(0,l.assert)(t),t.stateEffect()}onAttached(t){this.resetStateCounts();const e=this.stateEffect();e.restriction==c.DStateRestriction.AttackToOther?this._characterAI=new u.LConfusionAI(u.LConfusionAIRestriction.AttackToOther):e.restriction==c.DStateRestriction.Blind&&(this._characterAI=new m.LBlindAI)}onDetached(t){}onQueryIdleSequelId(){return this.stateData().idleSequel}onDecisionPhase(t,e,i){if(this._characterAI){if(i==n.DecisionPhase.AIMinor)return this._characterAI.thinkMoving(e,t);if(i==n.DecisionPhase.AIMajor)return this._characterAI.thinkAction(e,t)}if(i==n.DecisionPhase.UpdateState)return this.updateStateTurns(),this.removeStatesAuto(),a.SPhaseResult.Pass;if(i==n.DecisionPhase.Manual||i==n.DecisionPhase.AIMinor||i==n.DecisionPhase.AIMajor){const t=this.stateEffect();return t.restriction==c.DStateRestriction.None?a.SPhaseResult.Pass:t.restriction==c.DStateRestriction.NotAction?a.SPhaseResult.Handled:a.SPhaseResult.Pass}return a.SPhaseResult.Pass}onActivity(t,e,i){const r=[];if(this.state().collectTraits(t,r),r.find((t=>t.code==p.MRBasics.traits.SealActivity&&t.dataId==i.activity().actionId()))){const i=this.stateData(),r=y.UName.makeUnitName(t);return e.postMessage(i.message3.format(r)),a.SCommandResponse.Canceled}return a.SCommandResponse.Pass}onPreprocessActivity(t,e){if(this.stateEffect().restriction==c.DStateRestriction.AttackToOther){const i=e.actor().findEntityBehavior(d.LUnitBehavior);if(i&&i.manualMovement()){if(e.actionId()==p.MRBasics.actions.MoveToAdjacentActionId){const i=t.random().select(f.UMovement.directions);return e.withEffectDirection(i).withEntityDirection(i),e}if(e.actionId()==p.MRBasics.actions.performSkill&&e.skillId()==_.MRData.system.skills.normalAttack){const i=t.random().select(f.UMovement.directions);return e.withEntityDirection(i),e}}}return e}};g=r=s([l.MRSerializable],g),e.LGenericRMMZStateBehavior=g},3336:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LIllusionStateBehavior=void 0;const a=i(1325),n=i(7534),o=i(7352),c=i(1451),l=i(1298);let h=r=class extends n.LBehavior{constructor(){super(),this._characterAI=new c.LEscapeAI}clone(t){const e=o.MRLively.world.spawn(r);return e._characterAI=this._characterAI.clone(),e}onDecisionPhase(t,e,i){if(this._characterAI){if(i==n.DecisionPhase.AIMinor)return this._characterAI.thinkMoving(e,t);if(i==n.DecisionPhase.AIMajor)return this._characterAI.thinkAction(e,t)}return a.SPhaseResult.Pass}};h=r=s([l.MRSerializable],h),e.LIllusionStateBehavior=h},1924:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LItemStandingBehavior=void 0;const a=i(7534),n=i(7352),o=i(1298),c=i(5967);let l=r=class extends a.LBehavior{clone(t){return n.MRLively.world.spawn(r)}queryHomeLayer(){return c.DBlockLayerKind.Unit}};l=r=s([o.MRSerializable],l),e.LItemStandingBehavior=l},3585:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LNapStateBehavior=void 0;const a=i(4836),n=i(8254),o=i(1325),c=i(7534),l=i(7352),h=i(3806),u=i(5557),d=i(1298),p=i(6316);var f;!function(t){t[t.None=0]="None",t[t.Random=1]="Random",t[t.Certainly=2]="Certainly"}(f||(f={}));let m=r=class extends c.LBehavior{constructor(){super(...arguments),this._getUpReserved=f.None}clone(t){const e=l.MRLively.world.spawn(r);return e._getUpReserved=this._getUpReserved,e}onAttached(t){l.MRLively.eventServer.subscribe(a.MRBasics.events.roomEnterd,this),l.MRLively.eventServer.subscribe(a.MRBasics.events.walked,this),l.MRLively.eventServer.subscribe(a.MRBasics.events.skillEmitted,this)}onDetached(t){l.MRLively.eventServer.unsubscribe(a.MRBasics.events.roomEnterd,this),l.MRLively.eventServer.unsubscribe(a.MRBasics.events.walked,this),l.MRLively.eventServer.unsubscribe(a.MRBasics.events.skillEmitted,this)}onEvent(t,e,i){const r=this.ownerEntity();if(e==a.MRBasics.events.roomEnterd){const t=i;l.MRLively.map.block(r.mx,r.my)._roomId==t.newRoomId&&this.attemptReserveGetUp(r,t.entity)}else if(e==a.MRBasics.events.walked){const t=i;p.UMovement.checkAdjacentEntities(r,t.walker)&&this.attemptReserveGetUp(r,t.walker)}else if(e==a.MRBasics.events.skillEmitted){const t=i;l.MRLively.map.block(r.mx,r.my)._roomId==t.performer.roomId()&&this.attemptReserveGetUp(r,t.performer)}return u.LEventResult.Pass}attemptReserveGetUp(t,e){if(this._getUpReserved==f.Certainly)return;const i=e.allTraits();i.find((t=>t.code==a.MRBasics.traits.SilentStep))||n.Helpers.isHostile(e,t)&&(i.find((t=>t.code==a.MRBasics.traits.AwakeStep))?this._getUpReserved=f.Certainly:this._getUpReserved=f.Random)}onQueryIdleSequelId(){return a.MRBasics.sequels.asleep}onDecisionPhase(t,e,i){var r,s;if(i==c.DecisionPhase.ResolveAdjacentAndMovingTarget){if(this._getUpReserved==f.Certainly)null===(r=this.parentAs(h.LState))||void 0===r||r.removeThisState();else if(this._getUpReserved==f.Random){e.random().nextIntWithMax(100)<50&&(null===(s=this.parentAs(h.LState))||void 0===s||s.removeThisState())}return this._getUpReserved=f.None,o.SPhaseResult.Pass}return o.SPhaseResult.Pass}};m=r=s([d.MRSerializable],m),e.LNapStateBehavior=m},3806:function(t,e,i){"use strict";var r,s=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LState=void 0;const a=i(1298),n=i(6189),o=i(9185),c=i(1325),l=i(4977),h=i(7352),u=i(4685),d=i(4836);let p=r=class extends l.LObject{constructor(){super(l.LObjectType.State),this._stateId=0,this._submatchEffectIndex=-1,this._stateBehabiors=[],this._level=0,h.MRLively.world._registerObject(this)}clone(t){const e=new r;e._stateId=this._stateId,e._level=this._level;for(const i of this.stateBehabiors()){const r=i.clone(t);e._stateBehabiors.push(r.id()),r.setParent(e)}return e}setup(t){(0,a.assert)(t>0),this._stateId=t}id(){return this.__objectId()}stateDataId(){return this._stateId}stateData(){return o.MRData.states[this._stateId]}get isDeathState(){const t=this.stateData();return t.id==d.MRBasics.states.dead||t.deadState}stateEffect(){const t=this.stateData();return this._submatchEffectIndex>=0?o.MRData.states[t.submatchStates[this._submatchEffectIndex]].effect:t.effect}submatchEffectIndex(){return this._submatchEffectIndex}stateBehabiors(){return this._stateBehabiors.map((t=>h.MRLively.world.behavior(t)))}behaviorIds(){return this._stateBehabiors}level(){return this._level}setLevel(t){this._level=t}removeAllBehaviors(){const t=this.parentObject();this.stateBehabiors().forEach((e=>{e.clearParent(),e.onDetached(t),e.destroy()})),this._stateBehabiors=[]}recast(){}onAttached(t){for(const e of this.stateBehabiors())e.onAttached(t)}onDetached(t){for(const e of this.stateBehabiors())e.onDetached(t)}removeThisState(){const t=this.parentAs(u.LEntity);t&&t.removeState(this._stateId)}collectTraits(t,e){this.stateEffect().traits.forEach((t=>e.push(t))),this.iterateBehaviors((i=>(i.onCollectTraits(t,e),!0)))}iterateBehaviors(t){for(const e of this._stateBehabiors)if(!1===t(h.MRLively.world.behavior(e)))return!1;return!0}_callStateIterationHelper(t){let e=c.SCommandResponse.Pass;for(let i=this._stateBehabiors.length-1;i>=0;i--){const r=t(h.MRLively.world.behavior(this._stateBehabiors[i]));if(r!=c.SCommandResponse.Pass&&(e=r),(0,c.checkContinuousResponse)(r))break}return e}checkRemoveAtDamageTesting(t){for(const e of this.stateEffect().autoRemovals)if(e.kind==n.DAutoRemovalTiming.DamageTesting&&e.paramId==t)return!0;return!1}};p=r=s([a.MRSerializable],p),e.LState=p},7991:function(t,e,i){"use strict";var r=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LItemShopStructure=e.LShopEntrance=void 0;const s=i(7352),a=i(7569),n=i(9543),o=i(1298),c=i(6316),l=i(9185);let h=class{constructor(t){this._homeX=0,this._homeY=0,this._gateX=0,this._gateY=0,this._index=t}setup(t,e,i,r){(0,o.assert)(1==c.UMovement.blockDistance(t,e,i,r)),this._homeX=t,this._homeY=e,this._gateX=i,this._gateY=r}index(){return this._index}homeX(){return this._homeX}homeY(){return this._homeY}gateX(){return this._gateX}gateY(){return this._gateY}};h=r([o.MRSerializable],h),e.LShopEntrance=h;let u=class extends a.LStructure{constructor(){super(...arguments),this._roomId=0,this._itemShopTypeId=0,this._sellngItems=[],this._gates=[]}setup(t,e){this._roomId=t,this._itemShopTypeId=e}roomId(){return this._roomId}itemShopTypeId(){return this._itemShopTypeId}clientFaction(){return l.MRData.system.factions.player}addShopEntrance(t,e,i,r){const s=new h(this._gates.length);return s.setup(t,e,i,r),this._gates.push(s),s}shopEntrance(t){return this._gates[t]}getLossItems(){const t=[],e=s.MRLively.map.room(this._roomId);for(const i of this._sellngItems){const r=s.MRLively.world.entity(i);if(r.floorId.equals(s.MRLively.map.floorId())&&e.contains(r.mx,r.my)){const t=s.MRLively.map.block(r.mx,r.my);(0,o.assert)(t.containsEntity(r))}else t.push(r)}return t}setInitialItems(t){for(const e of t){const t=e.getEntityBehavior(n.LItemBehavior);(0,o.assert)(0==t.shopStructureId()),t.setShopStructureId(this.id()),this._sellngItems.push(e.entityId())}}getBillingPrice(){return this.getLossItems().reduce(((t,e)=>t+e.queryPrice().sellingPrice),0)}getDepositPriece(){return 0}commitBilling(){const t=this.getLossItems();for(const e of t)this._sellngItems.mutableRemove((t=>t.equals(e.entityId()))),e.getEntityBehavior(n.LItemBehavior).setShopStructureId(0)}checkBilling(){return this.getLossItems().length>0}updateSecuritySystemState(){}onEntityLocated(t,e){s.MRLively.map.block(e.mx,e.my)._roomId,this._roomId}};u=r([o.MRSerializable],u),e.LItemShopStructure=u},4325:function(t,e,i){"use strict";var r=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LMonsterHouseStructure=void 0;const s=i(1298),a=i(9185),n=i(8254),o=i(1893),c=i(7352),l=i(7569),h=i(9019),u=i(4836);let d=class extends l.LStructure{constructor(){super(...arguments),this._roomId=0,this._monsterHouseTypeId=0,this._monsterHouseFactionId=0,this._monsterHouseState=o.MonsterHouseState.Sleeping}setup(t,e){this._roomId=t,this._monsterHouseTypeId=e,this._monsterHouseFactionId=a.MRData.system.factions.enemy,this._monsterHouseState=o.MonsterHouseState.Sleeping}roomId(){return this._roomId}get room(){return c.MRLively.map.room(this._roomId)}monsterHouseTypeId(){return this._monsterHouseTypeId}monsterHouseData(){return a.MRData.monsterHouses[this._monsterHouseTypeId]}monsterHouseFactionId(){return this._monsterHouseFactionId}monsterHouseState(){return this._monsterHouseState}startMonsterHouse(t){(0,s.assert)(this._monsterHouseTypeId>0),(0,s.assert)(this._monsterHouseState==o.MonsterHouseState.Sleeping),t.postWaitSequel(),t.postMessage((0,s.tr2)("モンスターハウスだ！")),h.SSoundManager.playBgm(this.monsterHouseData().bgm),this._monsterHouseState=o.MonsterHouseState.Activated,this.room.forEachEntities((t=>{t.removeState(u.MRBasics.states.monsterHouseSleepStateId)}))}onEntityLocated(t,e){c.MRLively.map.block(e.mx,e.my)._roomId==this._roomId&&n.Helpers.isHostileFactionId(this.monsterHouseFactionId(),e.getOutwardFactionId())&&this.monsterHouseState()==o.MonsterHouseState.Sleeping&&this.startMonsterHouse(t)}};d=r([s.MRSerializable],d),e.LMonsterHouseStructure=d},7569:function(t,e,i){"use strict";var r=this&&this.__decorate||function(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(e,"__esModule",{value:!0}),e.LStructure=void 0;const s=i(1298);let a=class{constructor(t){this._id=t}id(){return this._id}onEntityLocated(t,e){}};a=r([s.MRSerializable],a),e.LStructure=a},2404:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.linear=void 0,e.linear=function(t,e,i,r){return i*(t/r)+e}},9708:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SimplexNoise=e.PerlinNoise=void 0;class i{constructor(t,e,i){this.x=t,this.y=e,this.z=i}dot2(t,e){return this.x*t+this.y*e}}const r=[new i(1,1,0),new i(-1,1,0),new i(1,-1,0),new i(-1,-1,0),new i(1,0,1),new i(-1,0,1),new i(1,0,-1),new i(-1,0,-1),new i(0,1,1),new i(0,-1,1),new i(0,1,-1),new i(0,-1,-1)],s=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],a=.5*(Math.sqrt(3)-1),n=(3-Math.sqrt(3))/6;e.PerlinNoise=class{constructor(t){t=null!=t?t:Math.random(),(t=Math.floor(t))<256&&(t|=t<<8),t>65535&&(t%=65535),console.log("seed",t),this.perm=new Array(512),this.gradP=new Array(512);for(let e=0;e<256;e++){let i;i=1&e?s[e]^255&t:s[e]^t>>8&255,this.perm[e]=this.perm[e+256]=i,this.gradP[e]=this.gradP[e+256]=r[i%12]}}noise2D(t,e){var i=Math.floor(t),r=Math.floor(e);t-=i,e-=r,i&=255,r&=255;var s=this.gradP[i+this.perm[r]].dot2(t,e),a=this.gradP[i+this.perm[r+1]].dot2(t,e-1),n=this.gradP[i+1+this.perm[r]].dot2(t-1,e),o=this.gradP[i+1+this.perm[r+1]].dot2(t-1,e-1),c=this.fade(t);return this.lerp(this.lerp(s,n,c),this.lerp(a,o,c),this.fade(e))}fade(t){return t*t*t*(t*(6*t-15)+10)}lerp(t,e,i){return(1-i)*t+i*e}};e.SimplexNoise=class{constructor(t){t=null!=t?t:Math.random(),(t=Math.floor(t))<256&&(t|=t<<8),t>65535&&(t%=65535),this.perm=new Array(512),this.gradP=new Array(512);for(let e=0;e<256;e++){let i;i=1&e?s[e]^255&t:s[e]^t>>8&255,this.perm[e]=this.perm[e+256]=i,this.gradP[e]=this.gradP[e+256]=r[i%12]}}noise2D(t,e){var i,r,s=(t+e)*a,o=Math.floor(t+s),c=Math.floor(e+s),l=(o+c)*n,h=t-o+l,u=e-c+l;h>u?(i=1,r=0):(i=0,r=1);var d=h-i+n,p=u-r+n,f=h-1+2*n,m=u-1+2*n;o&=255,c&=255;var y=this.gradP[o+this.perm[c]],_=this.gradP[o+i+this.perm[c+r]],g=this.gradP[o+1+this.perm[c+1]],v=.5-h*h-u*u,S=.5-d*d-p*p,M=.5-f*f-m*m;return 70*((v<0?0:(v*=v)*v*y.dot2(h,u))+(S<0?0:(S*=S)*S*_.dot2(d,p))+(M<0?0:(M*=M)*M*g.dot2(f,m)))}}},8245:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Vector2=void 0;class i{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}static clone(t){return new i(t.x,t.y)}static add(t,e){return"number"==typeof e?new i(t.x+e,t.y+e):new i(t.x+e.x,t.y+e.y)}static sub(t,e){return"number"==typeof e?new i(t.x-e,t.y-e):new i(t.x-e.x,t.y-e.y)}static mul(t,e){return"number"==typeof e?new i(t.x*e,t.y*e):new i(t.x*e.x,t.y*e.y)}static div(t,e){return"number"==typeof e?new i(t.x/e,t.y/e):new i(t.x/e.x,t.y/e.y)}static sign(t){return new i(t.x<0?-1:t.x>0?1:0,t.y<0?-1:t.y>0?1:0)}}e.Vector2=i},1639:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(7295),s=i(2213),a=DataManager.createGameObjects;DataManager.createGameObjects=function(){a.call(this),r.SGameManager.createGameObjects()};const n=DataManager.setupNewGame;DataManager.setupNewGame=function(){n.call(this),r.SGameManager.setupNewGame()};const o=DataManager.makeSaveContents;DataManager.makeSaveContents=function(){const t=o.call(this);return t.re=r.SGameManager.makeSaveContents(),t};const c=DataManager.extractSaveContents;DataManager.extractSaveContents=function(t){c.call(this,t),r.SGameManager.loadGame(t.re,!0)},DataManager.extractMetadata=function(t){s.DHelpers.extractMetadata(t)};const l=DataManager.saveGame;DataManager.saveGame=function(t){return l.call(this,t)};const h=DataManager.loadGame;DataManager.loadGame=function(t){return h.call(this,t)};const u=DataManager.onLoad;DataManager.onLoad=function(t){u.call(this,t)}},4794:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FloorRestartSequence=void 0;const r=i(7352),s=i(9115);var a;!function(t){t[t.Idle=0]="Idle",t[t.FadeOut=1]="FadeOut",t[t.Loading=2]="Loading",t[t.FadeIn=3]="FadeIn"}(a||(a={}));class n{static isProcessing(){return this._step!=a.Idle||s.MRSystem.requestedRestartFloorItem.hasAny()}static update(t){switch(this._step){case a.Idle:s.MRSystem.requestedRestartFloorItem.hasAny()&&(t.fadeOutAll(),this._step=a.FadeOut,console.log("to FadeOut"));break;case a.FadeOut:if(console.log("FadeOut"),!t.isFading()){console.log("if FadeOut");const e=0;DataManager.loadGame(e).then((()=>this.onLoadSuccess(t))).catch((()=>this.onLoadFailure(t))),this._step=a.Loading}break;case a.Loading:break;case a.FadeIn:t.isFading()||(this._step=a.Idle);break;default:throw new Error("Unreachable.")}}static onLoadSuccess(t){SceneManager.goto(Scene_Map),this._step=a.FadeIn;const e=r.MRLively.world.entity(s.MRSystem.requestedRestartFloorItem);e.removeFromParent(),e.destroy(),s.MRSystem.requestedRestartFloorItem.clear()}static onLoadFailure(t){throw new Error("onLoadFailure")}}e.FloorRestartSequence=n,n._step=a.Idle},7515:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(7352),s=i(1298),a=Game_CharacterBase.prototype.initMembers;Game_CharacterBase.prototype.initMembers=function(){a.call(this)},Game_CharacterBase.prototype.isREEvent=function(){return!1},Game_CharacterBase.prototype.isREPrefab=function(){return!1},Game_CharacterBase.prototype.isRESpritePrepared=function(){return!1},Game_CharacterBase.prototype.isREExtinct=function(){return!1},Game_CharacterBase.prototype.increaseRERevision=function(){this._reRevision||(this._reRevision=0),this._reRevision++},Game_CharacterBase.prototype.reRevision=function(){return this._reRevision?this._reRevision:0};const n=Game_CharacterBase.prototype.updatePattern;Game_CharacterBase.prototype.updatePattern=function(){r.MRLively.map.floorId().isTacticsMap()||n.call(this)};const o=Game_CharacterBase.prototype.updateAnimation;Game_CharacterBase.prototype.updateAnimation=function(){r.MRLively.map.floorId().isTacticsMap()||o.call(this)},Game_CharacterBase.prototype.popupDamage_RE=function(t,e){this._popupDamages_RE||(this._popupDamages_RE=[]),this._popupDamages_RE.push({value:t,color:e})},Game_CharacterBase.prototype.isDamagePopupRequested_RE=function(){return void 0!==this._popupDamages_RE&&this._popupDamages_RE.length>0},Game_CharacterBase.prototype.clearDamagePopup_RE=function(){this._popupDamages_RE=void 0},Game_CharacterBase.prototype.shiftDamageInfo_RE=function(){(0,s.assert)(this._popupDamages_RE);const t=this._popupDamages_RE.shift();return(0,s.assert)(t),t}},3395:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(7352),s=i(9868),a=i(1298),n=i(927),o=i(3758),c=i(8855),l={id:0,name:"",note:"",pages:[],x:0,y:0};var h=Game_Event.prototype.initMembers;Game_Event.prototype.initMembers=function(){h.call(this),this._prefabId_RE=0,this._spritePrepared_RE=!1,this._pageData_RE=[]};var u=Game_Event.prototype.event;Game_Event.prototype.event=function(){return this.isREEvent()||this._mapId==o.MRDataManager.databaseMapId?this._eventData_RE?this._eventData_RE:l:u.call(this)};Game_Event.prototype.isTriggerIn;Game_Event.prototype.isTriggerIn=function(t){return!this.isREEntity()&&t.includes(this._trigger)};var d=Game_Event.prototype.setupPageSettings;Game_Event.prototype.setupPageSettings=function(){d.call(this),this._isREEntity=!!s.SRmmzHelpers.readEntityMetadata(this,this._mapId),this._reEventData=this._pageIndex>=0?n.DAnnotationReader.readREEventMetadataFromPage(this.page()):void 0};var p=Game_Event.prototype.meetsConditions;Game_Event.prototype.meetsConditions=function(t){if(!p.call(this,t))return!1;const e=this.event().pages.findIndex((e=>e==t));(0,a.assert)(e>=0);const i=this._pageData_RE[e];if(i&&i.condition_state){if(!c.MRView.entityVisualSet)return!1;{const t=c.MRView.entityVisualSet.findEntityVisualByRMMZEventId(this.eventId());if(!t)return!1;{const e=i.condition_state;if(!t.entity()._states.find((t=>r.MRLively.world.object(t).stateData().key==e)))return!1}}}return!0};const f=Game_Event.prototype.update;Game_Event.prototype.update=function(){f.call(this)},Game_Event.prototype.setupPrefab=function(t,e,i){this._mapId=e,this._prefabId_RE=t.id,this._eventData_RE=i,this._pageData_RE=[];for(let t=0;t<this._eventData_RE.pages.length;t++){const e=n.DAnnotationReader.readREEventMetadataFromPage(this._eventData_RE.pages[t]);e&&(this._pageData_RE[t]=e)}this.refresh()},Game_Event.prototype.resetPrefab=function(t){this._pageIndex=-2,this.setupPrefab(t,t.rmmzMapId,t.rmmzEventData)},Game_Event.prototype.isREEntity=function(){return this._isREEntity},Game_Event.prototype.isREEvent=function(){return this._prefabId_RE>0},Game_Event.prototype.isREPrefab=function(){return this._prefabId_RE>0},Game_Event.prototype.isREExtinct=function(){return this._erased},Game_Event.prototype.isRESpritePrepared=function(){return this._spritePrepared_RE},Game_Event.prototype.setSpritePrepared=function(t){this._spritePrepared_RE=!0}},6996:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(3721),s=i(6291),a=i(9185),n=i(4797),o=i(9248),c=i(7352),l=i(9154),h=i(9115),u=Game_Interpreter.prototype.setup;Game_Interpreter.prototype.setup=function(t,e){u.call(this,t,e),0!=this._eventId&&(c.MRLively.system.eventInterpreterContextKey=void 0)};const d=Game_Interpreter.prototype.updateWaitMode;Game_Interpreter.prototype.updateWaitMode=function(){return"REResultWinodw"==this._waitMode?c.MRLively.challengeResultShowing:"MR-Dialog"==this._waitMode?h.MRSystem.dialogContext._hasDialogModel()||h.MRSystem.commandContext.checkOpenDialogRequired():d.call(this)};const p=Game_Interpreter.prototype.command111;Game_Interpreter.prototype.command111=function(t){let e=!1;const i=c.MRLively.system.getEventCommandTarget();if(i){let r=!1;switch(t[0]){case 7:{const s=i.findEntityBehavior(o.LInventoryBehavior);if(s)switch(t[2]){case 0:r=s.gold()>=t[1];break;case 1:r=s.gold()<=t[1];break;case 2:r=s.gold()<t[1]}e=!0;break}case 8:{const s=i.findEntityBehavior(o.LInventoryBehavior);if(s){const e=a.MRData.itemData(t[1]).entityId;r=!!s.items.find((t=>t.dataId==e))}e=!0;break}}if(e)return this._branch[this._indent]=r,!1===this._branch[this._indent]&&this.skipBranch(),!0}return p.call(this,t)};const f=Game_Interpreter.prototype.command201;Game_Interpreter.prototype.command201=function(t){return!!f.call(this,t)&&(r.UTransfer.transterRmmzDirectly($gamePlayer._newMapId,$gamePlayer._newX,$gamePlayer._newY),!0)};const m=Game_Interpreter.prototype.command129;Game_Interpreter.prototype.command129=function(t){const e=m.call(this,t),i=$gameParty.members()[0].actorId();return c.MRLively.camera.focus(c.MRLively.world.getEntityByRmmzActorId(i)),e};const y=Game_Interpreter.prototype.command125;Game_Interpreter.prototype.command125=function(t){var e;const i=c.MRLively.system.getEventCommandTarget();if(!i)return y.call(this,t);{const r=this.operateValue(t[0],t[1],t[2]);null===(e=i.findEntityBehavior(o.LInventoryBehavior))||void 0===e||e.gainGold(r)}return!0};const _=Game_Interpreter.prototype.command126;Game_Interpreter.prototype.command126=function(t){const e=c.MRLively.system.getEventCommandTarget();if(e){const i=a.MRData.itemData(t[0]);return R(this,e,t[1],t[2],t[3],i.entityId),!0}return _.call(this,t)};const g=Game_Interpreter.prototype.command127;Game_Interpreter.prototype.command127=function(t){const e=c.MRLively.system.getEventCommandTarget();if(e){const i=a.MRData.getItemFromRmmzWeaponId(t[0]);return R(this,e,t[1],t[2],t[3],i.id),!0}return g.call(this,t)};const v=Game_Interpreter.prototype.command128;Game_Interpreter.prototype.command128=function(t){const e=c.MRLively.system.getEventCommandTarget();if(e){const i=a.MRData.getItemFromRmmzArmorId(t[0]);return R(this,e,t[1],t[2],t[3],i.id),!0}return v.call(this,t)};const S=Game_Interpreter.prototype.command316;Game_Interpreter.prototype.command316=function(t){var e;if(c.MRLively.system.getEventCommandTarget()){if(0===t[1]){const i=c.MRLively.system.getEventCommandTarget();if(i){const r=this.operateValue(t[2],t[3],t[4]);null===(e=i.findEntityBehavior(n.LExperienceBehavior))||void 0===e||e.setLevel(i,r)}}return!0}return S.call(this,t)};const M=Game_Interpreter.prototype.command314;function R(t,e,i,r,a,n){const c=e.findEntityBehavior(o.LInventoryBehavior);if(c){const e=Math.min(t.operateValue(i,r,a),c.remaining);for(let t=0;t<e;t++){const t=l.SEntityFactory.newEntity(s.DEntityCreateInfo.makeSingle(n));c.addEntity(t)}}}Game_Interpreter.prototype.command314=function(t){if(c.MRLively.system.getEventCommandTarget()){if(0===t[1]){const t=c.MRLively.system.getEventCommandTarget();t&&t.recoverAll()}return!0}return M.call(this,t)}},4246:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(9115),s=i(9901),a=i(1298),n=i(3758),o=i(7352),c=i(7295),l=i(6134);Game_Map.prototype.unlinkREEvents=function(){for(const t of this.events())t.isREEvent()&&($dataMap.events[t.eventId()]=null)};const h=Game_Map.prototype.setup;Game_Map.prototype.setup=function(t){o.MRLively.map.releaseMap(),o.MRLively.messageHistory.clear(),h.call(this,t),o.MRLively.camera.isFloorTransfering()&&o.MRLively.camera.transferingNewFloorId().isTacticsMap()&&(n.MRDataManager.isLandMap(t)&&this.events().forEach((t=>t.setTransparent(!0))),$gamePlayer.hideFollowers()),c.SGameManager.performFloorTransfer(),o.MRLively.recorder.startRecording(),l.RMMZHelper.triggerOnStartEvent(),r.MRSystem.mapManager.attemptRefreshVisual(),a.Log.d("RMMZ map setup finished.")};const u=Game_Map.prototype.tileset;Game_Map.prototype.tileset=function(){const t=s.SView.getTilemapView();return t.tilesetId?$dataTilesets[t.tilesetId]:u.call(this)};const d=Game_Map.prototype.update;Game_Map.prototype.update=function(t){d.call(this,t),o.MRLively.map.lastKeeperCount!=o.MRLively.map.keeperCount&&0==o.MRLively.map.keeperCount&&l.RMMZHelper.triggerOnKeeperLostEvent(),o.MRLively.map.lastKeeperCount=o.MRLively.map.keeperCount};const p=Game_Map.prototype.autoplay;Game_Map.prototype.autoplay=function(){const t=o.MRLively.map.floorId();if(t.isDungeonMap()){const e=t.floorInfo();if(""!=e.bgmName)return void AudioManager.playBgm({name:e.bgmName,pan:0,pitch:e.bgmPitch,volume:e.bgmVolume},0)}p.call(this)}},6753:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(7352),s=Game_Message.prototype.isBusy;Game_Message.prototype.isBusy=function(){return s.call(this)||r.MRLively.challengeResultShowing}},9124:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(7352),s=i(8855),a=i(6134),n=Game_Player.prototype.initMembers;Game_Player.prototype.initMembers=function(){n.call(this)};const o=Game_Player.prototype.isTransparent;Game_Player.prototype.isTransparent=function(){return!!r.MRLively.map.floorId().isTacticsMap()||o.call(this)};const c=Game_Player.prototype.canMove;Game_Player.prototype.canMove=function(){var t;return!r.MRLively.map.floorId().isTacticsMap()&&(!!(null===(t=s.MRView.dialogManager)||void 0===t?void 0:t.dialogNavigator.isEmpty)&&c.call(this))};const l=Game_Player.prototype.refresh;Game_Player.prototype.refresh=function(){if(l.call(this),a.RMMZHelper.isRESystemMap()){const t=r.MRLively.camera.focusedEntity();t&&$gamePlayer.locate(t.mx,t.my)}};const h=Game_Player.prototype.update;Game_Player.prototype.update=function(t){h.call(this,t)}},169:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(2205),s=i(1298);JsonEx._decode;JsonEx._decode=function(t){const e=Object.prototype.toString.call(t);if("[object Object]"===e||"[object Array]"===e){if(t["@"]){const e=window[t["@"]];if(e)Object.setPrototypeOf(t,e.prototype);else{const e=function(t){if(t.endsWith("Behavior")){const e=r.SBehaviorFactory.createBehaviorInstance(t);if(e)return e}return s.TypeStore.createInstance(t)}(t["@"]);Object.assign(e,t),t=e}}for(const e of Object.keys(t))t[e]=this._decode(t[e])}return t}},664:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(1298),s=i(9185),a=i(4765),n=i(7352),o=i(9115),c=i(8855),l=i(3721),h=i(4836),u=i(4685),d=i(8771),p=i(1301),f=i(2345),m=i(687),y=i(685),_=i(6134),g=i(9248),v=i(2255),S="LN_MysteryRogueSystem";PluginManager.registerCommand(S,"RE.ShowChallengeResult",(t=>{n.MRLively.challengeResultShowing=!0,$gameMap._interpreter.setWaitMode("REResultWinodw")})),PluginManager.registerCommand(S,"MR-SetContext",(t=>{const e=t.key;n.MRLively.system.eventInterpreterContextKey=e&&"default"!=e?e:void 0})),PluginManager.registerCommand(S,"MR-ShowWarehouseStoreDialog",(t=>{const e=t.serviceProviderKey,i=t.serviceUserKey;if(c.MRView.sequelFactory){const t=n.MRLively.camera.getFocusedEntity();o.MRSystem.commandContext.openDialog(t,new d.SWarehouseStoreDialog(p.USearch.getEntityByKeyPattern(i),p.USearch.getEntityByKeyPattern(e)),!1).then((t=>{$gameVariables.setValue(h.MRBasics.variables.result,t.result)})),$gameMap._interpreter.setWaitMode("MR-Dialog")}})),PluginManager.registerCommand(S,"MR-ShowWarehouseWithdrawDialog",(t=>{const e=t.serviceProviderKey,i=t.serviceUserKey;if(c.MRView.sequelFactory){const t=n.MRLively.camera.getFocusedEntity();o.MRSystem.commandContext.openDialog(t,new f.SWarehouseWithdrawDialog(p.USearch.getEntityByKeyPattern(i),p.USearch.getEntityByKeyPattern(e)),!1).then((t=>{$gameVariables.setValue(h.MRBasics.variables.result,t.result)})),$gameMap._interpreter.setWaitMode("MR-Dialog")}})),PluginManager.registerCommand(S,"MR-ShowItemSellDialog",(t=>{const e=t.serviceProviderKey,i=t.serviceUserKey,r=t.inventoryOwnerKey;if(c.MRView.sequelFactory){const t=n.MRLively.camera.getFocusedEntity();o.MRSystem.commandContext.openDialog(t,new y.SItemSellDialog(p.USearch.getEntityByKeyPattern(e),p.USearch.getEntityByKeyPattern(i),p.USearch.getEntityByKeyPattern(r)),!1).then((t=>{$gameVariables.setValue(h.MRBasics.variables.result,t.resultItems.length)})),$gameMap._interpreter.setWaitMode("MR-Dialog")}})),PluginManager.registerCommand(S,"MR-ProceedFloorForward",(function(t){l.UTransfer.proceedFloorForwardForPlayer()})),PluginManager.registerCommand(S,"MR-ProceedFloorBackword",(function(t){const e=n.MRLively.camera.focusedEntity();if(e){const t=e.floorId,i=t.floorNumber()-1;if(i<=0){o.MRSystem.integration.onSetLandExitResult(s.LandExitResult.Escape);const e=t.landData().exitMapData.mapId;(0,r.assert)(e>0);const i=this.command201([0,e,0,0,2,0]);(0,r.assert)(i)}else{const r=a.LFloorId.make(t.landId(),v.DFloorClass.FloorMap,i);n.MRLively.world.transferEntity(e,r),this.setWaitMode("transfer")}}})),PluginManager.registerCommand(S,"MR-LivingResult-GetIncludesState",(function(t){const e=t.actorKey,i=t.stateKey;let r;if(e){const t=n.MRLively.world.objects().find((t=>t instanceof u.LEntity&&t.data.entity.key==e));t&&t instanceof u.LEntity&&(r=t)}else{const t=n.MRLively.camera.focusedEntity();t&&(r=t)}if(r){const t=s.MRData.getState(i).id,e=r._deathResult.states().includes(t);$gameVariables.setValue(h.MRBasics.variables.result,e?1:0)}else $gameVariables.setValue(h.MRBasics.variables.result,-1)})),PluginManager.registerCommand(S,"MR-StartChallenge",(function(t){const e=n.MRLively.system.getEventCommandTarget();if(e){const t=e.party();t&&t.startChallenging()}})),PluginManager.registerCommand(S,"MR-FinishChallenge",(function(t){const e=n.MRLively.system.getEventCommandTarget();if(e){const t=e.party();t&&t.finishChallenging()}})),PluginManager.registerCommand(S,"MR-SetProperty",(function(t){const e=t.entityKey,i=t.property,r=t.value;m.UProperty.setValue(e,i,m.UProperty.getValueByVariablePattern(r))})),PluginManager.registerCommand(S,"MR-GetProperty",(function(t){const e=t.entityKey,i=t.property,r=t.variable,s=p.USearch.getEntityByKeyPattern(e);_.RMMZHelper.setVariable(r,m.UProperty.getValueFromEntity(s,i))})),PluginManager.registerCommand(S,"MR-ResetStatus",(function(t){const e=t.entityKey;p.USearch.getEntityByKeyPattern(e).resetStatus()})),PluginManager.registerCommand(S,"MR-ResetInventory",(function(t){const e=t.entityKey,i=p.USearch.getEntityByKeyPattern(e).findEntityBehavior(g.LInventoryBehavior);i&&i.reset()}))},3243:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(1298),s=i(8855);Game_Map.prototype.spawnREEvent=function(t,e,i){if(!$dataMap.events)throw new Error;(0,r.assert)(t.id>0),(0,r.assert)(t.rmmzEventData.id>0);const s=null!=i?i:t.rmmzEventData;if(e){const i=$dataMap.events[e];(0,r.assert)(i);const s=this._events[e];return s.initMembers(),s.increaseRERevision(),s.setupPrefab(t,$gameMap.mapId(),i),s}let a=this._events.findIndex((t=>t&&t.isREEvent()&&t.isREExtinct()));if(a<0){a=this._events.length;const e=new Game_Event(t.rmmzMapId,a);return e.setupPrefab(t,t.rmmzMapId,s),this._events[a]=e,e}{const e=this._events[a];(0,r.assert)(e.isREEvent());const i=e.isRESpritePrepared();return e.initMembers(),e.increaseRERevision(),e.setupPrefab(t,t.rmmzMapId,s),e.setSpritePrepared(i),e}},Game_Map.prototype.getREPrefabEvents=function(){return this.events().filter((function(t){return t.isREPrefab()}))};var a=Spriteset_Map.prototype.createCharacters;Spriteset_Map.prototype.createCharacters=function(){this._prefabSpriteIdRE=this._counter+1,a.call(this);for(let t=0;t<this._characterSprites.length;t++){const e=this._characterSprites[t];e._character instanceof Game_Event&&(e._spriteIndex=t,e._character.isREEvent()&&e._character.setSpritePrepared(!0))}};var n=Spriteset_Map.prototype.update;Spriteset_Map.prototype.update=function(){this.updateREPrefabEvent(),n.call(this)},Spriteset_Map.prototype.updateREPrefabEvent=function(){if($gameMap.getREPrefabEvents().forEach((t=>{t.isRESpritePrepared()||this.makeREPrefabEventSprite(t)})),s.MRView.entityVisualSet)for(const t of s.MRView.entityVisualSet.entityVisuals())if(t.rmmzSpriteIndex()<0){const e=this._characterSprites.findIndex((e=>e._character instanceof Game_Event&&e._character.eventId()==t.rmmzEventId()));e<0&&(console.log(this._characterSprites),console.log("visual",t)),(0,r.assert)(e>=0),t._setSpriteIndex(e)}},Spriteset_Map.prototype.makeREPrefabEventSprite=function(t){(0,r.assert)(s.MRView.sequelFactory),t.setSpritePrepared(!0);var e=new Sprite_Character(t);const i=this._characterSprites.length;this._characterSprites.push(e),e._spriteIndex=i;this._tilemap.addChild(e)}},6134:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RMMZHelper=void 0;const r=i(3758),s=i(7352),a=i(8855);class n{static isRESystemMap(){return r.MRDataManager.isRESystemMap($gameMap.mapId())}static setRegionId(t,e,i){this.setRETileData(t,e,5,i)}static setRETileData(t,e,i,r){var s,a;if($dataMap.data){const n=null!==(s=$dataMap.width)&&void 0!==s?s:0,o=null!==(a=$dataMap.height)&&void 0!==a?a:0;$dataMap.data[(i*o+e)*n+t]=r}}static mapAutoTileId(t){const e=this._autoTileTable.findIndex((e=>e==t));return e>=0?e:0}static syncCameraPositionToGamePlayer(){if($gamePlayer.isTransferring())return;const t=s.MRLively.camera.focusedEntity();if(t&&a.MRView.entityVisualSet){const e=a.MRView.entityVisualSet.findEntityVisualByEntity(t);if(e){const t=e.position(),i=$gamePlayer.scrolledX(),r=$gamePlayer.scrolledY();$gamePlayer._realX=t.x,$gamePlayer._realY=t.y,$gamePlayer._x=Math.floor(t.x),$gamePlayer._y=Math.floor(t.y),$gamePlayer.updateScroll(i,r)}}}static triggerOnStartEvent(){for(const t of $gameMap.events())t._reEventData&&t._reEventData.trigger&&"onStart"==t._reEventData.trigger&&t.start()}static triggerOnKeeperLostEvent(){for(const t of $gameMap.events())t._reEventData&&t._reEventData.trigger&&"onKeeperLost"==t._reEventData.trigger&&t.start()}static setVariable(t,e){const i=parseInt(t);if(isNaN(i)){const i=$dataSystem.variables.findIndex((e=>e&&e==t));if(!(i>=0))throw new Error(`${t} not found.`);$gameVariables.setValue(i,e)}else $gameVariables.setValue(i,e)}}e.RMMZHelper=n,n._autoTileTable=[0,64,256,320,4,68,260,324,1,65,257,321,5,69,261,325,73,329,77,333,448,452,449,453,292,293,356,357,7,71,263,327,365,455,484]},2071:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RMMZIntegration=void 0;const r=i(1298),s=i(9185),a=i(3024),n=i(8855),o=i(9868),c=i(9600),l=i(5150),h=i(7352),u=i(4794),d=i(4836),p=i(985),f=i(913);class m extends a.SIntegration{onEventPublished(t,e,i){}onReserveTransferMap(t,e,i,r){$gamePlayer.reserveTransfer(t,e,i,r,0),$gamePlayer.requestMapReload(),s.MRData.maps[t].exitMap&&$gamePlayer.setTransparent(!0)}onEntityLocated(t){t.entityId().equals(h.MRLively.camera.focusedEntityId())&&(n.MRView._playerPosRefreshNeed=!0)}onLocateRmmzEvent(t,e,i){$gameMap.event(t).locate(0,0)}onLoadFixedMapData(t){o.SRmmzHelpers.buildFixedMapData(t)}onLoadFixedMapEvents(){h.MRLively.map.keeperCount=0,$gameMap.events().forEach((t=>{const e=o.SRmmzHelpers.readEntityMetadata(t,$gameMap.mapId());if(t&&e)if(e.troopId>0)l.SEntityFactory.spawnTroopAndMembers(s.MRData.troops[e.troopId],t.x,t.y,e.stateIds),t.setTransparent(!0);else{const i=o.SRmmzHelpers.createEntityFromRmmzEvent(e,t.eventId(),t.x,t.y);(0,r.assert)(i.data.prefabId>0),i.inhabitsCurrentFloor?i.rmmzEventId=t.eventId():t.setTransparent(!0),e.keeper&&(i.keeper=!0,h.MRLively.map.keeperCount++)}})),h.MRLively.map.lastKeeperCount=h.MRLively.map.keeperCount}onUpdateBlock(t){n.MRView.mapBuilder&&(n.MRView.mapBuilder.refreshBlock(t),n.MRView.spriteset&&n.MRView.spriteset._tilemap.refresh())}onRefreshGameMap(t){n.MRView.mapBuilder=new c.VMapEditor(t),n.MRView.mapBuilder.build()}onFlushEffectResult(t){var e;const i=null===(e=n.MRView.entityVisualSet)||void 0===e?void 0:e.findEntityVisualByEntity(t);i&&i.showEffectResult()}onFlushSequelSet(t){}onCheckVisualSequelRunning(){return!!u.FloorRestartSequence.isProcessing()||(!!SceneManager.isCurrentSceneBusy()||!!n.MRView.entityVisualSet&&n.MRView.entityVisualSet.visualRunning())}onOpenDialog(t){var e;null===(e=n.MRView.dialogManager)||void 0===e||e.openDialog(t)}onUpdateDialog(t){const e=n.MRView.dialogManager;e&&((0,r.assert)(!e.dialogNavigator.isEmpty),e.dialogNavigator.update(t))}onDialogClosed(t,e){const i=n.MRView.dialogManager;i&&i.dialogNavigator.closeDialog(t,e)}onEntityEnteredMap(t){n.MRView.entityVisualSet&&n.MRView.entityVisualSet.createVisual2(t)}onEntityLeavedMap(t){var e;null===(e=n.MRView.entityVisualSet)||void 0===e||e.reserveDeleteVisual(t),t.inhabitsCurrentFloor=!1,t.rmmzEventId=0,t.keeper&&(t.keeper=!1,h.MRLively.map.keeperCount--)}onEntityReEnterMap(t){}onSetLandExitResult(t){$gameVariables.setValue(d.MRBasics.variables.landExitResultDetail,t),$gameVariables.setValue(d.MRBasics.variables.landExitResult,Math.floor(t/100))}onEquipmentChanged(t){const e=t.findEntityBehavior(p.LActorBehavior),i=t.findEntityBehavior(f.LEquipmentUserBehavior);if(e&&i){const t=$gameActors.actor(e.rmmzActorId);(0,r.assert)(t);const s=i.equippedItemEntities();t._equips=[];for(let e=0;e<s.length;e++){const i=s[e].data.item();t._equips[e]=new Game_Item,i.rmmzWeaponId>0?t._equips[e].setEquip(!0,i.rmmzWeaponId):t._equips[e].setEquip(!1,i.rmmzArmorId)}t.refresh()}}}e.RMMZIntegration=m},6847:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(3758),s=i(2071),a=i(9115),n=i(8855),o=i(9185),c=Scene_Boot.prototype.isReady;Scene_Boot.prototype.isReady=function(){const t=c.call(this);return!!r.MRDataManager.isImportCompleted()&&(o.MRData.verify(),t)};const l=Scene_Boot.prototype.onDatabaseLoaded;Scene_Boot.prototype.onDatabaseLoaded=function(){l.call(this),r.MRDataManager.load(),n.MRView.initialize(),a.MRSystem.integration=new s.RMMZIntegration}},9613:()=>{"use strict";const t=Scene_Load.prototype.onLoadSuccess;Scene_Load.prototype.onLoadSuccess=function(){t.call(this)}},2508:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(1298),s=i(9115),a=i(5647),n=i(8855),o=i(7352),c=i(6134),l=i(6840),h=i(4794),u=Scene_Map.prototype.isReady;Scene_Map.prototype.isReady=function(){return u.call(this)};const d=Scene_Map.prototype.onMapLoaded;Scene_Map.prototype.onMapLoaded=function(){d.call(this)};const p=Scene_Map.prototype.onTransferEnd;Scene_Map.prototype.onTransferEnd=function(){var t;p.call(this),null===(t=n.MRView._messageWindowSet)||void 0===t||t.attemptStartDisplayFloorName()};const f=Scene_Map.prototype.create;Scene_Map.prototype.create=function(){f.call(this)};const m=Scene_Map.prototype.createDisplayObjects;Scene_Map.prototype.createDisplayObjects=function(){o.MRLively.map.floorId().isTacticsMap()&&s.MRSystem.mapManager.attemptRefreshVisual(),(0,r.assert)(!n.MRView.entityVisualSet),n.MRView.entityVisualSet=new a.VEntityManager,m.call(this),n.MRView.onSceneChanged(this)};const y=Scene_Map.prototype.start;Scene_Map.prototype.start=function(){y.call(this)};const _=Scene_Map.prototype.terminate;Scene_Map.prototype.terminate=function(){_.call(this),n.MRView.entityVisualSet&&(n.MRView.entityVisualSet.ternimate(),n.MRView.entityVisualSet=void 0),n.MRView.spriteSet2&&(n.MRView.spriteSet2=void 0)};const g=Scene_Map.prototype.update;Scene_Map.prototype.update=function(){h.FloorRestartSequence.update(this),n.MRView._messageWindowSet&&n.MRView._messageWindowSet._floorNameWindow.isEffectRunning()||(o.MRLively.map.floorId().isTacticsMap()?($gameMap.isEventRunning()||o.MRLively.camera.isFloorTransfering()||s.MRSystem.scheduler.stepSimulation(),s.MRSystem.minimapData.update()):o.MRLively.immediatelyCommandExecuteScheduler.stepSimulation()),n.MRView.update(),o.MRLively.map.floorId().isTacticsMap()&&n.MRView._syncCamera&&c.RMMZHelper.syncCameraPositionToGamePlayer(),g.call(this)};const v=Scene_Map.prototype.callMenu;Scene_Map.prototype.callMenu=function(){if(o.MRLively.map.floorId().isRMMZDefaultSystemMap())v.call(this);else{(0,r.assert)(0==s.MRSystem.dialogContext.dialogs().length);const t=o.MRLively.camera.focusedEntity();(0,r.assert)(t),s.MRSystem.commandContext.openDialog(t,new l.SMainMenuDialog(t),!1),this.menuCalling=!1}};const S=Scene_Map.prototype.updateCallMenu;Scene_Map.prototype.updateCallMenu=function(){o.MRLively.map.floorId().isRMMZDefaultSystemMap()?S.call(this):o.MRLively.map.floorId().isTacticsMap()?this.menuCalling=!1:0==s.MRSystem.dialogContext.dialogs().length&&S.call(this)};const M=Scene_Map.prototype.shouldAutosave;Scene_Map.prototype.shouldAutosave=function(){return!!o.MRLively.map.floorId().isTacticsMap()||M.call(this)};const R=Scene_Map.prototype.isAutosaveEnabled;Scene_Base.prototype.isAutosaveEnabled=function(){return!!o.MRLively.map.floorId().isTacticsMap()||R.call(this)};const b=Scene_Map.prototype.fadeOutForTransfer;Scene_Map.prototype.fadeOutForTransfer=function(){h.FloorRestartSequence.isProcessing()||b.call(this)};const E=Scene_Map.prototype.needsFadeIn;Scene_Map.prototype.needsFadeIn=function(){return!!h.FloorRestartSequence.isProcessing()||E.call(this)}},9769:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(7352),s=Scene_Save.prototype.executeSave;Scene_Save.prototype.executeSave=function(t){s.call(this,t),r.MRLively.recorder.setSavefileId(t)}},9955:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(215),s=i(9185);var a=Scene_Title.prototype.start;Scene_Title.prototype.start=function(){a.call(this),(0,r.registerExtensions)(),s.MRData.ext.onDatabaseLoaded()}},9320:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(8855),s=i(8127),a=i(5674),n=i(1298),o=i(8994),c=[0,4,0,6,1,0,2,5,3,7],l=[0,0,0,0,1,0,2,3,3,3];Sprite_Character.prototype.setStateIcons=function(t){this._stateIcons=t};const h=Sprite_Character.prototype.initMembers;Sprite_Character.prototype.initMembers=function(){h.call(this),this._stateIcons=[];const t=ImageManager.loadSystem("IconSet");this._stateIconSprite=new Sprite(t),this._stateIconSprite.visible=!1,this.addChild(this._stateIconSprite),this._reRevision=0};Sprite_Character.prototype.characterPatternY;Sprite_Character.prototype.characterPatternY=function(){return this._character.characterName().endsWith("-X")?c[this._character.direction()]:l[this._character.direction()]};const u=Sprite_Character.prototype.update;Sprite_Character.prototype.update=function(){u.call(this),this._reRevision!=this._character.reRevision()&&(this._reRevision=this._character.reRevision(),this._stateIcons=[],this._stateIconSprite.visible=!1);const t=this.findVisual();t?(this._spriteSet||(this._spriteSet=new s.VCharacterSpriteSet(this.parent,this)),this._spriteSet&&this._spriteSet.update(),this._stateIcons.length>0?(a.VHelper.setIconFrame(this._stateIconSprite,this._stateIcons[0]),this._stateIconSprite.anchor.x=.5,this._stateIconSprite.anchor.y=1,this._stateIconSprite.y=this.bitmap?-this.patternHeight():0,this._stateIconSprite.visible=!0):this._stateIconSprite.visible=!1,t.rmmzSpriteIndex()!=this._spriteIndex&&console.log("err",this),(0,n.assert)(t.rmmzSpriteIndex()==this._spriteIndex)):this._stateIconSprite.visible=!1,this.updateDamagePopup_RE()},Sprite_Character.prototype.endAllEffect=function(){},Sprite_Character.prototype.findVisual=function(){if(!r.MRView.entityVisualSet)return;const t=this._character;if(t instanceof Game_Event){return r.MRView.entityVisualSet.findEntityVisualByRMMZEventId(t.eventId())}},Sprite_Character.prototype.updateDamagePopup_RE=function(){if(this.attemtSetupDamagePopup_RE(),this._damageSprites_RE&&this._damageSprites_RE.length>0){for(var t=0;t<this._damageSprites_RE.length;t++)this._damageSprites_RE[t].update();this._damageSprites_RE[0].isPlaying()||(this.getPopupParent_RE().removeChild(this._damageSprites_RE[0]),this._damageSprites_RE.shift())}},Sprite_Character.prototype.attemtSetupDamagePopup_RE=function(){if(this._character.isDamagePopupRequested_RE()){var t=new o.Sprite_CharacterDamage_RE;t.x=this.x+this.damageOffsetX_RE(),t.y=this.y+this.damageOffsetY_RE(),t.z||(t.z=9),t.setupCharacter(this._character),this._damageSprites_RE||(this._damageSprites_RE=[]),this._damageSprites_RE.push(t),this.getPopupParent_RE().addChild(t)}},Sprite_Character.prototype.damageOffsetX_RE=function(){return 0},Sprite_Character.prototype.damageOffsetY_RE=function(){return 0},Sprite_Character.prototype.getPopupParent_RE=function(){return this.parent}},8994:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Sprite_CharacterDamage_RE=void 0;class i extends Sprite_Damage{setupCharacter(t){var e=t.shiftDamageInfo_RE();this.createDigits(e.value)}updateChild(t){t.y=-this.easeOutExpo(90-this._duration,0,50,90)}easeOutExpo(t,e,i,r){return t==r?e+i:i*(1-Math.pow(2,-10*t/r))+e}}e.Sprite_CharacterDamage_RE=i},5136:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(3425);Spriteset_Base.prototype.createMRFloatingAnimationSprite=function(t,e,i){const s=new(this.isMVAnimation(t)?Sprite_AnimationMV:Sprite_Animation)(void 0),a=new r.VFloatingAnimationTargetSprite(void 0);a.animationSprite=s;const n=[a];for(const t of n)t.x=e,t.y=i,this._effectsContainer.addChild(t);s.setup(n,t,!1,0,null),s.targetObjects=[],this._effectsContainer.addChild(s),this._animationSprites.push(s),this._mrFloatingAnimationSprites.push(a)};const s=Spriteset_Base.prototype.initialize;Spriteset_Base.prototype.initialize=function(){s.call(this),this._mrFloatingAnimationSprites=[]};const a=Spriteset_Base.prototype.removeAnimation;Spriteset_Base.prototype.removeAnimation=function(t){a.call(this,t);for(let e=this._mrFloatingAnimationSprites.length-1;e>=0;e--){const i=this._mrFloatingAnimationSprites[e];i.animationSprite==t&&(this._effectsContainer.removeChild(i),this._mrFloatingAnimationSprites.splice(e,1),i.destroy())}}},8543:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(3815),s=i(1298),a=i(8855),n=i(6134),o=Spriteset_Map.prototype.initialize;Spriteset_Map.prototype.initialize=function(){(0,s.assert)(!a.MRView.spriteSet2),o.call(this)};const c=Spriteset_Map.prototype.destroy;Spriteset_Map.prototype.destroy=function(t){c.call(this,t)};var l=Spriteset_Map.prototype.createLowerLayer;Spriteset_Map.prototype.createLowerLayer=function(){l.call(this)};var h=Spriteset_Map.prototype.createPictures;Spriteset_Map.prototype.createPictures=function(){n.RMMZHelper.isRESystemMap()?a.MRView.spriteSet2=new r.VSpriteSet(this):a.MRView.spriteSet2=void 0,h.call(this)};var u=Spriteset_Map.prototype.createCharacters;Spriteset_Map.prototype.createCharacters=function(){u.call(this),a.MRView.spriteset=this};var d=Spriteset_Map.prototype.updateTilemap;Spriteset_Map.prototype.updateTilemap=function(){var t;d.call(this),null===(t=a.MRView.spriteSet2)||void 0===t||t.update()};var p=Spriteset_Map.prototype.createUpperLayer;Spriteset_Map.prototype.createUpperLayer=function(){p.call(this)};var f=Spriteset_Map.prototype.updateShadow;Spriteset_Map.prototype.updateShadow=function(){f.call(this)}},5723:function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),s=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),a=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&r(e,t,i);return s(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.RmmzStorageManager=void 0;const n=a(i(7147));e.RmmzStorageManager=class{static ensureSaveDirectory(){const t=this.fileDirectoryPath();n.existsSync(t)||n.mkdirSync(t)}static fileDirectoryPath(){const t=i(1017),e=process.cwd();return t.join(e,"save/")}}},3477:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TilemapRendererId=void 0;i(5449);const r=i(7352),s=i(8855);!function(t){t[t.Default=0]="Default",t[t.Minimap=2]="Minimap"}(e.TilemapRendererId||(e.TilemapRendererId={}));const a=[[[2,4],[1,4],[2,3],[1,3]],[[2,0],[1,4],[2,3],[1,3]],[[2,4],[3,0],[2,3],[1,3]],[[2,0],[3,0],[2,3],[1,3]],[[2,4],[1,4],[2,3],[3,1]],[[2,0],[1,4],[2,3],[3,1]],[[2,4],[3,0],[2,3],[3,1]],[[2,0],[3,0],[2,3],[3,1]],[[2,4],[1,4],[2,1],[1,3]],[[2,0],[1,4],[2,1],[1,3]],[[2,4],[3,0],[2,1],[1,3]],[[2,0],[3,0],[2,1],[1,3]],[[2,4],[1,4],[2,1],[3,1]],[[2,0],[1,4],[2,1],[3,1]],[[2,4],[3,0],[2,1],[3,1]],[[2,0],[3,0],[2,1],[3,1]],[[1,4],[1,4],[0,3],[1,3]],[[0,4],[3,0],[0,3],[1,3]],[[0,4],[1,4],[0,3],[3,1]],[[0,4],[3,0],[0,3],[3,1]],[[2,2],[1,2],[2,3],[1,3]],[[2,2],[1,2],[2,3],[3,1]],[[2,2],[1,2],[2,1],[1,3]],[[2,2],[1,2],[2,1],[3,1]],[[2,4],[3,4],[2,3],[3,3]],[[2,4],[3,4],[2,1],[3,3]],[[2,0],[3,4],[2,3],[3,3]],[[2,0],[3,4],[2,1],[3,3]],[[2,4],[1,4],[2,4],[1,4]],[[2,0],[1,4],[2,5],[1,5]],[[2,4],[3,0],[2,5],[1,5]],[[2,0],[3,0],[2,5],[1,5]],[[0,4],[3,4],[0,3],[3,3]],[[2,2],[1,2],[2,5],[1,5]],[[0,2],[1,2],[0,3],[1,3]],[[0,2],[1,2],[0,3],[3,1]],[[2,2],[2,2],[2,3],[3,3]],[[2,2],[3,2],[2,1],[3,3]],[[2,4],[3,4],[2,5],[3,5]],[[2,0],[3,4],[2,5],[3,5]],[[0,4],[1,4],[0,4],[1,4]],[[0,4],[3,0],[0,5],[1,5]],[[0,2],[3,2],[0,3],[3,3]],[[0,2],[1,2],[0,5],[1,5]],[[0,4],[3,4],[0,5],[3,5]],[[2,2],[3,2],[2,5],[3,5]],[[0,2],[3,2],[0,5],[3,5]],[[0,0],[1,0],[0,1],[1,1]]],n=[[[2,2],[1,2],[2,1],[1,1]],[[0,2],[1,2],[0,1],[1,1]],[[2,0],[1,0],[2,1],[1,1]],[[0,0],[1,0],[0,1],[1,1]],[[2,2],[3,2],[2,1],[3,1]],[[0,2],[3,2],[0,1],[3,1]],[[2,0],[3,0],[2,1],[3,1]],[[0,0],[3,0],[0,1],[3,1]],[[2,2],[1,2],[2,3],[1,3]],[[0,2],[1,2],[0,3],[1,3]],[[2,0],[1,0],[2,3],[1,3]],[[1,0],[1,0],[0,3],[1,3]],[[2,2],[3,2],[2,3],[3,3]],[[0,2],[3,2],[0,3],[3,3]],[[2,0],[3,0],[2,3],[3,3]],[[0,0],[3,0],[0,3],[3,3]]],o=Tilemap.prototype._addSpot;function c(t){const e=Tilemap.getAutotileKind(t);return 88<=e&&e<=95||(104<=e&&e<=111||120<=e&&e<=127)}Tilemap.prototype._addSpot=function(t,e,i,r){o.call(this,t,e,i,r);const a=t+i,n=e+r,c=i*this._tileWidth,l=r*this._tileHeight;this._readMapData(a,n,5),this._readMapData(a,n,0),this._readMapData(a,n,1),this._readMapData(a,n,2),this._readMapData(a,n,3),this._readMapData(a,n,4);if(2!=this._lowerLayer._rendererId&&s.MRView.guideGrid&&s.MRView.guideGrid.isVisible()){const t=s.MRView.guideGrid.readMapData(a,n);this._addTile(this._lowerLayer,t,c,l)}};const l=Tilemap.prototype._addAutotile;Tilemap.prototype._addAutotile=function(t,e,i,s){const o=Tilemap.getAutotileKind(e);if(r.MRLively.map.floorId().isTacticsMap()&&Tilemap.isTileA4(e)){const r=i/this._tileWidth,l=s/this._tileHeight,h=Math.ceil(this.origin.x),u=Math.ceil(this.origin.y),d=Math.floor((h-this._margin)/this._tileWidth)+r,p=Math.floor((u-this._margin)/this._tileHeight)+l,f=Tilemap.getAutotileShape(e),m=o%8,y=Math.floor(o/8),_=this._tileWidth/2,g=this._tileHeight/2;let v=Tilemap.FLOOR_AUTOTILE_TABLE;const S=3,M=2*m,R=Math.floor(2.5*(y-10)+(y%2==1?.5:0)),b=[0,0,0,0];if(y%2==1){if(v=Tilemap.WALL_AUTOTILE_TABLE,b[0]=-g,b[1]=-g,11==f&&d>0){(function(t){const e=Tilemap.getAutotileKind(t);return 80<=e&&e<=87||96<=e&&e<=103||112<=e&&e<=119})(this._readMapData(d-1,p,0))&&(v=n)}}else if(16==f){if(d>0){c(this._readMapData(d-1,p,0))&&(v=a)}}else if(36==f){if(d<this.width-1){c(this._readMapData(d+1,p,0))&&(v=a)}}else if((28==f||40==f)&&p<this.height-1){c(this._readMapData(d,p+1,0))&&(v=a)}const E=v[f];for(let e=0;e<4;e++){const r=(2*M+E[e][0])*_,a=(2*R+E[e][1])*g,n=i+e%2*_,o=s+Math.floor(e/2)*g;t.addRect(S,r,a+b[e],n,o,_,g)}}else l.call(this,t,e,i,s)},PIXI.Renderer.registerPlugin("rpgtilemap2",Tilemap.Renderer);const h=Tilemap.prototype.initialize;Tilemap.prototype.initialize=function(){h.apply(this),this.selfVisible=!0},Tilemap.prototype.setRendererId=function(t){this._lowerLayer._rendererId=t},Tilemap.Layer.prototype.render=function(t){const e=t.gl,i=2==this._rendererId?t.plugins.rpgtilemap:t.plugins.rpgtilemap2,r=i.getShader(),s=r.uniforms.uProjectionMatrix;if(this.parent instanceof Tilemap&&!this.parent.selfVisible)return!1;t.batch.setObjectRenderer(i),t.projection.projectionMatrix.copyTo(s),s.append(this.worldTransform),t.shader.bind(r),this._needsTexturesUpdate&&(i.updateTextures(t,this._images),this._needsTexturesUpdate=!1),i.bindTextures(t),t.geometry.bind(this._vao,r),this._updateIndexBuffer(),this._needsVertexUpdate&&(this._updateVertexBuffer(),this._needsVertexUpdate=!1),t.geometry.updateBuffers();const a=this._elements.length;a>0&&(t.state.set(this._state),t.geometry.draw(e.TRIANGLES,6*a,0))}},9600:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VMapEditor=void 0;const r=i(1298),s=i(2213),a=i(9185),n=i(5449),o=i(4519),c=i(4879),l=i(2020);var h;!function(t){t[t.UL=0]="UL",t[t.UR=1]="UR",t[t.LL=2]="LL",t[t.LR=3]="LR"}(h||(h={}));e.VMapEditor=class{constructor(t){this._coreMap=t;const e=t.floorData(),i=e.template?a.MRData.templateMaps.find((t=>t.name==e.template)):a.MRData.templateMaps[1];(0,r.assert)(i),this._templateMap=i}build(){if($dataMap.tilesetId=this._templateMap.tilesetId,$dataMap.width=this._coreMap.width(),$dataMap.height=this._coreMap.height(),$dataMap.data=new Array($dataMap.width*$dataMap.height*5),$gameMap.changeTileset($dataMap.tilesetId),this._coreMap.floorId().isFixedMap());else for(let t=0;t<$dataMap.height;t++)for(let e=0;e<$dataMap.width;e++){const i=this._coreMap.block(e,t);this.refreshBlock(i)}}refreshBlock(t){const e=t.mx,i=t.my;{const r=t.shapeVisualPartIndex;if(r>0){const t=this._templateMap.parts[r];this.putPart(e,i,0,t)}else switch(t.tileShape()){case c.LTileShape.Floor:t.systemDecoration()==c.LBlockSystemDecoration.ItemShop?this.putAutoTile(e,i,0,this._templateMap.itemShopFloorAutoTileKind):this.putAutoTile(e,i,0,this._templateMap.floorAutoTileKind);break;case c.LTileShape.Wall:this.putAutoTile(e,i,0,this._templateMap.floorAutoTileKind),this.isValidPos(e,i+1)&&this._coreMap.block(e,i+1)._blockComponent!=n.FBlockComponent.None?this.putAutoTile(e,i,1,this._templateMap.wallEdgeAutoTileKind):this.putAutoTile(e,i,1,this._templateMap.wallHeadAutoTileKind);break;default:throw new Error("Not implemented.")}}{const r=t.decorationVisualPartIndex;if(r>0){const t=this._templateMap.parts[r];this.putPart(e,i,2,t)}}}putPart(t,e,i,s){switch((0,r.assert)(s),s.tileType){case l.DBlockVisualPartTileType.Normal:for(let r=0;r<s.height;r++){const a=e-r;this.isValidPos(t,a)&&this.setTileId(t,e,i,s.tiles[r])}break;case l.DBlockVisualPartTileType.Autotile:this.putAutoTile(t,e,i,s.tiles[0]);break;default:throw new Error("Unreachable.")}}width(){return $dataMap.width}height(){return $dataMap.width}isValidPos(t,e){return 0<=t&&t<this.width()&&0<=e&&e<this.height()}tileId(t,e,i){const r=$dataMap.width,s=$dataMap.height;return $dataMap.data[(i*s+e)*r+t]||0}setTileId(t,e,i,r){const s=$dataMap.width,a=$dataMap.height;$dataMap.data[(i*a+e)*s+t]=r}putAutoTile(t,e,i,r){const s=Tilemap.makeAutotileId(r,this.getAutotileShape(t,e,i,r));this.setTileId(t,e,i,s),this.isValidPos(t-1,e-1)&&this.refreshAutoTile(t-1,e-1,i,r),this.isValidPos(t,e-1)&&this.refreshAutoTile(t,e-1,i,r),this.isValidPos(t+1,e-1)&&this.refreshAutoTile(t+1,e-1,i,r),this.isValidPos(t-1,e)&&this.refreshAutoTile(t-1,e,i,r),this.isValidPos(t+1,e)&&this.refreshAutoTile(t+1,e,i,r),this.isValidPos(t-1,e+1)&&this.refreshAutoTile(t-1,e+1,i,r),this.isValidPos(t,e+1)&&this.refreshAutoTile(t,e+1,i,r),this.isValidPos(t+1,e+1)&&this.refreshAutoTile(t+1,e+1,i,r)}refreshAutoTile(t,e,i,r){if(Tilemap.getAutotileKind(this.tileId(t,e,i))==r){const s=Tilemap.makeAutotileId(r,this.getAutotileShape(t,e,i,r));this.setTileId(t,e,i,s)}}getAutotileShape(t,e,i,r){let a=[0,0,0,0];{const s=[{x:-1,y:-1},{x:1,y:-1},{x:-1,y:1},{x:1,y:1}];for(let n=0;n<4;n++){const o=s[n].x,c=s[n].y,l=this.getSameKindTile(t+o,e+c,i,r),h=this.getSameKindTile(t+o,e,i,r),u=this.getSameKindTile(t,e+c,i,r);a[n]=l&&u&&h?1:!l&&u&&h?2:!u&&h?3:u&&!h?4:5}}const n=(s.DHelpers.isWallSideAutoTile(r)?o.SMinimapData._subtileToAutoTileTable_Wall:o.SMinimapData._subtileToAutoTileTable).findIndex((t=>t[h.UL]==a[h.UL]&&t[h.UR]==a[h.UR]&&t[h.LL]==a[h.LL]&&t[h.LR]==a[h.LR]));return n>=0?n:0}getSameKindTile(t,e,i,r){const s=this.tileId(t,e,i);return!(!Tilemap.isAutotile(s)||Tilemap.getAutotileKind(s)!=r)}}},3013:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(6134),s=Window_MapName.prototype.update;Window_MapName.prototype.update=function(){r.RMMZHelper.isRESystemMap()||s.call(this)}},8254:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Helpers=void 0;const r=i(9185),s=i(8245),a=i(6901);class n{static dirToTileOffset(t){return this._dirToTileOffsetTable[t]}static offsetToDir(t,e){return 0==t?0==e||e>0?2:8:t>0?0==e?6:e>0?3:9:0==e?4:e>0?1:7}static makeFrontPosition(t,e,i,r){const a=this._dirToTileOffsetTable[i];return new s.Vector2(t+a.x*r,e+a.y*r)}static makeEntityFrontPosition(t,e){const i=this._dirToTileOffsetTable[t.dir];return new s.Vector2(t.mx+i.x*e,t.my+i.y*e)}static getDistance(t,e){const i=t.mx-e.mx,r=t.my-e.my;return Math.sqrt(i*i+r*r)}static isHostile(t,e){return this.isHostileFactionId(t.getOutwardFactionId(),e.getOutwardFactionId())}static isFriend(t,e){return this.isFriendFactionId(t.getOutwardFactionId(),e.getOutwardFactionId())}static getLooksToFactionType(t,e){return this.isFriend(t,e)?a.DFactionType.Friendly:this.isHostile(t,e)?a.DFactionType.Hostile:a.DFactionType.Neutral}static isHostileFactionId(t,e){return 0!=(r.MRData.factions[t].hostileBits&1<<e)}static isFriendFactionId(t,e){return t==e||0!=(r.MRData.factions[t].friendBits&1<<e)}static lerp(t,e,i){return t+(e-t)*i}}e.Helpers=n,n._dirToTileOffsetTable=[{x:0,y:0},{x:-1,y:1},{x:0,y:1},{x:1,y:1},{x:-1,y:0},{x:0,y:0},{x:1,y:0},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1}]},9115:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MRSystem=void 0;const r=i(1163),s=i(4977);class a{}e.MRSystem=a,a.propertyData=[{id:0,defaultValue:void 0},{id:1,defaultValue:0},{id:2,defaultValue:1},{id:3,defaultValue:[]}],a.properties={equipmentSlots:3},a.ext=new r.MRSystemExtension,a.requestedPlayback=!1,a.unittest=!1,a.requestedRestartFloorItem=s.LEntityId.makeEmpty()},1163:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MRSystemExtension=void 0;e.MRSystemExtension=class{onNewEntity(t,e){}}},8475:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SAIHelper=void 0;class i{static axisToDir(t,e){let i=Math.atan2(t,e);i=(i+Math.PI)/(2*Math.PI),i+=1/16;let r=0;return 0<i&&i<1&&(r=Math.floor(8*i)),this.axisToDirIndices[r]}static distanceToDir(t,e,i,r){const s=i-t,a=r-e;return this.axisToDir(s,a)}static entityDistanceToDir(t,e){const i=e.mx-t.mx,r=e.my-t.my;return this.axisToDir(i,r)}}e.SAIHelper=i,i._movingPriority=[[],[1,2,4,3,7],[2,3,1,6,4],[3,6,2,9,1],[4,1,7,2,8],[],[6,9,3,8,2],[7,4,8,1,9],[8,7,9,4,6],[9,8,6,7,3]],i.axisToDirIndices=[8,7,4,1,2,3,6,9]},7737:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SAbilityFactory=void 0;const r=i(1048);e.SAbilityFactory=class{static newAbility(t){const e=new r.LAbility;return e.setup(t),e}}},1886:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SActionHitTest=void 0;const r=i(4561),s=i(4836),a=i(3609);e.SActionHitTest=class{static testProjectle(t,e,i,s,n){const o=this.testCertainIndirectHits(t,e,i);if(void 0!==o)return o;const c=s==r.DEffectHitType.Physical?a.paraIndirectPhysicalHitRate:100,l=100*this.evaRate(i,s),h=n.nextIntWithMax(100)>=c,u=!h&&n.nextIntWithMax(100)<l;return!h&&!u}static evaRate(t,e){return e==r.DEffectHitType.Physical?t.xparam(s.MRBasics.xparams.eva):e==r.DEffectHitType.Magical?t.xparam(s.MRBasics.xparams.mev):0}static testCertainIndirectHits(t,e,i){const r=t.hasTrait(s.MRBasics.traits.AwfulPhysicalIndirectAttack),a=t.hasTrait(s.MRBasics.traits.CertainIndirectAttack),n=i.hasTrait(s.MRBasics.traits.DodgePhysicalIndirectAttack);if(!a||!n)return!n&&(!!a||!r&&void 0)}}},2105:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SActivityContext=void 0;const r=i(1325),s=i(7043),a=i(4393);e.SActivityContext=class{constructor(t){this._activity=t}activity(){return this._activity}then(t){return this._thenFunc=t,this}catch(t){return this._catchFunc=t,this}postHandleActivity(t,e){const i=new s.HandleActivityCommand;return t.postTask2(new a.STask("HandleActivity",(()=>{let n=r.SCommandResponse.Pass;if(e.iterateBehaviorsReverse((i=>(n=i.onActivityPreReaction(e,t,this._activity),n==r.SCommandResponse.Pass))),n!=r.SCommandResponse.Canceled){const n=i._thenFunc,o=()=>((n?n():s.SHandleCommandResult.Resolved)==s.SHandleCommandResult.Resolved?(e.iterateBehaviorsReverse((i=>(i.onActivityReaction(e,t,this._activity),!0))),this._thenFunc&&this._thenFunc()):this._catchFunc&&this._catchFunc(),r.SCommandResponse.Pass);t.postTask2(new a.STask("HandleActivity.2",o))}else i._catchFunc&&i._catchFunc(),this._catchFunc&&this._catchFunc();return r.SCommandResponse.Pass}))),i}}},3175:function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),s=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),a=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&r(e,t,i);return s(e,t),e},n=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))((function(s,a){function n(t){try{c(r.next(t))}catch(t){a(t)}}function o(t){try{c(r.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(n,o)}c((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.SActivityRecorder=e.ActivityRecordingCommandType=void 0;const o=a(i(7147)),c=i(1298),l=i(9115),h=i(4621),u=i(5723);var d,p;!function(t){t[t.Activity=1]="Activity",t[t.CloseMainDialog=2]="CloseMainDialog"}(d=e.ActivityRecordingCommandType||(e.ActivityRecordingCommandType={})),function(t){t[t.Idle=0]="Idle",t[t.Recording=1]="Recording",t[t.Playback=2]="Playback"}(p||(p={}));e.SActivityRecorder=class{constructor(){this._recorderMode=p.Idle,this._playbackCommandIndex=0,this._savefileId=0,this._silentPlayback=!1}setSavefileId(t){this._savefileId=t}isIdle(){return this._recorderMode==p.Idle}isRecording(){return this._recorderMode==p.Recording}isPlayback(){return this._recorderMode==p.Playback}checkPlaybackRemaining(t){return(0,c.assert)(this._playbackCommands),this._playbackCommands.length-this._playbackCommandIndex<=t}startRecording(){return this.closeFile(),u.RmmzStorageManager.ensureSaveDirectory(),this._recorderMode=p.Recording,new Promise(((t,e)=>n(this,void 0,void 0,(function*(){this._stream=o.createWriteStream(this.filePath()),this._stream.on("open",(()=>t(!0))),this._stream.on("error",(()=>e(!1)))}))))}stopRecording(){return this._stream&&(this._stream.close(),this._recorderMode=p.Idle),new Promise(((t,e)=>n(this,void 0,void 0,(function*(){this._stream&&this._stream.on("close",(()=>t(!0)))}))))}restartRecording(){this.closeFile();this._stream=o.createWriteStream(this.filePath(),{flags:"a"}),this._recorderMode=p.Recording}filePath(){return(u.RmmzStorageManager.fileDirectoryPath()+`re${this._savefileId}.resave`).replace(/\\/g,"/")}push(t){(0,c.assert)(this._stream),this._stream.write(JSON.stringify(t)+",\n")}attemptStartPlayback(t){this.closeFile();const e=this.filePath();if(!o.existsSync(e))return!1;const i=o.readFileSync(e,{encoding:"utf8"}),r="["+i.substring(0,i.length-2)+"]";return this._playbackCommands=JSON.parse(r),!(!this._playbackCommands||0==this._playbackCommands.length)&&(this._playbackCommandIndex=0,this._recorderMode=p.Playback,this._silentPlayback=t,!0)}clearSilentPlayback(){this._silentPlayback=!1}isSilentPlayback(){return this._silentPlayback}closeFile(){this._stream&&(this._stream.close(),this._stream=void 0)}runPlaybackCommand(t){(0,c.assert)(this._playbackCommands),(0,c.assert)(this.isPlayback());do{const e=this._playbackCommands[this._playbackCommandIndex];if(this._playbackCommandIndex++,!this.doCommand(t,e))break}while(this._playbackCommandIndex<this._playbackCommands.length);return this._playbackCommandIndex<this._playbackCommands.length||(this._recorderMode,p.Idle,!1)}doCommand(t,e){switch(e.type){case d.Activity:return(0,c.assert)(e.activity),l.MRSystem.commandContext.postActivity(h.LActivity.makeFromData(e.activity)),!0;case d.CloseMainDialog:return!1;default:throw new Error("Unreachable.")}}}},2205:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SBehaviorFactory=void 0;const r=i(7352),s=i(2971),a=i(3585),n=i(5960),o=i(8727),c=i(639),l=i(6501),h=i(9248),u=i(2479),d=i(913),p=i(7922),f=i(5705),m=i(985),y=i(9543),_=i(5748),g=i(7036),v=i(2436),S=i(3336),M=i(3542),R=i(5858),b=i(9684),E=i(1924),I=i(8198);class x{static register(t,e,i){this._behaviorEntries.push({fullName:t,friendlyName:e,create:()=>new i})}static attachBehaviors(t,e){e.forEach((e=>{const i=this.createBehavior(e.name);if(!i)throw new Error(`Behavior "${e.name}" that you tried to add to the entity "${t._name}" is invalid.`);t._addBehavior(i)}))}static createBehavior(t){const e=this.createBehaviorInstance(t);if(e)return r.MRLively.world._registerObject(e),e}static createBehaviorInstance(t){const e=this._behaviorEntries.find((e=>e.fullName==t||e.friendlyName==t));return e?e.create():void 0}}e.SBehaviorFactory=x,x._behaviorEntries=[{fullName:"LCommonBehavior",friendlyName:"_Common",create:()=>new o.LCommonBehavior},{fullName:"REGame_DecisionBehavior",friendlyName:"_Decision",create:()=>new c.LDecisionBehavior},{fullName:"REUnitBehavior",friendlyName:"_Unit",create:()=>new l.LUnitBehavior},{fullName:"LInventoryBehavior",friendlyName:"_Inventory",create:()=>new h.LInventoryBehavior},{fullName:"LItemUserBehavior",friendlyName:"_ItemUser",create:()=>new u.LItemUserBehavior},{fullName:"LEquipmentBehavior",friendlyName:"Equipment",create:()=>new R.LEquipmentBehavior},{fullName:"LEquipmentUserBehavior",friendlyName:"_EquipmentUser",create:()=>new d.LEquipmentUserBehavior},{fullName:"LActorBehavior",friendlyName:"_Actor",create:()=>new m.LActorBehavior},{fullName:"REExitPointBehavior",friendlyName:"_ExitPoint",create:()=>new p.LExitPointBehavior},{fullName:"LEntryPointBehavior",friendlyName:"_EntryPoint",create:()=>new _.LEntryPointBehavior},{fullName:"LEnemyBehavior",friendlyName:"_Enemy",create:()=>new f.LEnemyBehavior},{fullName:"LGenericRMMZStateBehavior",friendlyName:"_GenericRMMZState",create:()=>new g.LGenericRMMZStateBehavior},{fullName:"LItemBehavior",friendlyName:"_Item",create:()=>new y.LItemBehavior},{fullName:"LNapStateBehavior",friendlyName:"NapState",create:()=>new a.LNapStateBehavior},{fullName:"LItemImitatorBehavior",friendlyName:"ItemImitator",create:()=>new v.LItemImitatorBehavior},{fullName:"LIllusionStateBehavior",friendlyName:"IllusionState",create:()=>new S.LIllusionStateBehavior},{fullName:"LGrabFootBehavior",friendlyName:"FootBehavior",create:()=>new M.LGrabFootBehavior},{fullName:"LRevivalItemBehavior",friendlyName:"RevivalItem",create:()=>new b.LRevivalItemBehavior},{fullName:"LItemStandingBehavior",friendlyName:"ItemStanding",create:()=>new E.LItemStandingBehavior},{fullName:"LKnockbackBehavior",friendlyName:"Knockback",create:()=>new n.LKnockbackBehavior},{fullName:"LSelfExplosionBehavior",friendlyName:"SelfExplosion",create:()=>new I.LSelfExplosionBehavior},{fullName:"LDebugMoveRightBehavior",friendlyName:"DebugMoveRight",create:()=>new s.LDebugMoveRightBehavior}]},1325:(t,e)=>{"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.SCommand=e.checkContinuousResponse=e.SPhaseResult=e.SCommandResponse=void 0,function(t){t[t.Handled=0]="Handled",t[t.Pass=1]="Pass",t[t.Canceled=2]="Canceled"}(i=e.SCommandResponse||(e.SCommandResponse={})),function(t){t[t.Pass=0]="Pass",t[t.Handled=1]="Handled"}(e.SPhaseResult||(e.SPhaseResult={})),e.checkContinuousResponse=function(t){return t==i.Pass};class r{constructor(t){this.id=t,this._objects=[]}static make(t){return new r(t)}get objects(){return this._objects}withObject(t){return this._objects=[t],this}withObjects(t){return this._objects=t,this}}e.SCommand=r},7043:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SCommandContext=e.HandleActivityCommand=e.SHandleCommandResult=void 0;const r=i(1325),s=i(1298),a=i(4795),n=i(7352),o=i(9115),c=i(5157),l=i(6501),h=i(2105),u=i(4393),d=i(9019);!function(t){t[t.Resolved=0]="Resolved",t[t.Rejected=1]="Rejected"}(e.SHandleCommandResult||(e.SHandleCommandResult={}));e.HandleActivityCommand=class{then(t){return this._thenFunc=t,this}catch(t){return this._catchFunc=t,this}};e.SCommandContext=class{constructor(t){this._visualAnimationWaiting=!1,this._recodingCommandList=[],this._runningCommandList=[],this._afterChainCommandList=[],this._messageIndex=0,this._commandChainRunning=!1,this.__whenWaitingTasks=[],this._subTaskChainStack=[],this._sequelContext=t}pushSubTaskChain(t){this._subTaskChainStack.push(t)}popSubTaskChain(t){(0,s.assert)(this._subTaskChainStack[this._subTaskChainStack.length-1]==t),this._subTaskChainStack.push(t)}get currentSubTaskChain(){return this._subTaskChainStack.length>0?this._subTaskChainStack[this._subTaskChainStack.length-1]:void 0}clear(){this._visualAnimationWaiting=!1,this._recodingCommandList=[],this._runningCommandList=[],this._messageIndex=0,this._commandChainRunning=!1}get dialogContext(){return o.MRSystem.dialogContext}random(){return n.MRLively.world.random()}checkOpenDialogRequired(){return void 0!==this._recodingCommandList.find((t=>"openDialog"==t._name))}callCommand(t,e,i){let s=r.SCommandResponse.Pass;e.iterateBehaviorsReverse((a=>(s=a.onCommand(e,this,t,i),s==r.SCommandResponse.Pass)))}makeTask(t){const e=new u.STask("Task",void 0);return e._callMethod=u.STaskCallMethod.Then,e._thenFunc2=t,e._subChain=new u.SSubTaskChain(this,e),e}makeCommandTask(t,e){return this.makeTask((i=>{this.callCommand(i,t,e)}))}postTask2(t){return this.pushRecodingCommandList(t),t}postTask(t){const e=this.makeTask(t);return this.postTask2(e),e}postCommandTask(t,e){const i=this.makeCommandTask(t,e);return this.postTask2(i),i}whenAll(t){const e=new u.STask("Task",void 0);return e._callMethod=u.STaskCallMethod.Then,e._subChain=new u.SSubTaskChain(this,e),e._callMethod=u.STaskCallMethod.When,e._whenWaitingTasks=t,this.__whenWaitingTasks.push(e),e._status=u.STaskStatus.Pending,e}postConsumeActionToken(t,e){const i=t.findEntityBehavior(l.LUnitBehavior);(0,s.assert)(i),t._actionToken.verify(e);this.pushRecodingCommandList(new u.STask("ConsumeActionToken",(()=>(s.Log.doCommand("ConsumeActionToken"),this.attemptConsumeActionToken(t,e),r.SCommandResponse.Handled)))),s.Log.postCommand("ConsumeActionToken")}postActivity(t,e=!0){let i=t;if(e)for(const e of t.actor().collectBehaviors().reverse())i=e.onPreprocessActivity(this,i);i.isConsumeAction()&&i.actor()._actionToken.verify(i.getConsumeActionTokenType());const a=new h.SActivityContext(t);return this.pushRecodingCommandList(new u.STask("Activity",(()=>{if(s.Log.doCommand("Activity"),i.isConsumeAction()){const t=i.actor();this.attemptConsumeActionToken(t,i.getConsumeActionTokenType())}const t=i.actor()._sendActivity(this,a);return t==r.SCommandResponse.Pass&&a._catchFunc&&a._catchFunc(),t}))),s.Log.postCommand("Activity"),a}attemptConsumeActionToken(t,e){const i=t._actionToken.consume(e);t._schedulingResult.setConsumedActionTokeInCurrentPhase(i),t._effectResult.clear(),t.params.updateBuffs(t),o.MRSystem.integration.flushEffectResultOneEntity(t)}callSymbol(t,e,i,s,a){return t._callBehaviorIterationHelper((n=>{const o=n[a];if(o){const r={self:t,sender:e,subject:i,args:s};return o.call(n,r,this)}return r.SCommandResponse.Pass}))}post(t,e,i,a,n,o){return this.pushRecodingCommandList(new u.STask("Post",(()=>{const s=this.callSymbol(t,e,i,a,n);return s!=r.SCommandResponse.Canceled&&o&&o(),s}))),s.Log.postCommand("Post"),this._recodingCommandList[this._recodingCommandList.length-1]}postCall(t){return this.pushRecodingCommandList(new u.STask("Call",(()=>(s.Log.doCommand("Call"),t(),r.SCommandResponse.Handled)))),s.Log.postCommand("Call"),this._recodingCommandList[this._recodingCommandList.length-1]}findReactorEntityInBlock(t,e){const i=t.layers();for(let t=i.length-1;t>=0;t--){const r=i[t].entities().find((t=>null!=t.queryReactions().find((t=>t.actionId==e))));if(r)return r}}openDialog(t,e,i){const a=()=>(s.Log.doCommand("OpenDialog"),o.MRSystem.dialogContext.setCauseEntity(t),n.MRLively.recorder.isPlayback()?o.MRSystem.dialogContext.open(new c.SActivityPlaybackDialog):o.MRSystem.dialogContext.open(e),r.SCommandResponse.Handled);return i?this.pushAfterChainCommandList(new u.STask("openDialog",a)):this.pushRecodingCommandList(new u.STask("openDialog",a)),s.Log.postCommand("openDialog"),e}displayFlavorEffect(t,e,i){if(e){if(e.text)for(const t of e.text)this.postMessage(t.format(...i.messageFormatArgs));e.sound&&d.SSoundManager.playSe(e.sound),e.rmmzAnimationId>0&&this.postAnimation(t,e.rmmzAnimationId,!1),e.motionId>0&&this.postSequel(t,e.motionId,void 0,void 0,i.motionObjectEntity)}}postSequel(t,e,i,n,o){(0,s.assert)(e>0);const c=null!=i?i:t.mx,l=null!=n?n:t.my,h=new a.SMotionSequel(t,e,c,l,o);return this.pushRecodingCommandList(new u.STask("Sequel",(()=>(s.Log.doCommand("Sequel"),this._sequelContext.addSequel(h),this._visualAnimationWaiting=!0,r.SCommandResponse.Handled)))),s.Log.postCommand("Sequel"),h}postAnimation(t,e,i){if(e<=0)return;this.pushRecodingCommandList(new u.STask("Animation",(()=>(s.Log.doCommand("Animation"),this._sequelContext.addSequel(new a.SAnumationSequel(t,e,i)),this._visualAnimationWaiting=!0,r.SCommandResponse.Handled)))),s.Log.postCommand("Animation")}postFloatingAnimation(t,e,i,n,o){if(console.log("postFloatingAnimation",e,i,n),n<=0)return;this.pushRecodingCommandList(new u.STask("Animation",(()=>(s.Log.doCommand("Animation"),this._sequelContext.addSequel(new a.SFloatingAnumationSequel(t,n,e,i,o)),this._visualAnimationWaiting=!0,r.SCommandResponse.Handled)))),s.Log.postCommand("Animation")}postBalloon(t,e,i){if(e<=0)return;this.pushRecodingCommandList(new u.STask("Balloon",(()=>(s.Log.doCommand("Balloon"),this._sequelContext.addSequel(new a.SBalloonSequel(t,e,i)),this._visualAnimationWaiting=!0,r.SCommandResponse.Handled)))),s.Log.postCommand("Balloon")}postWaitSequel(){this.pushRecodingCommandList(new u.STask("WaitSequel",(()=>(s.Log.doCommand("WaitSequel"),this._sequelContext.flushSequelSet(!0),this._visualAnimationWaiting=!0,r.SCommandResponse.Handled)))),s.Log.postCommand("WaitSequel")}postWait(t,e){this.pushRecodingCommandList(new u.STask("Wait",(()=>(s.Log.doCommand("Wait"),this._sequelContext.addSequel(new a.SWaitSequel(t,e)),this._visualAnimationWaiting=!0,r.SCommandResponse.Handled)))),s.Log.postCommand("Wait")}postEmitEffect(t,e,i,a,n){this.pushRecodingCommandList(new u.STask("ApplyEffect",(()=>(t.iterateBehaviorsReverse((s=>s.onEmitEffect(t,this,e,i,a,n)==r.SCommandResponse.Pass)),r.SCommandResponse.Pass)))),s.Log.postCommand("ApplyEffect")}postDestroy(t){this.pushRecodingCommandList(new u.STask("Destroy",(()=>(s.Log.doCommand("Destroy"),t.destroy(),r.SCommandResponse.Handled)))),s.Log.postCommand("Destroy")}postMessage(t){(0,s.assert)(t);this.pushRecodingCommandList(new u.STask("Message",(()=>(s.Log.doCommand("Message"),n.MRLively.messageHistory.add(t),r.SCommandResponse.Handled)))),s.Log.postCommand("Message")}postEffectResult(t){this.pushRecodingCommandList(new u.STask("EffectResult",(()=>(t?o.MRSystem.integration.flushEffectResultOneEntity(t):o.MRSystem.integration.flushEffectResult(),r.SCommandResponse.Handled))))}postTransferFloor(t,e,i=0,a=0,o=0){this.pushRecodingCommandList(new u.STask("TransferFloor",(()=>(s.Log.doCommand("TransferFloor"),n.MRLively.world.transferEntity(t,e,i,a),r.SCommandResponse.Handled)))),s.Log.postCommand("TransferFloor")}postSkipPart(t){const e=t.findEntityBehavior(l.LUnitBehavior);(0,s.assert)(e);this.pushRecodingCommandList(new u.STask("SkipPart",(()=>(s.Log.doCommand("SkipPart"),t._actionToken.clearActionTokenCount(),r.SCommandResponse.Handled)))),s.Log.postCommand("SkipPart")}visualAnimationWaiting(){return this._visualAnimationWaiting}clearVisualAnimationWaiting(){this._visualAnimationWaiting=!1}isRunning(){return null!=this._nextPriorityTask||this._messageIndex<this._runningCommandList.length||0!=this._recodingCommandList.length||0!=this._afterChainCommandList.length||0!=this.__whenWaitingTasks.length}isRecordingListEmpty(){return 0==this._recodingCommandList.length}isEmpty(){return!this.isRunning()&&this.isRecordingListEmpty()}_processCommand(){if(this._nextPriorityTask||this._messageIndex>=this._runningCommandList.length&&(this._recodingCommandList.length>0||this._afterChainCommandList.length>0)&&this._submit(),this.isRunning()){const t=this._nextPriorityTask?this._nextPriorityTask:this._runningCommandList[this._messageIndex];this._nextPriorityTask=void 0,t.call(this),this._nextPriorityTask||this._commandChainRunning&&(this._messageIndex++,this._messageIndex>=this._runningCommandList.length&&(this._commandChainRunning=!1,s.Log.d("<<<<[End CommandChain]"),(this._recodingCommandList.length>0||this._afterChainCommandList.length>0||this.__whenWaitingTasks.length>0)&&this._submit()))}}_submit(){if((0,s.assert)(!this._commandChainRunning),[this._runningCommandList,this._recodingCommandList]=[this._recodingCommandList,this._runningCommandList],this._recodingCommandList.splice(0),this._messageIndex=0,this.__whenWaitingTasks.length>0){const t=this.__whenWaitingTasks;this.__whenWaitingTasks=[];for(const e of t){(0,s.assert)(e._status==u.STaskStatus.Pending);let t=!0;for(const i of e._whenWaitingTasks)if(!i.isCompleted){t=!1;break}t?(console.log("when start"),this._runningCommandList.push(e)):this.__whenWaitingTasks.push(e)}}this._runningCommandList.length>0?(s.Log.d(">>>>[Start CommandChain]"),this._commandChainRunning=!0):this._afterChainCommandList.length>0&&([this._runningCommandList,this._afterChainCommandList]=[this._afterChainCommandList,this._runningCommandList],this._afterChainCommandList.splice(0),this._commandChainRunning=!0)}_setNextPriorityTask(t){(0,s.assert)(!this._nextPriorityTask),(0,s.assert)(t._status==u.STaskStatus.Pending),this._nextPriorityTask=t}dumpCommands(){this._runningCommandList.forEach((t=>{console.log("  "+t._name)}))}pushRecodingCommandList(t){(0,s.assert)(t._status==u.STaskStatus.Created),t._status=u.STaskStatus.Pending,this._recodingCommandList.push(t)}pushAfterChainCommandList(t){(0,s.assert)(t._status==u.STaskStatus.Created),t._status=u.STaskStatus.Pending,this._afterChainCommandList.push(t)}}},2994:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SWarehouseDialogResult=e.SStepPhase=void 0,function(t){t[t.RunStarting=0]="RunStarting",t[t.PhaseStarting=1]="PhaseStarting",t[t.StepStarting=2]="StepStarting",t[t.MainProcess=3]="MainProcess",t[t.MainProcessClosing=4]="MainProcessClosing",t[t.AfterProcess=5]="AfterProcess",t[t.AfterProcessClosing=6]="AfterProcessClosing",t[t.StepClosing=7]="StepClosing",t[t.PhaseClosing=8]="PhaseClosing",t[t.RunClosing=9]="RunClosing",t[t.Closed=10]="Closed"}(e.SStepPhase||(e.SStepPhase={})),function(t){t[t.Succeeded=0]="Succeeded",t[t.SucceededAsMuch=1]="SucceededAsMuch",t[t.Cancel=-1]="Cancel",t[t.FullyCanceled=-2]="FullyCanceled"}(e.SWarehouseDialogResult||(e.SWarehouseDialogResult={}))},2217:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SDebugHelpers=void 0;const r=i(4836);e.SDebugHelpers=class{static setHP(t,e){const i=t.getParamActualMax(r.MRBasics.params.hp);t.setActualDamgeParam(r.MRBasics.params.hp,i-e)}static setFP(t,e){const i=t.getParamActualMax(r.MRBasics.params.fp);t.setActualDamgeParam(r.MRBasics.params.fp,i-e)}}},4979:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SDialog=e.SDialogAction=void 0;const r=i(4765),s=i(1298),a=i(9115);var n;!function(t){t[t.None=0]="None",t[t.Submit=1]="Submit",t[t.Cancel=2]="Cancel",t[t.CloseAllSubDialogs=3]="CloseAllSubDialogs"}(n=e.SDialogAction||(e.SDialogAction={}));e.SDialog=class{constructor(){this._openedFloorId=r.LFloorId.makeEmpty(),this._dialogResult={action:n.None,selectedItems:[]}}onUpdate(t){}isVisualIntegration(){return!0}then(t){this._resultCallback=e=>{t(e)}}submit(){(0,s.assert)(this._dialogResult.action==n.None),this._dialogResult.action=n.Submit,this._closeSelfAndSubDialogs()}cancel(){(0,s.assert)(this._dialogResult.action==n.None),this._dialogResult.action=n.Cancel,this._closeSelfAndSubDialogs()}closeAllSubDialogs(){(0,s.assert)(a.MRSystem.dialogContext.dialogs().length>=2),(0,s.assert)(this._dialogResult.action==n.None),this._dialogResult.action=n.CloseAllSubDialogs,this._closeSelfAndSubDialogs()}_closeSelfAndSubDialogs(){a.MRSystem.dialogContext._closeDialog(this),this._resultCallbackVisual&&this._resultCallbackVisual(this),this._resultCallback&&this._resultCallback(this)}get dialogResult(){return this._dialogResult}get resultAction(){return this._dialogResult.action}get isSubmitted(){return this._dialogResult.action==n.Submit}openSubDialog(t,e){t._resultCallbackVisual=t=>{if(!(!!e&&e(t)))switch(t.resultAction){case n.Submit:this.submit();break;case n.Cancel:break;case n.CloseAllSubDialogs:a.MRSystem.dialogContext.dialogs().length>=2&&this.closeAllSubDialogs()}},a.MRSystem.dialogContext.open(t)}}},6179:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SDialogContext=void 0;const r=i(1298),s=i(7352),a=i(3175),n=i(9115),o=i(5157);e.SDialogContext=class{constructor(t){this._commandContext=t,this._dialogs=[]}open(t){t._openedFloorId=s.MRLively.map.floorId().clone(),this._dialogs.push(t),n.MRSystem.integration.openDialog(t)}pop(){const t=this.activeDialog()instanceof o.SActivityPlaybackDialog,e=!this.activeDialog()._openedFloorId.equals(s.MRLively.map.floorId());this._dialogs.pop(),0==this._dialogs.length&&s.MRLively.recorder.isRecording()&&(t||e||s.MRLively.recorder.push({type:a.ActivityRecordingCommandType.CloseMainDialog,activity:null}))}dialogs(){return this._dialogs}activeDialog(){return(0,r.assert)(this._hasDialogModel()),this._dialogs[this._dialogs.length-1]}causeEntity(){return this._causeEntity}commandContext(){return this._commandContext}postActivity(t){this._commandContext.postActivity(t),s.MRLively.recorder.isRecording()&&s.MRLively.recorder.push({type:a.ActivityRecordingCommandType.Activity,activity:t.toData()})}_closeDialog(t){(0,r.assert)(this.activeDialog()==t),this.pop(),n.MRSystem.integration.dialogClosed(this,t)}setCauseEntity(t){this._causeEntity=t}_hasDialogModel(){return this._dialogs.length>0}_update(){(0,r.assert)(this._hasDialogModel());const t=this.activeDialog();t.onUpdate(this),this._hasDialogModel()&&t.isVisualIntegration()&&n.MRSystem.integration.updateDialog(this)}}},7933:(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SEffectApplyer=exports.SParameterEffect=exports.SParameterEffectApplyType=exports.SEffectorFact=exports.SEffect=void 0;const MRBasics_1=__webpack_require__(4836),DEffect_1=__webpack_require__(4561),DItemEffect_1=__webpack_require__(2890),MRData_1=__webpack_require__(9185),LProjectileBehavior_1=__webpack_require__(9651),LBattlerBehavior_1=__webpack_require__(846),LEffectResult_1=__webpack_require__(3367),UIdentify_1=__webpack_require__(6296),UTransfer_1=__webpack_require__(3721),MRSystem_1=__webpack_require__(9115),SEffectContext_1=__webpack_require__(695),PluginParameters_1=__webpack_require__(3609),UState_1=__webpack_require__(4882),Common_1=__webpack_require__(1298);class SEffect{constructor(t,e){this._fact=t,this._data=e,this._parameterEffects2=[];for(const i of e.effect.parameterQualifyings){const e=new SParameterEffect(i);this._parameterEffects2.push(e);const r=t.subject().traitsWithId(MRBasics_1.MRBasics.traits.FixedDamage,i._parameterId).backOrUndefined();r&&(e.fixedDamage=r.value)}}fact(){return this._fact}subject(){return this._fact.subject()}data(){return this._data}get successRate(){return this.data().effect.successRate}isCertainHit(){return this.data().effect.hitType==DEffect_1.DEffectHitType.Certain}isPhysical(){return this.data().effect.hitType==DEffect_1.DEffectHitType.Physical}isMagical(){return this.data().effect.hitType==DEffect_1.DEffectHitType.Magical}hitRate(){const t=this.successRate;if(this.isPhysical()){const e=this.subject();return.01*t*(e?e.xparamOrDefault(MRBasics_1.MRBasics.xparams.hit,1):1)}return.01*t}evaRate(t){return this.isPhysical()?t.xparam(MRBasics_1.MRBasics.xparams.eva):this.isMagical()?t.xparam(MRBasics_1.MRBasics.xparams.mev):0}criRate(t){const e=this.subject(),i=e?e.xparam(MRBasics_1.MRBasics.xparams.cri):1;return this._data.effect.critical?i*(1-t.xparam(MRBasics_1.MRBasics.xparams.cev)):0}lukEffectRate(t){const e=this.subject(),i=e?e.getActualParam(MRBasics_1.MRBasics.params.luk):0,r=t.getActualParam(MRBasics_1.MRBasics.params.luk);return Math.max(1+.001*(i-r),0)}hasParamDamage(){return this._parameterEffects2.findIndex((t=>t&&t.applyType!=SParameterEffectApplyType.None))>=0}parameterEffects2(){return this._parameterEffects2}otherEffectQualifyings(){return this._data.effect.otherEffectQualifyings}effectBehaviors(){return this._data.effect.effectBehaviors}specialEffectQualifyings(){return this._data.effect.rmmzSpecialEffectQualifyings}buffQualifying(){return this._data.effect.buffQualifying}}exports.SEffect=SEffect;class SEffectorFact{constructor(t,e,i,r){this._effectors=[],this._effects=[],this._subject=t,this._subjectEffects=e,this._subjectBattlerBehavior=t.findEntityBehavior(LBattlerBehavior_1.LBattlerBehavior),this._incidentType=i,this._incidentEntityKind=0,this._direction=r,this._genericEffectRate=1;for(const t of e.targetEffects())this._effects.push(new SEffect(this,t));this._selfModifier=new SEffect(this,e.selfEffect),e.succeededSelfEffect&&(this._succeededSelfModifier=new SEffect(this,e.succeededSelfEffect)),this._subject.iterateBehaviors2((t=>(t.onCollectEffector(this._subject,this),!0)))}withIncidentEntityKind(t){return this._incidentEntityKind=t,this._incidentEntityKind>0?this._genericEffectRate=this._subject.traitsPi(MRBasics_1.MRBasics.traits.EffectProficiency,this._incidentEntityKind):this._incidentEntityKind=1,this}withItem(t){return this._item=t,this}withSkill(t){return this._sourceSkill=t,this}subject(){return this._subject}subjectBehavior(){return this._subjectBattlerBehavior}effectSet(){return this._subjectEffects}incidentType(){return this._incidentType}incidentEntityKind(){return this._incidentEntityKind}item(){return this._item}sourceSkill(){return this._sourceSkill}direction(){return this._direction}selfModifier(){return this._selfModifier}succeededSelfModifier(){return this._succeededSelfModifier}addEffector(t){this._effectors.push(t)}genericEffectRate(){return this._genericEffectRate}effects(){return this._effects}}var SParameterEffectApplyType;exports.SEffectorFact=SEffectorFact,function(t){t[t.None=0]="None",t[t.Damage=1]="Damage",t[t.Recover=2]="Recover"}(SParameterEffectApplyType=exports.SParameterEffectApplyType||(exports.SParameterEffectApplyType={}));class SParameterEffect{constructor(t){switch(this.qualifying=t,t.applyType){case DEffect_1.DParameterEffectApplyType.Damage:this.applyType=SParameterEffectApplyType.Damage,this.isDrain=!1;break;case DEffect_1.DParameterEffectApplyType.Recover:this.applyType=SParameterEffectApplyType.Recover,this.isDrain=!1;break;case DEffect_1.DParameterEffectApplyType.Drain:this.applyType=SParameterEffectApplyType.Damage,this.isDrain=!0;break;default:throw new Error}this.paramId=t._parameterId,this.elementIds=t.elementIds,(0,Common_1.assert)(this.elementIds.length>0),this.formula=t.formula,this.variance=t.variance,this._valid=!0}isRecover(){return this.applyType==SParameterEffectApplyType.Recover}get isValid(){return this._valid}set isValid(t){this._valid=t}evalConditions(t){this.qualifying.fallback?this._valid=!1:t.params.hasParam(this.paramId)?this._valid=this.meetsConditions(t):this._valid=!1}meetsConditions(target){if(this.qualifying.conditionTargetCategoryId>0&&this.qualifying.conditionTargetCategoryId!=target.kindDataId())return!1;if(!this.qualifying.conditionFormula)return!0;{const a=MRSystem_1.MRSystem.formulaOperandA;a.wrap(target);try{const r=eval(this.qualifying.conditionFormula);return r}catch(t){return console.error(t),!1}}}}exports.SParameterEffect=SParameterEffect;class SEffectApplyer{constructor(t,e){this._effect=t,this._rand=e}apply(t,e,i){const r=i._effectResult,s=this._effect.fact().sourceSkill();if(s&&i.traitsWithId(MRBasics_1.MRBasics.traits.SkillGuard,s).length>0)return;let a=!0;for(const t of e.parameterEffects2())t.evalConditions(i),t.isValid&&(a=!1);if(a){const t=e.parameterEffects2().find((t=>t.qualifying.fallback));t&&(t.isValid=!0)}for(const t of e.parameterEffects2())if(t&&t.applyType!=SParameterEffectApplyType.None){if(t.isValid&&0!=t.paramId){const e=this.makeDamageValue(t,i,r.critical);this.executeDamage(t,i,e,r)}for(const e of t.elementIds)for(const t of i.traitsWithId(MRBasics_1.MRBasics.traits.DeathVulnerableElement,e))this.addState(i,t.value,r)}for(const s of e.specialEffectQualifyings())this.applyItemEffect(t,i,s,r);for(const t of e.buffQualifying())i.addBuff(t),r.makeSuccess();for(const s of e.otherEffectQualifyings())this.applyOtherEffect(t,i,s,r);for(const r of e.effectBehaviors()){MRSystem_1.MRSystem.effectBehaviorManager.get(r.specialEffectId).onApplyTargetEffect(t,r,this._effect.fact().subject(),this._effect.fact().item(),e,i,i._effectResult)}this.applyItemUserEffect(i),i.refreshConditions();for(const t of r.paramEffects2)t.newValue=i.getActualParam(t.paramId)}makeDamageValue(t,e,i){if(!t.isRecover()&&t.fixedDamage)return t.fixedDamage;const r=this.evalDamageFormula(t,e);let s=r*this.calcElementRate(t,e);return this._effect.isPhysical()&&(s*=e.sparam(MRBasics_1.MRBasics.sparams.pdr)),this._effect.isMagical()&&(s*=e.sparam(MRBasics_1.MRBasics.sparams.mdr)),r<0&&(s*=this.elemetedRecoverRate(e,t)),r<0&&(s*=e.sparam(MRBasics_1.MRBasics.sparams.rec)),i&&(s=this.applyCritical(s)),s=this.applyVariance(s,t.variance),s=this.applyGuard(s,e),s=this.applyProficiency(s),s=this.applyDamageRate(s,t.paramId,e),s=this.applyRaceRate(s,e),s=Math.round(s),s}elemetedRecoverRate(t,e){let i=1;for(const r of e.elementIds)i*=t.traitsPi(MRBasics_1.MRBasics.traits.ElementedRecoveryRate,r);return i}evalDamageFormula(paramEffect,target){try{const a=MRSystem_1.MRSystem.formulaOperandA,b=MRSystem_1.MRSystem.formulaOperandB,c=MRSystem_1.MRSystem.formulaOperandC;a.wrap(this._effect.subject()),b.wrap(target),c.wrap(this._effect.fact().item());const v="undefined"==typeof $gameVariables?void 0:$gameVariables._data,sign=paramEffect.isRecover()?-1:1;let value=Math.max(eval(paramEffect.formula),0);return value=Math.max(value,1),value*=sign,isNaN(value)?0:value}catch(t){return 0}}calcElementRate(t,e){let i=1;for(const r of t.elementIds)if(r<0){const t=this._effect.subject(),r=t?t.attackElements():[];i*=this.elementsMaxRate(e,r)}else i*=e.elementRate(r);return i}elementsMaxRate(t,e){if(e.length>0){const i=e.map((e=>t.elementRate(e)));return Math.max(...i)}return 1}applyCritical(t){return 3*t}applyVariance(t,e){const i=Math.floor(Math.max(Math.abs(t)*e/100,0)),r=this._rand.nextIntWithMax(i+1)+this._rand.nextIntWithMax(i+1)-i;return t>=0?t+r:t-r}applyGuard(t,e){return t/1}applyProficiency(t){return t*this._effect.fact().genericEffectRate()}applyDamageRate(t,e,i){return t>0?t*i.traitsPi(MRBasics_1.MRBasics.traits.ParamDamageRate,e):t}getRacePointRate(t){return 0==t?1:.1}applyRaceRate(t,e){const i=this._effect.subject().traits(MRBasics_1.MRBasics.traits.RaceRate);if(i.length>0){const r=[];i.sort(((t,e)=>t.value-e.value));for(const t of i){void 0===r[t.dataId]&&(r[t.dataId]={value:0,count:0});const e=r[t.dataId];e.value+=t.value*this.getRacePointRate(e.count),e.count++}let s=0,a=0;for(const t of e.queryRaceIds())void 0!==r[t]&&(s+=r[t].value,a++);if(a>0)return s*t}return t}executeDamage(t,e,i,r){var s;const a=e.getActualParam(t.paramId);if(0===i&&(r.critical=!1),t.isDrain&&(i=Math.min(a,i)),r.makeSuccess(),t.qualifying.applyTarget==DEffect_1.DValuePoint.Actual)e.gainActualParam(t.paramId,-i,!1),i>0&&this.removeStatesByDamage(e,t.paramId),this.gainDrainedParam(t,i);else{if(t.qualifying.applyTarget!=DEffect_1.DValuePoint.Growth)throw new Error("Not implemented.");null===(s=e.params.params()[t.paramId])||void 0===s||s.gainEffortValue(-i)}if(!t.qualifying.silent){const e=new LEffectResult_1.LParamEffectResult(t.paramId);e.applyTarget=t.qualifying.applyTarget,e.damage=i,e.oldValue=a,e.parameterDamageEffect=t.qualifying,e.drain=t.isDrain,r.paramEffects2.push(e)}t.paramId==MRBasics_1.MRBasics.params.hp&&(r.hpAffected=!0)}gainDrainedParam(t,e){if(t.isDrain){let i=this._effect.subject();i&&i.gainActualParam(t.paramId,e,!1)}}applyItemEffect(t,e,i,r){switch(i.code){case DItemEffect_1.DItemEffect.EFFECT_RECOVER_HP:case DItemEffect_1.DItemEffect.EFFECT_RECOVER_MP:case DItemEffect_1.DItemEffect.EFFECT_GAIN_TP:throw new Error("Not implemented.");case DItemEffect_1.DItemEffect.EFFECT_ADD_STATE:this.itemEffectAddState(e,i,r);break;case DItemEffect_1.DItemEffect.EFFECT_REMOVE_STATE:this.itemEffectRemoveState(e,i,r);break;case DItemEffect_1.DItemEffect.EFFECT_ADD_BUFF:case DItemEffect_1.DItemEffect.EFFECT_ADD_DEBUFF:case DItemEffect_1.DItemEffect.EFFECT_REMOVE_BUFF:case DItemEffect_1.DItemEffect.EFFECT_REMOVE_DEBUFF:throw new Error("Not implemented.");case DItemEffect_1.DItemEffect.EFFECT_SPECIAL:this.itemEffectSpecial(t,e,i,r);break;case DItemEffect_1.DItemEffect.EFFECT_GROW:case DItemEffect_1.DItemEffect.EFFECT_LEARN_SKILL:case DItemEffect_1.DItemEffect.EFFECT_COMMON_EVENT:throw new Error("Not implemented.")}}applyOtherEffect(t,e,i,r){switch(i.key){case"kSystemEffect_ふきとばし":const i=this._effect.subject();LProjectileBehavior_1.LProjectileBehavior.startMoveAsProjectile(t,e,new SEffectContext_1.SEffectSubject(i),this._effect.fact().direction(),PluginParameters_1.paramThrowingDistance);break;case"kSystemEffect_脱出":t.postSequel(e,MRBasics_1.MRBasics.sequels.escape),UTransfer_1.UTransfer.exitLand(t,e,MRData_1.LandExitResult.Escape);break;case"kSystemEffect_識別":UIdentify_1.UIdentify.identify(t,e,!0);break;default:throw new Error("Not implemented.")}}applyItemUserEffect(t){}itemEffectAddState(t,e,i){0===e.dataId||this.itemEffectAddNormalState(t,e,i)}itemEffectAddNormalState(t,e,i){const r=MRData_1.MRData.states[e.dataId];if(!t.isStateAddable(e.dataId))return;if(!UState_1.UState.meetsApplyConditions(r,t))return;let s=e.value1;this._effect.isCertainHit()||(s*=t.stateRate(e.dataId),s*=this._effect.lukEffectRate(t)),this._rand.nextIntWithMax(100)<100*s&&this.addState(t,e.dataId,i)}addState(t,e,i){t.addState(e),i.makeSuccess();MRData_1.MRData.states[e].deadState&&i.clearParamEffects()}removeStatesByDamage(t,e){const i=[];t.iterateStates((t=>{const r=t.stateData();for(const s of r.effect.damageRemovels)s.paramId==e&&this._rand.nextIntWithMax(100)<s.chance&&i.push(t.stateDataId())})),t.removeStates(i)}itemEffectRemoveState(t,e,i){let r=e.value1;this._rand.nextIntWithMax(100)<100*r&&(t.removeState(e.dataId),i.makeSuccess())}itemEffectSpecial(t,e,i,r){i.dataId===DItemEffect_1.DItemEffect.SPECIAL_EFFECT_ESCAPE&&(t.postDestroy(e),r.makeSuccess())}}exports.SEffectApplyer=SEffectApplyer},695:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SEffectContext=e.SEffectSubject=e.SEffectIncidentType=void 0;const r=i(4836),s=i(9185),a=i(846),n=i(8254),o=i(5705),c=i(7352),l=i(7933),h=i(8665),u=i(1325),d=i(4977),p=i(6294),f=i(4598);var m;!function(t){t[t.DirectAttack=0]="DirectAttack",t[t.IndirectAttack=1]="IndirectAttack"}(m=e.SEffectIncidentType||(e.SEffectIncidentType={}));class y{constructor(t){this._entity=t}entity(){return this._entity}}e.SEffectSubject=y;class _{constructor(t,e){this._effectorFact=t,this._rand=e}effectorFact(){return this._effectorFact}applyWithWorth(t,e){const i=p.UEffect.resolveApplyEffects(this._effectorFact.effects(),e,t.random());for(const e of i.targets)for(const i of e.actualEffects)e.target.previewRejection(t,{kind:"Effect",effect:i.data()})&&this.applyWithHitTest(t,i,e.target,e.mainTarget);return t.postCall((()=>{}))}findAnimationEntity(t){if(!t.hasParent())return;const e=t.parentObject();return e.objectType()==d.LObjectType.Map&&t.objectType()==d.LObjectType.Entity?t:this.findAnimationEntity(e)}applyWithHitTest(t,e,i,r){const l=i.findEntityBehavior(a.LBattlerBehavior),u=e.data(),d=i._effectResult;d.clear(),d.sourceEffectId=u.effectId,u.effect.hasAnyValidEffect()&&d._revision++;{let r=!1;const a=e.data(),n=this._effectorFact.subjectBehavior(),o=n?n.attackAnimationId():s.MRData.system.bareHandsFlavorEffect,c=void 0===a.effect.flavorEffect?o:a.effect.flavorEffect;if(c){const e=this.findAnimationEntity(i);e&&(t.displayFlavorEffect(e,c,{messageFormatArgs:[]}),r=!0)}const l=this._effectorFact.effectSet().succeededSelfEffect;l&&l.effect.flavorEffect&&(t.displayFlavorEffect(e.subject(),l.effect.flavorEffect,{messageFormatArgs:[]}),r=!0),r&&t.postWaitSequel()}return t.postCall((()=>{l?(d.used=this.testApply(l),this.judgeHits(e,i,d),d.physical=e.isPhysical(),d.isHit()&&this.applyCore(t,e,i,d)):this.applyCore(t,e,i,d);const r=c.MRLively.camera.focusedEntity(),s=!!r&&n.Helpers.isFriend(e.subject(),r);d.focusedFriendly=!s||n.Helpers.isFriend(e.subject(),i);{const t=[];for(const r of e.parameterEffects2())r&&!r.isRecover()&&i.iterateStates((e=>(e.checkRemoveAtDamageTesting(r.paramId)&&t.push(e.stateDataId()),!0)));i.removeStates(t)}if(t.post(i,e.subject(),new y(this._effectorFact.subject()),void 0,h.onEffectResult),t.postEffectResult(i),i.isDeathStateAffected()){const t=i.findEntityBehavior(a.LBattlerBehavior);t instanceof o.LEnemyBehavior&&this._effectorFact.subject()._reward.addExp(t.exp())}}))}judgeHits(t,e,i){const r=this._effectorFact.subject();if(r&&_.judgeCertainHits(r,t,this._effectorFact.incidentType(),e,i))return;const s=100*t.hitRate(),a=100*t.evaRate(e);i.missed=i.used&&this._rand.nextIntWithMax(100)>=s,i.evaded=!i.missed&&this._rand.nextIntWithMax(100)<a}static judgeCertainHits(t,e,i,s,a){if(i==m.DirectAttack){if(t.traits(r.MRBasics.traits.CertainDirectAttack).length>0)return a.missed=!1,a.evaded=!1,!0}else if(i==m.IndirectAttack){const e=t.traits(r.MRBasics.traits.AwfulPhysicalIndirectAttack).length>0,i=t.traits(r.MRBasics.traits.CertainIndirectAttack).length>0,n=s.traits(r.MRBasics.traits.DodgePhysicalIndirectAttack).length>0;if(i&&n)return!1;if(n)return a.missed=!0,a.evaded=!0,!0;if(i)return a.missed=!1,a.evaded=!1,!0;if(e)return a.missed=!0,a.evaded=!0,!0}return!1}testApply(t){return this.testLifeAndDeath(t)}testLifeAndDeath(t){return!0}applyCore(t,e,i,r){{let r=u.SCommandResponse.Pass;if(i.iterateBehaviorsReverse((s=>(r=s.onPreApplyEffect(i,t,e),r==u.SCommandResponse.Pass))),r!=u.SCommandResponse.Pass)return}if(e.hasParamDamage()){const t=100*e.criRate(i);r.critical=this._rand.nextIntWithMax(100)<t}const s=new l.SEffectApplyer(e,this._rand);if(s.apply(t,e,i),s.apply(t,this._effectorFact.selfModifier(),this._effectorFact.subject()),i._effectResult.success){const e=this._effectorFact.succeededSelfModifier();e&&s.apply(t,e,this._effectorFact.subject())}f.UAction.postEffectSensed(t,i)}}e.SEffectContext=_},8510:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SEmittorPerformer=void 0;const r=i(4836),s=i(4561),a=i(6291),n=i(9185),o=i(9651),c=i(8665),l=i(7352),h=i(695),u=i(5150),d=i(6316),p=i(1298),f=i(5967),m=i(7933),y=i(1301),_=i(4598),g=i(3482),v=i(1325);class S{constructor(t,e){this._skillId=0,this._selectedTargetItems=[],this._effectDirection=0,this._subject=t,this._performer=e,this._onPerformed=void 0}static makeWithSkill(t,e,i){(0,p.assert)(i>0);const r=new S(t,e);return r._skillId=i,r}static makeWithEmitor(t,e,i){const r=new S(t,e);return r._emittor=i,r}setSkillId(t){return this._skillId=t,this}setEmittor(t){return this._emittor=t,this}setItemEntity(t){return this._itemEntity=t,this}setSelectedTargetItems(t){return this._selectedTargetItems=t,this}setDffectDirection(t){return this._effectDirection=t,this}setProjectilePriorityEffectSet(t){return this._projectilePriorityEffectSet=t,this}perform(t,e){if(this._onPerformed=e,this._skillId>0)this.performeSkill(t,this._performer,this._skillId);else{if(!this._emittor)throw new Error("Unreachable.");this.performeEffect(t,this._performer,this._emittor,this._effectDirection>0?this._effectDirection:this._performer.dir,this._itemEntity,this._selectedTargetItems,0)}}performeSkill(t,e,i){const r=n.MRData.skills[i];t.displayFlavorEffect(e,r.flavorEffect,{messageFormatArgs:[g.UName.makeUnitName(e),r.name]});const s=r.emittor();s&&this.performeEffect(t,e,s,e.dir,void 0,[],i)}canPayParamCost(t,e,i){if(i.type==s.DParamCostType.Decrease){if(t.getActualParam(e)<i.value)return!1}else{if(i.type!=s.DParamCostType.Increase)throw new Error("Unreachable.");if(t.getParamActualMax(e)-t.getActualParam(e)<i.value)return!1}return!0}payParamCost(t,e,i){if(i.type==s.DParamCostType.Decrease)t.gainActualParam(e,-i.value,!0);else{if(i.type!=s.DParamCostType.Increase)throw new Error("Unreachable.");t.gainActualParam(e,i.value,!0)}}canPaySkillCost(t,e,i){const r=e.paramCosts[s.DSkillCostSource.Actor];if(r)for(let e=0;e<r.length;e++){const i=r[e];if(void 0!==i&&!this.canPayParamCost(t,e,i))return!1}const a=e.paramCosts[s.DSkillCostSource.Item];if(a)for(let t=0;t<a.length;t++){const e=a[t];if(void 0!==e){if(!i)return!1;if(!this.canPayParamCost(i,t,e))return!1}}return!0}paySkillCost(t,e,i){const r=e.paramCosts[s.DSkillCostSource.Actor];if(r)for(let e=0;e<r.length;e++){const i=r[e];void 0!==i&&this.payParamCost(t,e,i)}const a=e.paramCosts[s.DSkillCostSource.Item];if(a)for(let t=0;t<a.length;t++){const e=a[t];void 0!==e&&((0,p.assert)(i),this.payParamCost(i,t,e))}}raiseSkillEmitted(t,e,i,s){const a={performer:e,targets:i,skillId:s};l.MRLively.eventServer.publish(t,r.MRBasics.events.skillEmitted,a)}onPerformed(t,e){if(this._onPerformed&&this._onPerformed(e),this._emittor){const i=this._emittor;for(const r of e)r.iterateBehaviorsReverse((e=>e.onEffectPerformed(r,t,i)==v.SCommandResponse.Pass))}}performeEffect(t,e,i,a,n,o,u){if(this.canPaySkillCost(e,i.costs,n))if(this.paySkillCost(e,i.costs,n),i.selfAnimationId>0&&t.postAnimation(e,i.selfAnimationId,!0),i.selfSequelId>0&&t.postSequel(e,i.selfSequelId,void 0,void 0,!0),i.scope.range==s.DEffectFieldScopeType.Performer){const r=new m.SEffectorFact(this._subject,i.effectSuite,h.SEffectIncidentType.IndirectAttack,a);n&&(r.withIncidentEntityKind(n.kindDataId()),r.withItem(n)),u>0&&r.withSkill(u);const s=new h.SEffectContext(r,t.random()),o=[e];t.postCall((()=>{s.applyWithWorth(t,o),this.onPerformed(t,o),u>0&&this.raiseSkillEmitted(t,e,o,u)}))}else if(i.scope.range==s.DEffectFieldScopeType.Front1){const s=d.UMovement.getFrontBlock(e);let a=i.targetAreaAnimationId;a<0&&(a=e.getAttackAnimationId(0)),t.postFloatingAnimation(e,s.mx,s.my,a,!1),t.postSequel(e,r.MRBasics.sequels.attack);{const r=this.getTargetInBlock(s,i.scope);for(const s of r){const r=new m.SEffectorFact(this._subject,i.effectSuite,h.SEffectIncidentType.DirectAttack,e.dir);n&&(r.withIncidentEntityKind(n.kindDataId()),r.withItem(n)),u>0&&r.withSkill(u);const a=new h.SEffectContext(r,t.random());d.UMovement.checkDiagonalWallCornerCrossing(e,e.dir)||t.post(s,e,new h.SEffectSubject(e),{effectContext:a},c.onAttackReaction).then((()=>(this.onPerformed(t,[s]),!0)))}u>0&&this.raiseSkillEmitted(t,e,r,u)}}else if(i.scope.range==s.DEffectFieldScopeType.StraightProjectile)this.performeEffect_StraightProjectile(t,e,i,n,e.mx,e.my,e.dir);else if(i.scope.range==s.DEffectFieldScopeType.ReceiveProjectile){const r=0!=this._effectDirection?this._effectDirection:e.dir,s=y.USearch.findFirstWallInDirection(e.mx,e.my,r);this.performeEffect_StraightProjectile(t,e,i,n,s.mx,s.my,d.UMovement.reverseDir(r))}else if(i.scope.range==s.DEffectFieldScopeType.Selection){const e=new m.SEffectorFact(this._subject,i.effectSuite,h.SEffectIncidentType.IndirectAttack,a);n&&(e.withIncidentEntityKind(n.kindDataId()),e.withItem(n)),u>0&&e.withSkill(u);new h.SEffectContext(e,t.random()).applyWithWorth(t,o),this.onPerformed(t,o)}else if(i.scope.range==s.DEffectFieldScopeType.Around||i.scope.range==s.DEffectFieldScopeType.AroundAndCenter){const r=i.scope.range==s.DEffectFieldScopeType.AroundAndCenter,a=[];y.USearch.iterateAroundEntities(e.mx,e.my,i.scope.length,r,(t=>{t.equals(e)||a.push(t)})),this.applyEffect(t,e,i,a,u,n)}else if(i.scope.range==s.DEffectFieldScopeType.Center){const r=[],s=l.MRLively.map.tryGetBlock(e.mx,e.my);if(s)for(const t of s.getEntities())t.equals(e)||r.push(t);this.applyEffect(t,e,i,r,u,n)}else if(i.scope.range==s.DEffectFieldScopeType.Room){const r=[];l.MRLively.map.room(e.roomId()).forEachEntities((t=>{_.UAction.testFactionMatch(e,t,s.DRmmzEffectScope.Opponent_All)&&r.push(t)})),this.applyEffect(t,e,i,r,u,n)}else{if(i.scope.range!=s.DEffectFieldScopeType.Map)throw new Error("Not implemented.");{const r=[];l.MRLively.map.entities().filter((t=>{_.UAction.testFactionMatch(e,t,s.DRmmzEffectScope.Everyone)&&r.push(t)})),this.applyEffect(t,e,i,r,u,n)}}}performeEffect_StraightProjectile(t,e,i,s,c,d,f){const m=a.DEntityCreateInfo.makeSingle(n.MRData.getEntity(i.scope.projectilePrefabKey).id).withStackCount(1),y=u.SEntityFactory.newEntity(m);l.MRLively.map.appearEntity(y,c,d),y.dir=f;const _=null==s?void 0:s.data.getReaction(r.MRBasics.actions.collide).emittors();let g=i;_&&((0,p.assert)(1==_.length),g=_[0]);let v=g;this._projectilePriorityEffectSet&&(v=this._projectilePriorityEffectSet),o.LProjectileBehavior.startMoveAsEffectProjectile(t,y,new h.SEffectSubject(e),f,i.scope.length,v)}applyEffect(t,e,i,r,s,a){const n=new m.SEffectorFact(this._subject,i.effectSuite,h.SEffectIncidentType.DirectAttack,e.dir);a&&(n.withIncidentEntityKind(a.kindDataId()),n.withItem(a)),s>0&&n.withSkill(s);const o=new h.SEffectContext(n,t.random());t.postCall((()=>{o.applyWithWorth(t,r),this.onPerformed(t,r),s>0&&this.raiseSkillEmitted(t,e,r,s)}))}getTargetInBlock(t,e){if(e.layerScope==f.DBlockLayerScope.TopOnly){for(let i=f.DBlockLayerKind.Top;i>=0;i--)if(e.layers.includes(i)){const e=t.layer(i).firstEntity();if(e)return[e]}return[]}throw e.layerScope==f.DBlockLayerScope.All?new Error("Not implemented."):new Error("Unreachable.")}}e.SEmittorPerformer=S},5150:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SEntityFactory=void 0;const r=i(9185),s=i(7352),a=i(639),n=i(6501),o=i(7922),c=i(8727),l=i(9248),h=i(9543),u=i(6559),d=i(5705),p=i(5858),f=i(913),m=i(6291),y=i(5748),_=i(985),g=i(2205),v=i(5045),S=i(9651),M=i(6464),R=i(4146),b=i(5346),E=i(943),I=i(6316),x=i(7872),w=i(1298),T=i(6668),D=i(4836),P=i(2999),A=i(9115),k=i(3542),C=i(1524),L=i(2689),B=i(4245),F=i(2384),O=i(5870),N=i(321),j=i(1292),U=i(4419),V=i(4797),H=i(7673),W=i(1289);e.SEntityFactory=class{static newActor(t){const e=s.MRLively.world.spawnEntity(t);return this.buildActor(e),e}static setupCommon(t){t.addBehavior(c.LCommonBehavior),t.addBehavior(S.LProjectileBehavior),t.addBehavior(h.LItemBehavior)}static buildActor(t){(0,w.assert)(0===t.behaviorIds().length),this.setupCommon(t),t.addBehavior(a.LDecisionBehavior),t.addBehavior(n.LUnitBehavior).setFactionId(r.MRData.system.factions.player),t.addBehavior(l.LInventoryBehavior),t.addBehavior(f.LEquipmentUserBehavior),t.addBehavior(V.LExperienceBehavior),t.addBehavior(_.LActorBehavior),t.addBehavior(v.LEaterBehavior),t.addBehavior(M.LSurvivorBehavior)}static buildMonster(t,e){this.setupCommon(t),t.addBehavior(a.LDecisionBehavior),t.addBehavior(n.LUnitBehavior).setFactionId(e.factionId),t.addBehavior(l.LInventoryBehavior),t.addBehavior(d.LEnemyBehavior),t.addBehavior(H.LRaceBehavior),g.SBehaviorFactory.attachBehaviors(t,e.entity.behaviors),this.setupDirectly_Enemy(t,e)}static buildItem(t){this.setupCommon(t);const e=t.data;e.entity.kindId!=D.MRBasics.entityCategories.WeaponKindId&&e.entity.kindId!=D.MRBasics.entityCategories.ShieldKindId||t.addBehavior(p.LEquipmentBehavior),g.SBehaviorFactory.attachBehaviors(t,e.entity.behaviors);for(const i of e.entity.abilityNames){const e=r.MRData.abilities.find((t=>t.key==i));if(!e)throw new Error(`Ability "${i}" not found.`);t.addAbility(e.id)}this.setupDirectly_Item(t,e)}static buildTrap(t,e){r.MRData.itemData(e);this.setupCommon(t),t.addBehavior(u.LTrapBehavior)}static newBasicExitPoint(){const t=s.MRLively.world.spawnEntity(r.MRData.getEntity("kEntity_ExitPointA").id);return this.buildExitPoint(t),t}static buildEntryPoint(t){t.addBehavior(S.LProjectileBehavior),t.addBehavior(y.LEntryPointBehavior)}static buildExitPoint(t){t.addBehavior(S.LProjectileBehavior),t.addBehavior(o.LExitPointBehavior)}static buildOrnament(t,e){t.addBehavior(S.LProjectileBehavior)}static newEntity(t,e){const i=r.MRData.entities[t.entityId],a=s.MRLively.world.spawnEntity(i.id);this.buildEntity(a);for(const e of t.stateIds)a.addState(e);a._name=t.debugName,void 0!==t.stackCount?a._stackCount=t.stackCount:void 0!==i.initialStackCount?a._stackCount=s.MRLively.world.random().nextIntWithMinMax(i.initialStackCount.minValue,i.initialStackCount.maxValue+1):a._stackCount=1,e&&e.landData().checkIdentifiedEntity(a.kindData())&&a.setIndividualIdentified(!0);{const e=a.findEntityBehavior(B.LGoldBehavior);e&&e.setGold(t.gold)}return a}static buildEntity(t){const e=t.dataId;(0,w.assert)(e>0);const i=r.MRData.entities[e],s=r.MRData.prefabs[i.prefabId];W.DEntityCategory.isMonster(i)?this.buildMonster(t,i):W.DEntityCategory.isTrap(i)?this.buildTrap(t,i.item().id):W.DEntityCategory.isEntryPoint(i)?this.buildEntryPoint(t):W.DEntityCategory.isExitPoint(i)?this.buildExitPoint(t):W.DEntityCategory.isOrnament(i)?this.buildOrnament(t,s):this.buildItem(t)}static spawnTroopAndMembers(t,e,i,r){const a=[],n=s.MRLively.world.newParty();for(const o of t.members){const t=this.newEntity(m.DEntityCreateInfo.makeSingle(o,r),s.MRLively.map.floorId());n.addMember(t),a.push(t);const c=I.UMovement.selectNearbyLocatableBlock(s.MRLively.world.random(),e,i,t.getHomeLayer(),t);c&&s.MRLively.world.transferEntity(t,s.MRLively.map.floorId(),c.mx,c.my)}return a}static setupDirectly_Item(t,e){switch(e.entity.key){case"kEntity_聖域の巻物A":t.addBehavior(b.LSanctuaryBehavior),t.addBehavior(E.LGlueToGroundBehavior);break;case"kEntity_保存の壺A":t.addBehavior(l.LInventoryBehavior),t.addBehavior(T.LStorageBehavior);break;case"kEntity_GoldA":t.addBehavior(B.LGoldBehavior);break;case"kEntity_転ばぬ先の杖A":t.addBehavior(j.LStumblePreventionBehavior);break;case"kEntity_RevivalGrassA":t.addBehavior(U.LActivityCharmBehavior)}A.MRSystem.ext.onNewEntity(t,e)}static setupDirectly_Enemy(t,e){switch(e.entity.key){case"kEnemy_バットA":case"kEnemy_黒幕バットA":t.addBehavior(P.LRatedRandomAIBehavior);break;case"kEnemy_ウルフA":t.addBehavior(O.LParamBehavior).setParamBase(D.MRBasics.params.agi,100);break;case"kEnemy_苗色スライムA":t.addBehavior(R.LEntityDivisionBehavior);break;case"kEnemy_軍隊ウルフA":t.addBehavior(x.LFlockBehavior);break;case"kEnemy_バインドゴーレムA":t.addBehavior(k.LGrabFootBehavior);break;case"kEnemy_NPC汎用A":t.getEntityBehavior(n.LUnitBehavior).setFactionId(r.MRData.system.factions.neutral);break;case"kEnemy_瑠璃猫A":t.addBehavior(C.LItemThiefBehavior);break;case"kEnemy_小金猫A":t.addBehavior(F.LGoldThiefBehavior);break;case"kEnemy_金剛猫A":t.addBehavior(N.LEscapeBehavior),t.addBehavior(O.LParamBehavior).setParamBase(D.MRBasics.params.agi,100);break;case"kEnemy_店主A":t.addBehavior(L.LShopkeeperBehavior)}A.MRSystem.ext.onNewEntity(t,e)}}},4271:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SFormulaOperand=void 0;const r=i(1298),s=i(4836),a=i(9185),n=i(3609);e.SFormulaOperand=class{constructor(){var t={};for(const e of a.MRData.parameters)t[e.code]={get:()=>{if(n.paramPowerToAtk&&e.id==s.MRBasics.params.atk){const t=this.entity(),e=t.getActualParam(s.MRBasics.params.atk);return e+e*((t.getActualParam(s.MRBasics.params.pow)-8)/16)}return this.entity().getActualParam(e.id)},configurable:!0},t["max_"+e.code]={get:()=>this.entity().getParamActualMax(e.id),configurable:!0};Object.defineProperties(this,t)}entity(){return(0,r.assert)(this._entity),this._entity}wrap(t){this._entity=t}}},7295:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SGameManager=void 0;const r=i(7352),s=i(9154),a=i(6229),n=i(4997),o=i(4168),c=i(9185),l=i(5207),h=i(8444),u=i(9115),d=i(3175),p=i(1298),f=i(3587),m=i(4207),y=i(7043),_=i(8741),g=i(5557),v=i(4519),S=i(312),M=i(5449),R=i(894),b=i(6251),E=i(9662),I=i(6179),x=i(6011),w=i(4879),T=i(3721),D=i(4977),P=i(1336),A=i(8124),k=i(4271),C=(i(9248),i(6291),i(6294)),L=i(4836),B=(i(913),i(5372));e.SGameManager=class{static createSystemObjects(){u.MRSystem.sequelContext=new m.SSequelContext,u.MRSystem.commandContext=new y.SCommandContext(u.MRSystem.sequelContext),u.MRSystem.dialogContext=new I.SDialogContext(u.MRSystem.commandContext),u.MRSystem.turnContext=new P.STurnContext,u.MRSystem.scheduler=new l.SScheduler,u.MRSystem.minimapData=new v.SMinimapData,u.MRSystem.mapManager=new E.SMapManager,u.MRSystem.groundRules=new x.SGroundRules,u.MRSystem.effectBehaviorManager=new A.SSpecialEffectManager,u.MRSystem.requestedPlayback=!1,u.MRSystem.formulaOperandA=new k.SFormulaOperand,u.MRSystem.formulaOperandB=new k.SFormulaOperand,u.MRSystem.formulaOperandC=new k.SFormulaOperand}static createGameObjects(){this.createSystemObjects(),r.MRLively.immediatelyCommandExecuteScheduler=new _.SImmediatelyCommandExecuteScheduler,r.MRLively.system=new o.LSystem,r.MRLively.world=new n.LWorld,r.MRLively.map=new a.LMap,r.MRLively.camera=new h.LCamera,r.MRLively.scheduler=new S.LScheduler2,r.MRLively.recorder=new d.SActivityRecorder,r.MRLively.messageHistory=new f.LMessageHistory,r.MRLively.eventServer=new g.LEventServer,r.MRLively.chronus=new B.LChronus,r.MRLively.borderWall=new w.LBlock(-1,-1),r.MRLively.world._registerObject(r.MRLively.map);for(const t of c.MRData.actors)if(t>0){const e=c.MRData.entities[t].actorData();if(e.id>0){const i=s.SEntityFactory.newActor(t);i.mx=e.initialX,i.my=e.initialY,r.MRLively.system.uniqueActorUnits.push(i.entityId().clone())}}}static setupNewGame(){let t;r.MRLively.world.iterateEntity((e=>e.dataId!=c.MRData.system.initialPartyMembers[0]||(t=e,!1))),(0,p.assert)(t),r.MRLively.system.mainPlayerEntityId=t.entityId(),r.MRLively.camera.focus(t);const e=r.MRLively.world.newParty();e.addMember(t),T.UTransfer.transterRmmzDirectly($dataSystem.startMapId,$dataSystem.startX,$dataSystem.startY),e.startChallenging()}static performFloorTransfer(){if(r.MRLively.camera.isFloorTransfering()){const t=r.MRLively.map.floorId(),e=r.MRLively.camera.transferingNewFloorId();if(e.landId()!=t.landId()&&r.MRLively.world.land(e.landId()).resetIdentifyer(),e.isTacticsMap()){const t=r.MRLively.world.random(),i=t.nextInt();console.log("seed:",i);const s=new M.FMap(e,i);if(e.rmmzFixedMapId()>0){u.MRSystem.integration.onLoadFixedMapData(s);(new R.FMapBuilder).buildForFixedMap(s)}else{const i=e.floorInfo(),r=i.presetId?c.MRData.floorPresets[i.presetId]:c.MRData.floorPresets[L.MRBasics.defaultTerrainPresetId],a=C.UEffect.selectRating(t,r.terrains,(t=>t.rating));(0,p.assert)(a);const n=c.MRData.terrainSettings[a.terrainSettingsId];new b.FGenericRandomMapGenerator(s,n).generate();(new R.FMapBuilder).buildForRandomMap(s),s.print()}r.MRLively.map._removeAllEntities(),r.MRLively.map.setup(e,s),u.MRSystem.mapManager.setMap(r.MRLively.map),u.MRSystem.mapManager.setupMap(s)}else r.MRLively.map.setupForRMMZDefaultMap(e);u.MRSystem.minimapData.clear(),u.MRSystem.scheduler.reset(),r.MRLively.camera.clearFloorTransfering(),p.Log.d("PerformFloorTransfer")}}static makeSaveContentsCore(){let t={};return t.system=r.MRLively.system,t.world=r.MRLively.world,t.map=r.MRLively.map,t.camera=r.MRLively.camera,t.scheduler=r.MRLively.scheduler,t.messageHistory=r.MRLively.messageHistory,t.eventServer=r.MRLively.eventServer,t.chronus=r.MRLively.chronus,t}static loadSaveContentsCore(t){r.MRLively.system=t.system,r.MRLively.world=t.world,r.MRLively.map=t.map,r.MRLively.camera=t.camera,r.MRLively.scheduler=t.scheduler,r.MRLively.messageHistory=t.messageHistory,r.MRLively.eventServer=t.eventServer,r.MRLively.chronus=t.chronus}static makeSaveContents(){const t=this.makeSaveContentsCore();return u.MRSystem.floorStartSaveContents||(u.MRSystem.floorStartSaveContents=JsonEx.stringify(t)),t}static loadGameObjects(t){this.loadSaveContentsCore(t);const e=r.MRLively.world.objects().find((t=>t&&t.objectType()==D.LObjectType.Map));(0,p.assert)(e),r.MRLively.map=e,u.MRSystem.mapManager.setMap(r.MRLively.map),u.MRSystem.mapManager.requestRefreshVisual()}static loadGame(t,e){if(this.createSystemObjects(),this.loadGameObjects(t),!u.MRSystem.requestedRestartFloorItem.hasAny()&&e)try{r.MRLively.recorder.attemptStartPlayback(!1)}catch(t){throw console.error(t),t}}}},6011:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SGroundRules=void 0;e.SGroundRules=class{onEntityLandLeaved(t){}}},8741:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SImmediatelyCommandExecuteScheduler=void 0;const r=i(7352),s=i(9115);e.SImmediatelyCommandExecuteScheduler=class{stepSimulation(){const t=s.MRSystem.dialogContext,e=s.MRSystem.commandContext;for(;;){if(e.isRunning())return e._processCommand(),void s.MRSystem.sequelContext.attemptFlush(!1);if(e.isRecordingListEmpty()||e._submit(),t._hasDialogModel()&&(t._update(),t._hasDialogModel()))return;if(e.isRunning()||r.MRLively.world._removeDestroyedObjects(),e.isEmpty())break}}}},3024:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SIntegration=void 0;const r=i(7352),s=i(4977),a=i(9115);e.SIntegration=class{refreshGameMap(t){r.MRLively.recorder.isSilentPlayback()||this.onRefreshGameMap(t)}flushEffectResultOneEntity(t){t._effectResult.hasResult()&&(this.onFlushEffectResult(t),t._effectResult.showResultMessages(a.MRSystem.commandContext,t),t._effectResult.clear())}flushEffectResult(){for(const t of r.MRLively.world.objects())if(t&&t.objectType()==s.LObjectType.Entity){const e=t;this.flushEffectResultOneEntity(e)}}flushSequelSet(t){r.MRLively.recorder.isSilentPlayback()||this.onFlushSequelSet(t)}checkVisualSequelRunning(){return!r.MRLively.recorder.isSilentPlayback()&&this.onCheckVisualSequelRunning()}openDialog(t){r.MRLively.recorder.isSilentPlayback()||this.onOpenDialog(t)}updateDialog(t){r.MRLively.recorder.isSilentPlayback()||this.onUpdateDialog(t)}dialogClosed(t,e){r.MRLively.recorder.isSilentPlayback()||this.onDialogClosed(t,e)}entityEnteredMap(t){r.MRLively.recorder.isSilentPlayback()||this.onEntityEnteredMap(t)}entityLeavedMap(t){r.MRLively.recorder.isSilentPlayback()||this.onEntityLeavedMap(t)}entityReEnterMap(t){r.MRLively.recorder.isSilentPlayback()||this.onEntityReEnterMap(t)}}},9662:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SMapManager=void 0;const r=i(7352),s=i(9115),a=i(9154),n=i(1298),o=i(9185),c=i(4977),l=i(6316),h=i(99),u=i(4325),d=i(7991),p=i(2011),f=i(1301),m=i(5967),y=i(1584),_=i(1695),g=i(3609),v=i(1289),S=i(6294);e.SMapManager=class{constructor(){this._enemySpanwRate=10,this._enemySpawnCount=0,this._needRefreshVisual=!1,this._map=r.MRLively.map,this._enemySpawnCount=this._enemySpanwRate}get exitPoint(){return(0,n.assert)(this._exitPoint),this._exitPoint}setMap(t){this._map=t}map(){return this._map}rand(){return r.MRLively.world.random()}setupMap(t){const e=this._map.floorId();e.isNormalMap()||(e.isRandomMap()?this.setupRandomMap(t):this.setupFixedMap(t))}setupRandomMap(t){const e=this._map.floorId();this.requestRefreshVisual();{const i=t.exitPont();if(i){const t=o.MRData.lands[e.landId()].appearanceTable.system[e.floorNumber()].find((t=>v.DEntityCategory.isExitPoint(t.spawiInfo.entityData())));(0,n.assert)(t),this._exitPoint=a.SEntityFactory.newBasicExitPoint(),r.MRLively.world.transferEntity(this._exitPoint,e,i.mx(),i.my())}}const i=this.enterEntitiesToCurrentMap();this.buildStructurs();for(const t of i)if(t.floorId.equals(this._map.floorId())){const e=t.getHomeLayer(),i=this.findSpawnableBlockRandom(e);(0,n.assert)(i),l.UMovement.locateEntity(t,i.mx,i.my)}for(let t=0;t<5;t++){const t=this._map.getSpawnableBlocks(m.DBlockLayerKind.Unit);if(t.length>0){const e=t[this.rand().nextIntWithMax(t.length)];this.spawnEnemy(e.mx,e.my)}}for(let t=0;t<5;t++){const t=this._map.getSpawnableBlocks(m.DBlockLayerKind.Ground);if(t.length>0){const e=t[this.rand().nextIntWithMax(t.length)];this.spawnItem(e.mx,e.my)}}this.spawnTraps(5);const c=this._map.land2().landData().appearanceTable.events[e.floorNumber()];for(const t of c)s.MRSystem.integration.onLocateRmmzEvent(t.rmmzEventId,0,0)}setupFixedMap(t){s.MRSystem.integration.onLoadFixedMapEvents(),this.buildStructurs();const e=this.enterEntitiesToCurrentMap(),i=t.entryPoint();(0,n.assert)(i);for(const t of e)t.isOnOffstage()&&l.UMovement.locateEntity(t,i.mx(),i.my())}setupInitial(){}buildStructurs(){for(const t of this._map.structures())if(0==t.id());else if(t instanceof u.LMonsterHouseStructure){(new h.SMonsterHouseBuilder).build(this,t,this.rand())}else{if(!(t instanceof d.LItemShopStructure))throw new Error("Not implemented.");console.log("ItemShop!!");(new p.SItemShopBuilder).build(this,t,this.rand())}}requestRefreshVisual(){this._needRefreshVisual=!0}attemptRefreshVisual(){this._needRefreshVisual&&(this._map.floorId().isRandomMap()&&s.MRSystem.integration.refreshGameMap(r.MRLively.map),this._needRefreshVisual=!1)}updateRound(){this._enemySpawnCount--,this._enemySpawnCount<=0&&(this._enemySpawnCount=this._enemySpanwRate,this.spawnRandomEnemy())}enterEntitiesToCurrentMap(){const t=r.MRLively.camera.focusedEntity();(0,n.assert)(t);const e=[],i=(this._map.floorId().isFixedMap(),r.MRLively.world.objects());for(let t=1;t<i.length;t++){const r=i[t];if(r&&r.objectType()==c.LObjectType.Entity){const t=r,i=t.hasParent();if(t.isAppearedOnMap())continue;this._map.floorId().equals(t.floorId)&&!i&&(this._map._reappearEntity(t),e.push(t))}}return e}findSpawnableBlockRandom(t){const e=this._map.roomFloorBlocks().filter((e=>e.isContinuation()&&!e.layer(t).isContainsAnyEntity()));if(0==e.length)return;const i=e;return 0!=i.length?i[this.rand().nextIntWithMax(i.length)]:void 0}spawnRandomEnemy(){const t=f.USearch.selectUnitSpawnableBlock(this.rand());if(!t)throw new Error("Not implemented.");this.spawnEnemy(t.mx,t.my)}spawnEnemy(t,e){const i=this._map.floorId(),s=this._map.land2().landData().appearanceTable;if(0==s.enemies.length)return[];const n=s.enemies[i.floorNumber()];if(0==n.length)return[];const c=S.UEffect.selectRatingForce(this.rand(),n,100,(t=>t.spawiInfo.rate));let h;if(c.spawiInfo.troopId>0)h=a.SEntityFactory.spawnTroopAndMembers(o.MRData.troops[c.spawiInfo.troopId],t,e,c.spawiInfo.stateIds);else{const s=a.SEntityFactory.newEntity(c.spawiInfo,i);r.MRLively.world.transferEntity(s,i,t,e),h=[s]}const u=this.rand().select(l.UMovement.directions);for(const t of h)t.dir=u;return h}spawnItem(t,e){const i=this._map.floorId(),s=y.USpawner.createItemFromSpawnTable(i,this.rand());return s&&r.MRLively.world.transferEntity(s,i,t,e),s}spawnTrap(t,e){const i=this._map.floorId(),s=y.USpawner.createTrapFromSpawnTable(i,this.rand());s&&r.MRLively.world.transferEntity(s,i,t,e)}spawnTraps(t){const e=g.paramMaxTrapsInMap-_.ULimitations.getTrapCountInMap(),i=Math.min(t,e),r=this._map.getSpawnableBlocks(m.DBlockLayerKind.Ground);for(let t=0;t<i;t++)if(r.length>0){const t=r[this.rand().nextIntWithMax(r.length)];this.spawnTrap(t.mx,t.my);r.mutableRemove((e=>e==t))}}}},4519:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SMinimapData=void 0;const r=i(1298),s=i(5449),a=i(846),n=i(9543),o=i(6559),c=i(7922),l=i(7352),h=i(8254),u=i(5107),d=i(9901),p=i(2213),f=i(2593);var m;!function(t){t[t.UL=0]="UL",t[t.UR=1]="UR",t[t.LL=2]="LL",t[t.LR=3]="LR"}(m||(m={}));class y{constructor(){this._width=0,this._height=0,this._data=[],this._tilemapResetNeeded=!0,this._refreshNeeded=!0}clear(){this._width=0,this._height=0,this._tilemapResetNeeded=!0}reset(t,e){this._width=t,this._height=e,this._data=new Array(this._width*this._height*4),this._tilemapResetNeeded=!0}width(){return this._width}height(){return this._height}data(){return this._data}setData(t,e,i,s){(0,r.assert)(this.isValid(t,e,i)),this._data[(i*this._height+e)*this._width+t]=s}getData(t,e,i){return(0,r.assert)(this.isValid(t,e,i)),this._data[(i*this._height+e)*this._width+t]}isValid(t,e,i){return 0<=t&&t<this._width&&0<=e&&e<this._height&&0<=i&&i<4}isTilemapResetNeeded(){return this._tilemapResetNeeded}clearTilemapResetNeeded(){this._tilemapResetNeeded=!1}setTilemapResetNeeded(){this._tilemapResetNeeded=!0}setRefreshNeeded(){this._refreshNeeded=!0}playerMarkerTileId(){return p.DHelpers.TILE_ID_A5+9}itemMarkerTileId(){return p.DHelpers.TILE_ID_A5+10}enemyMarkerTileId(){return p.DHelpers.TILE_ID_A5+11}exitMarkerTileId(){return p.DHelpers.TILE_ID_A5+14}refresh(){const t=l.MRLively.map,e=t.width(),i=t.height();for(let r=0;r<i;r++)for(let i=0;i<e;i++){const e=t.block(i,r);switch(e._blockComponent){default:const t=this.getAutotileShape(i,r,s.FBlockComponent.None);e._passed?this.setData(i,r,0,p.DHelpers.TILE_ID_A2+t):this.setData(i,r,0,0);break;case s.FBlockComponent.Room:case s.FBlockComponent.Passageway:e._passed?this.setData(i,r,0,p.DHelpers.TILE_ID_A5+1):this.setData(i,r,0,0)}}this._refreshNeeded=!1}update(){const t=l.MRLively.map,e=t.width(),i=t.height(),s=l.MRLively.camera.focusedEntity();(0,r.assert)(s),e==this._width&&i==this._height||this.reset(e,i),this._refreshNeeded&&this.refresh();for(let t=0;t<i;t++)for(let i=0;i<e;i++)this.setData(i,t,1,0);for(const e of t.entities()){const t=e.queryMinimapMarkerClass();if(t!=f.LMinimapMarkerClass.None){if(t!==f.LMinimapMarkerClass.Item)throw new Error("Not implemetend.");this.setData(e.mx,e.my,1,this.itemMarkerTileId())}else{const t=this.getDefiniteMarkerTileId(s,e);t&&this.setData(e.mx,e.my,1,t)}}}getDefiniteMarkerTileId(t,e){if(!d.SView.getMinimapVisibility(e).visible)return 0;if(e.entityId().equals(t.entityId()))return this.playerMarkerTileId();if(u.SNavigationHelper.testVisibilityForMinimap(t,e)){if(e.findEntityBehavior(o.LTrapBehavior))return p.DHelpers.TILE_ID_A5+13;if(e.findEntityBehavior(a.LBattlerBehavior))return h.Helpers.isHostile(t,e)?this.enemyMarkerTileId():p.DHelpers.TILE_ID_A5+12;if(e.findEntityBehavior(n.LItemBehavior))return this.itemMarkerTileId();if(e.findEntityBehavior(c.LExitPointBehavior))return this.exitMarkerTileId()}return 0}getAutotileShape(t,e,i){let r=[0,0,0,0];{const s=[{x:-1,y:-1},{x:1,y:-1},{x:-1,y:1},{x:1,y:1}];for(let a=0;a<4;a++){const n=s[a].x,o=s[a].y,c=this.getSameKindTile(t+n,e+o,i),l=this.getSameKindTile(t+n,e,i),h=this.getSameKindTile(t,e+o,i);r[a]=c&&h&&l?1:!c&&h&&l?2:!h&&l?3:h&&!l?4:5}}const s=y._subtileToAutoTileTable.findIndex((t=>t[m.UL]==r[m.UL]&&t[m.UR]==r[m.UR]&&t[m.LL]==r[m.LL]&&t[m.LR]==r[m.LR]));return s>=0?s:0}getSameKindTile(t,e,i){const r=l.MRLively.map.tryGetBlock(t,e);return!r||(!r._passed||r._blockComponent==i)}}e.SMinimapData=y,y._subtileToAutoTileTable=[[1,1,1,1],[2,1,1,1],[1,2,1,1],[2,2,1,1],[1,1,1,2],[2,1,1,2],[1,2,1,2],[2,2,1,2],[1,1,2,1],[2,1,2,1],[1,2,2,1],[2,2,2,1],[1,1,2,2],[2,1,2,2],[1,2,2,2],[2,2,2,2],[4,1,4,1],[4,2,4,1],[4,1,4,2],[4,2,4,2],[3,3,1,1],[3,3,1,2],[3,3,2,1],[3,3,2,2],[1,4,1,4],[1,4,2,4],[2,4,1,4],[2,4,2,4],[1,1,3,3],[2,1,3,3],[1,2,3,3],[2,2,3,3],[4,4,4,4],[3,3,3,3],[5,3,4,1],[5,3,4,2],[3,5,1,4],[3,5,2,4],[1,4,3,5],[2,4,3,5],[4,1,5,3],[4,2,5,3],[5,5,4,4],[5,3,5,3],[4,4,5,5],[3,5,3,5],[5,5,5,5],[5,5,5,5]],y._subtileToAutoTileTable_Wall=[[1,1,1,1],[4,1,4,1],[3,3,1,1],[5,2,4,1],[1,4,1,4],[4,4,4,4],[3,5,1,4],[5,5,4,4],[1,1,3,3],[4,1,5,4],[3,3,3,3],[5,3,5,3],[1,4,3,5],[4,4,5,5],[3,5,3,5],[5,5,5,5]]},5107:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SNavigationHelper=void 0;const r=i(6559),s=i(7352),a=i(4836),n=i(7922),o=i(3609),c=i(6316),l=i(8254);e.SNavigationHelper=class{static testVisibilityForMinimap(t,e){const i=s.MRLively.map,n=s.MRLively.map.block(e.mx,e.my),h=e.findEntityBehavior(r.LTrapBehavior);if(h){if(i.trapClarity)return!0;if(!h.exposed())return!1}if(l.Helpers.isFriend(t,e))return!0;if(c.UMovement.checkAdjacentEntities(t,e))return!0;if(t.isOnRoom()&&t.roomId()==e.roomId()){if(!i.room(t.roomId()).poorVisibility)return!0;if(c.UMovement.blockDistance(t.mx,t.my,e.mx,e.my)<=o.paramDefaultVisibiltyLength)return!0}if(i.unitClarity&&e.isUnit())return!0;if(i.itemClarity&&this.isItem(e))return!0;if(l.Helpers.isHostile(t,e)){if(t.collectTraits().find((t=>t.code==a.MRBasics.traits.UnitVisitor)))return!0}else if(n._passed)return!0;return!1}static isItem(t){return!(!t.data.itemData||t.findEntityBehavior(n.LExitPointBehavior))}}},9868:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SRmmzHelpers=void 0;const r=i(1298),s=i(4836),a=i(9185),n=i(5449),o=i(7352),c=i(4879),l=i(3609),h=i(9154),u=i(6291),d=i(2213);e.SRmmzHelpers=class{static readEntityMetadata(t,e){if(t._pageIndex>=0){const i=t.event();return(0,r.assert)(i),u.DEntitySpawner2.makeFromEventPageData(i,t.page(),e)}}static createEntitiesFromRmmzFixedMapEventData(t){$dataMap.events.forEach((e=>{if(e){const i=u.DEntitySpawner2.makeFromEventData(e,t);if(i)if(i.troopId>0)h.SEntityFactory.spawnTroopAndMembers(a.MRData.troops[i.troopId],e.x,e.y,i.stateIds);else{if(i.entityId<0)throw new Error("Invalid enity data.");this.createEntityFromRmmzEvent(i,e.id,e.x,e.y)}}}))}static createEntityFromRmmzEvent(t,e,i,r){const s=h.SEntityFactory.newEntity(t,o.MRLively.map.floorId());return t.override&&(s.inhabitsCurrentFloor=!0,s.rmmzEventId=e),o.MRLively.world.transferEntity(s,o.MRLively.map.floorId(),i,r),s}static getRegionId(t,e){var i,r;if($dataMap.data){const s=null!==(i=$dataMap.width)&&void 0!==i?i:0,a=null!==(r=$dataMap.height)&&void 0!==r?r:0;return $dataMap.data[(5*a+e)*s+t]}return 0}static buildFixedMapData(t){var e,i;if(!$dataMap)throw new Error;const r=null!==(e=$dataMap.width)&&void 0!==e?e:10,a=null!==(i=$dataMap.height)&&void 0!==i?i:10;t.resetFromFullSize(r,a,0,0);for(let e=0;e<t.innerHeight;e++)for(let i=0;i<t.innerWidth;i++){const r=t.block(i,e);r.setTileShape(this.getTileShape(i,e));const a=this.getRegionId(i,e);a==l.paramFixedMapRoomRegionId?r.setComponent(n.FBlockComponent.Room):a==l.paramFixedMapMonsterHouseRoomRegionId?(r.setComponent(n.FBlockComponent.Room),r.setFixedMapMonsterHouseTypeId(s.MRBasics.monsterHouses.fixed)):a==l.paramFixedMapItemShopRoomRegionId?(r.setComponent(n.FBlockComponent.Room),r.setFixedMapItemShopTypeId(s.MRBasics.itemShops.fixed)):a==l.paramFixedMapPassagewayRegionId&&r.setComponent(n.FBlockComponent.Passageway)}}static getTileShape(t,e){if(p.checkPassage(t,e,15)){const i=p.allTiles(t,e);for(const t of i)if(d.DHelpers.isTileA4(t))return c.LTileShape.HardWall;return c.LTileShape.Floor}return c.LTileShape.HardWall}};class p{static tileset(){return $dataTilesets[$dataMap.tilesetId]}static tilesetFlags(){const t=this.tileset();return t?t.flags:[]}static layeredTiles(t,e){const i=[];for(let r=0;r<4;r++)i.push(this.tileId(t,e,3-r));return i}static allTiles(t,e){return this.layeredTiles(t,e)}static checkPassage(t,e,i){const r=this.tilesetFlags(),s=this.allTiles(t,e);for(const t of s){const e=r[t];if(0==(16&e)){if(0==(e&i))return!0;if((e&i)===i)return!1}}return!1}}p.tileId=function(t,e,i){const r=$dataMap.width,s=$dataMap.height;return $dataMap.data[(i*s+e)*r+t]||0}},4795:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SSequelSet=e.SSequelRun=e.SSequelClip=e.SWaitSequel=e.SBalloonSequel=e.SFloatingAnumationSequel=e.SAnumationSequel=e.SMotionSequel=e.SSequelUnit=void 0;const r=i(1298),s=i(9185);class a{constructor(t,e,i){this._entity=t,this._parallel=e,this._args=i}entity(){return this._entity}isParallel(){return this._parallel}args(){return this._args}}e.SSequelUnit=a;class n extends a{constructor(t,e,i,r,a){super(t,s.MRData.sequels[e].parallel,a),this._sequelId=e,this._targetX=i,this._targetY=r,this._relatedSequels=[]}sequelId(){return this._sequelId}data(){return s.MRData.sequels[this._sequelId]}setStartPosition(t,e){this._startX=t,this._startY=e}hasStartPosition(){return!!this._startX&&!!this._startY}startX(){return(0,r.assert)(void 0!==this._startX),this._startX}startY(){return(0,r.assert)(void 0!==this._startY),this._startY}targetX(){return this._targetX}targetY(){return this._targetY}isFluidSequence(){return this._relatedSequels.length>0}relatedSequels(){return this._relatedSequels}addRelatedSequels(t){this._relatedSequels.push(t)}}e.SMotionSequel=n;e.SAnumationSequel=class extends a{constructor(t,e,i){super(t,!i,void 0),this._anumationlId=e,this._isWait=i}anumationlId(){return this._anumationlId}isWait(){return this._isWait}};e.SFloatingAnumationSequel=class extends a{constructor(t,e,i,r,s){super(t,!1,void 0),this.anumationlId=e,this.mx=i,this.my=r,this._isWait=s}isWait(){return this._isWait}};e.SBalloonSequel=class extends a{constructor(t,e,i){super(t,!i,void 0),this._balloonId=e,this._isWait=i}balloonId(){return this._balloonId}isWait(){return this._isWait}};e.SWaitSequel=class extends a{constructor(t,e){super(t,!0,void 0),this._waitCount=e}waitCount(){return this._waitCount}};class o{constructor(t){this._sequels=[t]}sequels(){return this._sequels}entity(){return this._sequels[0].entity()}isParallel(){return this._sequels[0].isParallel()}hasMotionSeque(){return this._sequels.findIndex((t=>t instanceof n))>=0}add(t){if(t instanceof n&&t.data().fluidSequence){const e=this._sequels.find((e=>e instanceof n&&e.sequelId()==t.sequelId()));if(e)return void e.addRelatedSequels(t)}this._sequels.push(t)}}e.SSequelClip=o;class c{constructor(t){this._clips=[new o(t)]}clips(){return this._clips}isParallel(){return this._clips[0].isParallel()}hasMotionSeque(){return this._clips.findIndex((t=>t.hasMotionSeque()))>=0}add(t){(0,r.assert)(t.isParallel()==this.isParallel());const e=this._clips.findIndex((e=>e.entity()==t.entity()));e<0?this._clips.push(new o(t)):this._clips[e].add(t)}}e.SSequelRun=c;e.SSequelSet=class{constructor(){this._runs=[],this._allParallel=!0,this._waitForAll=!0,this._isEmpty=!0}runs(){return this._runs}isAllParallel(){return this._allParallel}isEmpty(){return this._isEmpty}reset(){this._runs.splice(0),this._allParallel=!0,this._isEmpty=!0,this._waitForAll=!1}waitForAll(){this._waitForAll=!0}isWaitForAll(){return this._waitForAll}addSequel(t){let e=!1;if(0==this._runs.length)e=!0;else if(t.isParallel()){this._runs[this._runs.length-1].isParallel()||(e=!0)}else e=!0;e?this._runs.push(new c(t)):this._runs[this._runs.length-1].add(t),t.isParallel()||(this._allParallel=!1),this._isEmpty=!1}}},4207:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SSequelContext=void 0;const r=i(1298),s=i(7352),a=i(4795),n=i(9115);e.SSequelContext=class{constructor(){this._sequelSet=new a.SSequelSet,this.trapPerforming=!1}clear(){this._sequelSet=new a.SSequelSet}isEmptySequelSet(){return this._sequelSet.isEmpty()}attemptFlush(t){this._sequelSet.isAllParallel()&&!t||this.flushSequelSet(!1)}addSequel(t){this._sequelSet.addSequel(t)}flushSequelSet(t){r.Log.d("[FlushSequel]"),this.isEmptySequelSet()||(s.MRLively.signalFlushSequelSet&&s.MRLively.signalFlushSequelSet(this._sequelSet),t&&this._sequelSet.waitForAll(),n.MRSystem.integration.flushSequelSet(this._sequelSet),this._sequelSet=new a.SSequelSet)}}},9019:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SSoundManager=void 0;e.SSoundManager=class{static playSystemSound(t){"undefined"!=typeof SoundManager&&SoundManager.playSystemSound(t)}static playBgm(t){"undefined"!=typeof SoundManager&&AudioManager.playBgm(t,0)}static playSe(t){"undefined"!=typeof SoundManager&&AudioManager.playSe(t)}static playEquip(){this.playSystemSound(4)}static playMiss(){this.playSystemSound(17)}static playPickItem(){this.playSe({name:"Item1",volume:80,pitch:100,pan:0})}static playLevelUp(){this.playSe({name:"Item3",volume:80,pitch:100,pan:0})}}},7085:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SStateFactory=void 0;const r=i(7352),s=i(7036),a=i(3806),n=i(1298),o=i(9154);e.SStateFactory=class{static newState(t){const e=new a.LState;e.setup(t);const i=new s.LGenericRMMZStateBehavior;r.MRLively.world._registerObject(i);const c=[i];for(const i of e.stateEffect().behaviors){(0,n.assert)(!i.args||0==i.args.length);const r=o.SBehaviorFactory.createBehavior(i.name);if(!r)throw new Error(`Behavior "${i.name}" specified in state "${t}:${e.stateData().displayName}" is invalid.`);c.push(r)}for(const t of c)t.setParent(e);return e._stateBehabiors=c.map((t=>t.id())),e}}},1336:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.STurnContext=void 0;e.STurnContext=class{}},9901:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SView=void 0;const r=i(1298),s=i(4836),a=i(6189),n=i(9185),o=i(7352),c=i(3336),l=i(6501),h=i(6559),u=i(1301),d=i(8254),p=i(7922);e.SView=class{static getLookNames(t,e){if(!t.entityId().equals(e.entityId())&&e.findEntityBehavior(l.LUnitBehavior)){if(t.states().find((t=>t.stateEffect().restriction==a.DStateRestriction.Blind)))return{name:(0,r.tr2)("なにものか"),iconIndex:0,upgrades:0};if(t.collectBehaviors().find((t=>t instanceof c.LIllusionStateBehavior)))return{name:(0,r.tr2)("？？？"),iconIndex:0,upgrades:0}}return e.getDisplayName()}static getTilemapView(){const t=o.MRLively.camera.focusedEntity();return t&&t.states().find((t=>t.stateEffect().restriction==a.DStateRestriction.Blind))?{visible:!1,tilesetId:0}:{visible:!0,tilesetId:void 0}}static getMinimapVisibility(t){const e=o.MRLively.camera.focusedEntity();if(e&&!e.entityId().equals(t.entityId())){if(this.checkEntityInvisible(e,t))return{visible:!1,translucent:!1};if(!this.checkEntityVisible(e,t))return{visible:!1,translucent:!1};if(e.collectBehaviors().find((t=>t instanceof c.LIllusionStateBehavior)))return t.findEntityBehavior(l.LUnitBehavior)?{visible:!0,translucent:!1,image:n.MRData.prefabs[s.MRBasics.prefabs.illusionActor].image}:{visible:!0,translucent:!1,image:n.MRData.prefabs[s.MRBasics.prefabs.illusionItem].image}}else if(t.traits(s.MRBasics.traits.Invisible).length>0)return{visible:!0,translucent:!0};return{visible:!0,translucent:!1}}static getEntityVisibility(t){return this.getMinimapVisibility(t)}static checkEntityInvisible(t,e){if(u.USearch.hasBlindness(t))return!0;if(!u.USearch.isVisibleFromSubject(t,e))return!0;const i=e.findEntityBehavior(h.LTrapBehavior);return!(!i||i.isExposedFor(t))}static checkEntityVisible(t,e){const i=o.MRLively.map;if(i.unitClarity&&e.isUnit())return!0;if(i.itemClarity&&this.isItem(e))return!0;if(d.Helpers.isFriend(t,e))return!0;if(!d.Helpers.isHostile(t,e)){if(o.MRLively.map.block(e.mx,e.my)._passed)return!0}return!!u.USearch.checkInSightEntity(t,e)}static isItem(t){return!(!t.data.itemData||t.findEntityBehavior(p.LExitPointBehavior))}}},5157:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SActivityPlaybackDialog=void 0;const r=i(1298),s=i(7352),a=i(4979);class n extends a.SDialog{isVisualIntegration(){return!1}onUpdate(t){(0,r.assert)(s.MRLively.recorder.isPlayback()),s.MRLively.recorder.runPlaybackCommand(this)||s.MRLively.recorder.restartRecording(),this.submit()}}e.SActivityPlaybackDialog=n},514:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SCommonCommand=void 0;const r=i(1298),s=i(4621),a=i(4598),n=i(9115),o=i(2492);e.SCommonCommand=class{static handleAction(t,e,i,c,l){if(a.UAction.checkItemSelectionRequired(c,l)){const a=new o.SItemSelectionDialog(e,i);t.openSubDialog(a,(t=>{if(t.isSubmitted){const t=a.selectedEntity();(0,r.assert)(t);const i=(new s.LActivity).setup(l,e,c,e.dir);i.setObjects2([t]),n.MRSystem.dialogContext.postActivity(i)}return!1}))}else{const i=(new s.LActivity).setup(l,e,c,e.dir);n.MRSystem.dialogContext.postActivity(i),t.submit()}}}},7574:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SDetailsDialog=void 0;const r=i(1298),s=i(1019),a=i(7352),n=i(3482),o=i(4979);class c extends o.SDialog{constructor(t){super(),this._entity=t}entity(){return this._entity}get summary(){return n.UName.makeNameAsItem(this._entity)}get description(){const t=a.MRLively.camera.focusedEntity();return(0,r.assert)(t),a.MRLively.getCurrentIdentifyer().getEntityIdentificationLevel(t,this._entity)==s.EntityIdentificationLevel.Unidentified?(0,r.tr2)("このアイテムは識別されていません。"):this._entity.data.description}}e.SDetailsDialog=c},9028:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SDialogCommand=void 0;const r=i(1298),s=i(9185);class a{constructor(){this._displayName="",this._actionId=0,this._systemCommandId=""}static makeActivityCommand(t,e,i){const r=new a;return r._displayName=null!=e?e:s.MRData.skills[t].name,r._actionId=t,r._activityCommandHandler=i,r}static makeSystemCommand(t,e,i){const r=new a;return r._displayName=t,r._systemCommandId=e,r._systemCommandIdHandler=i,r}get displayName(){return this._displayName}get isActivityCommand(){return 0!=this._actionId}get actionId(){return this._actionId}get activityCommandHandler(){return(0,r.assert)(this._activityCommandHandler),this._activityCommandHandler}get isSystemCommand(){return this._systemCommandId.length>0}get systemCommandId(){return this._systemCommandId}get systemCommandIdHandler(){return(0,r.assert)(this._systemCommandIdHandler),this._systemCommandIdHandler}execute(){if(this._activityCommandHandler)this._activityCommandHandler(this._actionId);else{if(!this._systemCommandIdHandler)throw new Error("Unreachable.");this._systemCommandIdHandler(this._systemCommandId)}}}e.SDialogCommand=a},2554:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SEventExecutionDialog=void 0;const r=i(4979);class s extends r.SDialog{constructor(t,e){super(),this._rmmzEventId=t,this.billingPrice=0,this.depositPrice=0,this.owner=e}rmmzEventId(){return this._rmmzEventId}onUpdate(t){}}e.SEventExecutionDialog=s},1722:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SFeetDialog=void 0;const r=i(4836),s=i(9248),a=i(7352),n=i(4979),o=i(514),c=i(9028),l=i(6094);class h extends n.SDialog{constructor(t,e){super(),this._actorEntityId=t.entityId(),this._itemEntityId=e.entityId()}get actor(){return a.MRLively.world.entity(this._actorEntityId)}get item(){return a.MRLively.world.entity(this._itemEntityId)}makeActionList(){const t=this.item;let e=[];const i=this.actor.queryActions(),s=t.queryReactions().filter((t=>i.includes(t.actionId))).distinctObjects((t=>t.actionId));return s.find((t=>t.actionId==r.MRBasics.actions.ShootActionId))&&s.mutableRemove((t=>t.actionId==r.MRBasics.actions.ThrowActionId)),e=e.concat(l.SItemListDialog.normalizeActionList(s).map((t=>c.SDialogCommand.makeActivityCommand(t.actionId,t.displayName,(e=>this.handleAction(t.actionId)))))),e}handleAction(t){o.SCommonCommand.handleAction(this,this.actor,this.actor.getEntityBehavior(s.LInventoryBehavior),this.item,t)}}e.SFeetDialog=h},6094:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SItemListDialog=void 0;const r=i(1298),s=i(4836),a=i(9185),n=i(4621),o=i(913),c=i(9248),l=i(6668),h=i(7352),u=i(9115),d=i(4979),p=i(514),f=i(9028),m=i(2492);class y extends d.SDialog{constructor(t,e){super(),this._actorEntityId=t.entityId(),this._inventoryBehaviorId=e.id()}get actor(){return h.MRLively.world.entity(this._actorEntityId)}get inventory(){return h.MRLively.world.behavior(this._inventoryBehaviorId)}setSelectedEntity(t){this._selectedEntity=t}selectedEntity(){return(0,r.assert)(this._selectedEntity),this._selectedEntity}makeActionList(t){if(!h.MRLively.map.floorId().isTacticsMap())return[];const e=this.actor;let i=[];if(t.findEntityBehavior(l.LStorageBehavior)&&(i.push(f.SDialogCommand.makeSystemCommand("peek",(0,r.tr2)("見る"),(t=>this.handlePeek()))),i.push(f.SDialogCommand.makeSystemCommand("putIn",(0,r.tr2)("入れる"),(t=>this.handlePutIn())))),t.data.shortcut){const s=e.getEntityBehavior(o.LEquipmentUserBehavior).shortcutItem;s&&s==t?i.push(f.SDialogCommand.makeSystemCommand((0,r.tr2)("はずす"),"UnsetShortcutSet",(t=>this.handleShortcutUnset()))):i.push(f.SDialogCommand.makeSystemCommand((0,r.tr2)("セット"),"SetShortcutSet",(t=>this.handleShortcutSet())))}const a=e.queryActions(),n=t.queryReactions().filter((t=>a.includes(t.actionId))).distinctObjects((t=>t.actionId));e.getEntityBehavior(o.LEquipmentUserBehavior).isEquipped(t)?n.mutableRemove((t=>t.actionId==s.MRBasics.actions.EquipActionId)):n.mutableRemove((t=>t.actionId==s.MRBasics.actions.EquipOffActionId));h.MRLively.map.firstFeetEntity(e)&&n.mutableRemove((t=>t.actionId==s.MRBasics.actions.PutActionId))&&n.push({actionId:s.MRBasics.actions.ExchangeActionId});return n.find((t=>t.actionId==s.MRBasics.actions.ShootActionId))&&n.mutableRemove((t=>t.actionId==s.MRBasics.actions.ThrowActionId)),i=i.concat(y.normalizeActionList(n).map((t=>f.SDialogCommand.makeActivityCommand(t.actionId,t.displayName,(e=>this.handleAction(t.actionId)))))),i}static normalizeActionList(t){return t.distinctObjects((t=>t.actionId)).immutableSort(((t,e)=>{const i=a.MRData.skills[t.actionId],r=a.MRData.skills[e.actionId];return i.priority==r.priority?i.id-r.id:r.priority-i.priority}))}handleAction(t){const e=this.selectedEntity();p.SCommonCommand.handleAction(this,this.actor,this.inventory,e,t)}handleShortcutSet(){const t=this.selectedEntity();this.actor.getEntityBehavior(o.LEquipmentUserBehavior).equipOnShortcut(u.MRSystem.commandContext,t),this.closeAllSubDialogs()}handleShortcutUnset(){const t=this.selectedEntity();this.actor.getEntityBehavior(o.LEquipmentUserBehavior).equipOffShortcut(u.MRSystem.commandContext,t),this.closeAllSubDialogs()}handlePeek(){const t=this.selectedEntity().getEntityBehavior(c.LInventoryBehavior);this.openSubDialog(new m.SItemSelectionDialog(this.actor,t),(t=>!1))}handlePutIn(){const t=this.selectedEntity(),e=new m.SItemSelectionDialog(this.actor,this.inventory);this.openSubDialog(e,(i=>{const s=e.selectedEntity();(0,r.assert)(s);const a=n.LActivity.makePutIn(this.actor,t,s);return u.MRSystem.dialogContext.postActivity(a),this.submit(),!1}))}}e.SItemListDialog=y},2492:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SItemSelectionDialog=void 0;const r=i(7352),s=i(4979);class a extends s.SDialog{constructor(t,e){super(),this._actorEntityId=t.entityId(),this._inventoryBehaviorId=e.id()}entity(){return r.MRLively.world.entity(this._actorEntityId)}inventory(){return r.MRLively.world.behavior(this._inventoryBehaviorId)}setSelectedEntity(t){this._selectedEntity=t}selectedEntity(){return this._selectedEntity}}e.SItemSelectionDialog=a},685:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SItemSellDialog=void 0;const r=i(9248),s=i(7352),a=i(5139),n=i(9115),o=i(4979);class c extends o.SDialog{constructor(t,e,i){super(),this._serviceProviderId=t.entityId(),this._serviceUserId=e.entityId(),this._inventoryId=i.getEntityBehavior(r.LInventoryBehavior).id(),this._resultItems=[]}get serviceProvider(){return s.MRLively.world.entity(this._serviceProviderId)}get serviceUser(){return s.MRLively.world.entity(this._serviceUserId)}get inventory(){return s.MRLively.world.behavior(this._inventoryId)}get resultItems(){return this._resultItems.map((t=>s.MRLively.world.entity(t)))}setResultItems(t){this._resultItems=t.map((t=>t.entityId()))}submitSell(){a.UInventory.postSellItemsAndDestroy(n.MRSystem.commandContext,this.serviceUser,this.resultItems),this.submit()}}e.SItemSellDialog=c},6840:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SMainMenuDialog=void 0;const r=i(7352),s=i(4979);class a extends s.SDialog{constructor(t){super(),this._entityId=t.entityId()}entity(){return r.MRLively.world.entity(this._entityId)}}e.SMainMenuDialog=a},756:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SNicknameDialog=void 0;const r=i(7352),s=i(4979);class a extends s.SDialog{constructor(t,e){super(),this._actorEntityId=t.entityId(),this._targetItemId=e.entityId()}get item(){return r.MRLively.world.entity(this._targetItemId)}setNickname(t){r.MRLively.getCurrentIdentifyer().setNickname(this.item.dataId,t)}}e.SNicknameDialog=a},1676:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SPlayerDialog=void 0;const r=i(4979);class s extends r.SDialog{constructor(){super(...arguments),this.dashingEntry=!1}onUpdate(t){}}e.SPlayerDialog=s},8771:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SWarehouseStoreDialog=void 0;const r=i(9248),s=i(7352),a=i(5139),n=i(9115),o=i(2994),c=i(4979);class l extends c.SDialog{constructor(t,e){super(),this._userEntityId=t.entityId(),this._inventoryBehaviorId=t.getEntityBehavior(r.LInventoryBehavior).id(),this._warehouseEntityId=e.entityId(),this._warehouseInventoryBehaviorId=e.getEntityBehavior(r.LInventoryBehavior).id(),this._resultItems=[],this._result=o.SWarehouseDialogResult.Cancel}get user(){return s.MRLively.world.entity(this._userEntityId)}get inventory(){return s.MRLively.world.behavior(this._inventoryBehaviorId)}get warehouseEntity(){return s.MRLively.world.entity(this._warehouseEntityId)}get warehouseInventory(){return s.MRLively.world.behavior(this._warehouseInventoryBehaviorId)}resultItems(){return this._resultItems.map((t=>s.MRLively.world.entity(t)))}get result(){return this._result}storeItems(t){this._resultItems=t.map((t=>t.entityId()));const e={code:o.SWarehouseDialogResult.Succeeded,items:[]};a.UInventory.postStoreItemsToWarehouse(n.MRSystem.commandContext,this.user,this.warehouseEntity,t,e).finally((t=>{this._result=e.code,this.submit()}))}}e.SWarehouseStoreDialog=l},2345:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SWarehouseWithdrawDialog=void 0;const r=i(9248),s=i(7352),a=i(5139),n=i(9115),o=i(2994),c=i(4979);class l extends c.SDialog{constructor(t,e){super(),this._userEntityId=t.entityId(),this._userInventoryBehaviorId=t.getEntityBehavior(r.LInventoryBehavior).id(),this._warehouseEntityId=e.entityId(),this._inventoryBehaviorId=e.getEntityBehavior(r.LInventoryBehavior).id(),this._resultItems=[],this._result=o.SWarehouseDialogResult.Cancel}get user(){return s.MRLively.world.entity(this._userEntityId)}get userInventory(){return s.MRLively.world.behavior(this._userInventoryBehaviorId)}get inventory(){return s.MRLively.world.behavior(this._inventoryBehaviorId)}get warehouseEntity(){return s.MRLively.world.entity(this._warehouseEntityId)}resultItems(){return this._resultItems.map((t=>s.MRLively.world.entity(t)))}get result(){return this._result}withdrawItems(t){this._resultItems=t.map((t=>t.entityId()));const e={code:o.SWarehouseDialogResult.Succeeded,items:[]};a.UInventory.postWithdrawItemsToWarehouse(n.MRSystem.commandContext,this.user,this.warehouseEntity,t,e).finally((t=>{this._result=e.code,this.submit()}))}}e.SWarehouseWithdrawDialog=l},101:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SAddStateSpecialEffect=void 0;const r=i(9185),s=i(4882),a=i(2678);class n extends a.SSpecialEffect{onApplyTargetEffect(t,e,i,r,s,a,o){n.itemEffectAddState(a,s,e,t.random(),o)}static itemEffectAddState(t,e,i,r,s){0===i.dataId||this.itemEffectAddNormalState(t,e,i,r,s)}static itemEffectAddNormalState(t,e,i,a,o){const c=r.MRData.states[i.dataId];if(!t.isStateAddable(i.dataId))return;if(!s.UState.meetsApplyConditions(c,t))return;let l=i.value;e.isCertainHit()||(l*=t.stateRate(i.dataId),l*=e.lukEffectRate(t)),a.nextIntWithMax(100)<100*l&&n.addState(t,i.dataId,o)}static addState(t,e,i){t.addState(e),i.makeSuccess();r.MRData.states[e].deadState&&i.clearParamEffects()}}e.SAddStateSpecialEffect=n},8981:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SChangeInstanceSpecialEffect=void 0;const r=i(9185),s=i(913),a=i(9248),n=i(7352),o=i(1584),c=i(2678);class l extends c.SSpecialEffect{onApplyTargetEffect(t,e,i,c,l,h,u){const d=e.entityId?r.MRData.entities[e.entityId]:t.random().select(o.USpawner.getEnemiesFromSpawnTable(h.floorId)),p=h.isUnit();h.setupInstance(d.id);{const t=h.parentAs(a.LInventoryBehavior);if(t){const e=t.ownerEntity().findEntityBehavior(s.LEquipmentUserBehavior);e&&(e.isShortcutEquipped(h)?e.removeShortcut(h):e.removeEquitment(h))}}u.makeSuccess(),p&&n.MRLively.scheduler.resetEntity(h)}}e.SChangeInstanceSpecialEffect=l},6562:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SClarificationSpecialEffect=void 0;const r=i(4836),s=i(7352),a=i(9115),n=i(2678);class o extends n.SSpecialEffect{onApplyTargetEffect(t,e,i,n,o,c,l){const h=s.MRLively.map;t.postCall((()=>{switch(e.value){case r.DClarificationType.Unit:h.unitClarity=!0,a.MRSystem.minimapData.setRefreshNeeded();break;case r.DClarificationType.Item:h.itemClarity=!0,a.MRSystem.minimapData.setRefreshNeeded();break;case r.DClarificationType.Trap:h.trapClarity=!0,a.MRSystem.minimapData.setRefreshNeeded();break;case r.DClarificationType.Terrain:s.MRLively.map.blocks().forEach((t=>t._passed=!0)),a.MRSystem.minimapData.setRefreshNeeded();break;case r.DClarificationType.Sight:h.sightClarity=!0,a.MRSystem.minimapData.setRefreshNeeded();break;default:throw new Error("Unreachable.")}})),l.makeSuccess()}}e.SClarificationSpecialEffect=o},310:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SDispelEquipmentsSpecialEffect=void 0;const r=i(9185),s=i(913),a=i(2678);class n extends a.SSpecialEffect{onApplyTargetEffect(t,e,i,a,n,o,c){const l=o.findEntityBehavior(s.LEquipmentUserBehavior);if(l){const t=l.equippedItemEntities();if(this.testApply(t))for(const e of t)e.isStateAffected(r.MRData.system.states.curse)&&(e.removeState(r.MRData.system.states.curse),c.makeSuccess(),e._effectResult._revision++)}}testApply(t){return!!t.find((t=>t.isStateAffected(r.MRData.system.states.curse)))}}e.SDispelEquipmentsSpecialEffect=n},3996:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SDivisionSpecialEffect=void 0;const r=i(4836),s=i(6229),a=i(7352),n=i(6316),o=i(2678);class c extends o.SSpecialEffect{onApplyTargetEffect(t,e,i,o,c,l,h){const u=a.MRLively.map.block(l.mx,l.my);h.makeSuccess();const d=n.UMovement.getAdjacentBlocks(l).filter((t=>n.UMovement.checkPassageBlockToBlock(l,u,t,s.MovingMethod.Walk)));if(d.length>1){const e=d[t.random().nextIntWithMax(d.length)],i=l.clone();a.MRLively.world.transferEntity(i,l.floorId,e.mx,e.my),t.postSequel(i,r.MRBasics.sequels.MoveSequel).setStartPosition(l.mx,l.my),t.postWaitSequel()}}}e.SDivisionSpecialEffect=c},5134:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SGoldStealSpecialEffect=void 0;const r=i(1298),s=i(4836),a=i(6291),n=i(9185),o=i(9248),c=i(3482),l=i(5150),h=i(2678),u=i(9968);class d extends h.SSpecialEffect{onApplyTargetEffect(t,e,i,s,a,n,l){const h=this.pickGold(n,t.random());if(!h)return void t.postMessage((0,r.tr2)("なにも盗めなかった。"));i.getEntityBehavior(o.LInventoryBehavior).addEntity(h),u.SItemStealSpecialEffect.postWarpBySteal(t,i,c.UName.makeNameAsItem(h))}pickGold(t,e){const i=t.findEntityBehavior(o.LInventoryBehavior);if(!i)return;const r=i.gold();if(r<=0)return;const c=Math.min(1e3,r),h=l.SEntityFactory.newEntity(a.DEntityCreateInfo.makeSingle(n.MRData.system.fallbackGoldEntityId,[]));return h.setParamCurrentValue(s.MRBasics.params.gold,c),i.gainGold(-c),h}}e.SGoldStealSpecialEffect=d},9968:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SItemStealSpecialEffect=void 0;const r=i(1298),s=i(913),a=i(9248),n=i(4598),o=i(3482),c=i(1301),l=i(2678);class h extends l.SSpecialEffect{onApplyTargetEffect(t,e,i,s,l,u,d){if(d.makeSuccess(),c.USearch.isNeutralItem(u)){const e=i.getEntityBehavior(a.LInventoryBehavior);n.UAction.postPickItem(t,i,e,u).then((()=>(h.postWarpBySteal(t,i,o.UName.makeNameAsItem(u)),!0)))}else{const e=this.pickItem(u,t.random());if(!e)return void t.postMessage((0,r.tr2)("なにも盗めなかった。"));i.getEntityBehavior(a.LInventoryBehavior).addEntity(e),h.postWarpBySteal(t,i,o.UName.makeNameAsItem(e))}}pickItem(t,e){const i=t.findEntityBehavior(a.LInventoryBehavior);if(!i)return;let r=i.items;if(0==r.length)return;const n=t.findEntityBehavior(s.LEquipmentUserBehavior);if(n&&(r=r.filter((t=>!n.isEquipped(t)&&!n.isShortcutEquipped(t)))),0==r.length)return;const o=e.select(r);return i.removeEntity(o),o}static postWarpBySteal(t,e,i){t.postMessage((0,r.tr2)("%1は%2を盗んだ！").format(o.UName.makeUnitName(e),i)),n.UAction.postWarp(t,e)}}e.SItemStealSpecialEffect=h},5145:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SLevelDownSpecialEffect=void 0;const r=i(4836),s=i(4797),a=i(2678);class n extends a.SSpecialEffect{onApplyTargetEffect(t,e,i,a,n,o,c){if(!o.params.param(r.MRBasics.params.level))return;const l=o.findEntityBehavior(s.LExperienceBehavior);if(!l)return;const h=o.getEffortValue(r.MRBasics.params.level);h>1&&(o.setEffortValue(r.MRBasics.params.level,h-1),l.setExp(o,l.nextLevelExp(o)-1),c.leveldown=!0,c.makeSuccess())}}e.SLevelDownSpecialEffect=n},8999:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SPerformeSkillSpecialEffect=void 0;const r=i(1298),s=i(4621),a=i(2678);class n extends a.SSpecialEffect{onApplyTargetEffect(t,e,i,a,n,o,c){(0,r.assert)(e.dataId);const l=e.dataId;t.postActivity(s.LActivity.makePerformSkill(o,l)),c.makeSuccess()}}e.SPerformeSkillSpecialEffect=n},4209:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SRemoveStateSpecialEffect=void 0;const r=i(2678);class s extends r.SSpecialEffect{onApplyTargetEffect(t,e,i,r,s,a,n){if(!e.dataId)return;let o=e.value;t.random().nextIntWithMax(100)<100*o&&(a.removeState(e.dataId),n.makeSuccess())}}e.SRemoveStateSpecialEffect=s},5927:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SRemoveStatesByIntentionsSpecialEffect=void 0;const r=i(2678);class s extends r.SSpecialEffect{onApplyTargetEffect(t,e,i,r,s,a,n){const o=e.value,c=a.states().filter((t=>(t.stateData().intentions&o)===o)).map((t=>t.stateDataId()));c.length>0&&(a.removeStates(c),n.makeSuccess())}}e.SRemoveStatesByIntentionsSpecialEffect=s},8732:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SRestartFloorSpecialEffect=void 0;const r=i(1298),s=i(9115),a=i(2678);class n extends a.SSpecialEffect{onApplyTargetEffect(t,e,i,a,n,o,c){(0,r.assert)(a),s.MRSystem.requestedRestartFloorItem=a.entityId(),c.makeSuccess()}}e.SRestartFloorSpecialEffect=n},2678:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SSpecialEffect=void 0;e.SSpecialEffect=class{onApplyTargetEffect(t,e,i,r,s,a,n){}}},8124:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SSpecialEffectManager=void 0;const r=i(1298),s=i(4836),a=i(5134),n=i(9968),o=i(5145),c=i(834),l=i(1808),h=i(6319),u=i(1514),d=i(1597),p=i(310),f=i(8981),m=i(8732),y=i(6562),_=i(3996),g=i(5927),v=i(8999),S=i(4209),M=i(101);e.SSpecialEffectManager=class{constructor(){this.behaviors=[],this.setupBuiltins()}register(t,e){this.behaviors[t]=e}find(t){return this.behaviors[t]}get(t){const e=this.find(t);return(0,r.assert)(e),e}setupBuiltins(){this.register(s.MRBasics.effectBehaviors.itemSteal,new n.SItemStealSpecialEffect),this.register(s.MRBasics.effectBehaviors.goldSteal,new a.SGoldStealSpecialEffect),this.register(s.MRBasics.effectBehaviors.levelDown,new o.SLevelDownSpecialEffect),this.register(s.MRBasics.effectBehaviors.randomWarp,new c.SWarpSpecialEffect),this.register(s.MRBasics.effectBehaviors.stumble,new l.SStumbleSpecialEffect),this.register(s.MRBasics.effectBehaviors.transferToNextFloor,new h.STransferToNextFloorSpecialEffect),this.register(s.MRBasics.effectBehaviors.transferToLowerFloor,new u.STransferToLowerFloorSpecialEffect),this.register(s.MRBasics.effectBehaviors.trapProliferation,new d.STrapProliferationSpecialEffect),this.register(s.MRBasics.effectBehaviors.dispelEquipments,new p.SDispelEquipmentsSpecialEffect),this.register(s.MRBasics.effectBehaviors.changeInstance,new f.SChangeInstanceSpecialEffect),this.register(s.MRBasics.effectBehaviors.restartFloor,new m.SRestartFloorSpecialEffect),this.register(s.MRBasics.effectBehaviors.clarification,new y.SClarificationSpecialEffect),this.register(s.MRBasics.effectBehaviors.division,new _.SDivisionSpecialEffect),this.register(s.MRBasics.effectBehaviors.addState,new M.SAddStateSpecialEffect),this.register(s.MRBasics.effectBehaviors.removeState,new S.SRemoveStateSpecialEffect),this.register(s.MRBasics.effectBehaviors.removeStatesByIntentions,new g.SRemoveStatesByIntentionsSpecialEffect),this.register(s.MRBasics.effectBehaviors.performeSkill,new v.SPerformeSkillSpecialEffect)}}},1808:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SStumbleSpecialEffect=void 0;const r=i(4836),s=i(4621),a=i(2678);class n extends a.SSpecialEffect{onApplyTargetEffect(t,e,i,a,n,o,c){if(c.makeSuccess(),o.previewRejection(t,{kind:"EffectBehavior",id:e.specialEffectId})){const e=(new s.LActivity).setup(r.MRBasics.actions.stumble,o);t.postActivity(e)}}}e.SStumbleSpecialEffect=n},1514:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.STransferToLowerFloorSpecialEffect=void 0;const r=i(2255),s=i(4765),a=i(7352),n=i(3721),o=i(2678);class c extends o.SSpecialEffect{onApplyTargetEffect(t,e,i,o,c,l,h){const u=a.MRLively.map.land2(),d=u.landData();if(d.forwardDirection==r.DLandForwardDirection.Flat)return;const p=l.floorId,f=p.floorNumber()+(d.forwardDirection==r.DLandForwardDirection.Downhill?1:-1);if(1<=f&&f<u.maxFloorNumber()){if(l.isPlayer())n.UTransfer.proceedFloorForwardForPlayer();else{const t=s.LFloorId.make(p.landId(),r.DFloorClass.EventMap,f);a.MRLively.world.transferEntity(l,t)}h.makeSuccess()}}}e.STransferToLowerFloorSpecialEffect=c},6319:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.STransferToNextFloorSpecialEffect=void 0;const r=i(2255),s=i(4765),a=i(7352),n=i(3721),o=i(2678);class c extends o.SSpecialEffect{onApplyTargetEffect(t,e,i,o,c,l,h){const u=a.MRLively.map.land2(),d=l.floorId,p=d.floorNumber()+1;if(1<=p||p<u.maxFloorNumber()){if(l.isPlayer())n.UTransfer.proceedFloorForwardForPlayer();else{const t=s.LFloorId.make(d.landId(),r.DFloorClass.FloorMap,p);a.MRLively.world.transferEntity(l,t)}h.makeSuccess()}}}e.STransferToNextFloorSpecialEffect=c},1597:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.STrapProliferationSpecialEffect=void 0;const r=i(9115),s=i(2678);class a extends s.SSpecialEffect{onApplyTargetEffect(t,e,i,s,a,n,o){r.MRSystem.mapManager.spawnTraps(30),o.makeSuccess()}}e.STrapProliferationSpecialEffect=a},834:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SWarpSpecialEffect=void 0;const r=i(4598),s=i(2678);class a extends s.SSpecialEffect{onApplyTargetEffect(t,e,i,s,a,n,o){r.UAction.postWarp(t,n),o.makeSuccess()}}e.SWarpSpecialEffect=a},9154:function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),s=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),s(i(2205),e),s(i(5150),e)},2011:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SItemShopBuilder=void 0;const r=i(1298),s=i(1289),a=i(2689),n=i(4879),o=i(7352),c=i(6316),l=i(1584),h=i(5150);e.SItemShopBuilder=class{build(t,e,i){const r=t.map().room(e.roomId());r.forEachBlocks((t=>{t.setSystemDecoration(n.LBlockSystemDecoration.ItemShop)}));const u=this.setupEntranceBlocks(r);for(const t of u){const i=e.addShopEntrance(t.home.mx,t.home.my,t.gate.mx,t.gate.my);l.USpawner.spawnSingleEntity("kEnemy_店主A",t.home.mx,t.home.my).getEntityBehavior(a.LShopkeeperBehavior).setup(e.id(),i.index())}const d=t.map().floorId(),p=t.map().land2().landData().appearanceTable.shop[d.floorNumber()].filter((t=>s.DEntityCategory.isItem(t.spawiInfo.entityData())));if(p.length>0){const i=[],s=c.UMovement.getCenterOfRoom(r);for(let e=s.y-1;e<=s.y+1;e++)for(let a=s.x-1;a<=s.x+1;a++)if(r.contains(a,e)){const r=t.rand().select(p),s=h.SEntityFactory.newEntity(r.spawiInfo,d);o.MRLively.world.transferEntity(s,d,a,e),i.push(s)}e.setInitialItems(i)}}setupEntranceBlocks(t){const e=[];for(const i of t.getRoomInnerEntranceBlocks()){let s,a;i.mx==t.mx1||i.mx==t.mx2?(s=this.getInRoomFloorBlock(t,i.mx,i.my-1),a=this.getInRoomFloorBlock(t,i.mx,i.my+1)):(i.my==t.my1||i.my==t.my2)&&(s=this.getInRoomFloorBlock(t,i.mx-1,i.my),a=this.getInRoomFloorBlock(t,i.mx+1,i.my)),(0,r.assert)(s||a),i._shopkeeperLine=!0,s&&(s._shopkeeperLine=!0),a&&(a._shopkeeperLine=!0);const n=null!=s?s:a;(0,r.assert)(n),e.push({home:n,gate:i})}return e}getInRoomFloorBlock(t,e,i){if(!t.contains(e,i))return;const r=o.MRLively.map.tryGetBlock(e,i);return r&&r.isFloorLikeShape()?r:void 0}}},99:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SMonsterHouseBuilder=void 0;const r=i(4836),s=i(3609);e.SMonsterHouseBuilder=class{build(t,e,i){const a=t.map().room(e.roomId()),n=a.width*a.height,o=i.nextIntWithMinMax(s.paramMonsterHouseEnemiesMin,s.paramMonsterHouseEnemiesMax+1);for(let e=0;e<o;e++){const e=i.nextIntWithMax(n),s=a.mx1+Math.floor(e%a.width),o=a.my1+Math.floor(e/a.width),c=t.spawnEnemy(s,o);for(const t of c)t.addState(r.MRBasics.states.monsterHouseSleepStateId)}const c=i.nextIntWithMinMax(s.paramMonsterHouseItemsMin,s.paramMonsterHouseItemsMax+1);for(let e=0;e<c;e++){const e=i.nextIntWithMax(n),r=a.mx1+Math.floor(e%a.width),s=a.my1+Math.floor(e/a.width),o=80,c=i.nextIntWithMax(100);c<o&&(c<o/2?t.spawnItem(r,s):t.spawnTrap(r,s))}}}},3150:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SChainAfterScheduler=void 0;const r=i(7352),s=i(1325),a=i(4836),n=i(4598),o=i(8665),c=i(1298),l=i(4621);var h;!function(t){t[t.Prologue=0]="Prologue",t[t.StabilizeSituation=1]="StabilizeSituation",t[t.PreviewDead=2]="PreviewDead",t[t.ResolvePermanentDeath=3]="ResolvePermanentDeath",t[t.Epilogue=4]="Epilogue"}(h||(h={}));e.SChainAfterScheduler=class{constructor(){this._phase=h.Prologue}reset(){this._phase=h.Prologue}isRunning(){return this._phase!=h.Epilogue}isEnd(){return this._phase==h.Epilogue}process(t){for(;this.isRunning();){switch(this._phase){case h.Prologue:this.process_Prologue(t);break;case h.StabilizeSituation:this.process_StabilizeSituation(t);break;case h.PreviewDead:this.process_PreviewDead(t);break;case h.ResolvePermanentDeath:this.process_ResolvePermanentDeath(t);break;default:throw new Error("Unreachable.")}if(t.isRunning())break}}process_Prologue(t){this._phase=h.StabilizeSituation}process_StabilizeSituation(t){for(const e of r.MRLively.map.entities()){const i=r.MRLively.map.block(e.mx,e.my).findEntityLayerKind(e);(0,c.assert)(i);const s=e.getHomeLayer();i!=s&&n.UAction.postDropOrDestroyOnCurrentPos(t,e,s)}for(const e of r.MRLively.map.entities()){e.iterateBehaviorsReverse((i=>(i.onStabilizeSituation(e,t),!0)));for(const i of e.fieldEffects())i.onStabilizeSituation(t)}this._phase=h.PreviewDead}process_PreviewDead(t){for(const e of r.MRLively.map.entities())e.isDeathStateAffected()&&t.postActivity((new l.LActivity).setup(a.MRBasics.actions.dead,e));this._phase=h.ResolvePermanentDeath}process_ResolvePermanentDeath(t){for(const e of r.MRLively.map.entities())if(e.isDeathStateAffected()){let i=s.SCommandResponse.Pass;e.iterateBehaviorsReverse((r=>(i=r.onPermanentDeath(e,t),i==s.SCommandResponse.Pass))),i==s.SCommandResponse.Pass&&(t.postSequel(e,a.MRBasics.sequels.CollapseSequel),n.UAction.postDropItems(t,e,o.LGenerateDropItemCause.Dead),t.postDestroy(e))}this._phase=h.Epilogue}}},5207:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SScheduler=void 0;const r=i(1298),s=i(7352),a=i(9115),n=i(312),o=i(281),c=i(3150);e.SScheduler=class{constructor(){this._data=s.MRLively.scheduler,this._stepScheduler=new o.SStepScheduler2(this),this._chainAfterScheduler=new c.SChainAfterScheduler,this._brace=!1,this._occupy=!1}reset(){this._data=s.MRLively.scheduler,this._data.chedulerPhase=n.LSchedulerPhase.RoundStarting,this._stepScheduler.start(),this._chainAfterScheduler.reset(),this._brace=!1,this._occupy=!1}data(){return this._data}stepSimulation(){const t=a.MRSystem.dialogContext,e=a.MRSystem.commandContext;for(;!a.MRSystem.integration.checkVisualSequelRunning()&&!s.MRLively.camera.isFloorTransfering();){if(this._brace){this._brace=!1;break}if(!e.isRunning()&&a.MRSystem.integration.checkVisualSequelRunning())break;if(e.isRunning()){e._processCommand(),e.isRunning()||this.onCommandChainConsumed(),a.MRSystem.sequelContext.attemptFlush(!1);continue}let i=!0;if(t._hasDialogModel()){if(t._update(),t._hasDialogModel())break;{const e=t.causeEntity();e&&(e.immediatelyAfterAdjacentMoving=!1),i=!1}}i&&((0,r.assert)(e.isRecordingListEmpty()),s.MRLively.world._removeDestroyedObjects(),this.stepSimulationInternal())}this._occupy=!1}stepSimulationInternal(){switch(this._data.chedulerPhase){case n.LSchedulerPhase.RoundStarting:this.update_RoundStarting();break;case n.LSchedulerPhase.Processing:this.update_ProcessPhase();break;case n.LSchedulerPhase.RoundEnding:this.update_RoundEnding();break;default:throw new Error("Unreachable.")}}update_RoundStarting(){a.MRSystem.mapManager.updateRound(),this._data.buildSchedulingUnits(),this._data.dealActionTokens(),this._data.chedulerPhase=n.LSchedulerPhase.Processing,this._occupy=!0,this._stepScheduler.start()}update_ProcessPhase(){this._stepScheduler.process()||(this._data.chedulerPhase=n.LSchedulerPhase.RoundEnding)}update_RoundEnding(){s.MRLively.chronus.advanceRound(),this._occupy?a.MRSystem.sequelContext.isEmptySequelSet()&&(this._brace=!0):a.MRSystem.sequelContext.flushSequelSet(!1),this._data.chedulerPhase=n.LSchedulerPhase.RoundStarting}onCommandChainConsumed(){this._chainAfterScheduler.isEnd()||(this._chainAfterScheduler.process(a.MRSystem.commandContext),this._chainAfterScheduler.isEnd()&&this._chainAfterScheduler.reset())}}},9570:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SSchedulerPhase=void 0;e.SSchedulerPhase=class{onStart(){}onAfterProcess(t){}onEnd(t){}}},8381:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SSchedulerPhase_AIMajorAction=e.SSchedulerPhase_CheckFeetMoved=e.SSchedulerPhase_ResolveAdjacentAndMovingTarget=e.SSchedulerPhase_AIMinorAction=e.SSchedulerPhase_ManualAction=void 0;const r=i(7534),s=i(7352),a=i(9115),n=i(4598),o=i(7991),c=i(9570),l=i(1298);class h extends c.SSchedulerPhase{isAllowIterationAtPrepare(){return!1}onStart(){s.MRLively.map.updateLocatedResults(a.MRSystem.commandContext)}testProcessable(t,e){return e.manualMovement()&&t._actionToken.canMajorAction()}onProcess(t,e){(0,l.assert)(this.testProcessable(t,e)),a.MRSystem.sequelContext.flushSequelSet(!1),t._callDecisionPhase(a.MRSystem.commandContext,r.DecisionPhase.Manual)}}e.SSchedulerPhase_ManualAction=h;class u extends c.SSchedulerPhase{isAllowIterationAtPrepare(){return!1}onStart(){for(const t of s.MRLively.map.structures())o.LItemShopStructure}testProcessable(t,e){return!e.manualMovement()&&t._actionToken.canMinorAction()&&e._targetingEntityId<=0}onProcess(t,e){(0,l.assert)(this.testProcessable(t,e)),t._callDecisionPhase(a.MRSystem.commandContext,r.DecisionPhase.AIMinor)}onEnd(t){for(const e of t.data()._schedulingUnits)if(e.isValid()){const t=e.unitBehavior();(t.requiredTrapProcess()||t.requiredFeetProcess())&&(n.UAction.postPreStepFeetProcess(a.MRSystem.commandContext,e.entity()),t.clearTrapProcess())}a.MRSystem.sequelContext.attemptFlush(a.MRSystem.sequelContext.trapPerforming),a.MRSystem.sequelContext.trapPerforming=!1;for(const t of s.MRLively.map.entities())n.UAction.postAttemptPerformStepFeetProcess(a.MRSystem.commandContext,t);for(const e of t.data()._schedulingUnits)if(e.isValid()){const i=e.entity();(e.isManual()||void 0!==i._schedulingResult.consumedActionToken(t.data().currentPhaseIndex()))&&i._callDecisionPhase(a.MRSystem.commandContext,r.DecisionPhase.UpdateState)}for(const e of t.data()._schedulingUnits)if(e.isValid()){const t=e.unitBehavior();t.requiredFeetProcess()&&(n.UAction.postStepOnGround(a.MRSystem.commandContext,e.entity()),t.clearFeetProcess())}}}e.SSchedulerPhase_AIMinorAction=u;class d extends c.SSchedulerPhase{isAllowIterationAtPrepare(){return!1}onStart(){s.MRLively.map.updateLocatedResults(a.MRSystem.commandContext)}testProcessable(t,e){return!0}onProcess(t,e){(0,l.assert)(this.testProcessable(t,e)),t._callDecisionPhase(a.MRSystem.commandContext,r.DecisionPhase.ResolveAdjacentAndMovingTarget)}}e.SSchedulerPhase_ResolveAdjacentAndMovingTarget=d;class p extends c.SSchedulerPhase{isAllowIterationAtPrepare(){return!1}onStart(){a.MRSystem.sequelContext.attemptFlush(!0)}testProcessable(t,e){return e.requiredFeetProcess()}onProcess(t,e){(0,l.assert)(this.testProcessable(t,e)),e.requiredFeetProcess()&&(n.UAction.postStepOnGround(a.MRSystem.commandContext,t),e.clearFeetProcess())}}e.SSchedulerPhase_CheckFeetMoved=p;class f extends c.SSchedulerPhase{isAllowIterationAtPrepare(){return!0}testProcessable(t,e){return!e.manualMovement()&&t._actionToken.canMajorAction()}onProcess(t,e){this.testProcessable(t,e)&&(t._callDecisionPhase(a.MRSystem.commandContext,r.DecisionPhase.AIMajor),t._callDecisionPhase(a.MRSystem.commandContext,r.DecisionPhase.UpdateState))}}e.SSchedulerPhase_AIMajorAction=f},281:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SStepScheduler2=void 0;const r=i(1298),s=i(2593),a=i(7352),n=i(9115),o=i(2994),c=i(8381);e.SStepScheduler2=class{constructor(t){this._scheduler=t,this._data=t.data(),this._cctx=n.MRSystem.commandContext,this._stepPhase=o.SStepPhase.RunStarting,this._phases=[new c.SSchedulerPhase_ManualAction,new c.SSchedulerPhase_AIMinorAction,new c.SSchedulerPhase_ResolveAdjacentAndMovingTarget,new c.SSchedulerPhase_AIMajorAction],(0,r.assert)(this._phases.length==s.phaseCount)}start(){this._data=this._scheduler.data(),this._data.nextSearchIndex=0,this._data._currentPhaseIndex=-1,this._stepPhase=o.SStepPhase.RunStarting;for(const t of this._data.schedulingUnits())t.isValid()&&(t.unitBehavior()._targetingEntityId=0)}process(){for((0,r.assert)(this._stepPhase!=o.SStepPhase.Closed);!this.isSequenceClosed()&&!n.MRSystem.commandContext.isRunning();)this.processCore2();return!this.isSequenceClosed()}isSequenceClosed(){return this._stepPhase==o.SStepPhase.Closed}currentPhase(){const t=this._data.currentPhaseIndex();return(0,r.assert)(0<=t&&t<this._phases.length),this._phases[t]}processCore2(){switch(this._stepPhase){case o.SStepPhase.RunStarting:this.process_RunStarting();break;case o.SStepPhase.PhaseStarting:this.process_PhaseStarting();break;case o.SStepPhase.StepStarting:this.process_StepStarting();break;case o.SStepPhase.MainProcess:this.process_MainProcess();break;case o.SStepPhase.MainProcessClosing:this.process_MainProcessClosing();break;case o.SStepPhase.AfterProcess:this.process_AfterProcess();break;case o.SStepPhase.AfterProcessClosing:this.process_AfterProcessClosing();break;case o.SStepPhase.StepClosing:this.process_StepClosing();break;case o.SStepPhase.PhaseClosing:this.process_PhaseClosing();break;case o.SStepPhase.RunClosing:this.process_RunClosing();break;case o.SStepPhase.Closed:default:throw new Error("Unreachable.")}}process_RunStarting(){for(const t of this._data.schedulingUnits())t.isValid()&&t.entity()._schedulingResult.clear();this._data.schedulingUnits().length<=0?this._stepPhase=o.SStepPhase.RunClosing:(this._data._currentPhaseIndex=-1,this._stepPhase=o.SStepPhase.PhaseStarting)}process_PhaseStarting(){this._data.resetSeek(),this._data._currentPhaseIndex++,this._data._currentPhaseIndex>=this._phases.length?this._stepPhase=o.SStepPhase.RunClosing:(this.currentPhase().onStart(),this._stepPhase=o.SStepPhase.StepStarting)}process_StepStarting(){this._data.nextUnit(this.currentPhase())?this._stepPhase=o.SStepPhase.MainProcess:this._stepPhase=o.SStepPhase.PhaseClosing}process_MainProcess(){const t=this._data.currentUnit();t.isValid()&&this.currentPhase().onProcess(t.entity(),t.unitBehavior()),this._stepPhase=o.SStepPhase.MainProcessClosing}process_MainProcessClosing(){this._stepPhase=o.SStepPhase.AfterProcess}process_AfterProcess(){for(const t of a.MRLively.map.entities())t._callBehaviorIterationHelper((e=>e.onAfterStep(t,n.MRSystem.commandContext)));this._stepPhase=o.SStepPhase.AfterProcessClosing}process_AfterProcessClosing(){this._stepPhase=o.SStepPhase.StepClosing}process_StepClosing(){const t=this._data.currentUnit();t.increaseIterationCount(),this.onStepProcessEnd(t),t.isIterationClosed()?this._data.isSeeking()?this._stepPhase=o.SStepPhase.StepStarting:this._stepPhase=o.SStepPhase.PhaseClosing:this._stepPhase=o.SStepPhase.MainProcess}process_PhaseClosing(){this.currentPhase().onEnd(this._scheduler),this._stepPhase=o.SStepPhase.PhaseStarting}process_RunClosing(){this._data.currentRunIndex++,this._data.currentRunIndex>=this._data.maxRunCount?this._stepPhase=o.SStepPhase.Closed:this._stepPhase=o.SStepPhase.RunStarting}onStepProcessEnd(t){for(const t of a.MRLively.map.entities())t._callBehaviorIterationHelper((t=>t.onStepEnd(n.MRSystem.commandContext)));if(t.isValid()){const e=t.entity();e._reward.apply(e),e._effectResult.showResultMessages(n.MRSystem.commandContext,e),e._effectResult.clear()}this._data.attemptRefreshSpeedLevel()}}},4393:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SSubTaskChain=e.STaskCallMethod=e.STask=e.STaskStatus=void 0;const r=i(1298),s=i(1325);var a,n,o;!function(t){t[t.Created=0]="Created",t[t.Pending=1]="Pending",t[t.Running=2]="Running",t[t.Succeeded=3]="Succeeded",t[t.Rejected=4]="Rejected"}(a=e.STaskStatus||(e.STaskStatus={}));class c{constructor(t,e,i,s){this._callMethod=n.Default,this._whenWaitingTasks=[],(0,r.assert)(!(e&&i)),this._status=a.Created,this._name=t,this._entryFunc=e,this._chainFunc=i}get isCompleted(){return this._status>a.Running}then(t){(0,r.assert)(!this._nextTask);return this.thenTask(new c("then",void 0,t))}then2(t){(0,r.assert)(this._subChain);const e=this.thenTask(new c("then",void 0,void 0));return e._subChain=this._subChain,e._thenFunc2=t,e}thenTask(t){return(0,r.assert)(!this._nextTask),(0,r.assert)(t._status==a.Created),t._status=a.Pending,this._nextTask=t,this._nextTask}catch(t){return(0,r.assert)(!this._catchFunc),this._catchFunc=t,this}finally(t){(0,r.assert)(this._subChain),(0,r.assert)(!this._nextTask);const e=this.thenTask(new c("finally",void 0,void 0));return e._subChain=this._subChain,e._finallyFunc=t,e}call(t){if((0,r.assert)(this._status==a.Pending),this._status=a.Running,this._callMethod==n.Default)this._entryFunc?this._status=this._entryFunc()!=s.SCommandResponse.Canceled?a.Succeeded:a.Rejected:this._chainFunc&&(this._status=this._chainFunc()?a.Succeeded:a.Rejected),this._status!=a.Rejected&&this._nextTask&&!this._subChain&&t._setNextPriorityTask(this._nextTask);else{if((0,r.assert)(this._subChain),t.pushSubTaskChain(this._subChain),this._callMethod==n.When){this.checkWaitingTasksStatus()==a.Succeeded||this._subChain.reject(),this.prologueCalling(void 0)}else if(this._callMethod==n.Then)if(this._finallyFunc)this._finallyFunc(this._subChain),this.prologueCalling(void 0);else{(0,r.assert)(this._thenFunc2);const t=this._thenFunc2(this._subChain);this.prologueCalling(t)}else(0,r.assert)(this._catchFunc),this._catchFunc(this._subChain),this.prologueCalling(void 0);t.popSubTaskChain(this._subChain)}}prologueCalling(t){(0,r.assert)(this._subChain),this._status!=a.Running||this._subChain._holding||(t?t._blockingTask=this:(this._blockingTask&&((0,r.assert)(this._blockingTask._subChain),this._blockingTask._subChain.next()),this._subChain.next()))}checkWaitingTasksStatus(){let t=a.Succeeded;for(let e of this._whenWaitingTasks){if(e._status==a.Running){t=a.Running;break}if(e._status==a.Rejected){t=a.Rejected;break}}return t}setNextPriorityTaskIfNeeded(t){this._nextTask&&t._setNextPriorityTask(this._nextTask)}}e.STask=c,function(t){t[t.Default=0]="Default",t[t.Then=1]="Then",t[t.Catch=2]="Catch",t[t.When=3]="When"}(n=e.STaskCallMethod||(e.STaskCallMethod={})),function(t){t[t.Next=0]="Next",t[t.Reject=1]="Reject"}(o||(o={}));e.SSubTaskChain=class{constructor(t,e){this._ctx=t,this._firstTask=e,this._currentTask=e,this._error=!1,this._errorHandled=!1,this._postedMethod=o.Next,this._holding=!1}hold(){this._holding=!0}next(){this._postedMethod=o.Next,this.processOrPost()}reject(){this._postedMethod=o.Reject,this.processOrPost()}processOrPost(){const t=this._ctx._subTaskChainStack[this._ctx._subTaskChainStack.length-1];t!=this?t._postedChain=this:this.processInternal()}processInternal(){if(this._postedMethod==o.Next)this.nextInternal();else{if(this._postedMethod!=o.Reject)throw new Error("Unreachable.");this.rejectInternal()}}nextInternal(){if((0,r.assert)(this._currentTask),this._currentTask._status=a.Succeeded,this._error){(0,r.assert)(this._currentTask._catchFunc||this._currentTask._finallyFunc);let t=this._currentTask._nextTask;for(this._currentTask=void 0;t;){if(t._finallyFunc){t._callMethod=n.Then,this._ctx._setNextPriorityTask(t),this._currentTask=t;break}if(!this._errorHandled&&t._catchFunc){t._callMethod=n.Catch,this._ctx._setNextPriorityTask(t),this._currentTask=t,this._errorHandled=!0;break}t=t._nextTask}}else{const t=this._currentTask._nextTask;this._currentTask=void 0,(t&&t._thenFunc2||(null==t?void 0:t._finallyFunc))&&(t._callMethod=n.Then,this._ctx._setNextPriorityTask(t),this._currentTask=t)}this._currentTask||this.close()}rejectInternal(){(0,r.assert)(this._currentTask),(0,r.assert)(!this._errorHandled),this._error=!0,this._currentTask._status=a.Rejected;let t=this._currentTask._nextTask;for(this._currentTask=void 0;t;){if(t._finallyFunc){t._callMethod=n.Then,this._ctx._setNextPriorityTask(t),this._currentTask=t;break}if(t._catchFunc){t._callMethod=n.Catch,this._ctx._setNextPriorityTask(t),this._currentTask=t,this._errorHandled=!0;break}t=t._nextTask}this._currentTask||this.close()}close(){this._postedChain&&this._postedChain.processInternal()}}},4598:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UAction=void 0;const r=i(1298),s=i(4561),a=i(2213),n=i(9185),o=i(8665),c=i(7352),l=i(4836),h=i(5967),u=i(9248),d=i(1019),p=i(8254),f=i(695),m=i(9019),y=i(8153),_=i(6316),g=i(3482),v=i(1301),S=i(913),M=i(4621),R=i(1695),b=i(1325);class E{static postEffectSensed(t,e){t.postCall((()=>{e.iterateBehaviorsReverse((i=>i.onEffectSensed(e,t)))}))}static postStepOnGround(t,e){const i=c.MRLively.map.block(e.mx,e.my).layer(h.DBlockLayerKind.Ground).firstEntity();i&&(t.post(e,i,new f.SEffectSubject(e),void 0,o.onWalkedOnTopAction),t.post(i,e,new f.SEffectSubject(i),void 0,o.onWalkedOnTopReaction))}static postPreStepFeetProcess(t,e){const i=c.MRLively.map.block(e.mx,e.my).layer(h.DBlockLayerKind.Ground).firstEntity();i&&(t.callSymbol(e,i,new f.SEffectSubject(e),void 0,o.onPreStepFeetProcess_Actor),t.callSymbol(i,e,new f.SEffectSubject(i),void 0,o.onPreStepFeetProcess))}static postAttemptPerformStepFeetProcess(t,e){const i=c.MRLively.map.block(e.mx,e.my).layer(h.DBlockLayerKind.Ground).firstEntity();i&&t.post(i,e,new f.SEffectSubject(i),void 0,o.onPerformStepFeetProcess)}static postFall(t,e){t.postActivity(M.LActivity.makeFall(e)).then((()=>{this.postDropOrDestroyOnCurrentPos(t,e,e.getHomeLayer())})).catch((()=>{this.postDropOrDestroyOnCurrentPos(t,e,e.getHomeLayer())}))}static postPickItem(t,e,i,s){const a=b.SCommand.make(l.MRBasics.commands.testPutInItem).withObjects([s]);return t.postCommandTask(e,a).then2((()=>{c.MRLively.map._removeEntity(s),i.addEntityWithStacking(s);const a=d.LEntityDescription.makeDisplayText(g.UName.makeUnitName(e),d.DescriptionHighlightColor.UnitName);t.postMessage((0,r.tr)("{0} は {1} をひろった",a,g.UName.makeNameAsItem(s))),m.SSoundManager.playPickItem()}))}static postDropOrDestroy(t,e,i,r){t.postCall((()=>{c.MRLively.world.transferEntity(e,c.MRLively.map.floorId(),i,r),this.postDropOrDestroyOnCurrentPos(t,e,e.getHomeLayer())}))}static postDropOrDestroyOnCurrentPos(t,e,i){if(R.ULimitations.isItemCountFullyInMap());else{const r=_.UMovement.selectNearbyLocatableBlock(t.random(),e.mx,e.my,i,e);if(r)return _.UMovement.locateEntity(e,r.mx,r.my,i),void t.postSequel(e,l.MRBasics.sequels.dropSequel)}t.postMessage((0,r.tr2)("%1は消えてしまった…。").format(g.UName.makeNameAsItem(e))),t.postDestroy(e)}static postWarp(t,e){const i=v.USearch.selectUnitSpawnableBlock(t.random());if(!i)throw new Error("Not implemented.");t.postTransferFloor(e,e.floorId,i.mx,i.my),t.postSequel(e,l.MRBasics.sequels.warp)}static postStumble(t,e,i){e.isPlayer()?this.postStumbleForPlayer(t,e,i):this.postStumbleForNPC(t,e),t.postSequel(e,l.MRBasics.sequels.stumble)}static postStumbleForPlayer(t,e,i){if(e.findEntityBehavior(u.LInventoryBehavior)){const s=this.getDefenselessInventoryItems(e),a=this.StumbleTable[i];(0,r.assert)(a.length>0);Math.min(s.length,a.length);let n=0;for(let i=0;i<a.length&&n<s.length;i++){const r=e.mx+a[i].x,o=e.my+a[i].y,u=c.MRLively.map.tryGetBlock(r,o);if(u&&u.isFloorLikeShape()&&!u.layer(h.DBlockLayerKind.Ground).isContainsAnyEntity()){const i=s[n];i.removeFromParent(),c.MRLively.world.transferEntity(i,c.MRLively.map.floorId(),e.mx,e.my),t.postTransferFloor(i,c.MRLively.map.floorId(),r,o),t.postSequel(i,l.MRBasics.sequels.jump),n++}}}}static postStumbleForNPC(t,e){this.postDropItems(t,e,o.LGenerateDropItemCause.Stumble)}static getDefenselessInventoryItems(t){const e=t.findEntityBehavior(u.LInventoryBehavior),i=t.findEntityBehavior(S.LEquipmentUserBehavior);return e?i?e.items.filter((t=>!i.isEquipped(t))):e.items:[]}static checkItemSelectionRequired(t,e){const i=t.data.findReaction(e);if(i)for(const t of i.emittors())if(t.scope.range==s.DEffectFieldScopeType.Selection)return!0;return!1}static checkAdjacentDirectlyAttack(t,e){const i=c.MRLively.map,r=i.block(t.mx,t.my),s=i.block(e.mx,e.my),a=s.mx-r.mx,n=s.my-r.my;if(Math.abs(a)>1)return!1;if(Math.abs(n)>1)return!1;const o=p.Helpers.offsetToDir(a,n);return!_.UMovement.checkDiagonalWallCornerCrossing(t,o)}static getSkillEffectiveTargets(t,e,i){const r=e.emittor();return this.searchTargetEntities(t,r.scope,e.rmmzEffectScope,i)}static makeCandidateSkillActions(t,e){let i=t.collectSkillActions(),r=[];t.hasTrait(l.MRBasics.traits.SealSpecialAbility)&&(i=i.filter((t=>t.skillId==n.MRData.system.skills.normalAttack)));for(const e of i){const i=this.getSkillEffectiveTargets(t,n.MRData.skills[e.skillId],!0);i.length>0&&r.push({action:e,targets:i.map((t=>t.entityId()))})}r.find((t=>t.action.skillId==n.MRData.system.skills.move))||r.push({action:{conditionParam1:void 0,conditionParam2:void 0,conditionType:void 0,rating:3,skillId:n.MRData.system.skills.move},targets:[]}),t.iterateBehaviorsReverse((t=>{t.onPostMakeSkillActions(r)})),t.hasTrait(l.MRBasics.traits.UseSkillForced)&&r.mutableRemove((t=>t.action.skillId==n.MRData.system.skills.normalAttack));let s=0;if(r.forEach((t=>s=Math.max(t.action.rating,s))),r=r.filter((t=>t.action.rating>=s-5)),e.hasAny()&&_.UMovement.checkEntityAdjacent(t,c.MRLively.world.entity(e)))r.mutableRemove((t=>t.action.skillId==n.MRData.system.skills.move));else{let e=!1;for(const i of r){for(const s of i.targets){const i=c.MRLively.world.entity(s);if(_.UMovement.checkEntityAdjacent(t,i)){r.mutableRemove((t=>t.action.skillId==n.MRData.system.skills.move)),e=!0;break}}if(e)break}}return r}static testFactionMatch(t,e,i){if(i==s.DRmmzEffectScope.Everyone)return!0;if(a.DHelpers.isForFriend(i)){if(p.Helpers.isFriend(t,e))return!0}else{if(!a.DHelpers.isForOpponent(i))throw new Error("Not implemented.");if(p.Helpers.isHostile(t,e))return!0}return!1}static searchTargetEntities(t,e,i,r){if(e.range==s.DEffectFieldScopeType.Performer)return[t];if(e.range==s.DEffectFieldScopeType.Front1){return _.UMovement.getAdjacentEntities(t).filter((e=>{if(r&&!this.testFactionMatch(t,e,i))return!1;if(!this.checkAdjacentDirectlyAttack(t,e))return!1;const s=c.MRLively.map.block(e.mx,e.my);return!(!s||y.UBlock.checkPurifier(s,t))}))}if(e.range==s.DEffectFieldScopeType.StraightProjectile){let r=[];for(const a of _.UMovement.directions){const n=p.Helpers._dirToTileOffsetTable[a].x,o=p.Helpers._dirToTileOffsetTable[a].y;for(let a=1;a<e.length;a++){const l=t.mx+n*a,h=t.my+o*a,u=c.MRLively.map.tryGetBlock(l,h);if(!u)break;if(e.area!=s.DEffectFieldScopeArea.Room)throw e.area==s.DEffectFieldScopeArea.Floor?new Error("Not implemented."):new Error("Unreachable");if(u.room()){if(!v.USearch.checkInSightBlockFromSubject(t,u))break}else if(2==a)break;const d=u.getEntities().filter((e=>!!this.testFactionMatch(t,e,i)));d.length>0&&(r=r.concat(d))}}return r}if(e.range==s.DEffectFieldScopeType.Room){const e=[];return c.MRLively.map.room(t.roomId()).forEachEntities((r=>{this.testFactionMatch(t,r,i)&&e.push(r)})),e}throw new Error("Unreachable.")}static checkEntityWithinSkillActionRange(t,e,i,r){const s=e.emittor(),a=this.searchTargetEntities(t,s.scope,e.rmmzEffectScope,i);for(const t of r)if(a.find((e=>e==t)))return!0;return!1}static findInSightNearlyHostileEntity(t){if(!v.USearch.hasBlindness(t))return c.MRLively.map.getInsightEntities(t).filter((e=>p.Helpers.isHostile(t,e)&&v.USearch.isVisibleFromSubject(t,e))).immutableSort(((e,i)=>p.Helpers.getDistance(t,e)-p.Helpers.getDistance(t,i))).find((e=>p.Helpers.isHostile(t,e)))}static findTalkableFront(t){const e=_.UMovement.getFrontBlock(t).getFirstEntity();if(e&&!p.Helpers.isHostile(t,e)&&e.queryReactions().find((t=>t.actionId==l.MRBasics.actions.talk)))return e}static postDropItems(t,e,i){const s=c.MRLively.map;(0,r.assert)(s.checkAppearing(e));const a=e.generateDropItems(i);for(const i of a)this.postDropOrDestroy(t,i,e.mx,e.my)}}e.UAction=E,E.StumbleTable=[[],[{x:-1,y:1},{x:-1,y:0},{x:0,y:1},{x:-2,y:2},{x:-1,y:2},{x:-2,y:1},{x:0,y:2},{x:-2,y:0}],[{x:0,y:1},{x:1,y:1},{x:-1,y:1},{x:0,y:2},{x:1,y:2},{x:-1,y:2},{x:2,y:2},{x:-2,y:2}],[{x:1,y:1},{x:1,y:0},{x:0,y:1},{x:2,y:2},{x:2,y:1},{x:1,y:2},{x:2,y:0},{x:0,y:2}],[{x:-1,y:0},{x:-1,y:1},{x:-1,y:-1},{x:-2,y:0},{x:-2,y:1},{x:-2,y:-1},{x:-2,y:-2},{x:-2,y:2}],[],[{x:1,y:0},{x:1,y:-1},{x:1,y:1},{x:2,y:0},{x:2,y:-1},{x:2,y:1},{x:2,y:-2},{x:2,y:2}],[{x:-1,y:-1},{x:-1,y:0},{x:0,y:-1},{x:-2,y:-2},{x:-2,y:-1},{x:-1,y:-2},{x:-2,y:0},{x:0,y:-2}],[{x:0,y:-1},{x:-1,y:-1},{x:1,y:-1},{x:0,y:-2},{x:-1,y:-2},{x:1,y:-2},{x:-2,y:-2},{x:2,y:-2}],[{x:1,y:-1},{x:0,y:-1},{x:1,y:0},{x:2,y:-2},{x:1,y:-2},{x:2,y:-1},{x:0,y:-2},{x:2,y:0}]]},8153:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UBlock=void 0;const r=i(4879),s=i(7352);e.UBlock=class{static pos(t,e){return t instanceof r.LBlock?[t.mx,t.my]:[t,e]}static adjacentBlocks4(t,e,i){const[r,s]=this.pos(e,i);return[t.block(r,s-1),t.block(r-1,s),t.block(r+1,s),t.block(r,s+1)]}static adjacentBlocks8XY(t,e,i){return[t.block(e-1,i-1),t.block(e,i-1),t.block(e+1,i-1),t.block(e-1,i),t.block(e+1,i),t.block(e-1,i+1),t.block(e,i+1),t.block(e+1,i+1)]}static getAdjacentBlocks8(t,e){return this.adjacentBlocks8XY(t,e.mx,e.my)}static checkPurifier(t,e){for(const i of s.MRLively.map.entities())for(const r of i.fieldEffects())if(!r.onCheckPossibleMovement(e,t.mx,t.my))return!0;return!1}}},5964:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UDialog=void 0;const r=i(1298),s=i(9248),a=i(7352),n=i(1722),o=i(6094);e.UDialog=class{static postOpenInventoryDialog(t,e,i){const r=t.dialogContext,a=e.findEntityBehavior(s.LInventoryBehavior);return!!a&&(r.activeDialog().openSubDialog(new o.SItemListDialog(e,a),i),!0)}static postOpenFeetDialog(t,e,i){const s=t.dialogContext,o=a.MRLively.map.firstFeetEntity(e);return o?(s.activeDialog().openSubDialog(new n.SFeetDialog(e,o),i),!0):(t.postMessage((0,r.tr2)("足元には何もない。")),!1)}static openSkillDialog(t,e,i){}}},6294:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UEffect=e.UResolvedApplyEffects=e.UResolvedApplyEffectTarget=void 0;const r=i(1298);class s{constructor(t,e){this.target=t,this.mainTarget=e,this.candidateEffects=[],this.actualEffects=[]}}e.UResolvedApplyEffectTarget=s;class a{constructor(){this.targets=[]}addCandidateTargetEffect(t,e,i){const a=this.targets.find((e=>e.target==t));if(a)(0,r.assert)(a.mainTarget==e),a.candidateEffects.push(i);else{const r=new s(t,e);r.candidateEffects.push(i),this.targets.push(r)}}}e.UResolvedApplyEffects=a;e.UEffect=class{static resolveApplyEffects(t,e,i){const r=new a;for(const s of e)this.selectCandidateTargetEffects(r,t,s,i);for(const t of r.targets)this.resolveApplyEffectsSingleTarget(t,i);return r}static selectCandidateTargetEffects(t,e,i,r){for(const r of e){const e=r.data().effect.subEntityFindKey.key;if(e)for(const s of i.querySubEntities(e))t.addCandidateTargetEffect(s,i,r);else t.addCandidateTargetEffect(i,i,r)}}static resolveApplyEffectsSingleTarget(t,e){const i=t.candidateEffects.filter((t=>!t.data().hasCondition()));for(const e of i)t.actualEffects.push(e);const r=t.candidateEffects.filter((e=>e.data().hasCondition()&&this.meetsCondition(e,t.target)));if(r.length>0){const i=[];for(const e of r)e.data().conditions.applyRating>0?i.push(e):t.actualEffects.push(e);const s=this.selectEffect(i,e);s&&t.actualEffects.push(s)}else for(const e of t.candidateEffects.filter((t=>t.data().conditions.fallback)))t.actualEffects.push(e)}static meetsCondition(t,e){const i=t.data();e.data;return!i.conditions.fallback&&((0==i.conditions.targetCategoryId||i.conditions.targetCategoryId==e.kindDataId())&&!(0!=i.conditions.targetRaceId&&!e.queryRaceIds().includes(i.conditions.targetRaceId)))}static selectEffect(t,e){return this.selectRating(e,t,(t=>t.data().conditions.applyRating))}static selectRating(t,e,i){const r=Math.max(...e.map((t=>i(t))))-10,s=e.filter((t=>i(t)>r)),a=s.reduce(((t,e)=>t+i(e)-r),0);if(a>0){let e=t.nextIntWithMax(a);for(const t of s){const s=i(t);if(s&&(e-=s-r,e<0))return t}throw new Error("Unreachable.")}}static selectRatingForce(t,e,i,s){(0,r.assert)(e.length>0);const a=Math.max(...e.map((t=>s(t))))-i,n=e.filter((t=>s(t)>a)),o=n.reduce(((t,e)=>t+s(e)-a),0);if(o>0){let e=t.nextIntWithMax(o);for(const t of n){const i=s(t);if(i&&(e-=i-a,e<0))return t}throw new Error("Unreachable.")}return e[t.nextIntWithMax(e.length)]}}},6296:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UIdentify=void 0;const r=i(1298),s=i(7352),a=i(3482);e.UIdentify=class{static identifyByTiming(t,e,i,r,a=!0){if(s.MRLively.camera.focusedEntity()!=e)return;const n=i.data;n.identificationReaction>0&&n.identificationReaction==r&&this.identify(t,i,a)}static identify(t,e,i){if(s.MRLively.getCurrentIdentifyer().checkGlobalIdentified(e))e.setIndividualIdentified(!0);else{const n=a.UName.makeNameAsItem(e);e.setIndividualIdentified(!0),s.MRLively.getCurrentIdentifyer().identifyGlobal(e.dataId);const o=a.UName.makeNameAsItem(e);i&&t.postMessage((0,r.tr2)("%1は%2だった。").format(n,o))}}}},5139:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UInventory=void 0;const r=i(1298),s=i(4836),a=i(7534),n=i(913),o=i(9248),c=i(1325),l=i(2994),h=i(695),u=i(3482);e.UInventory=class{static sort(t){const e=t.ownerEntity().findEntityBehavior(n.LEquipmentUserBehavior),i=this.makeMergedStackables(t);let r;r=e?i.sort(((t,i)=>{const r=e.isEquipped(t)?t.kindDataId():t.kindDataId()+1e4,s=e.isEquipped(i)?i.kindDataId():i.kindDataId()+1e4;return r==s?t.dataId-i.dataId:r-s})):i.sort(((t,e)=>t.kindDataId()-e.kindDataId())),t._entities=r.map((t=>t.entityId().clone()))}static makeMergedStackables(t){const e=t.items;for(let t=e.length-1;t>=0;t--)for(let i=t-1;i>=0;i--){const r=e[t],s=e[i];if(s.checkStackable(r)){s.increaseStack(r),e.mutableRemoveAt(t);break}}return e}static postStoreItemsToWarehouse(t,e,i,a,n){const h=e.getEntityBehavior(o.LInventoryBehavior),d=i.getEntityBehavior(o.LInventoryBehavior);return t.postTask((e=>{d.itemCount+a.length>d.capacity&&(t.postMessage((0,r.tr2)("倉庫がいっぱいです。")),n.code=l.SWarehouseDialogResult.FullyCanceled,e.reject())})).then2((e=>{const o=a.map((e=>t.postCommandTask(e,c.SCommand.make(s.MRBasics.commands.testPickOutItem)).thenTask(t.makeCommandTask(i,c.SCommand.make(s.MRBasics.commands.testPutInItem).withObject(e))).then2((i=>{h.removeEntity(e),d.addEntity(e),t.postMessage((0,r.tr2)("%1を預けた。").format(u.UName.makeNameAsItem(e))),this.sort(d),n.items.push(e)}))));return t.whenAll(o)}))}static postWithdrawItemsToWarehouse(t,e,i,a,n){const d=e.getEntityBehavior(o.LInventoryBehavior),p=i.getEntityBehavior(o.LInventoryBehavior);new h.SEffectSubject(e);return t.postTask((e=>{d.itemCount+a.length>d.capacity&&(t.postMessage((0,r.tr2)("もちものがいっぱいです。")),n.code=l.SWarehouseDialogResult.FullyCanceled,e.reject())})).then2((i=>{const o=a.map((i=>t.postCommandTask(i,c.SCommand.make(s.MRBasics.commands.testPickOutItem)).thenTask(t.makeCommandTask(e,c.SCommand.make(s.MRBasics.commands.testPutInItem).withObject(i))).then2((e=>{p.removeEntity(i),d.addEntity(i),t.postMessage((0,r.tr2)("%1を取り出した。").format(u.UName.makeNameAsItem(i))),n.items.push(i)}))));return t.whenAll(o)}))}static postSellItemsAndDestroy(t,e,i){const r=e.getEntityBehavior(o.LInventoryBehavior),s=new h.SEffectSubject(e);let n=0;for(const o of i)t.post(e,e,s,o,a.testPickOutItem,(()=>{if(n++,n>=i.length){let t=0;for(const e of i)t+=e.data.purchasePrice,e.removeFromParent(),e.destroy();r.gainGold(t)}return!0}))}}},1695:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ULimitations=void 0;const r=i(6559),s=i(6501),a=i(7352),n=i(3609);e.ULimitations=class{static getItemCountInMap(){const t=a.MRLively.map;let e=0;return t.iterateEntities((t=>{t.findEntityBehavior(s.LUnitBehavior)||t.findEntityBehavior(r.LTrapBehavior)||e++})),e}static isItemCountFullyInMap(){return this.getItemCountInMap()>=n.paramMaxItemsInMap}static getTrapCountInMap(){const t=a.MRLively.map;let e=0;return t.iterateEntities((t=>{t.findEntityBehavior(r.LTrapBehavior)&&e++})),e}static getResidualsTrapCountInMap(){return Math.max(n.paramMaxTrapsInMap-this.getTrapCountInMap(),0)}}},6316:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UMovement=void 0;const r=i(1298),s=i(4836),a=i(7352),n=i(6229),o=i(8254),c=i(9115),l=i(8153),h=i(5967),u=i(3609);class d{static distanceSq(t,e,i,r){const s=t-i,a=e-r;return s*s+a*a}static reverseDir(t){return 10-t}static isDiagonalMoving(t){return t%2!=0}static checkAdjacentEntities(t,e){return Math.abs(t.mx-e.mx)<=1&&Math.abs(t.my-e.my)<=1}static checkAdjacentPositions(t,e,i,r){const s=t-i,a=e-r;return Math.abs(s)<=1&&Math.abs(a)<=1}static checkEntityAdjacent(t,e){const i=t.mx-e.mx,r=t.my-e.my;return Math.abs(i)<=1&&Math.abs(r)<=1}static checkDirectlyAdjacentEntity(t,e){const i=this.getLookAtDir(t,e);return!this.checkDiagonalWallCornerCrossing(t,i)&&this.checkEntityAdjacent(t,e)}static checkDiagonalWallCornerCrossing(t,e){const i=a.MRLively.map;if(d.isDiagonalMoving(e)){const r=d.rotatePositionByDir(7,e),s=d.rotatePositionByDir(9,e),a=i.block(t.mx+r.x,t.my+r.y),n=i.block(t.mx+s.x,t.my+s.y);return!!a.isWallLikeShape()||!!n.isWallLikeShape()}return!1}static checkPassageToDir(t,e){const i=o.Helpers.dirToTileOffset(e),r=a.MRLively.map,s=r.block(t.mx,t.my),c=r.block(t.mx+i.x,t.my+i.y);return this.checkPassageBlockToBlock(t,s,c,n.MovingMethod.Walk)}static checkPassageBlockToBlock(t,e,i,r,s){const n=a.MRLively.map,c=s||t.getHomeLayer(),l=i.mx-e.mx,u=i.my-e.my;if(Math.abs(l)>1)return!1;if(Math.abs(u)>1)return!1;if(s==h.DBlockLayerKind.Projectile){if(!n.canMoveEntering(i,t,r,c))return!1}else{if(!n.canLeaving(e,t))return!1;if(!n.canMoveEntering(i,t,r,c))return!1;const s=o.Helpers.offsetToDir(l,u);if(this.isDiagonalMoving(s)){const e=this.rotatePositionByDir(7,s),i=this.rotatePositionByDir(9,s),r=n.block(t.mx+e.x,t.my+e.y),a=n.block(t.mx+i.x,t.my+i.y);if(r.isWallLikeShape())return!1;if(a.isWallLikeShape())return!1}}return!0}static getLookAtDir(t,e){const i=e.mx-t.mx,r=e.my-t.my;return o.Helpers.offsetToDir(i,r)}static getLookAtDirFromPos(t,e,i,r){return o.Helpers.offsetToDir(i-t,r-e)}static getCenter(t){let e=0,i=0;for(const r of t)e+=r.mx,i+=r.my;return{x:Math.floor(e/t.length),y:Math.floor(i/t.length)}}static getCenterOfRoom(t){const e=(t.mx1+t.mx2)/2,i=(t.my1+t.my2)/2;return{x:Math.floor(e),y:Math.floor(i)}}static getNextDirCW(t){switch(t){case 1:return 4;case 2:return 1;default:return 2;case 4:return 7;case 6:return 3;case 7:return 8;case 8:return 9;case 9:return 6}}static getRightDir(t){return this.getNextDirCW(this.getNextDirCW(t))}static getAdjacentBlock(t,e){const i=o.Helpers._dirToTileOffsetTable[e];return a.MRLively.map.block(t.mx+i.x,t.my+i.y)}static getFrontBlock(t){const e=o.Helpers.makeEntityFrontPosition(t,1);return a.MRLively.map.block(e.x,e.y)}static getAdjacentBlocks(t){const e=a.MRLively.map;(0,r.assert)(e.floorId().equals(t.floorId));const i=[];for(const r of this.adjacent8Offsets){const s=t.mx+r[0],a=t.my+r[1];e.isValidPosition(s,a)&&i.push(e.block(s,a))}return i}static getAdjacentEntities(t,e){const i=[];for(const e of this.getAdjacentBlocks(t))for(const t of e.getEntities())i.push(t);return i}static getNextAdjacentEntityDirCW(t){const e=a.MRLively.map;let i=t.dir;for(let r=0;r<9;r++){const r=o.Helpers.dirToTileOffset(i),s=t.mx+r.x,a=t.my+r.y;if(e.block(s,a).aliveEntity(h.DBlockLayerKind.Unit))return i;i=this.getNextDirCW(i)}return t.dir}static getMovingCandidateBlockAsLHRule(t,e){const i=a.MRLively.map,r=i.block(t.mx,t.my);for(const s of this.LHRuleOffsets){const a=this.transformRotationBlock(s.x,s.y,e),o=i.tryGetBlock(t.mx+a.x,t.my+a.y);if(o&&this.checkPassageBlockToBlock(t,r,o,n.MovingMethod.Walk))return o}}static getWay3FrontBlocks(t,e){const i=[],r=a.MRLively.map;for(const s of this.way3Offsets){const a=this.transformRotationBlock(s.x,s.y,e),n=r.tryGetBlock(t.mx+a.x,t.my+a.y);n&&i.push(n)}return i}static getMovableAdjacentTiles(t){const e=[],i=a.MRLively.map,r=i.block(t.mx,t.my);for(const s of this.AdjacentDirs){const a=o.Helpers.dirToTileOffset(s),c=i.tryGetBlock(t.mx+a.x,t.my+a.y);c&&this.checkPassageBlockToBlock(t,r,c,n.MovingMethod.Walk)&&e.push(c)}return e}static selectNearbyLocatableBlock(t,e,i,r,s){for(let n=0;n<=3;n++){const o=a.MRLively.map.getEdgeBlocks(e,i,n).filter((t=>{if(t.isWallLikeShape())return!1;const e=t.layer(r);return!e.isContainsAnyEntity()||!(1!=e.entityIds().length||!e.entityIds()[0].equals(s.entityId()))}));if(o.length>0)return t.select(o)}}static blockDistance(t,e,i,r){const s=Math.abs(i-t),a=Math.abs(r-e);return Math.max(s,a)}static transformRotationBlock(t,e,i){const s=this.blockDistance(0,0,t,e),a=2*s,n=[{x:o.Helpers.dirToTileOffset(7).x*s,y:o.Helpers.dirToTileOffset(7).y*s,forwardX:1,forwardY:0,beginOffset:0*a,endOffset:1*a},{x:o.Helpers.dirToTileOffset(9).x*s,y:o.Helpers.dirToTileOffset(9).y*s,forwardX:0,forwardY:1,beginOffset:1*a,endOffset:2*a},{x:o.Helpers.dirToTileOffset(3).x*s,y:o.Helpers.dirToTileOffset(3).y*s,forwardX:-1,forwardY:0,beginOffset:2*a,endOffset:3*a},{x:o.Helpers.dirToTileOffset(1).x*s,y:o.Helpers.dirToTileOffset(1).y*s,forwardX:0,forwardY:-1,beginOffset:3*a,endOffset:4*a}];let c=-1;for(const i of n){const r=Math.min(i.x,i.x+i.forwardX*a),s=Math.min(i.y,i.y+i.forwardY*a),n=Math.max(i.x,i.x+i.forwardX*a),o=Math.max(i.y,i.y+i.forwardY*a);if(r<=t&&t<=n&&s<=e&&e<=o){c=this.blockDistance(i.x,i.y,t,e)+i.beginOffset;break}}(0,r.assert)(c>=0);const l=(c+this._edgeOffsetTable[i]*s)%n[3].endOffset,h=n.find((t=>t.beginOffset<=l&&l<t.endOffset));(0,r.assert)(h);const u=l-h.beginOffset;return{x:h.x+h.forwardX*u,y:h.y+h.forwardY*u}}static rotatePositionByDir(t,e){const i=o.Helpers.dirToTileOffset(t);return this.transformRotationBlock(i.x,i.y,e)}static rotateDir(t,e){const i=o.Helpers.dirToTileOffset(t),r=this.transformRotationBlock(i.x,i.y,e);return o.Helpers.offsetToDir(r.x,r.y)}static checkDashStopBlock(t){const e=t.mx,i=t.my,r=a.MRLively.map,s=o.Helpers.dirToTileOffset(t.dir),c=r.block(e,i),u=r.block(e+s.x,i+s.y);if(!this.checkPassageBlockToBlock(t,c,u,n.MovingMethod.Walk))return!1;if(c.layer(h.DBlockLayerKind.Ground).isContainsAnyEntity())return!1;if(c._roomId!=u._roomId)return!1;if(l.UBlock.adjacentBlocks8XY(r,e,i).find((t=>t.layer(h.DBlockLayerKind.Unit).isContainsAnyEntity()||t.layer(h.DBlockLayerKind.Ground).isContainsAnyEntity())))return!1;if(c.isPassageway()){const s=o.Helpers.dirToTileOffset(this.reverseDir(t.dir));if(l.UBlock.adjacentBlocks4(r,e+s.x,i+s.y).filter((t=>t.isFloorLikeShape())).length<l.UBlock.adjacentBlocks4(r,e,i).filter((t=>t.isFloorLikeShape())).length)return!1}else if(c.isRoomInnerEntrance())return!1;return!0}static moveEntity(t,e,i,s,n,o){const c=a.MRLively.map;if((0,r.assert)(e.floorId.equals(c.floorId())),!c.isValidPosition(i,s))return!1;const l=c.block(e.mx,e.my),h=c.block(i,s);return!!this.checkPassageBlockToBlock(e,l,h,n,o)&&((0,r.assert)(l.removeEntity(e)),e.mx=i,e.my=s,h.addEntity(o,e),this._postLocate(e,l,h,c,t),!0)}static locateEntity(t,e,i,s){const n=a.MRLively.map;(0,r.assert)(t.floorId.equals(n.floorId()));const o=n.block(t.mx,t.my),l=n.block(e,i);(0,r.assert)(l);const h=s||t.getHomeLayer();o.removeEntity(t),t.mx=e,t.my=i,l.addEntity(h,t),this._postLocate(t,o,l,n,void 0),c.MRSystem.integration.onEntityLocated(t)}static locateEntityAtFloorMoved(t,e,i,r){t.floorId=e.clone(),t.mx=i,t.my=r}static _postLocate(t,e,i,n,o){if((0,r.assert)(!t.isOnOffstage()),a.MRLively.camera.focusedEntityId().equals(t.entityId())&&this.markPassed(n,i),e&&o&&e._roomId!=i._roomId){const r={entity:t,newRoomId:i._roomId,oldRoomId:e._roomId};a.MRLively.eventServer.publish(o,s.MRBasics.events.roomEnterd,r),a.MRLively.eventServer.publish(o,s.MRBasics.events.roomLeaved,r)}t._located=!0}static markPassed(t,e){if(e._passed=!0,e._roomId>0){const i=t.room(e._roomId);i.poorVisibility?i.forEachSightableBlocks((t=>{this.blockDistance(e.mx,e.my,t.mx,t.my)<=u.paramDefaultVisibiltyLength&&(t._passed=!0)})):i.forEachSightableBlocks((t=>t._passed=!0))}else this.adjacent8Offsets.forEach((i=>{const r=e.mx+i[0],s=e.my+i[1];t.isValidPosition(r,s)&&(t.block(r,s)._passed=!0)}));c.MRSystem.minimapData.setRefreshNeeded()}}e.UMovement=d,d._edgeOffsetTable=[0,5,4,3,6,0,2,7,0,1],d.LHRuleOffsets=[{x:0,y:-1},{x:-1,y:-1},{x:1,y:-1},{x:-1,y:0},{x:1,y:0}],d.way3Offsets=[{x:0,y:-1},{x:-1,y:-1},{x:1,y:-1}],d.directions=[1,2,3,4,6,7,8,9],d.adjacent8Offsets=[[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]],d.AdjacentDirs=[1,2,3,4,6,7,8,9]},3482:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UName=void 0;const r=i(1298),s=i(1019),a=i(7352),n=i(9901);e.UName=class{static makeUnitName(t,e){e||(e=a.MRLively.camera.focusedEntity()),(0,r.assert)(e);const i=n.SView.getLookNames(e,t);return s.LEntityDescription.makeDisplayText(i.name,s.DescriptionHighlightColor.UnitName)}static makeNameAsItem(t,e){return e||(e=a.MRLively.camera.focusedEntity()),(0,r.assert)(e),a.MRLively.getCurrentIdentifyer().makeDisplayText(e,t)}}},687:(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.UPropertyPath=exports.UComponentType=exports.UProperty=void 0;const Common_1=__webpack_require__(1298),MRLively_1=__webpack_require__(7352),SFormulaOperand_1=__webpack_require__(4271),USearch_1=__webpack_require__(1301);class UProperty{static setValue(t,e,i){const r=USearch_1.USearch.getEntityByKeyPattern(t),s=new UPropertyPath(e),a=this.getObject(r,s);if(!s.propertyName)throw new Error("Invalid property name.");if(!a)throw new Error(`Invalid property path. ${e}`);if(s.behaviorName){const t=r.findEntityBehaviorByName(s.behaviorName);t||new Error(`Behavior not found. ${e}`),t[s.propertyName]=i}}static getValue(t,e){const i=MRLively_1.MRLively.world.getFirstEntityByKey(t);throw this.getValueFromEntity(i,e)}static getValueFromEntity(entity,path){const propPath=new UPropertyPath(path),obj=this.getObject(entity,propPath);if(!propPath.propertyName)return void 0!==obj?1:0;if(!obj)throw new Error(`Invalid property path. ${path}`);if(propPath.behaviorName){const behavior=entity.findEntityBehaviorByName(propPath.behaviorName);let value;return behavior||new Error(`Behavior not found. ${path}`),eval(`value = behavior.${propPath.propertyName}`),value}if(propPath.propertyName){let value;return eval(`value = obj.${propPath.propertyName}`),value}}static getObject(t,e){if(e.componentType==UComponentType.Entity)return t;if(e.componentType==UComponentType.Param){const e=new SFormulaOperand_1.SFormulaOperand;return e.wrap(t),e}if(e.componentType==UComponentType.State)return t.states().find((t=>t.stateData().key==e.element));throw new Error("Not implemented.")}static getValueByVariablePattern(pattern){if(pattern.startsWith("${")){const t=pattern.indexOf("}");if(t>=0){const e=pattern.substring(2,t),i=parseInt(pattern);if(isNaN(i)){const t=$dataSystem.variables.findIndex((t=>t&&t==e));if(t>=0)return $gameVariables.value(t);throw new Error(`${pattern} not found.`)}return $gameVariables.value(i)}}const numberValue=parseInt(pattern);return isNaN(numberValue)?eval(pattern):numberValue}}var UComponentType;exports.UProperty=UProperty,function(t){t[t.Entity=0]="Entity",t[t.Param=1]="Param",t[t.State=2]="State",t[t.Ability=3]="Ability"}(UComponentType=exports.UComponentType||(exports.UComponentType={}));class UPropertyPath{constructor(t){const e=t.split(":");let i,r;if(i=1==e.length?e[0]:e[1],e.length>=2||e[0].includes("[")){const t=/([a-z]+)(\[.+\])*/gi.exec(e[0]);(0,Common_1.assert)(t);const s=t[1];r=this.parseComponentType(s);const a=t[2];a&&(this.element=a.substring(1,a.length-1)),1==e.length&&(i="")}if(0==i.length)void 0===r&&(r=UComponentType.Param);else{const t=i.split(".");t.length>=2?(this.behaviorName=t[0],this.propertyName=t.slice(1).join("."),void 0===r&&(r=UComponentType.Entity)):(this.propertyName=t.join("."),void 0===r&&(r=UComponentType.Param))}this.componentType=r}parseComponentType(t){switch(t.toLocaleLowerCase()){case"entity":return UComponentType.Entity;case"param":return UComponentType.Param;case"state":return UComponentType.State;case"ability":return UComponentType.Ability;default:throw new Error((0,Common_1.tr2)("プロパティパスのコンポーネント種類が不正です。(%1)").format(t))}}}exports.UPropertyPath=UPropertyPath},1301:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.USearch=void 0;const r=i(1298),s=i(5967),a=i(6189),n=i(4836),o=i(5748),c=i(7922),l=i(9543),h=i(6559),u=i(6501),d=i(7352),p=i(3609),f=i(8254),m=i(6316);e.USearch=class{static hasBlindness(t){return void 0!==t.states().find((t=>t.stateEffect().restriction==a.DStateRestriction.Blind))}static isVisible(t){return!t.hasTrait(n.MRBasics.traits.Invisible)}static isVisibleFromSubject(t,e){return!!d.MRLively.map.unitClarity||(!!t.hasTrait(n.MRBasics.traits.ForceVisible)||!e.hasTrait(n.MRBasics.traits.Invisible))}static checkInSightEntity(t,e){if(t.isOnRoom()){const i=d.MRLively.map.room(t.roomId());return!!i.containsWithEdge(e.mx,e.my)&&!(i.poorVisibility&&m.UMovement.blockDistance(t.mx,t.my,e.mx,e.my)>p.paramDefaultVisibiltyLength)}return m.UMovement.checkAdjacentEntities(t,e)}static checkInSightBlockFromSubject(t,e){if(this.hasBlindness(t))return!1;if(t.isOnRoom()){return d.MRLively.map.room(t.roomId()).checkVisibilityBlock(e)}return m.UMovement.checkAdjacentPositions(t.mx,t.my,e.mx,e.my)}static isNeutralItem(t){return!t.findEntityBehavior(u.LUnitBehavior)&&(!t.findEntityBehavior(h.LTrapBehavior)&&(!t.findEntityBehavior(c.LExitPointBehavior)&&(!t.findEntityBehavior(o.LEntryPointBehavior)&&!!t.findEntityBehavior(l.LItemBehavior))))}static iterateAroundPositions(t,e,i,r){if(0==i)return;const s=t-i,a=e-i,n=t+i,o=e+i;for(let t=s;t<n;t++)r(t,a);for(let t=a;t<o;t++)r(n,t);for(let t=n;t>s;t--)r(t,o);for(let t=o;t>a;t--)r(s,t)}static iterateAroundBlocks(t,e,i,s,a){if((0,r.assert)(i>=1),s){const i=d.MRLively.map.tryGetBlock(t,e);i&&a(i)}this.iterateAroundPositions(t,e,i,((t,e)=>{const i=d.MRLively.map.tryGetBlock(t,e);i&&a(i)}))}static iterateAroundEntities(t,e,i,r,s){this.iterateAroundBlocks(t,e,i,r,(t=>{for(const e of t.getEntities())s(e)}))}static getFirstUnderFootEntity(t){const e=d.MRLively.map.tryGetBlock(t.mx,t.my);if(e){return e.getFirstEntity(s.DBlockLayerKind.Ground)}}static selectUnitSpawnableBlock(t){const e=d.MRLively.map.getSpawnableBlocks(s.DBlockLayerKind.Unit);if(0==e.length)return null;const i=d.MRLively.camera.focusedEntity();(0,r.assert)(i);const a=i.mx,n=i.my;let o=e.filter((t=>{const e=Math.abs(t.mx-a),i=Math.abs(t.my-n);return e>p.paramEnemySpawnInvalidArea||i>p.paramEnemySpawnInvalidArea}));return d.MRLively.map.isSingleRoomMap||(o=o.filter((t=>t._roomId!=i.roomId()))),o.length>0?o[t.nextIntWithMax(o.length)]:t.select(e)}static findLatestItemInVisibilityBlocks(t){const e=t.roomId(),i=d.MRLively.map.entities().filter((t=>t.roomId()==e&&!!this.isNeutralItem(t)));if(i.length>0)return i[i.length-1]}static findFirstWallInDirection(t,e,i){const r=d.MRLively.map;let s=1;for(;;){const a=f.Helpers._dirToTileOffsetTable[i],n=t+a.x*s,o=e+a.y*s;if(!r.isValidPosition(n,o))break;const c=r.tryGetBlock(n,o);if(c&&c.isWallLikeShape())return c;s++}throw new Error("Unreachable.")}static getUniqueActorByKey(t){const e=d.MRLively.system.uniqueActorUnits.map((t=>d.MRLively.world.entity(t))).find((e=>e.data.entity.key==t));if(!e)throw new Error((0,r.tr2)("%1はアクターの中から見つかりませんでした。").format(t));return e}static getEntityByKeyPattern(t){if("${Player}"==t)return d.MRLively.camera.getFocusedEntity();{const e=d.MRLively.system.uniqueActorUnits.map((t=>d.MRLively.world.entity(t))).find((e=>e.data.entity.key==t));if(!e)throw new Error((0,r.tr2)("%1は見つかりませんでした。").format(t));return e}}}},1584:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.USpawner=void 0;const r=i(6291),s=i(9185),a=i(7352),n=i(5150),o=i(6294);e.USpawner=class{static spawnSingleEntity(t,e,i){const o=a.MRLively.map.floorId(),c=n.SEntityFactory.newEntity(r.DEntityCreateInfo.makeSingle(s.MRData.getEntity(t).id),o);return a.MRLively.world.transferEntity(c,o,e,i),c}static getEnemiesFromSpawnTable(t){const e=new Set,i=t.landData().appearanceTable.enemies[t.floorNumber()];if(i)for(const t of i)if(t.spawiInfo.troopId>0){const i=s.MRData.troops[t.spawiInfo.troopId];for(const t of i.members)e.add(t)}else e.add(t.spawiInfo.entityId);return 0==e.size&&e.add(s.MRData.system.fallbackEnemyEntityId),Array.from(e.values()).map((t=>s.MRData.entities[t]))}static createItemFromSpawnTable(t,e){const i=t.landData().appearanceTable;if(0==i.items.length)return;const r=i.items[t.floorNumber()];if(0==r.length)return;const s=o.UEffect.selectRatingForce(e,r,100,(t=>t.spawiInfo.rate));return n.SEntityFactory.newEntity(s.spawiInfo,t)}static createTrapFromSpawnTable(t,e){const i=t.landData().appearanceTable;if(0==i.traps.length)return;const r=i.traps[t.floorNumber()];if(0==r.length)return;const s=o.UEffect.selectRatingForce(e,r,100,(t=>t.spawiInfo.rate));return n.SEntityFactory.newEntity(s.spawiInfo,t)}static createItemFromSpawnTableOrDefault(t,e){const i=this.createItemFromSpawnTable(t,e);return i||n.SEntityFactory.newEntity(r.DEntityCreateInfo.makeSingle(s.MRData.system.fallbackItemEntityId),t)}}},4882:(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.UState=void 0;const Common_1=__webpack_require__(1298),DEffect_1=__webpack_require__(4561),DState_1=__webpack_require__(6189),MRData_1=__webpack_require__(9185),SStateFactory_1=__webpack_require__(7085),Diag_1=__webpack_require__(7048);class UState{static effect(t){return t.submatchEffectIndex>=0?MRData_1.MRData.states[t.submatchEffectIndex].effect:t.data.effect}static resolveStates(entity,newStates,removeStateIds){const entityData=entity.data,currentStates=entity.states().map((t=>({data:t.stateData(),submatchEffectIndex:t.submatchEffectIndex(),removing:!1,new:!1,level:t.level()}))),stateGroups=MRData_1.MRData.stateGroups.map((t=>({data:t,states:[]})));for(const t of newStates){let e=currentStates.find((e=>e.data.id==t.stateId));if(e);else{if(!entity.isStateAddable(t.stateId))continue;e={data:MRData_1.MRData.states[t.stateId],submatchEffectIndex:this.selectEffectIndex(entity,MRData_1.MRData.states[t.stateId]),removing:!1,new:!0,level:0},currentStates.push(e)}switch(t.levelType){case DEffect_1.LStateLevelType.AbsoluteValue:e.level=t.level;break;case DEffect_1.LStateLevelType.RelativeValue:e.level+=t.level;break;default:throw new Error("Unreachable.")}0==e.level&&(e.removing=!0)}for(const t of removeStateIds){const e=currentStates.find((e=>e.data.id==t));e&&(e.removing=!0)}for(const state of currentStates){if(state.data.autoAdditionCondition){let cond=!1;try{const a=entity;cond=eval(state.data.autoAdditionCondition)}catch(t){Diag_1.Diag.error((0,Common_1.tr2)("ステートの自動付加条件の評価に失敗しました。ステートID: %1 条件: %2").format(state.data.id,state.data.autoAdditionCondition))}cond||(state.removing=!0)}this.checkRemoveAtActualParam(this.effect(state),entity)&&(state.removing=!0)}for(const data of MRData_1.MRData.states)if(data.autoAdditionCondition&&!currentStates.find((t=>t.data.id==data.id))){let cond=!1;try{const a=entity;cond=eval(data.autoAdditionCondition)}catch(t){Diag_1.Diag.error((0,Common_1.tr2)("ステートの自動付加条件の評価に失敗しました。ステートID: %1 条件: %2").format(data.id,data.autoAdditionCondition))}!0===cond&&currentStates.push({data,submatchEffectIndex:this.selectEffectIndex(entity,data),removing:!1,new:!0,level:1})}for(const data of entityData.autoAdditionStates)if(!currentStates.find((t=>t.data.id==data.stateId))){const a=entity,cond=eval(data.condition);!0===cond&&currentStates.push({data:MRData_1.MRData.states[data.stateId],submatchEffectIndex:this.selectEffectIndex(entity,MRData_1.MRData.states[data.stateId]),removing:!1,new:!0,level:1})}for(const t of currentStates)for(const e of t.data.stateGroupIds)stateGroups[e].states.push(t);for(const t of stateGroups)t.states.length>0&&t.states.sort(((t,e)=>t.data.priority==e.data.priority?t.data.id-e.data.id:t.data.priority-e.data.priority));for(const t of stateGroups)if(t.data.exclusive){let e=-1;for(let i=t.states.length-1;i>=0;i--)if(!t.states[i].removing){e=i;break}for(let i=0;i<e;i++)t.states[i].removing=!0}const oldStates=entity.states();for(const t of currentStates)if(t.removing){const e=oldStates.find((e=>e.stateDataId()==t.data.id));e&&(e.clearParent(),e.onDetached(entity),entity._effectResult.pushRemovedState(t.data.id))}const result=[];for(const t of currentStates)if(!t.removing){let e=oldStates.find((e=>e.stateDataId()==t.data.id));e?(t.new&&(0,Common_1.assert)(!t.new),e.recast()):((0,Common_1.assert)(t.new),e=SStateFactory_1.SStateFactory.newState(t.data.id),e._submatchEffectIndex=t.submatchEffectIndex,e.setParent(entity),(0,Common_1.assert)(e.hasId()),e.onAttached(entity),entity._effectResult.pushAddedState(t.data.id)),e.setLevel(t.level),result.push(e)}return result}static selectEffectIndex(t,e){for(let i=e.submatchStates.length-1;i>=0;i--){const r=e.submatchStates[i],s=MRData_1.MRData.states[r].effect;if(this.meetsConditions(t,s))return i}return-1}static meetsConditions(t,e){if(0!=e.matchConditions.kindId){const i=t.kindDataId();if(e.matchConditions.kindId!=i)return!1}return!0}static checkRemoveAtActualParam(effect,entity){const a=entity;for(const r of effect.autoRemovals)if(r.kind==DState_1.DAutoRemovalTiming.ActualParam){const v=eval(r.formula);if(!0===v)return!0}return!1}static attemptRemoveStateAtFloorTransfer(t){const e=[];t.iterateStates((t=>(t.stateEffect().autoRemovals.find((t=>t.kind==DState_1.DAutoRemovalTiming.FloorTransfer))&&e.push(t.stateDataId()),!0))),t.removeStates(e)}static meetsApplyConditions(t,e){return!(t.applyConditions.kindIds.length>0&&!t.applyConditions.kindIds.find((t=>t===e.kindDataId())))}}exports.UState=UState},3721:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UTransfer=void 0;const r=i(1298),s=i(2213),a=i(9185),n=i(3758),o=i(4765),c=i(7352),l=i(2255);e.UTransfer=class{static transterRmmzDirectly(t,e,i){const h=a.MRData.maps[t].landId,u=a.MRData.maps[t];let d=0,p=-1,f=-1;if(h==s.DHelpers.VanillaLandId||u.eventMap)d=t,p=e,f=i;else if(n.MRDataManager.isLandMap(t)){(0,r.assert)(0===i);const t=e,s=a.MRData.lands[h],n=s.floorInfos[t];s.findFixedMapByName(n.fixedMapName);d=t,p=-1,f=-1}else{if(!n.MRDataManager.isRESystemMap(t))throw new Error("Unreachable.");{const s=$dataMapInfos[t];(0,r.assert)(s);const n=s.name,o=a.MRData.lands[h];if(d=o.floorInfos.findIndex((t=>t&&t.fixedMapName==n)),p=e,f=i,d<0)throw new Error((0,r.tr2)("Landフロアテーブルに設定が無い固定マップへ移動しようとしました。\nland:%1, map:%2").format(o.name,s.name))}}const m=new o.LFloorId(h,l.DFloorClass.FloorMap,d),y=c.MRLively.camera.focusedEntity();y&&c.MRLively.world.transferEntity(y,m,p,f)}static exitLand(t,e,i){var s;(0,r.assert)(e==c.MRLively.camera.focusedEntity()),null===(s=e.party())||void 0===s||s.journal.commitLandResult(i);const a=c.MRLively.map,n=o.LFloorId.makeFromEventMapData(a.land2().landData().exitMapData);t.postTransferFloor(e,n)}static proceedFloorForwardForPlayer(t){var e;const i=c.MRLively.camera.focusedEntity();if(i){const r=i.floorId,s=r.floorNumber()+1;if(s>c.MRLively.map.land2().maxFloorNumber()){const t=o.LFloorId.makeFromEventMapData(r.landData().exitMapData);null===(e=i.party())||void 0===e||e.journal.commitLandResult(a.LandExitResult.Goal),c.MRLively.world.transferEntity(i,t)}else{const t=o.LFloorId.make(r.landId(),l.DFloorClass.FloorMap,s);c.MRLively.world.transferEntity(i,t)}t&&t.setWaitMode("transfer")}}}},8855:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MRView=void 0;const r=i(9832),s=i(9018),a=i(9336),n=i(3619),o=i(1885),c=i(2896),l=i(401),h=i(9737);class u{static initialize(){this.finalize(),this.sequelFactory=new a.VSequelFactory,this.dialogManager=new h.VDialogManager}static onSceneChanged(t){this.scene=t,this._challengeResultWindow=new c.VChallengeResultWindow,this.scene.addWindow(this._challengeResultWindow),this._messageWindowSet=new o.VMessageWindowSet(t),this.guideGrid=new n.VMapGuideGrid,this.chronus=new l.VChronus(t),this.ext.onMapVisualSetup()}static finalize(){this.sequelFactory=void 0,this.dialogManager=void 0}static update(){var t,e,i,s,a;null===(t=this.entityVisualSet)||void 0===t||t.update(),null===(e=this.guideGrid)||void 0===e||e.update(),null===(i=this._messageWindowSet)||void 0===i||i.update(),r.VAnimation.update(),null===(s=this.dialogManager)||void 0===s||s.dialogNavigator.lateUpdate(),null===(a=this.chronus)||void 0===a||a.update()}}e.MRView=u,u.ext=new s.MRVisualExtension,u._syncCamera=!0,u._playerPosRefreshNeed=!1},9018:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MRVisualExtension=void 0;e.MRVisualExtension=class{onMapVisualSetup(){}onOpenDialog(t){}}},8127:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VCharacterSpriteSet=void 0;const r=i(8516),s=i(9185),a=i(913),n=[0,-1,1,1,-1,0,1,-1,-1,1],o=[0,1,1,-1,1,0,-1,1,-1,-1];e.VCharacterSpriteSet=class{constructor(t,e){this._parent=t,this._owner=e,this._sprites=[],this._revisionNumber=0}update(){var t;const e=this._owner.findVisual(),i=null==e?void 0:e.entity().findEntityBehavior(a.LEquipmentUserBehavior);if(e&&i){if(this._revisionNumber!=i.revisitonNumber()){const e=i.equippedItemEntities();for(;this._sprites.length>e.length;)null===(t=this._sprites[this._sprites.length-1].sprite)||void 0===t||t.destroy(),this._sprites.pop();for(;this._sprites.length<e.length;)this._sprites.push({imageName:"",sprite:void 0,itemEntityDataId:0});for(let t=0;t<e.length;t++){const i=e[t].data,r=i.entity.equipmentImage.name,s=t<this._sprites.length?this._sprites[t].imageName:"",a=this._sprites[t];a.itemEntityDataId=i.id,s!=r?(this._sprites[t].imageName=r,a.sprite||(a.sprite=new Sprite(void 0)),a.sprite.bitmap=ImageManager.loadCharacter(r),a.sprite.visible=!1,a.sprite.anchor.x=.5,a.sprite.anchor.y=1):""==r&&a.sprite&&(a.sprite.bitmap=void 0)}for(const t of this._sprites)t.sprite&&this._parent.removeChild(t.sprite);for(const t of this._sprites.slice().reverse())t.sprite&&this._parent.addChild(t.sprite);this._revisionNumber=i.revisitonNumber()}const e=this._owner.patternWidth(),a=this._owner.patternHeight(),c=(this._owner.characterBlockX()+this._owner.characterPatternX())*e,l=(this._owner.characterBlockY()+this._owner.characterPatternY())*a,h=this._owner._character.direction();for(const t of this._sprites)t.sprite&&(t.sprite.setFrame(c,l,e,a),t.sprite.position=this._owner.position,t.sprite.visible=this._owner.visible,t.sprite.opacity=this._owner.opacity,s.MRData.entities[t.itemEntityDataId].entity.equipmentImage.side==r.DItemEquipmentSide.Right?t.sprite.z=this._owner.z+n[h]:t.sprite.z=this._owner.z+o[h])}else for(const t of this._sprites)t.sprite&&(t.sprite.visible=!0)}}},401:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VChronus=void 0;const r=i(1298),s=i(2163),a=i(7352),n=i(9832);e.VChronus=class{constructor(t){this._timeFrameId=-1,this._livingTimeRefreshFrameCount=-1,this._fadeBitmap=new Bitmap(32,32),this._fadeBitmap.fillAll("black"),this._fadeSprite=new Sprite(this._fadeBitmap),this._fadeSprite.anchor.x=.5,this._fadeSprite.anchor.y=.5,this._fadeSprite.scale.x=Graphics._width/32,this._fadeSprite.scale.y=Graphics._height/32,this._fadeSprite.x=Graphics._width/2,this._fadeSprite.y=Graphics._height/2,this._fadeSprite.opacity=0,t.addChild(this._fadeSprite),this._textBitmap=new Bitmap(Graphics._width,80),this._textSprite=new Sprite(this._textBitmap),this._textSprite.anchor.x=.5,this._textSprite.anchor.y=.5,this._textSprite.scale.x=Graphics._width/32,this._textSprite.scale.y=Graphics._height/32,this._textSprite.opacity=0,t.addChild(this._textSprite),this._textBitmap.drawText("test",0,0,Graphics._width,80,"center"),this._fadeAnimation=new n.VKeyFrameAnimationCurve,this._fadeAnimation.addFrame(0,0),this._fadeAnimation.addFrame(60,255),this._fadeAnimation.addFrame(120,255),this._fadeAnimation.addFrame(180,0)}update(){if(!s.MRData.chronus.enabled)return;const t=a.MRLively.chronus;this._timeFrameId!=t.currentTimeFrameId&&(this._timeFrameId=t.currentTimeFrameId,this.setTint(this._timeFrameId,!0)),this._livingTimeRefreshFrameCount<0?t.needsLivingTimeFrameRefresh&&(this._livingTimeRefreshFrameCount=0):(this._fadeSprite.opacity=this._fadeAnimation.evaluate(this._livingTimeRefreshFrameCount),this._livingTimeRefreshFrameCount++,this._livingTimeRefreshFrameCount>=this._fadeAnimation.lastFrameTime()&&(this._livingTimeRefreshFrameCount=-1,t.clearLivingTimeFrameRefresh()))}getEffectDuration(){return 120}setTint(t,e){const i=s.MRData.chronus.timeTones.find((e=>e.timeFrameId==t));(0,r.assert)(i);const a=[...i.value];$gameScreen.startTint(a,e?this.getEffectDuration():0)}}},9737:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VDialogManager=void 0;const r=i(1298),s=i(7574),a=i(2554),n=i(1722),o=i(6094),c=i(2492),l=i(685),h=i(6840),u=i(756),d=i(1676),p=i(8771),f=i(2345),m=i(6650),y=i(8535),_=i(8691),g=i(9198),v=i(4315),S=i(1606),M=i(1609),R=i(6391),b=i(788),E=i(2143),I=i(5903),x=i(9367),w=i(8855);e.VDialogManager=class{constructor(){this.dialogNavigator=new m.VDialogNavigator}openDialog(t){let e=w.MRView.ext.onOpenDialog(t);e||(t instanceof d.SPlayerDialog?e=new E.VPlayerDialog(t):t instanceof a.SEventExecutionDialog?e=new y.VEventExecutionDialog(t):t instanceof p.SWarehouseStoreDialog?e=new I.VWarehouseStoreDialog(t):t instanceof f.SWarehouseWithdrawDialog?e=new x.VWarehouseWithdrawDialog(t):t instanceof h.SMainMenuDialog?e=new R.VMainMenuDialog(t):t instanceof n.SFeetDialog?e=new g.VFeetDialog(t):t instanceof o.SItemListDialog?e=new v.VItemListDialog(t):t instanceof c.SItemSelectionDialog?e=new S.VItemSelectionDialog(t):t instanceof s.SDetailsDialog?e=new _.VDetailsDialog(t):t instanceof l.SItemSellDialog?e=new M.VItemSellDialog(t):t instanceof u.SNicknameDialog&&(e=new b.VNicknameDialog(t))),(0,r.assert)(e),this.dialogNavigator.openDialog(e)}}},8813:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VDirectionArrow=void 0;const r=i(7352),s=i(8855);class a extends Sprite{constructor(){super(void 0),this._x=100,this._y=100,this._dir=0,this._crossDiagonal=!1,this._bitmap=ImageManager.loadSystem("MR-DirectionArrow"),this._sprites=[new Sprite(this._bitmap),new Sprite(this._bitmap),new Sprite(this._bitmap),new Sprite(this._bitmap),new Sprite(this._bitmap),new Sprite(this._bitmap),new Sprite(this._bitmap),new Sprite(this._bitmap),new Sprite(this._bitmap)];const t=this;this._sprites.forEach(((e,i)=>{t.addChild(e)}))}setPosition(t,e){this._x=t,this._y=e}setDirection(t){this._dir=t}setCrossDiagonal(t){this._crossDiagonal=t}update(){if(!r.MRLively.map.floorId().isTacticsMap())return void(this.visible=!1);this.visible=!0;const t=r.MRLively.camera.focusedEntity();if(t&&s.MRView.entityVisualSet){const e=s.MRView.entityVisualSet.findEntityVisualByEntity(t);if(!e)return void(this.visible=!1);const i=e.getRmmzSprite();this.setPosition(i.x,i.y)}const e=this._bitmap.width;this._sprites.forEach(((t,i)=>{t.setFrame(0,i*e,e,e)}));const i=-e/2,a=-e;if(this._sprites[0].x=i+this._x-e,this._sprites[0].y=a+this._y+e,this._sprites[1].x=i+this._x,this._sprites[1].y=a+this._y+e,this._sprites[2].x=i+this._x+e,this._sprites[2].y=a+this._y+e,this._sprites[3].x=i+this._x-e,this._sprites[3].y=a+this._y,this._sprites[4].x=i+this._x,this._sprites[4].y=a+this._y,this._sprites[5].x=i+this._x+e,this._sprites[5].y=a+this._y,this._sprites[6].x=i+this._x-e,this._sprites[6].y=a+this._y-e,this._sprites[7].x=i+this._x,this._sprites[7].y=a+this._y-e,this._sprites[8].x=i+this._x+e,this._sprites[8].y=a+this._y-e,this._crossDiagonal)this._sprites[1].visible=this._sprites[3].visible=this._sprites[5].visible=this._sprites[7].visible=!1,this._sprites[0].visible=this._sprites[2].visible=this._sprites[6].visible=this._sprites[8].visible=!0;else for(let t=0;t<this._sprites.length;t++)this._sprites[t].visible=this._dir-1==t}}e.VDirectionArrow=a},6614:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VEntity=void 0;const r=i(1298),s=i(8245),a=i(7352),n=i(8254),o=i(2897),c=i(8855),l=i(5107),h=i(6501),u=i(9901),d=i(4836),p=i(5967),f=i(9185);e.VEntity=class{constructor(t,e){this._initialUpdate=!0,this._visibilityOpacityStart=1,this._visibilityOpacityTarget=1,this._visibilityFrame=0,this._prevVisibility=!0,this.reservedDestroy=!1,this.visualTransparent=!1,this._entity=t,this._rmmzEventId=e,this._rmmzSpriteIndex=-1,this._sequelContext=new o.VSequelContext(this),this._position=new s.Vector2(t.mx,t.my),this._sequelOpacity=1}entity(){return this._entity}rmmzEventId(){return this._rmmzEventId}rmmzEvent(){return $gameMap.event(this._rmmzEventId)}rmmzSpriteIndex(){return this._rmmzSpriteIndex}rmmzSprite(){return c.MRView.spriteset?c.MRView.spriteset._characterSprites[this._rmmzSpriteIndex]:void 0}getRmmzSprite(){const t=this.rmmzSprite();return(0,r.assert)(t),t}isVisible(){const t=a.MRLively.camera.focusedEntity();return!!t&&l.SNavigationHelper.testVisibilityForMinimap(t,this._entity)}position(){return this._position}x(){return this._position.x}y(){return this._position.y}setX(t){this._position.x=t}setY(t){this._position.y=t}setPosition(t){this._position=t}resetPosition(){this._position.x=this._entity.mx,this._position.y=this._entity.my}sequelContext(){return this._sequelContext}getIdleSequelId(){return this._entity.queryIdleSequelId()}_setSpriteIndex(t){this._rmmzSpriteIndex=t}actualImage(){return(0,r.assert)(this._actualImage),this._actualImage}setOpacity(t){this._sequelOpacity=t}imageOverriden(){return void 0!==this._actualImage}_update(){if((0,r.assert)(c.MRView.sequelFactory),this._rmmzEventId>=0){const t=$gameMap.event(this._rmmzEventId),e=this.entity();this._visibility=u.SView.getEntityVisibility(e);{const i=this.imageOverriden();this._actualImage=this.getCharacterImage(e,this._visibility),this._actualImage&&(t.setImage(this._actualImage.characterName,this._actualImage.characterIndex),t.isDirectionFixed()!=this._actualImage.directionFix&&(t.setDirection(this._actualImage.direction),t.setDirectionFix(this._actualImage.directionFix)),t.setStepAnime(this._actualImage.stepAnime),t.setWalkAnime(this._actualImage.walkAnime),this._actualImage.stepAnime||this._actualImage.walkAnime||t.setPattern(this._actualImage.pattern));const r=this.imageOverriden();r||r==i||(t._originalPattern=1,t._originalDirection=2,t.setupPage())}if(e._needVisualRefresh){e._needVisualRefresh=!1;const i=e.getPrefabId();t._prefabId_RE!=i&&t.resetPrefab(f.MRData.prefabs[i]),t.refresh()}t.setDirection(e.dir),this.visualTransparent?t.setTransparent(!0):t.setTransparent(!this._visibility.visible),this._sequelContext._update(),t._x=this._position.x,t._y=this._position.y,t._realX=this._position.x,t._realY=this._position.y,this.updateOpacity(e,t,this._visibility);const i=this.rmmzSprite();if(i){const t=this.entity();t.findEntityBehavior(h.LUnitBehavior)&&i.setStateIcons(t.states().map((t=>t.stateData().iconIndex)))}}}updateOpacity(t,e,i){this._initialUpdate&&(this._initialUpdate=!1,this._prevVisibility=this.isVisible(),this._prevVisibility||e.setOpacity(0));const r=this.isVisible();this._prevVisibility!=r&&(this._prevVisibility=r,r?(this._visibilityOpacityStart=e.opacity(),this._visibilityOpacityTarget=this.getActualOpacity(this._entity,i),this._visibilityFrame=10):(this._visibilityOpacityStart=e.opacity(),this._visibilityOpacityTarget=0,this._visibilityFrame=10));let s=255;this._visibilityFrame>0?(this._visibilityFrame--,s=this._visibilityFrame>0?n.Helpers.lerp(this._visibilityOpacityTarget,this._visibilityOpacityStart,this._visibilityFrame/10):this._visibilityOpacityTarget):s=this.getActualOpacity(t,i),e.setOpacity(s*this._sequelOpacity)}getCharacterImage(t,e){if(e.image)return e.image}getActualOpacity(t,e){return e.visible?e.translucent?127:255:0}showEffectResult(){const t=this.entity()._effectResult;if(this._rmmzEventId>=0){const e=$gameMap.event(this._rmmzEventId),i=t.paramEffects2.filter((t=>t.paramId==d.MRBasics.params.hp));if(i.length>0){const t=i.reduce(((t,e)=>t+e.damage),0);e.popupDamage_RE(t,p.DColorIndex.Default)}}}}},5647:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VEntityManager=void 0;const r=i(7352),s=i(6634),a=i(6614),n=i(1298),o=i(9185);e.VEntityManager=class{constructor(){this._visualEntities=[],this._sequelManager=new s.VSequelManager(this),r.MRLively.signalFlushSequelSet=t=>this.handleFlushSequelSet(t),this.resetVisuals()}resetVisuals(){for(const t of this._visualEntities)this.detachVisual(t);this._visualEntities=[],r.MRLively.map.entities().forEach((t=>{this.createVisual2(t)}))}entityVisuals(){return this._visualEntities}ternimate(){this._visualEntities=[]}update(){this._sequelManager.update(),this._visualEntities.forEach((t=>{t._update()})),this._sequelManager.postUpdate(),this.deleteVisuals()}sequelManager(){return this._sequelManager}findEntityVisualByEntity(t){return this._visualEntities.find((e=>e.entity().entityId()==t.entityId()))}getEntityVisualByEntity(t){const e=this.findEntityVisualByEntity(t);return(0,n.assert)(e),e}findEntityVisualByRMMZEventId(t){return this._visualEntities.find((e=>e.rmmzEventId()==t))}visualRunning(){return this._sequelManager.isRunning}reserveDeleteVisual(t){const e=this._visualEntities.findIndex((e=>e.entity()==t));if(e>=0){this._visualEntities[e].reservedDestroy=!0}}deleteVisuals(){for(let t=this._visualEntities.length-1;t>=0;t--){const e=this._visualEntities[t];e.reservedDestroy&&e.sequelContext().isLogicalCompleted2()&&(this.detachVisual(e),this._visualEntities.splice(t,1))}}detachVisual(t){this._sequelManager.removeVisual(t),$gameMap.event(t.rmmzEventId()).erase()}handleFlushSequelSet(t){this._sequelManager.setup(t)}createVisual2(t){let e;const i=r.MRLively.map.floorId().floorNumber(),s=r.MRLively.map.land2();for(const r of s.landData().appearanceTable.entities)r.startFloorNumber<=i&&i<=r.lastFloorNumber&&r.spawiInfo.entityId==t.dataId&&(e=r.spawiInfo.overrideEvent);const a=t.getPrefabId(),c=o.MRData.prefabs[a];if(t.inhabitsCurrentFloor)(0,n.assert)(t.rmmzEventId>0),$gameMap.spawnREEvent(c,t.rmmzEventId,void 0);else if(t.rmmzEventId>0)(0,n.assert)($gameMap.event(t.rmmzEventId));else{const i=$gameMap.spawnREEvent(c,void 0,e);t.rmmzEventId=i.eventId()}this.createVisual(t)}createVisual(t){let e;if(!(t.rmmzEventId>0))return;if(e=$gameMap.event(t.rmmzEventId),!e)throw new Error;(0,n.assert)(e.isREEvent());const i=new a.VEntity(t,e.eventId());this._visualEntities.push(i)}}},5674:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VHelper=void 0;e.VHelper=class{static setIconFrame(t,e){const i=ImageManager.iconWidth,r=ImageManager.iconHeight,s=e%16*i,a=Math.floor(e/16)*r;t.setFrame(s,a,i,r)}static toScreenX(t){const e=$gameMap.tileWidth(),i=$gameMap.adjustX(t);return Math.floor(i*e+e/2)}static toScreenY(t,e=!1){const i=$gameMap.tileHeight(),r=$gameMap.adjustY(t);return e?Math.floor(r*i+i/2):Math.floor(r*i+i)}}},4480:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VHudWindow=void 0;const r=i(4836),s=i(9248),a=i(7352),n=i(4797);class o extends Window_Base{constructor(){super(new Rectangle(0,0,Graphics.boxWidth,100)),this.frameVisible=!1,this.backOpacity=0,this.visible=!1,this.refresh()}refresh(){this.contents.clear();const t=a.MRLively.camera.focusedEntity();if(!t)return;const e=t.findEntityBehavior(n.LExperienceBehavior);if(!e)return;const i=t.findEntityBehavior(s.LInventoryBehavior);if(!i)return;const o=t.getActualParam(r.MRBasics.params.hp),c=t.getParamActualMax(r.MRBasics.params.hp),l=t.getActualParam(r.MRBasics.params.fp),h=t.getParamActualMax(r.MRBasics.params.fp),u=e.level(t),d=e.expForLevel(t,e.level(t)),p=e.nextLevelExp(t),f=Math.max(0,(e.currentExp(t)-d)/(p-d));a.MRLively.map.floorId().isTacticsMap()&&this.drawFloorNumber(0,0,a.MRLively.map.floorId()),this.drawLevel(150,0,u,f),this.drawHpFp(300,0,o,c,l,h),this.drawGold(i.gold())}update(){this.refresh(),a.MRLively.map.floorId().isTacticsMap()||a.MRLively.map.floorId().isSafetyMap()?this.visible=!0:this.visible=!1}drawFloorNumber(t,e,i){this.drawText(i.floorNumber().toString(),t,e,32,"right"),this.changeTextColor(this.paramTitleColor()),this.drawText("F",t+32,e,32,"left"),this.resetTextColor()}drawLevel(t,e,i,r){const s="Lv ",a=i.toString(),n=this.textWidth("Lv 000"),o=this.textWidth(s);this.changeTextColor(this.paramTitleColor()),this.drawText(s,t,e,o,"left"),this.resetTextColor(),this.drawText(a,t+o,e,n-o,"left"),this.contents.fillRect(t,e+this.lineHeight(),n,6,ColorManager.gaugeBackColor()),this.contents.fillRect(t,e+this.lineHeight(),n*r,6,this.expGugeColor())}drawHpFp(t,e,i,r,s,a){const n=250,o=`${i} / ${r}`,c=this.textWidth("HP "),l=this.textWidth(o);this.changeTextColor(this.paramTitleColor()),this.drawText("HP ",t,e,c,"left"),this.resetTextColor(),this.drawText(o,t+c,e,l,"left"),this.contents.fillRect(t,e+this.lineHeight(),n,6,ColorManager.gaugeBackColor()),this.contents.fillRect(t,e+this.lineHeight(),n*(i/r),6,this.hpGaugeFullyColor()),this.contents.fillRect(t,e+this.lineHeight()+6+1,n,6,ColorManager.gaugeBackColor()),this.contents.fillRect(t,e+this.lineHeight()+6+1,n*(s/a),6,this.fpGaugeColor())}drawGold(t){const e=t.toString(),i=this.textWidth(" G"),r=this.textWidth(e),s=this.contents.width-(i+r)-56;this.drawText(e,s,0,r,"right"),this.changeTextColor(this.paramTitleColor()),this.drawText(" G",s+r,0,i,"right"),this.resetTextColor()}paramTitleColor(){return ColorManager.textColor(23)}expGugeColor(){return ColorManager.hpGaugeColor2()}hpGaugeFullyColor(){return ColorManager.textColor(3)}fpGaugeColor(){return ColorManager.textColor(23)}}e.VHudWindow=o,o.HeaderHeight=70},3619:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VMapGuideGrid=void 0;const r=i(5449),s=i(7352),a=i(8254),n=i(8855);e.VMapGuideGrid=class{constructor(){this._mapData=[],this._mapWidth=0,this._mapHeight=0,this._visible=!1,this._mapdataRevision=0,this._entityDir=0}setVisible(t){var e;this._visible=t,null===(e=n.MRView.spriteset)||void 0===e||e._tilemap.refresh()}isVisible(){return this._visible}update(){let t=!1;const e=s.MRLively.camera.focusedEntity();this._mapdataRevision!=s.MRLively.map.mapdataRevision()&&(this._mapdataRevision=s.MRLively.map.mapdataRevision(),t=!0),e&&this._entityDir!=e.dir&&(this._entityDir=e.dir,t=!0),t&&this.refresh()}readMapData(t,e){return this._mapData[e*this._mapWidth+t]}setMapData(t,e,i){this._mapData[e*this._mapWidth+t]=i}refresh(){var t;this._mapWidth=$gameMap.width(),this._mapHeight=$gameMap.height();const e=this._mapWidth*this._mapHeight;(!this._mapData||this._mapData.length<e)&&(this._mapData=new Array(e));const i=s.MRLively.map;for(let t=0;t<this._mapHeight;t++)for(let e=0;e<this._mapWidth;e++){i.block(e,t)._blockComponent!=r.FBlockComponent.None?this.setMapData(e,t,769):this.setMapData(e,t,0)}const o=s.MRLively.camera.focusedEntity();if(o)for(let t=0;t<100;t++){const e=a.Helpers._dirToTileOffsetTable[o.dir],s=o.mx+e.x*t,n=o.my+e.y*t,c=i.tryGetBlock(s,n);if(!c||c._blockComponent==r.FBlockComponent.None)break;this.setMapData(s,n,770)}null===(t=n.MRView.spriteset)||void 0===t||t._tilemap.refresh()}}},1885:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VMessageWindowSet=void 0;const r=i(7352),s=i(4480),a=i(9716),n=i(7908),o=i(2443);e.VMessageWindowSet=class{constructor(t){this._scene=t,this._hudSpriteSet=new s.VHudWindow,this._scene.addWindow(this._hudSpriteSet),this._shadowBitmap=new Bitmap(32,32),this._shadowBitmap.fillAll("black"),this._shadowSprite=new Sprite(this._shadowBitmap),this._shadowSprite.setFrame(0,0,32,32),this._shadowSprite.scale.x=Graphics.boxWidth/32+1,this._shadowSprite.scale.y=Graphics.boxHeight/32+1,t._spriteset.addChild(this._shadowSprite),this._logWindow=new n.VMessageLogWindow(r.MRLively.messageHistory,this.messageWindowRect()),this._scene.addWindow(this._logWindow),this._floorNameWindow=new a.VFloorNameWindow(new Rectangle(0,0,Graphics.boxWidth,Graphics.boxHeight)),this._scene.addWindow(this._floorNameWindow),this._fadeDuration=0,this._fadeOpacity=0,this._fadeSign=0}get messageLogWindow(){return this._logWindow}messageWindowRect(){const t=Graphics.boxWidth,e=o.VWindowHelper.calcWindowHeight(2,!1)+8,i=(Graphics.boxWidth-t)/2,r=Graphics.boxHeight-e;return new Rectangle(i+30,r-30,t-60,e)}attemptStartDisplayFloorName(){$gameMap.displayName()&&(this._fadeDuration=0,this._fadeOpacity=255,this._floorNameWindow.open())}startFadeIn(){this._fadeSign=1,this._fadeDuration=30,this._fadeOpacity=255}update(){if(this._floorNameWindow.isEffectRunning()&&60==this._floorNameWindow.showCount()&&this.startFadeIn(),this._fadeDuration>0){const t=this._fadeDuration;this._fadeSign>0?this._fadeOpacity-=this._fadeOpacity/t:this._fadeOpacity+=(255-this._fadeOpacity)/t,this._fadeDuration--}this._shadowSprite.opacity=this._fadeOpacity}}},1215:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VSequel=void 0;e.VSequel=class{}},2897:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VSequelContext=void 0;const r=i(1298),s=i(8245),a=i(6501),n=i(7352),o=i(4795),c=i(8855);e.VSequelContext=class{constructor(t){this._currentClip=-1,this._frameCount=0,this._timeScale=0,this._cuurentFinished=!1,this._cancellationLocked=!1,this._startPosition=new s.Vector2(0,0),this._currentIdleSequelId=0,this._animationWaiting=!1,this._balloonWaiting=!1,this._waitFrameCount=0,this._entityVisual=t}sequel(){return(0,r.assert)(this._currentSequel),this._currentSequel}frameCount(){return this._frameCount}timeScale(){return this._timeScale}isDashing(){const t=n.MRLively.camera.focusedEntity();if(!t)return!1;const e=t.findEntityBehavior(a.LUnitBehavior);return!!e&&(e._straightDashing||e._fastforwarding)}startPosition(){return this._startPosition}finished(){if(this._clip){const t=!!this._animationWaiting&&this._entityVisual.rmmzEvent().isAnimationPlaying(),e=!!this._balloonWaiting&&this._entityVisual.rmmzEvent().isBalloonPlaying();return!t&&!e&&this._cuurentFinished&&this._currentClip>=this._clip.sequels().length}return!0}isCancellationLocked(){return this._cancellationLocked}isAnimationWaintng(t){return!(!t&&!this._animationWaiting||!this._entityVisual.rmmzEvent().isAnimationPlaying())||!(!t&&!this._balloonWaiting||!this._entityVisual.rmmzEvent().isBalloonPlaying())}isFrameWaiting(){return this._waitFrameCount>0}isLogicalCompleted2(){return this._currentClip<0||this.isLogicalCompleted(!1)}isLogicalCompleted(t){return!this.isCancellationLocked()&&!this.isAnimationWaintng(t)&&!this.isFrameWaiting()}lockCamera(){c.MRView._syncCamera=!1}unlockCamera(){c.MRView._syncCamera=!0}unlockCancellation(){this._cancellationLocked=!1}startAnimation(t){$gameTemp.requestAnimation([this._entityVisual.rmmzEvent()],t,!1)}end(){this.unlockCancellation(),this._cuurentFinished=!0}_start(t){this._clip=t,this._currentClip=-1,this._timeScale=t.sequels().length,this._cuurentFinished=!1,this._currentIdleSequelId=0,this._next()}_next(){for(;this._clip;){if(this._currentClip++,this._animationWaiting=!1,this._balloonWaiting=!1,!(this._currentClip<this._clip.sequels().length)){this._clip=void 0;break}{const t=this._clip.sequels()[this._currentClip];if(t instanceof o.SMotionSequel){this._startSequel(t),this._cancellationLocked=!0;break}if(t instanceof o.SAnumationSequel){if(this._startAnimation(t),this._animationWaiting)break}else if(t instanceof o.SFloatingAnumationSequel){if(this._startFloatingAnimation(t),this._animationWaiting)break}else if(t instanceof o.SBalloonSequel){if(this._startBalloon(t),this._balloonWaiting)break}else{if(t instanceof o.SWaitSequel){this._startWaitSequel(t);break}(0,r.assert)(0)}}}}_startSequel(t){if(!c.MRView.sequelFactory)throw new Error;this._currentSequel=t,this._currentVisualSequel=c.MRView.sequelFactory.createVisualSequel(t.sequelId()),this._frameCount=0,this._cancellationLocked=!1,this._cuurentFinished=!1,this._currentIdleSequelId=0,t.hasStartPosition()?(this._startPosition.x=t.startX(),this._startPosition.y=t.startY(),this._entityVisual.setPosition(new s.Vector2(this._startPosition.x,this._startPosition.y))):this._startPosition=s.Vector2.clone(this._entityVisual.position())}_startAnimation(t){$gameTemp.requestAnimation([this._entityVisual.rmmzEvent()],t.anumationlId(),!1),t.isWait()&&(this._animationWaiting=!0)}_startFloatingAnimation(t){var e;null===(e=c.MRView.sequelFactory)||void 0===e||e.startFloatingAnimation(t.anumationlId,t.mx,t.my),t.isWait()&&(this._animationWaiting=!0)}_startBalloon(t){$gameTemp.requestBalloon(this._entityVisual.rmmzEvent(),t.balloonId()),t.isWait()&&(this._balloonWaiting=!0)}_startWaitSequel(t){this._waitFrameCount=t.waitCount()}_update(){this._currentVisualSequel&&(this._currentVisualSequel.onUpdate(this._entityVisual,this),this._frameCount+=1,this._cuurentFinished&&(this._currentVisualSequel=void 0)),this._waitFrameCount>0&&this._waitFrameCount--;let t=!1;if(this._clip){const e=!!this._animationWaiting&&this._entityVisual.rmmzEvent().isAnimationPlaying(),i=!!this._balloonWaiting&&this._entityVisual.rmmzEvent().isBalloonPlaying();t=!this._clip.hasMotionSeque(),!e&&!i&&this._cuurentFinished&&this._currentClip<this._clip.sequels().length&&this._next()}else t=!0;if(t){const t=this._entityVisual.getIdleSequelId();if(this._currentIdleSequelId!=t&&0!=t){const e=this._entityVisual.position();this._startSequel(new o.SMotionSequel(this._entityVisual.entity(),t,e.x,e.y,void 0)),this._currentIdleSequelId=t}}}}},9336:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VSequelFactory=void 0;const r=i(8386),s=i(1379),a=i(8005),n=i(7441),o=i(3511),c=i(9185),l=i(2330),h=i(2475),u=i(9884),d=i(3961),p=i(3335),f=i(6060),m=i(2108),y=i(4053),_=i(4836),g=i(5178),v=i(8923),S=i(3298),M=i(8855),R=i(5674);e.VSequelFactory=class{constructor(){this._visualSequelFactory=[],this._visualSequelFactory[_.MRBasics.sequels.idle]=()=>new o.VIdleSequel,this._visualSequelFactory[_.MRBasics.sequels.MoveSequel]=()=>new n.REVisualSequel_Move,this._visualSequelFactory[_.MRBasics.sequels.blowMoveSequel]=()=>new a.VBlowMoveSequel,this._visualSequelFactory[_.MRBasics.sequels.dropSequel]=()=>new u.VDropSequel,this._visualSequelFactory[_.MRBasics.sequels.attack]=()=>new s.VAttackSequel,this._visualSequelFactory[_.MRBasics.sequels.CollapseSequel]=()=>new r.VCollapseSequel,this._visualSequelFactory[_.MRBasics.sequels.commonStopped]=()=>new h.VCommonStoppedSequel,this._visualSequelFactory[_.MRBasics.sequels.asleep]=()=>new l.VAsleepSequel,this._visualSequelFactory[_.MRBasics.sequels.escape]=()=>new d.VEscapeSequel,this._visualSequelFactory[_.MRBasics.sequels.earthquake2]=()=>new p.VEarthquake2Sequel,this._visualSequelFactory[_.MRBasics.sequels.useItem]=()=>new f.VUseItemSequel,this._visualSequelFactory[_.MRBasics.sequels.explosion]=()=>new m.VExplosionSequel,this._visualSequelFactory[_.MRBasics.sequels.down]=()=>new y.VDownSequel,this._visualSequelFactory[_.MRBasics.sequels.warp]=()=>new g.VWarpSequel,this._visualSequelFactory[_.MRBasics.sequels.stumble]=()=>new v.VStumbleSequel,this._visualSequelFactory[_.MRBasics.sequels.jump]=()=>new S.VJumpSequel}createVisualSequel(t){const e=this._visualSequelFactory[t];if(e)return e();throw new Error(`Visual Sequel not registerd. (id: ${t}, name: ${c.MRData.sequels[t].name})`)}startFloatingAnimation(t,e,i){const r=M.MRView.spriteSet2;r&&r.spritesetMap.createMRFloatingAnimationSprite($dataAnimations[t],R.VHelper.toScreenX(e),R.VHelper.toScreenY(i,!0))}}},6634:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VSequelManager=void 0;const r=i(8855);e.VSequelManager=class{constructor(t){this._currentSequelRun=-1,this._runningVisuals=[],this._entityVisualSet=t}setup(t){this._activeSequelSet=t,this._currentSequelRun=-1,this._runningVisuals.splice(0),this.update()}get isRunning(){return null!=this._activeSequelSet}update(){if(this._activeSequelSet){const t=this._activeSequelSet.runs();if(this._currentSequelRun>=t.length&&this.isLogicalCompleted())this.onFinishedAllSequels();else{let e=-1;if(this._currentSequelRun<0?e=0:this.isLogicalCompleted()&&(e=this._currentSequelRun+1),e>=0&&(this._currentSequelRun=e,this._currentSequelRun<t.length)){t[this._currentSequelRun].clips().forEach((t=>{const e=this._entityVisualSet.findEntityVisualByEntity(t.entity());e&&(r.MRView._syncCamera=!1,e.sequelContext()._start(t),this._runningVisuals.push(e))}))}}}}postUpdate(){if(this._activeSequelSet){const t=this._activeSequelSet.runs();this._currentSequelRun>=t.length-1&&this.isLogicalCompleted()&&this.onFinishedAllSequels()}}removeVisual(t){const e=this._runningVisuals.indexOf(t);e>=0&&this._runningVisuals.splice(e,1)}onFinishedAllSequels(){this._runningVisuals.splice(0),this._activeSequelSet=void 0,r.MRView._syncCamera=!0}isLogicalCompleted(){const t=!!this._activeSequelSet&&this._activeSequelSet.isWaitForAll();for(let e=0;e<this._runningVisuals.length;e++){if(!this._runningVisuals[e].sequelContext().isLogicalCompleted(t))return!1}return!0}}},3815:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VSpriteSet=void 0;const r=i(3477),s=i(9115),a=i(9901),n=i(8813),o=i(4480),c=i(9610);e.VSpriteSet=class{constructor(t){var e,i;this._spritesetMap=t,this._visibilityShadow=new c.VVisibilityShadow(t),this._directionArrow=new n.VDirectionArrow,this._spritesetMap.addChild(this._directionArrow),this._initialUpdate=!0;const s=null!==(e=$dataMap.width)&&void 0!==e?e:1,a=null!==(i=$dataMap.height)&&void 0!==i?i:1,l=new Array(s*a*4);l[(0*a+0)*s+0]=Tilemap.TILE_ID_A5+1,l[(0*a+0)*s+0+1]=Tilemap.TILE_ID_A5+1,this._minimapTilemap=new Tilemap,this._minimapTilemap._tileWidth=12,this._minimapTilemap._tileHeight=12,this._minimapTilemap.setData(s,a,l),this._minimapTilemap.horizontalWrap=$gameMap.isLoopHorizontal(),this._minimapTilemap.verticalWrap=$gameMap.isLoopVertical(),this._minimapTilemap.y=o.VHudWindow.HeaderHeight,this._minimapTilemap.scale.set(.75,.75),this._spritesetMap.addChild(this._minimapTilemap),this._minimapTilemap.setRendererId(r.TilemapRendererId.Minimap),this._spritesetMap._tilemap.setRendererId(r.TilemapRendererId.Default);const h=[],u=["World_A1","RE-Minimap_A2","","","RE-Minimap_A5","World_B","World_C","",""];for(const t of u)h.push(ImageManager.loadTileset(t));this._minimapTilemap.setBitmaps(h)}destroy(){}get spritesetMap(){return this._spritesetMap}directionArrow(){return this._directionArrow}update(){const t=s.MRSystem.minimapData;(t.isTilemapResetNeeded()||this._initialUpdate)&&(this._minimapTilemap.setData(t.width(),t.height(),t.data()),t.clearTilemapResetNeeded()),this._minimapTilemap.refresh(),this._minimapTilemap.selfVisible=this._spritesetMap._tilemap.selfVisible=a.SView.getTilemapView().visible,this._visibilityShadow._update(),this._initialUpdate=!1}}},9610:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VVisibilityShadow=void 0;const r=i(7352),s=i(9832),a=i(1768),n=i(8855),o=48;e.VVisibilityShadow=class{constructor(t){this._spritesetMap=t,this._visibilityShadowBitmap=ImageManager.loadSystem("MR-VisibilityShadow"),this._visibilityShadowInnerSprites=[],this._visibilityShadowInnerSprites[1]=this.createVisibilityShadowPart(16,.5,.5),this._visibilityShadowInnerSprites[2]=this.createVisibilityShadowPart(17,.5,.5),this._visibilityShadowInnerSprites[3]=this.createVisibilityShadowPart(18,.5,.5),this._visibilityShadowInnerSprites[4]=this.createVisibilityShadowPart(11,.5,.5),this._visibilityShadowInnerSprites[6]=this.createVisibilityShadowPart(13,.5,.5),this._visibilityShadowInnerSprites[7]=this.createVisibilityShadowPart(6,.5,.5),this._visibilityShadowInnerSprites[8]=this.createVisibilityShadowPart(7,.5,.5),this._visibilityShadowInnerSprites[9]=this.createVisibilityShadowPart(8,.5,.5),this._visibilityShadowOuterSprites=[],this._visibilityShadowOuterSprites[2]=this.createVisibilityShadowPart(22,.5,0),this._visibilityShadowOuterSprites[4]=this.createVisibilityShadowPart(10,1,.5),this._visibilityShadowOuterSprites[6]=this.createVisibilityShadowPart(14,0,.5),this._visibilityShadowOuterSprites[8]=this.createVisibilityShadowPart(2,.5,1),this._mx1=-1e3,this._my1=-1e3,this._mx2=-1e3,this._my2=-1e3,this._inRoom=!1}_update(){const t=!r.MRLively.map.sightClarity;for(const e of this._visibilityShadowInnerSprites)e&&(e.visible=t);for(const e of this._visibilityShadowOuterSprites)e&&(e.visible=t);if(r.MRLively.map.sightClarity)return;const e=r.MRLively.camera.focusedEntity();if(n.MRView.entityVisualSet&&e){const t=n.MRView.entityVisualSet.findEntityVisualByEntity(e);if(t){const e=$gamePlayer;if(t.rmmzSprite()){let t=0,i=0,s=0,a=0;const n=e._realX,o=e._realY,c=Math.round(n),l=Math.round(o),h=r.MRLively.map.rooms().find((t=>t.contains(c,l)));h?(t=$gameMap.adjustX(h.mx1),i=$gameMap.adjustX(h.mx2),s=$gameMap.adjustY(h.my1),a=$gameMap.adjustY(h.my2)):(t=$gameMap.adjustX(n),i=$gameMap.adjustX(n),s=$gameMap.adjustY(o),a=$gameMap.adjustY(o)),this._inRoom!=!!h&&(this.animateVisibleAreaRect(t,s,i,a),this._inRoom=!!h),this._mx1Animation&&!this._mx1Animation.isFinished()?this._mx1Animation.curve._targetValue=t:this._mx1=t,this._my1Animation&&!this._my1Animation.isFinished()?this._my1Animation.curve._targetValue=s:this._my1=s,this._mx2Animation&&!this._mx2Animation.isFinished()?this._mx2Animation.curve._targetValue=i:this._mx2=i,this._my2Animation&&!this._my2Animation.isFinished()?this._my2Animation.curve._targetValue=a:this._my2=a,this.updateVisibleAreaRect()}}}}animateVisibleAreaRect(t,e,i,r){if(this._mx1<=-1e3)this._mx1=t,this._my1=e,this._mx2=i,this._my2=r;else{const n=this._visibilityShadowInnerSprites[1];this._mx1Animation=s.VAnimation.startAt(n,"mx1",this._mx1,t,.1,a.easing.outQuad,(t=>{this._mx1=t})),this._my1Animation=s.VAnimation.startAt(n,"my1",this._my1,e,.1,a.easing.outQuad,(t=>{this._my1=t})),this._mx2Animation=s.VAnimation.startAt(n,"mx2",this._mx2,i,.1,a.easing.outQuad,(t=>{this._mx2=t})),this._my2Animation=s.VAnimation.startAt(n,"my2",this._my2,r,.1,a.easing.outQuad,(t=>{this._my2=t}))}}updateVisibleAreaRect(){const t=$gameMap.tileWidth(),e=$gameMap.tileHeight(),i=this._mx1*t,r=this._mx2*t+t,s=this._my1*e,a=this._my2*e+e,n=r-i,c=a-s,l=i-24,h=r+24,u=s-24,d=a+24,p=l+(h-l)/2,f=u+(d-u)/2;this._visibilityShadowInnerSprites[1].position.set(l,d),this._visibilityShadowInnerSprites[2].position.set(p,d),this._visibilityShadowInnerSprites[3].position.set(h,d),this._visibilityShadowInnerSprites[4].position.set(l,f),this._visibilityShadowInnerSprites[6].position.set(h,f),this._visibilityShadowInnerSprites[7].position.set(l,u),this._visibilityShadowInnerSprites[8].position.set(p,u),this._visibilityShadowInnerSprites[9].position.set(h,u),this._visibilityShadowInnerSprites[2].scale.x=n/o,this._visibilityShadowInnerSprites[4].scale.y=c/o,this._visibilityShadowInnerSprites[6].scale.y=c/o,this._visibilityShadowInnerSprites[8].scale.x=n/o;const m=i-o,y=r+o,_=s-o,g=a+o,v=y-m,S=g-_;this._visibilityShadowOuterSprites[2].position.set(m+v/2,g),this._visibilityShadowOuterSprites[4].position.set(m,_+S/2),this._visibilityShadowOuterSprites[6].position.set(y,_+S/2),this._visibilityShadowOuterSprites[8].position.set(m+v/2,_);const M=this._mx2-this._mx1+this._spritesetMap._tilemap.width/this._spritesetMap._tilemap._tileWidth;this._visibilityShadowOuterSprites[2].scale.set(2*M,M),this._visibilityShadowOuterSprites[4].scale.set(M,S/o),this._visibilityShadowOuterSprites[6].scale.set(M,S/o),this._visibilityShadowOuterSprites[8].scale.set(2*M,M)}createVisibilityShadowPart(t,e,i){const r=new Sprite(this._visibilityShadowBitmap);return r.setFrame(t%5*o,Math.floor(t/5)*o,o,o),r.anchor.set(e,i),this._spritesetMap.addChild(r),r}}},9832:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VAnimation=e.VAnimationInstance=e.VKeyFrameAnimationCurve=e.VKeyFrameTangentMode=e.VEasingAnimationCurve=e.VAnimationCurve=e.VAnimationWrapMode=void 0;const r=i(1298);var s,a;!function(t){t[t.Once=0]="Once",t[t.Loop=1]="Loop",t[t.Alternate=2]="Alternate"}(s=e.VAnimationWrapMode||(e.VAnimationWrapMode={}));class n{constructor(){this._wrapMode=s.Once}evaluate(t){return this.onEvaluate(this.calculateLocalTime(t,this.lastFrameTime(),this._wrapMode))}lastFrameTime(){return this.onGetLastFrameTime()}wrapMode(){return this._wrapMode}setWrapMode(t){this._wrapMode=t}onEvaluate(t){return 0}onGetLastFrameTime(){return 0}calculateLocalTime(t,e,i){let r=0;switch(i){case s.Once:r=Math.min(t,e);break;case s.Loop:r=t%e;break;case s.Alternate:{const i=2*e,s=t%i;r=s/i<=.5?s:i-s;break}default:throw new Error("Unreachable.")}return r}}e.VAnimationCurve=n;class o extends n{constructor(t,e,i,r){super(),this._startValue=t,this._targetValue=e,this._duration=i,this._func=r}onEvaluate(t){const e=this._func(t/this._duration);return(this._targetValue-this._startValue)*e+this._startValue}onGetLastFrameTime(){return this._duration}}e.VEasingAnimationCurve=o,function(t){t[t.Linear=0]="Linear",t[t.Tangent=1]="Tangent",t[t.Auto=2]="Auto",t[t.Constant=3]="Constant"}(a=e.VKeyFrameTangentMode||(e.VKeyFrameTangentMode={}));e.VKeyFrameAnimationCurve=class extends n{constructor(){super(),this._keyFrames=[],this._defaultValue=0}addKeyFrame(t){if(!(this._keyFrames.isEmpty()||this._keyFrames.back().time<=t.time))throw new Error("Not implemetend.");this._keyFrames.push(t)}addFrame(t,e,i=a.Linear,s=0){const n={time:t,value:e,leftTangentMode:a.Constant,leftTangent:0,rightTangentMode:i,rightTangent:s};if(!this._keyFrames.isEmpty()&&this._keyFrames.front().time<=t){const e=this.findKeyFrameIndex(t);(0,r.assert)(e>=0);const i=this._keyFrames[e];n.leftTangentMode=i.rightTangentMode,n.leftTangent=-i.rightTangent}else n.leftTangentMode=a.Constant,n.leftTangent=0;return this.addKeyFrame(n),this}onEvaluate(t){if(0==this._keyFrames.length)return this._defaultValue;if(t<this._keyFrames.front().time)return this._keyFrames.front().value;if(1==this._keyFrames.length)return this._keyFrames.front().value;if(t>=this._keyFrames.back().time)return this._keyFrames.back().value;{const e=this.findKeyFrameIndex(t),i=this._keyFrames[e],r=this._keyFrames[e+1],s=i.value,n=r.value,o=i.time,c=(t-o)/(r.time-o),l=[i.rightTangentMode,r.leftTangentMode],h=[0,0];for(let t=0;t<2;t++)switch(l[t]){case a.Constant:h[t]=s;break;case a.Linear:h[t]=s+(n-s)*c;break;case a.Tangent:h[t]=this.hermite(s,i.rightTangent,n,r.leftTangent,c);break;case a.Auto:{const a=this._keyFrames.front(),o=this._keyFrames.back();h[t]=this.catmullRom(i.time==a.time?o.value:this._keyFrames[e-1].value,s,n,r.time==o.time?a.value:this._keyFrames[e+2].value,c);break}}return h[0]+(h[1]-h[0])*c}}onGetLastFrameTime(){return 0==this._keyFrames.length?0:this._keyFrames[this._keyFrames.length-1].time}findKeyFrameIndex(t){for(let e=this._keyFrames.length-1;e>=0;e--)if(this._keyFrames[e].time<=t)return e;return-1}hermite(t,e,i,r,s){let a=2*(t-i)+(e+r);return a*=s,a+=3*(i-t)-2*e-r,a*=s,a+=e,a*=s,a+t}catmullRom(t,e,i,r,s){const a=.5*(i-t),n=.5*(r-e);return(2*e-2*i+a+n)*s*s*s+(-3*e+3*i-2*a-n)*s*s+a*s+e}};class c{constructor(t,e,i){this.key=t,this.curve=e,this.setter=i,this.time=0}update(t){const e=this.isFinished();this.time+=t;const i=this.curve.evaluate(this.time);if(this.setter(i),this._then){const t=this.isFinished();t&&e!=t&&this._then()}}isFinished(){return this.curve.wrapMode()==s.Once&&this.time>=this.curve.lastFrameTime()}then(t){this._then=t}}e.VAnimationInstance=c;class l{static start(t,e,i,r,s=0){const a=new c(e,i,r);return a.time+=s,this.add(t,e,a),a}static startAt(t,e,i,r,s,a,n,l=0){const h=new c(e,new o(i,r,s,a),n);return h.time+=l,this.add(t,e,h),h}static add(t,e,i){const s=t;s._animations_RE||(s._animations_RE=[]);const a=s._animations_RE;(0,r.assert)(a);for(let t=0;t<a.length;t++)if(a[t].key==e)return void(a[t]=i);a.push(i),this._containers.includes(s)||this._containers.push(s)}static stop(t,e){const i=t;if(i._animations_RE){const t=i._animations_RE;for(let i=t.length-1;i>=0;i--)t[i].key==e&&t.splice(i,1)}}static stopAll(t){const e=t;e._animations_RE&&(e._animations_RE=[],this._containers.mutableRemoveAll((t=>t==e)))}static update(){for(const t of this._containers){const e=t._animations_RE;if(e)for(const t of e)t.update(.016)}this.refresh()}static refresh(){for(let t=this._containers.length-1;t>=0;t--){let e=!0;const i=this._containers[t]._animations_RE;if(i)for(let t=i.length-1;t>=0;t--)i[t].isFinished()?i.splice(t,1):e=!1;e&&this._containers.splice(t,1)}}}e.VAnimation=l,l._containers=[];const h=PIXI.Container.prototype.destroy;PIXI.Container.prototype.destroy=function(t){l.stopAll(this),h.call(this,t)}},1768:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.easing=void 0,e.easing={linear:t=>t,quadratic:t=>t*(-t*t*t+4*t*t-6*t+4),cubic:t=>t*(4*t*t-9*t+6),elastic:t=>t*(33*t*t*t*t-106*t*t*t+126*t*t-67*t+15),inQuad:t=>t*t,outQuad:t=>t*(2-t),inOutQuad:t=>t<.5?2*t*t:(4-2*t)*t-1,inCubic:t=>t*t*t,outCubic:t=>--t*t*t+1,inOutCubic:t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,inQuart:t=>t*t*t*t,outQuart:t=>1- --t*t*t*t,inOutQuart:t=>t<.5?8*t*t*t*t:1-8*--t*t*t*t,inQuint:t=>t*t*t*t*t,outQuint:t=>1+--t*t*t*t*t,inOutQuint:t=>t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t,inSine:t=>1-Math.cos(t*(Math.PI/2)),outSine:t=>Math.sin(t*(Math.PI/2)),inOutSine:t=>-(Math.cos(Math.PI*t)-1)/2,inExpo:t=>Math.pow(2,10*(t-1)),outExpo:t=>1-Math.pow(2,-10*t),inOutExpo:t=>(t/=.5)<1?Math.pow(2,10*(t-1))/2:(t--,(2-Math.pow(2,-10*t))/2),inCirc:t=>1-Math.sqrt(1-t*t),outCirc:t=>Math.sqrt(1-(t-=1)*t),inOutCirc:t=>(t/=.5)<1?-(Math.sqrt(1-t*t)-1)/2:(t-=2,(Math.sqrt(1-t*t)+1)/2)}},8691:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VDetailsDialog=void 0;const r=i(5461),s=i(6969);class a extends r.VDialog{constructor(t){super(t),this.model=t,this._window=new s.VDetailsWindow(t),this._window.onClose=()=>this.handleClose(),this.addWindow(this._window)}onCreate(){}onUpdate(){}handleClose(){SoundManager.playOk(),this.cancel()}}e.VDetailsDialog=a},5461:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VDialog=void 0;const r=i(4979),s=i(9115);e.VDialog=class{constructor(t){this._created=!1,this._started=!1,this._windows=[],this._closing=!1,this.model=t}dialogContext(){return s.MRSystem.dialogContext}commandContext(){return this.dialogContext().commandContext()}openSubDialog(t,e){t._resultCallbackVisual=t=>{if(!e(t))switch(t.resultAction){case r.SDialogAction.Submit:this.submit();break;case r.SDialogAction.Cancel:break;case r.SDialogAction.CloseAllSubDialogs:s.MRSystem.dialogContext.dialogs().length>=2&&this.closeAllSubDialogs()}},s.MRSystem.dialogContext.open(t)}submit(){this.model.submit()}cancel(){this.model.cancel()}closeAllSubDialogs(){this.model.closeAllSubDialogs()}onCreate(){}onStart(){this._activeWindow&&this._activeWindow.activate()}onUpdate(){}onClose(){}onStop(){this._activeWindow&&this._activeWindow.deactivate()}onDestroy(){}get windowLayer(){return SceneManager._scene._windowLayer}addWindow(t){SceneManager._scene.addWindow(t),this._windows.push(t)}_removeWindow(t){SceneManager._scene._windowLayer.removeChild(t)}activateWindow(t){this._activeWindow&&this._activeWindow.deactivate(),this._activeWindow=t,this._activeWindow&&this._activeWindow.activate()}_destroy(){this.onDestroy(),this._windows.forEach((t=>{this._removeWindow(t),t.destroy()}))}}},6650:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VDialogNavigator=void 0;const r=i(1298);e.VDialogNavigator=class{constructor(){this._destroyList=[],this._subDialogs=[]}get isEmpty(){return!this._scene&&!this._nextScene&&0==this._subDialogs.length}openDialog(t){this.push(t)}closeDialog(t,e){this.pop(e)}push(t){this._scene&&this._subDialogs.push(this._scene),this._nextScene=t,t._navigator=this,this._scene&&this._scene.onStop()}pop(t){(0,r.assert)(this._scene),(0,r.assert)(this._scene.model==t),this._nextScene=this._subDialogs.pop(),this._scene.onStop(),this._destroyList.push(this._scene),this.changeScene()}clear(){this.destryDialogs(),this._scene&&(this._scene.onStop(),this._scene.onClose(),this._scene._destroy()),this._nextScene&&(this._nextScene.onStop(),this._nextScene.onClose(),this._nextScene._destroy());for(let t=this._subDialogs.length-1;t>=0;t--)this._subDialogs[t].onStop(),this._subDialogs[t].onClose(),this._subDialogs[t]._destroy();this._subDialogs=[],this._scene=void 0,this._nextScene=void 0}update(t){this._nextScene&&this.changeScene(),this.updateScene(t)}changeScene(){this._scene=this._nextScene,this._nextScene=void 0,this._scene&&(this._scene._created||(this._scene.onCreate(),this._scene._created=!0),this._scene.onStart())}updateScene(t){this._scene&&this._scene.onUpdate()}lateUpdate(){this.destryDialogs()}destryDialogs(){for(const t of this._destroyList)t._destroy();this._destroyList=[]}}},8535:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VEventExecutionDialog=void 0;const r=i(1298),s=i(5461);class a extends s.VDialog{constructor(t){super(t),this._model=t}onCreate(){$gameMap.event(this._model.rmmzEventId()).start()}onUpdate(){if(!$gameMap.isEventRunning()){const t=this.dialogContext().causeEntity();(0,r.assert)(t),this.submit()}}}e.VEventExecutionDialog=a},9198:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VFeetDialog=void 0;const r=i(5461),s=i(2420),a=i(2590),n=i(1298),o=i(7574);class c extends r.VDialog{constructor(t){super(t),this._model=t;this._entityNameWindow=new a.VEntityCaptionWindow(this._model.item),this.addWindow(this._entityNameWindow),this._commandWindow=new s.VFlexCommandWindow(new Rectangle(Graphics.boxWidth-200,100,200,200)),this._commandWindow.setupFromCommandList(this._model.makeActionList()),this._commandWindow.addSystemCommand((0,n.tr2)("説明"),"details",(()=>this.handleDetails())),this._commandWindow.setHandler("cancel",(()=>this.cancel())),this._commandWindow.refresh(),this._commandWindow.open(),this.addWindow(this._commandWindow),this.activateWindow(this._commandWindow)}handleDetails(){const t=new o.SDetailsDialog(this._model.item);this.model.openSubDialog(t,(t=>(this.activateWindow(this._commandWindow),!0)))}}e.VFeetDialog=c},4315:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VItemListDialog=void 0;const r=i(913),s=i(7471),a=i(5139);class n extends s.VItemListDialogBase{constructor(t){super(t.inventory,t,s.VItemListMode.Use),this._model=t;const e=this._model.actor.findEntityBehavior(r.LEquipmentUserBehavior);e&&this.itemListWindow.setEquipmentUser(e)}onCreate(){super.onCreate()}onUpdate(){Input.isTriggered("pagedown")&&(a.UInventory.sort(this._model.inventory),this.itemListWindow.refreshItems(),this.itemListWindow.playCursorSound())}onSelectedItemsChanged(t){this._model.setSelectedEntity(t[0])}onMakeCommandList(t){const e=this.itemListWindow.selectedItem();this.commandWindow.setupFromCommandList(this._model.makeActionList(e)),super.onMakeCommandList(t)}}e.VItemListDialog=n},7471:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VItemListDialogBase=e.VItemListMode=void 0;const r=i(1298),s=i(1019),a=i(7352),n=i(3609),o=i(7574),c=i(756),l=i(2420),h=i(3907),u=i(5461);var d;!function(t){t[t.Use=0]="Use",t[t.Selection=1]="Selection"}(d=e.VItemListMode||(e.VItemListMode={}));class p extends u.VDialog{constructor(t,e,i){super(e),this._inventory=t,this._mode=i;this._itemListWindow=new h.VItemListWindow(new Rectangle(0,100,Graphics.boxWidth-200,400)),this._itemListWindow.setInventory(this._inventory),this._itemListWindow.setHandler("ok",(()=>this.handleItemSubmit())),this._itemListWindow.setHandler("cancel",(()=>this.handleItemCancel())),this._itemListWindow.forceSelect(0),this.addWindow(this._itemListWindow),this.activateWindow(this._itemListWindow);{const t=this._itemListWindow.itemHeight()*n.paramInventoryItemsPerPage;this._itemListWindow.height=t+2*this._itemListWindow.padding,this._itemListWindow.refresh(),this._itemListWindow.y=64,this._itemListWindow.createContents(),this._itemListWindow.refresh()}this._commandWindow=new l.VFlexCommandWindow(new Rectangle(Graphics.boxWidth-200,this._itemListWindow.y,200,200)),this.addWindow(this._commandWindow)}get itemListWindow(){return this._itemListWindow}get commandWindow(){return this._commandWindow}onCreate(){this.activateItemWindow()}onUpdate(){}onSelectedItemsChanged(t){}onSelectionSubmit(){}onMakeCommandList(t){if(!this.itemListWindow.isMultipleSelecting()){{const e=this._inventory.ownerEntity(),i=this.itemListWindow.selectedItem();a.MRLively.getCurrentIdentifyer().getEntityIdentificationLevel(e,i)==s.EntityIdentificationLevel.Unidentified&&t.addSystemCommand((0,r.tr2)("名前"),"nickname",(()=>this.handleNickname()))}t.addSystemCommand((0,r.tr2)("説明"),"details",(()=>this.handleDetails()))}}activateCommandWindow(){this._commandWindow.refresh(),this._commandWindow.openness=255,this.activateWindow(this._commandWindow)}handleItemSubmit(){if(this.onSelectedItemsChanged(this._itemListWindow.getSelectedItems()),this._mode==d.Use)this._itemListWindow&&this._commandWindow&&(this._commandWindow.clear(),this.onMakeCommandList(this._commandWindow),this._commandWindow.setHandler("cancel",(()=>this.handleCommandCancel())),this._commandWindow.fitHeight(),this.activateCommandWindow());else{if(this._mode!=d.Selection)throw new Error("Unreachable.");this.onSelectionSubmit(),this.submit()}}handleItemCancel(){this.cancel()}handleCommandCancel(){this._itemListWindow&&this._commandWindow&&(this.activateWindow(this._itemListWindow),this._commandWindow.openness=0)}handleNickname(){const t=this._inventory.ownerEntity(),e=this.itemListWindow.selectedItem(),i=new c.SNicknameDialog(t,e);this.model.openSubDialog(i,(t=>(this._itemListWindow.refresh(),this.activateCommandWindow(),!0)))}handleDetails(){const t=this.itemListWindow.selectedItem(),e=new o.SDetailsDialog(t);this.model.openSubDialog(e,(t=>(this.activateCommandWindow(),!0)))}activateItemWindow(){this._itemListWindow&&(this._itemListWindow.refresh(),this._itemListWindow.activate())}}e.VItemListDialogBase=p},1606:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VItemSelectionDialog=void 0;const r=i(913),s=i(7471);class a extends s.VItemListDialogBase{constructor(t){super(t.inventory(),t,s.VItemListMode.Selection),this._model=t;const e=this._model.entity().findEntityBehavior(r.LEquipmentUserBehavior);e&&this.itemListWindow.setEquipmentUser(e)}onCreate(){super.onCreate()}onUpdate(){super.onUpdate()}onSelectionSubmit(){this._model.setSelectedEntity(this.itemListWindow.selectedItem())}}e.VItemSelectionDialog=a},1609:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VItemSellDialog=void 0;const r=i(1298),s=i(7471),a=i(3907);class n extends s.VItemListDialogBase{constructor(t){super(t.inventory,t,s.VItemListMode.Use),this._model=t,this.itemListWindow.multipleSelectionEnabled=!0,this.itemListWindow.priceTag=a.VItemListPriceTag.PurchasePrice}onMakeCommandList(t){const e=this.itemListWindow.getSelectedItems();t.addSystemCommand((0,r.tr2)("売る"),"sell",(()=>this.handleSell(e))),super.onMakeCommandList(t)}handleSell(t){SoundManager.playShop(),this._model.setResultItems(t),this._model.submitSell()}}e.VItemSellDialog=n},6391:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VMainMenuDialog=void 0;const r=i(337),s=i(5461),a=i(7525),n=i(4341),o=i(5964);class c extends s.VDialog{constructor(t){super(t),this._model=t,this._statusWindow=new a.VMainStatusWindow(n.VLayout.makeGridRect(0,8,12,4)),this._statusWindow.setEntity(this._model.entity()),this.addWindow(this._statusWindow)}onCreate(){this._commandWindow=new r.VMenuCommandWindow(new Rectangle(0,100,200,240)),this.addWindow(this._commandWindow),this._commandWindow.setHandler("item",this.handleItem.bind(this)),this._commandWindow.setHandler("feet",this.handleFeet.bind(this)),this._commandWindow.setHandler("cancel",(()=>this.cancel())),this._commandWindow.setHandler("save",this.handleSave.bind(this)),this._commandWindow.setHandler("suspend",this.handleSuspend.bind(this))}onStart(){var t;null===(t=this._commandWindow)||void 0===t||t.activate()}handleItem(){o.UDialog.postOpenInventoryDialog(this.commandContext(),this._model.entity(),(t=>{}))}handleFeet(){o.UDialog.postOpenFeetDialog(this.commandContext(),this._model.entity(),(t=>{}))||this.cancel()}handleSave(){SceneManager.push(Scene_Save),this.cancel()}handleSuspend(){throw new Error("Not implemented.")}}e.VMainMenuDialog=c},788:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VNicknameDialog=void 0;const r=i(5461),s=i(2443),a=i(5318);class n extends r.VDialog{constructor(t){super(t),this._model=t;{const t=this.editWindowRect();this._editWindow=new a.VNicknameEditWindow(t),this._editWindow.setupFromEntity(this._model.item),this.addWindow(this._editWindow)}{const t=this.inputWindowRect();this._inputWindow=new Window_NameInput(t),this._inputWindow.setEditWindow(this._editWindow),this._inputWindow.setHandler("ok",(()=>this.handleInputOk())),this.addWindow(this._inputWindow)}}editWindowRect(){const t=s.VWindowHelper.calcWindowHeight(9,!0),e=$gameSystem.windowPadding(),i=ImageManager.faceHeight+2*e,r=(Graphics.boxWidth-600)/2,a=(Graphics.boxHeight-(i+t+8))/2;return new Rectangle(r,a,600,i)}inputWindowRect(){const t=this._editWindow.x,e=this._editWindow.y+this._editWindow.height+8,i=this._editWindow.width,r=s.VWindowHelper.calcWindowHeight(9,!0);return new Rectangle(t,e,i,r)}handleInputOk(){const t=this._editWindow.name();this._model.setNickname(t),this.submit()}}e.VNicknameDialog=n},2143:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VPlayerDialog=void 0;const r=i(1298),s=i(7352),a=i(9115),n=i(4836),o=i(8855),c=i(6501),l=i(6840),h=i(5461),u=i(6316),d=i(4621),p=i(8254),f=i(913),m=i(2593),y=i(4180);var _;!function(t){t[t.Normal=0]="Normal",t[t.DirSelecting=1]="DirSelecting",t[t.DiagonalMoving=2]="DiagonalMoving"}(_||(_={}));class g extends h.VDialog{constructor(t){super(t),this.MovingInputInterval=5,this._updateMode=_.Normal,this._waitCount=0,this._directionButtonPresseCount=0,this._moveButtonPresseCount=0,this._movingInputWaitCount=-1,this._crossDiagonalCount=0,this.model=t}actionButton(){return"ok"}shortcutButton(){return"pageup"}dashButton(){return"shift"}directionButton(){return"shift"}isOffDirectionButton(){return this._directionButtonPresseCount<0}isDashButtonPressed(){return Input.isPressed(this.dashButton())}isMoveButtonPressed(){return this._moveButtonPresseCount>0}onStop(){this.endDirectionSelecting()}onUpdate(){this.updateInput();const t=a.MRSystem.dialogContext,e=t.causeEntity();if(e){if(Input.isPressed(this.directionButton())&&Input.isPressed(this.actionButton()))return e.getEntityBehavior(c.LUnitBehavior)._fastforwarding=!0,this.dialogContext().postActivity(d.LActivity.make(e).withConsumeAction(m.LActionTokenConsumeType.MajorActed)),void this.model.submit();switch(this._updateMode){case _.Normal:this.updateNormal(t,e);break;case _.DirSelecting:this.updateDirSelecting(t,e);break;case _.DiagonalMoving:this.updateDiagonalMoving(t,e)}}}updateInput(){0==this._directionButtonPresseCount?Input.isTriggered(this.directionButton())&&(this._directionButtonPresseCount=1):Input.isPressed(this.directionButton())?this._directionButtonPresseCount++:this._directionButtonPresseCount<0?this._directionButtonPresseCount=1:this._directionButtonPresseCount>1&&(this._directionButtonPresseCount=-1),0==this._moveButtonPresseCount?((Input.isTriggered("left")||Input.isTriggered("right")||Input.isTriggered("up")||Input.isTriggered("down"))&&(this._moveButtonPresseCount=1),Input.isPressed(this.dashButton())||(this._moveButtonPresseCount=1)):(Input.isTriggered("left")||Input.isTriggered("right")||Input.isTriggered("up")||Input.isTriggered("down"))&&this._moveButtonPresseCount++,this._movingInputWaitCount<0?0!=Input.dir8&&(this._movingInputWaitCount=this.MovingInputInterval):0!=Input.dir8?this._movingInputWaitCount++:this._movingInputWaitCount=0,Input.isPressed("pagedown")&&(this._updateMode=_.DiagonalMoving)}updateNormal(t,e){var i;let r=Input.dir8;if(0!=r&&this._movingInputWaitCount>=this.MovingInputInterval)this.attemptMoveEntity(t,e,r);else if(Input.isTriggered(this.actionButton()))this.attemptFrontAction(t,e);else if(Input.isTriggered(this.shortcutButton()))this.attemptShortcutAction(t,e);else if(this.isOffDirectionButton())this._updateMode=_.DirSelecting,s.MRLively.map.increaseRevision(),null===(i=o.MRView.guideGrid)||void 0===i||i.setVisible(!0),t.postActivity(d.LActivity.makeDirectionChange(e,u.UMovement.getNextAdjacentEntityDirCW(e)));else if(Input.isTriggered("menu"))return SoundManager.playOk(),void this.openSubDialog(new l.SMainMenuDialog(e),(t=>(t.isSubmitted,!1)))}endDirectionSelecting(){var t;(0,r.assert)(o.MRView.spriteSet2);const e=o.MRView.spriteSet2.directionArrow();null===(t=o.MRView.guideGrid)||void 0===t||t.setVisible(!1),this._updateMode=_.Normal,e.setDirection(0)}updateDirSelecting(t,e){(0,r.assert)(o.MRView.entityVisualSet),(0,r.assert)(o.MRView.spriteSet2);o.MRView.entityVisualSet.getEntityVisualByEntity(e).getRmmzSprite();if(o.MRView.spriteSet2.directionArrow().setDirection(e.dir),Input.isTriggered("ok"))return this.attemptFrontAction(t,e),void this.endDirectionSelecting();if(Input.isTriggered(this.shortcutButton()))this.attemptShortcutAction(t,e);else if(this.isOffDirectionButton())this.endDirectionSelecting();else{if(Input.isTriggered("menu"))return this.endDirectionSelecting(),void this.openSubDialog(new l.SMainMenuDialog(e),(t=>(t.isSubmitted,!1)));this._waitCount>0&&this._waitCount--,this._waitCount<=0&&0!=Input.dir8&&Input.dir8!=e.dir&&(t.postActivity(d.LActivity.makeDirectionChange(e,Input.dir8)),s.MRLively.map.increaseRevision(),this._waitCount=10)}}updateDiagonalMoving(t,e){var i;(0,r.assert)(o.MRView.entityVisualSet),(0,r.assert)(o.MRView.spriteSet2);o.MRView.entityVisualSet.getEntityVisualByEntity(e).getRmmzSprite();const s=o.MRView.spriteSet2.directionArrow();if(this._crossDiagonalCount++,this._crossDiagonalCount>3&&(null===(i=o.MRView.spriteSet2)||void 0===i||i.directionArrow().setCrossDiagonal(!0)),Input.isPressed("pagedown")){const i=Input.dir8;1!=i&&3!=i&&7!=i&&9!=i||(this.attemptMoveEntity(t,e,i),s.setCrossDiagonal(!1),this._crossDiagonalCount=0)}else s.setCrossDiagonal(!1),this._crossDiagonalCount=0,this._updateMode=_.Normal}attemptMoveEntity(t,e,i){if(0!=i&&t.postActivity(d.LActivity.makeDirectionChange(e,i)),this.isMoveButtonPressed()&&u.UMovement.checkPassageToDir(e,i)){const r=d.LActivity.makeMoveToAdjacent(e,i).withConsumeAction(m.LActionTokenConsumeType.MinorActed);return this.isDashButtonPressed()&&r.withFastForward(),t.postActivity(r),this.model.submit(),!0}return!1}attemptFrontAction(t,e){const i=u.UMovement.getFrontBlock(e).getFirstEntity();return i&&!p.Helpers.isHostile(e,i)&&i.queryReactions().find((t=>t.actionId==n.MRBasics.actions.talk))?(t.postActivity(d.LActivity.makeTalk(e).withConsumeAction(m.LActionTokenConsumeType.MajorActed)),this.model.submit(),!0):(t.postActivity(d.LActivity.makePerformSkill(e,y.MRData.system.skills.normalAttack).withConsumeAction(m.LActionTokenConsumeType.MajorActed)),this.model.submit(),!0)}attemptShortcutAction(t,e){const i=e.getEntityBehavior(f.LEquipmentUserBehavior).shortcutItem;if(i){const r=d.LActivity.makePrimaryUse(e,i).withConsumeAction();t.postActivity(r),this.model.submit()}return!0}}e.VPlayerDialog=g},5903:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VWarehouseStoreDialog=void 0;const r=i(1298),s=i(7471),a=i(2443);class n extends s.VItemListDialogBase{constructor(t){super(t.inventory,t,s.VItemListMode.Use),this._model=t,this.itemListWindow.multipleSelectionEnabled=!0;const e=t.warehouseInventory,i=a.VWindowHelper.calcWindowHeight(2,!1);this._capacityWindow=new Window_Help(new Rectangle(Graphics.boxWidth-200,Graphics.boxHeight-i,200,i)),this._capacityWindow.setText((0,r.tr2)("倉庫")+`\n${e.itemCount}/${e.capacity}`),this.addWindow(this._capacityWindow)}onMakeCommandList(t){t.addSystemCommand((0,r.tr2)("預ける"),"store",(()=>this.handleStore())),super.onMakeCommandList(t)}handleStore(){this._model.storeItems(this.itemListWindow.getSelectedItems())}}e.VWarehouseStoreDialog=n},9367:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VWarehouseWithdrawDialog=void 0;const r=i(1298),s=i(7471),a=i(2443);class n extends s.VItemListDialogBase{constructor(t){super(t.inventory,t,s.VItemListMode.Use),this._model=t,this.itemListWindow.multipleSelectionEnabled=!0;const e=t.userInventory,i=a.VWindowHelper.calcWindowHeight(2,!1);this._capacityWindow=new Window_Help(new Rectangle(Graphics.boxWidth-200,Graphics.boxHeight-i,200,i)),this._capacityWindow.setText((0,r.tr2)("持ち物")+`\n${e.itemCount}/${e.capacity}`),this.addWindow(this._capacityWindow)}onMakeCommandList(t){const e=this.itemListWindow.getSelectedItems();t.addSystemCommand((0,r.tr)("引き出す"),"store",(()=>this.handleWithdraw(e))),super.onMakeCommandList(t)}handleWithdraw(t){this._model.withdrawItems(t)}}e.VWarehouseWithdrawDialog=n},1379:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VAttackSequel=void 0;const r=i(8245),s=i(8254),a=i(1215);class n extends a.VSequel{onUpdate(t,e){const i=t.entity(),a=s.Helpers.dirToTileOffset(i.dir);t.setPosition(r.Vector2.add(e.startPosition(),r.Vector2.mul(a,.4))),e.frameCount()>10&&(t.resetPosition(),e.end())}}e.VAttackSequel=n},2330:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VAsleepSequel=void 0;const r=i(1215);class s extends r.VSequel{onUpdate(t,e){const i=t.rmmzEvent();i&&i.setPattern(1)}}e.VAsleepSequel=s},8005:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VBlowMoveSequel=void 0;const r=i(8245),s=i(1215);class a extends s.VSequel{onUpdate(t,e){const i=t.entity(),s=Math.pow(2,6)/256,a=r.Vector2.mul(r.Vector2.sub(new r.Vector2(i.mx,i.my),e.startPosition()),s),n=r.Vector2.sub(new r.Vector2(i.mx,i.my),t.position());Math.abs(n.x)<=s&&Math.abs(n.y)<=s||e.frameCount()>30?(t.resetPosition(),e.end()):t.setPosition(r.Vector2.add(t.position(),a))}}e.VBlowMoveSequel=a},8386:function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),s=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),a=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&r(e,t,i);return s(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.VCollapseSequel=void 0;const n=a(i(5287)),o=i(1215);class c extends o.VSequel{onUpdate(t,e){const i=24-e.frameCount(),r=t.rmmzEvent();r&&(t.setOpacity(i/24),r.setBlendMode(n.BLEND_MODES.ADD)),i<=0&&e.end()}}e.VCollapseSequel=c},2475:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VCommonStoppedSequel=void 0;const r=i(1215);class s extends r.VSequel{onUpdate(t,e){const i=t.rmmzEvent();i&&i.setPattern(1)}}e.VCommonStoppedSequel=s},4053:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VDownSequel=void 0;const r=i(1215);class s extends r.VSequel{onUpdate(t,e){const i=t.entity().data.prefab(),r=t.rmmzEvent(),s=i.downImage;s&&(void 0!==s.characterName&&void 0!==s.characterIndex&&r.setImage(s.characterName,s.characterIndex),void 0!==s.direction&&r.setDirection(s.direction),void 0!==s.pattern&&r.setPattern(s.pattern),void 0!==s.directionFix&&r.setDirectionFix(s.directionFix),void 0!==s.stepAnime&&r.setStepAnime(s.stepAnime),void 0!==s.walkAnime&&r.setWalkAnime(s.walkAnime))}}e.VDownSequel=s},9884:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VDropSequel=void 0;const r=i(8245),s=i(8254),a=i(1215);class n extends a.VSequel{onUpdate(t,e){var i;const a=e.frameCount(),n=(t.entity(),e.sequel()),o=(n.targetX()-e.startPosition().x)/16,c=(n.targetY()-e.startPosition().y)/16,l=a/16;let h=0,u=0;const d=null===(i=e.sequel().args())||void 0===i?void 0:i.movingDir;if(d){const t=s.Helpers.dirToTileOffset(d);h=t.x*(.2*(1-l)),u=t.y*(.2*(1-l))}const p=e.startPosition(),f=Math.sin(Math.PI*l);t.setPosition(new r.Vector2(o*a+(h+p.x),c*a+(u+p.y-f))),a>16&&(t.resetPosition(),e.end())}}e.VDropSequel=n},3335:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VEarthquake2Sequel=void 0;const r=i(1215);class s extends r.VSequel{onUpdate(t,e){const i=e.frameCount();0==i&&$gameScreen.startShake(9,9,120),i>120&&(t.resetPosition(),e.end())}}e.VEarthquake2Sequel=s},3961:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VEscapeSequel=void 0;const r=i(1215);class s extends r.VSequel{onUpdate(t,e){const i=e.frameCount(),r=(t.entity(),t.rmmzEvent());0==i&&e.startAnimation(117),60==i&&r.setTransparent(!0),i>120&&(t.resetPosition(),e.end())}}e.VEscapeSequel=s},2108:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VExplosionSequel=void 0;e.VExplosionSequel=class{onUpdate(t,e){const i=100-e.frameCount();0==e.frameCount()&&e.startAnimation(109);t.rmmzEvent()&&t.setOpacity(i/100),i<=0&&e.end()}}},3511:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VIdleSequel=void 0;const r=i(1215),s=i(7728);class a extends r.VSequel{onUpdate(t,e){s.VSequelHelper.updateStepAnimPattern(t),t.resetPosition()}}e.VIdleSequel=a},3298:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VJumpSequel=void 0;const r=i(1215);class s extends r.VSequel{constructor(){super(...arguments),this._moveSpeed=4,this._jumpPeak=0,this._jumpCount=0,this._realX=0,this._realY=0}onUpdate(t,e){const i=e.frameCount(),r=(t.rmmzEvent(),t.entity());0==i&&(this.jump(r.mx-e.startPosition().x,r.my-e.startPosition().y),this._realX=e.startPosition().x,this._realY=e.startPosition().y),this._jumpCount--,this._realX=(this._realX*this._jumpCount+r.mx)/(this._jumpCount+1),this._realY=(this._realY*this._jumpCount+r.my)/(this._jumpCount+1),t.setX(this._realX),t.setY(this._realY-this.jumpHeight()/40),this._jumpCount<=0&&(t.resetPosition(),e.end())}jump(t,e){const i=Math.round(Math.sqrt(t*t+e*e));this._jumpPeak=10+i-this._moveSpeed,this._jumpCount=2*this._jumpPeak}jumpHeight(){return(this._jumpPeak*this._jumpPeak-Math.pow(Math.abs(this._jumpCount-this._jumpPeak),2))/2}}e.VJumpSequel=s},7441:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.REVisualSequel_Move=void 0;const r=i(1298),s=i(8245),a=i(9832),n=i(1215),o=i(7728);class c extends n.VSequel{onUpdate(t,e){if(e.isDashing())e.unlockCamera(),t.resetPosition(),e.end();else{const i=e.sequel();if(i.isFluidSequence()){const n=e.frameCount();if(0==n){const t=4,e=1/(Math.pow(2,t)/256)/(i.relatedSequels().length+1);this._curveX=new a.VKeyFrameAnimationCurve,this._curveY=new a.VKeyFrameAnimationCurve;const r=i;this._curveX.addFrame(0,r.startX()),this._curveY.addFrame(0,r.startY()),this._curveX.addFrame(e,r.targetX()),this._curveY.addFrame(e,r.targetY());for(const[t,r]of i.relatedSequels().entries())this._curveX.addFrame(e*(t+2),r.targetX()),this._curveY.addFrame(e*(t+2),r.targetY())}(0,r.assert)(this._curveX),(0,r.assert)(this._curveY);const o=this._curveX.evaluate(n),c=this._curveY.evaluate(n);t.setPosition(new s.Vector2(o,c)),n>=this._curveX.lastFrameTime()&&e.end()}else{e.unlockCamera();const r=i.targetX(),a=i.targetY();o.VSequelHelper.updateStepAnimPattern(t);t.entity();const n=4,c=Math.pow(2,n)/256,l=s.Vector2.mul(s.Vector2.sub(new s.Vector2(r,a),e.startPosition()),c),h=s.Vector2.sub(new s.Vector2(r,a),t.position());Math.abs(h.x)<=c&&Math.abs(h.y)<=c||e.frameCount()>30?(t.setPosition(new s.Vector2(r,a)),e.end()):t.setPosition(s.Vector2.add(t.position(),l))}}}}e.REVisualSequel_Move=c},7728:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VSequelHelper=void 0;e.VSequelHelper=class{static updateStepAnimPattern(t){const e=t.rmmzEvent();e&&e.hasStepAnime()&&(e._animationCount++,e._animationCount>=e.animationWait()&&(e._pattern=(e._pattern+1)%e.maxPattern(),e._animationCount=0))}}},8923:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VStumbleSequel=void 0;const r=i(9832),s=i(1215);class a extends s.VSequel{constructor(){super(),this._curve=new r.VKeyFrameAnimationCurve,this._curve.addFrame(0,0),this._curve.addFrame(2,Math.PI/6),this._curve.addFrame(20,0)}onUpdate(t,e){const i=e.frameCount(),r=t.rmmzSprite();r&&(0==i&&AudioManager.playSe({name:"Damage3",volume:90,pitch:100,pan:0}),r.rotation=this._curve.evaluate(i)*a.RotationSignTable[t.entity().dir],i>60&&(r.rotation=0,t.resetPosition(),e.end()))}}e.VStumbleSequel=a,a.RotationSignTable=[1,-1,1,1,-1,1,1,-1,-1,1]},6060:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VUseItemSequel=void 0;const r=i(1298),s=i(4685),a=i(8855),n=i(1215),o=i(5674),c=[6,8,4,2];class l extends n.VSequel{constructor(){super(...arguments),this._baseX=0,this._baseY=0}onUpdate(t,e){const i=e.frameCount(),n=(t.entity(),t.rmmzEvent()),l=e.sequel().args();if((0,r.assert)(l instanceof s.LEntity),(0,r.assert)(a.MRView.spriteset),0==i){const t=ImageManager.loadSystem("IconSet");this._itemSprite=new Sprite(t),this._itemSprite.anchor.set(.5,.5),a.MRView.spriteset._tilemap.addChild(this._itemSprite),this._baseX=n._realX,this._baseY=n._realY;const e=l.data;o.VHelper.setIconFrame(this._itemSprite,e.display.iconIndex),this._itemVisual=this.findItemVisual(l),this._itemVisual&&(this._itemVisual.visualTransparent=!0)}const h=i/30,u=1.6*Math.sin(Math.PI*h);this._itemSprite&&(this._itemSprite.x=o.VHelper.toScreenX(this._baseX),this._itemSprite.y=o.VHelper.toScreenY(this._baseY+-.7-u));if(i>=2){const t=.05,e=Math.floor((i-2)*t*4)%4;n.setDirection(c[e])}if(i>=18){const r=(i-18)/12,s=.6*Math.sin(Math.PI*r);t.setY(e.startPosition().y-s),n.setDirection(2)}i>30&&(t.setY(e.startPosition().y),n.setDirection(2),this._itemSprite&&(this._itemSprite.visible=!1)),i>=38&&(this._itemSprite&&a.MRView.spriteset._tilemap.removeChild(this._itemSprite),this._itemVisual&&(this._itemVisual.visualTransparent=!1),t.resetPosition(),e.end())}findItemVisual(t){if(!a.MRView.entityVisualSet)return;return a.MRView.entityVisualSet.findEntityVisualByEntity(t)}}e.VUseItemSequel=l},5178:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VWarpSequel=void 0;const r=i(8245),s=i(1215);class a extends s.VSequel{onUpdate(t,e){const i=e.frameCount();t.setPosition(new r.Vector2(e.startPosition().x,e.startPosition().y-.5*i)),i>60&&(t.resetPosition(),e.end())}}e.VWarpSequel=a},3425:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VFloatingAnimationTargetSprite=void 0;class i extends Sprite{get isPlaying(){return!!this.animationSprite&&this.animationSprite.isPlaying()}}e.VFloatingAnimationTargetSprite=i},4341:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VUIContainer=e.VUITextElement=e.VUIElement=e.VLayout=void 0;e.VLayout=class{static makeGridRect(t,e,i,r){return new Rectangle(this.calcGridX(t),this.calcGridY(e),this.calcGridWidth(i),this.calcGridHeight(r))}static calcGridWidth(t){return t*(Graphics.boxWidth/12)}static calcGridHeight(t){return t*(Graphics.boxHeight/12)}static calcGridX(t){return t*(Graphics.boxWidth/12)}static calcGridY(t){return t*(Graphics.boxHeight/12)}static clamp(t,e,i){return Math.min(Math.max(t,e),i)}static makeOffset(t,e,i){return{x:t.x+e,y:t.y+i,width:t.width,height:t.height}}static inflateIncludes(t,e){if(0==t.width&&0==t.height)return e;{const i={x:0,y:0,width:0,height:0};let r=t.x,s=t.y,a=t.x+t.width,n=t.y+t.height;const o=e.x,c=e.y,l=e.x+e.width,h=e.y+e.height;return r=Math.min(r,o),s=Math.min(s,c),a=Math.max(a,l),n=Math.max(n,h),i.x=r,i.y=s,i.width=a-r,i.height=n-s,i}}};class i{constructor(){this._margin={top:0,right:0,bottom:0,left:0},this._padding={top:0,right:0,bottom:0,left:0},this._desiredWidth=0,this._desiredHeight=0,this._actualRect={x:0,y:0,width:0,height:0},this.row=0,this.col=0,this.rowSpan=1,this.colSpan=1,this.x=0,this.y=0,this.opacity=1}calcContentOuter(){return{top:this._margin.top+this._padding.top,right:this._margin.right+this._padding.right,bottom:this._margin.bottom+this._padding.bottom,left:this._margin.left+this._padding.left}}margin(t,e,i,r){return void 0!==e&&void 0!==i&&void 0!==r?(this._margin.top=t,this._margin.right=e,this._margin.bottom=i,this._margin.left=r):void 0!==e?(this._margin.top=this._margin.bottom=t,this._margin.right=this._margin.left=e):this._margin.top=this._margin.bottom=this._margin.right=this._margin.left=t,this}getMargin(){return this._margin}padding(){return this._padding}setGrid(t,e,i=1,r=1){return this.row=e,this.col=t,this.rowSpan=r,this.colSpan=i,this}setOpacity(t){return this.opacity=t,this}addTo(t){return t.addChild(this),this}setDesiredSize(t,e){this._desiredWidth=t,this._desiredHeight=e}desiredWidth(){return this._desiredWidth}desiredHeight(){return this._desiredHeight}measure(t){}arrange(t){const e={x:t.x+this._margin.left,y:t.y+this._margin.top,width:t.width-this._margin.left-this._margin.right,height:t.height-this._margin.top-this._margin.bottom};return this.arrangeOverride(e)}arrangeOverride(t){return this.setActualRect(t),t}setActualRect(t){this._actualRect=Object.assign({},t),this._actualRect.x+=this.x,this._actualRect.y+=this.y}actualRect(){return this._actualRect}draw(t){}}e.VUIElement=i;e.VUITextElement=class extends i{constructor(t){super(),this._text=t}setText(t){return this._text=t,this}setColor(t){return this._color=t,this}measure(t){const e=t.textSizeEx(this._text),i=this.calcContentOuter();this.setDesiredSize(e.width+i.left+i.right,e.height+i.top+i.bottom)}draw(t){if(this.opacity>0){const e=this.actualRect();this._color?t.changeTextColor(this._color):t.resetTextColor(),t.contents.paintOpacity=255*this.opacity,t.drawText(this._text,e.x,e.y,e.width,"left")}}};e.VUIContainer=class extends i{constructor(){super(),this._children=[]}addChild(t){return this._children.push(t),t}children(){return this._children}draw(t){for(const e of this._children)e.draw(t)}}},2001:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VUIGridLayout=void 0;const r=i(4341);var s,a;!function(t){t[t.Auto=0]="Auto",t[t.Direct=1]="Direct",t[t.Ratio=2]="Ratio"}(s||(s={})),function(t){t[t.Box=0]="Box",t[t.VerticalFlow=1]="VerticalFlow",t[t.HorizontalFlow=2]="HorizontalFlow"}(a||(a={}));class n{constructor(t){this.type=s.Auto,this.size=0,this.minSize=0,this.maxSize=1e5,this.desiredSize=0,this.actualOffset=0,this.actualSize=0,this.type=t}getAvailableDesiredSize(){return this.type==s.Auto?this.desiredSize:this.type==s.Direct?r.VLayout.clamp(this.size,this.minSize,this.maxSize):this.desiredSize}GetRatioSize(){return 0==this.size?1:this.size}AdjustActualSize(){this.actualSize=r.VLayout.clamp(this.actualSize,this.minSize,this.maxSize)}}class o extends r.VUIContainer{constructor(){super(),this.m_rule=a.VerticalFlow,this.m_rowDefinitions=[],this.m_columnDefinitions=[]}GetDefaultRowLengthType(){return this.m_rule==a.VerticalFlow?s.Auto:s.Ratio}GetDefaultColumnLengthType(){return this.m_rule==a.HorizontalFlow?s.Auto:s.Ratio}PrepareDefinitions(t,e){for(;this.m_rowDefinitions.length<t;)this.m_rowDefinitions.push(new n(this.GetDefaultRowLengthType()));for(;this.m_columnDefinitions.length<e;)this.m_columnDefinitions.push(new n(this.GetDefaultColumnLengthType()))}measure(t){const e=this.children();let i=0,r=0;for(let s=0;s<e.length;s++){const a=e[s];a.measure(t),i=Math.max(i,a.row+1),r=Math.max(r,a.col+1)}this.PrepareDefinitions(i,r);for(let t=0;t<e.length;t++){const i=e[t],r=this.m_rowDefinitions[i.row],a=this.m_columnDefinitions[i.col];r.type!=s.Auto&&r.type!=s.Ratio||(r.desiredSize=Math.max(r.desiredSize,i.desiredHeight())),a.type!=s.Auto&&r.type!=s.Ratio||(a.desiredSize=Math.max(a.desiredSize,i.desiredWidth()))}let a=0,n=0;for(const t of this.m_rowDefinitions)n+=t.getAvailableDesiredSize();for(const t of this.m_columnDefinitions)a+=t.getAvailableDesiredSize();this.setDesiredSize(a,n)}arrangeOverride(t){const e=this.padding(),i=t.width-(e.left+e.right),a=t.height-(e.top+e.bottom),n={width:0,height:0};let o=0,c=0;for(const t of this.m_rowDefinitions)t.type==s.Auto||t.type==s.Direct?(t.actualSize=t.getAvailableDesiredSize(),n.height+=t.actualSize):o+=t.GetRatioSize();for(const t of this.m_columnDefinitions)t.type==s.Auto||t.type==s.Direct?(t.actualSize=t.getAvailableDesiredSize(),n.width+=t.actualSize):c+=t.GetRatioSize();const l={width:0!=c?(i-n.width)/c:0,height:0!=o?(a-n.height)/o:0};l.width=Math.max(0,l.width),l.height=Math.max(0,l.height);const h={x:0,y:0};for(const t of this.m_rowDefinitions)t.type==s.Ratio&&(t.actualSize=l.height*t.GetRatioSize()),t.AdjustActualSize(),t.actualOffset=h.y,h.y+=t.actualSize;for(const t of this.m_columnDefinitions)t.type==s.Ratio&&(t.actualSize=l.width*t.GetRatioSize()),t.AdjustActualSize(),t.actualOffset=h.x,h.x+=t.actualSize;let u={x:0,y:0,width:0,height:0};const d=this.m_rowDefinitions.length,p=this.m_columnDefinitions.length,f=this.children();for(let i=0;i<f.length;i++){const s=f[i],a=s.row,n=s.col;let o=s.rowSpan,c=s.colSpan;o=Math.max(1,o),c=Math.max(1,c),o=Math.min(o,a+d),c=Math.min(c,n+p);const l={x:e.left,y:e.top,width:0,height:0};l.y+=this.m_rowDefinitions[a].actualOffset;for(let t=0;t<o;t++)l.height+=this.m_rowDefinitions[a+t].actualSize;l.x+=this.m_columnDefinitions[n].actualOffset;for(let t=0;t<c;t++)l.width+=this.m_columnDefinitions[n+t].actualSize;const h=r.VLayout.makeOffset(l,t.x,t.y);s.arrange(h),u=r.VLayout.inflateIncludes(u,h)}return u}}e.VUIGridLayout=o},9590:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=Window_Base.prototype.update;Window_Base.prototype.update=function(){i.call(this)}},2896:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VChallengeResultWindow=void 0;const r=i(3654),s=i(7352);class a extends Window_Base{constructor(){super(new Rectangle(10,10,500,400)),this.openness=0,this._text="VChallengeResultWindow",this.refresh()}update(){super.update(),this.isOpen()?this.isTriggered()&&(s.MRLively.challengeResultShowing=!1,this.close()):s.MRLively.challengeResultShowing&&this.open()}refresh(){this.baseTextRect();this.contents.clear();const t=this.itemHeight(),e=200;this.drawActorNameAndLevel(0,0*t,e),this.drawScore(232,0*t,e),this.drawPlaytime(1e3,232,1*t,e),this.drawResultSummary(0,2*t+t/2,400),this.drawParam(TextManager.hp,"87",0,4*t,e),this.drawParam("満腹度","54%",232,4*t,e),this.drawParam(TextManager.attack,"8/8",0,5*t,e),this.drawParam(TextManager.exp,"3225",232,5*t,e),this._drawItem("カタナ+3",96,0,7*t),this._drawItem("皮の盾",129,0,8*t)}drawActorNameAndLevel(t,e,i){this.drawText("LRIKI",t,e,i,"left"),this.drawText(`${TextManager.levelA} 15`,t,e,i,"right")}drawScore(t,e,i){this.changeTextColor(ColorManager.systemColor()),this.drawText(r.DTextManager.score,t,e,i,"left"),this.resetTextColor(),this.drawText(99999,t,e,i,"right")}drawPlaytime(t,e,i,r){this.drawText(this.playtimeText(t),e,i,r,"right")}drawResultSummary(t,e,i){this.drawTextEx("\\c[2]緑燐の丘 \\c[0]を無事にクリアした！",t,e,i)}drawParam(t,e,i,r,s){this.changeTextColor(ColorManager.systemColor()),this.drawText(t,i,r,s,"left"),this.resetTextColor(),this.drawText(e,i,r,s,"right")}_drawItem(t,e,i,r){this.drawIcon(e,i,r),this.drawText(t,i+34,r,200,"left")}playtimeText(t){const e=Math.floor(t/60/60),i=Math.floor(t/60)%60,r=t%60;return e.padZero(2)+":"+i.padZero(2)+":"+r.padZero(2)}isTriggered(){return Input.isRepeated("ok")||Input.isRepeated("cancel")||TouchInput.isRepeated()}drawItem(){}}e.VChallengeResultWindow=a},6969:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VDetailsWindow=void 0;class i extends Window_Base{constructor(t){super(new Rectangle(0,64,Graphics.boxWidth,400)),this._dialog=t,this.refresh()}isOpenAndActive(){return this.isOpen()&&this.visible&&this.active}update(){this.isOpenAndActive()&&this.isTriggered()&&this.close(),super.update()}close(){this.onClose&&this.onClose()}refresh(){this.baseTextRect();this.contents.clear();const t=this.lineHeight();let e=0;this.drawTextEx(this._dialog.summary,0,e,300),e+=2*t,this.drawTextEx(this._dialog.description,0,e,300),e+=t}isTriggered(){return Input.isRepeated("ok")||Input.isRepeated("cancel")||TouchInput.isRepeated()}}e.VDetailsWindow=i},2590:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VEntityCaptionWindow=void 0;const r=i(4341),s=i(2443);class a extends Window_Base{constructor(t){super(a.getDefaultRect());const e=this.padding;this.origin.x,this.origin.y;this._entity=t,this.refresh()}static getDefaultRect(){const t=s.VWindowHelper.calcWindowSizeFromClinetSize(0,s.VWindowHelper.LineHeight);return new Rectangle(0,r.VLayout.calcGridY(3),r.VLayout.calcGridWidth(9),t[1])}setEntity(t){this._entity=t,this.refresh()}refresh(){const t=this.baseTextRect();this.contents.clear(),s.VWindowHelper.drawEntityItemName(this,this._entity,0,0,t.width,void 0)}}e.VEntityCaptionWindow=a},2420:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VFlexCommandWindow=void 0;const r=i(9185);class s extends Window_Command{constructor(t){super(t),this._commands=[],this.openness=0,this.refresh()}setupFromCommandList(t){this.clear();for(const e of t)if(e.isActivityCommand)this.addActionCommand(e.actionId,e.displayName,`act#${e.actionId}`,e.activityCommandHandler);else{if(!e.isSystemCommand)throw new Error("Unreachable.");this.addSystemCommand(e.displayName,e.systemCommandId,e.systemCommandIdHandler)}}addActionCommand(t,e,i,s){this._commands.push({actionId:t,displayText:null!=e?e:r.MRData.skills[t].name,commandId:i,actionHandler:s,systemHandler:void 0})}addSystemCommand(t,e,i){this._commands.push({actionId:0,displayText:t,commandId:e,actionHandler:void 0,systemHandler:i})}clear(){this._commands=[],this.refresh()}fitHeight(){this.height=this.fittingHeight(this._commands.length)}makeCommandList(){this._commands&&this._commands.forEach(((t,e)=>{0==t.actionId?(this.addCommand(t.displayText,t.commandId,!0,void 0),this.setHandler(t.commandId,(()=>{t.systemHandler&&t.systemHandler(t.commandId)}))):(this.addCommand(t.displayText,t.commandId,!0,void 0),this.setHandler(t.commandId,(()=>{t.actionHandler&&t.actionHandler(t.actionId)})))}))}processOk(){super.processOk()}}e.VFlexCommandWindow=s},9716:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VFloorNameWindow=void 0;const r=i(7352);class s extends Window_Base{constructor(t){super(t),this._showCount=0,this.openness=0,this.opacity=0,this.contentsOpacity=0,this._showCount=0}open(){this.refresh(),this.openness=255,this._showCount=150}close(){this._showCount=0,this.openness=0}isEffectRunning(){return this._showCount>0}showCount(){return this._showCount}update(){Window_Base.prototype.update.call(this),this._showCount>0&&$gameMap.isNameDisplayEnabled()?(this.updateFadeIn(),this._showCount--):this.updateFadeOut()}updateFadeIn(){this.contentsOpacity+=16}updateFadeOut(){this.contentsOpacity-=16,this.contentsOpacity<=0&&this.close()}refresh(){if(this.contents.clear(),$gameMap.displayName()){const t=r.MRLively.map.floorId(),e=t.floorInfo(),i=(e.displayName?e.displayName:$gameMap.displayName()).format(t.floorNumber()).split("\\n"),s=this.lineHeight()*i.length,a=(this.innerHeight-s)/2,n=10,o=this.innerWidth;this.drawBackground(0,a-n,o,s+2*n);for(let t=0;t<i.length;t++)this.drawText(i[t],0,a+t*this.lineHeight(),o,"center")}}drawBackground(t,e,i,r){const s=ColorManager.dimColor1(),a=ColorManager.dimColor2(),n=i/2;this.contents.gradientFillRect(t,e,n,r,a,s,!1),this.contents.gradientFillRect(t+n,e,n,r,s,a,!1)}}e.VFloorNameWindow=s},3907:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VItemListWindow=e.VItemListPriceTag=e.VItemListWindowItem=void 0;const r=i(1298),s=i(9185),a=i(9543),n=i(3482);class o{constructor(t){this.entity=t,this.selectedIndex=void 0}}var c;e.VItemListWindowItem=o,function(t){t[t.None=0]="None",t[t.SellingPrice=1]="SellingPrice",t[t.PurchasePrice=2]="PurchasePrice"}(c=e.VItemListPriceTag||(e.VItemListPriceTag={}));class l extends Window_Selectable{constructor(t){super(t),this._items=[],this._pagenationEnabled=!0,this._currentPageIndex=0,this.multipleSelectionEnabled=!1,this.priceTag=c.None,this.createPagenationArrowSprites()}get itemsParPage(){return Math.floor((this.contentsHeight()-2*this.padding)/this.itemHeight())}get maxPageCount(){return Math.max(Math.floor((this._items.length-1)/this.itemsParPage)+1,0)}getActualPriceTag(t){if(this.priceTag!=c.None)return this.priceTag;{const e=t.findEntityBehavior(a.LItemBehavior);return e&&e.shopStructureId()>0?c.SellingPrice:c.None}}setInventory(t){this._inventory=t,this.refreshItems()}refreshItems(){this._inventory&&(this._items=this._inventory.items.map((t=>new o(t))),this.refresh())}setEquipmentUser(t){this._equipmentUser=t}selectedItem(){const t=this.itemAt(this.index());return(0,r.assert)(t),t.entity}isMultipleSelecting(){return void 0!==this._items.find((t=>void 0!==t.selectedIndex))}getSelectedItems(){const t=[];for(const e of this._items)void 0!==e.selectedIndex&&t.push(e);if(0==t.length){const t=this.itemAt(this.index());return t?[t.entity]:[]}return t.sort(((t,e)=>((0,r.assert)(void 0!==t.selectedIndex),(0,r.assert)(void 0!==e.selectedIndex),t.selectedIndex-e.selectedIndex))).map((t=>t.entity))}maxCols(){return 1}maxItems(){if(this._pagenationEnabled){const t=this.itemsParPage*this._currentPageIndex;return Math.max(Math.min(this._items.length-t,this.itemsParPage),0)}return this._items.length}isCurrentItemEnabled(){return this._items.length>0}refresh(){super.refresh(),this.refreshPagenationArrows(),this.updatePagenationArrows()}drawAllItems(){if(this.maxItems()<=0){const t=this.itemLineRect(0);this.drawText((0,r.tr2)("なにも持っていない"),t.x,t.y,300,"left")}else super.drawAllItems()}drawItem(t){const e=this.itemAt(t);if(e){const i=0,r=this.itemLineRect(t);this.changePaintOpacity(!0),this.drawEntityItemName(e,r.x,r.y,r.width-i),this.changePaintOpacity(!0)}}update(){if(super.update(),Input.isTriggered("pageup")&&this.multipleSelectionEnabled){const t=this.itemAt(this.index());t&&this.toggleItemSelection(t)}}cursorRight(t){if(this._pagenationEnabled){const t=this.maxPageCount;if(t<=1)return;this._currentPageIndex++,this._currentPageIndex>=t&&(this._currentPageIndex=0),this.correctSelectedIndex(),this.refresh(),this.playCursorSound()}else super.cursorRight(t)}cursorLeft(t){if(this._pagenationEnabled){const t=this.maxPageCount;if(t<=1)return;this._currentPageIndex--,this._currentPageIndex<0&&(this._currentPageIndex=t-1),this.correctSelectedIndex(),this.refresh(),this.playCursorSound()}else super.cursorRight(t)}toggleItemSelection(t){if(void 0===t.selectedIndex){let e=-1;for(const t of this._items)void 0!==t.selectedIndex&&(e=Math.max(e,t.selectedIndex));t.selectedIndex=e+1}else{const e=t.selectedIndex;for(const t of this._items)void 0!==t.selectedIndex&&t.selectedIndex>e&&(t.selectedIndex-=1);t.selectedIndex=void 0}this.playCursorSound(),this.paint()}correctSelectedIndex(){const t=this.maxItems();this.index()>t-1&&this.select(t-1)}numberWidth(){return this.textWidth("000")}itemAt(t){return 0==this._items.length?void 0:this._pagenationEnabled?this._items[this._currentPageIndex*this.itemsParPage+t]:this._items[t]}drawEntityItemName(t,e,i,r){if(t){const a=t.entity,o=i+(this.lineHeight()-ImageManager.iconHeight)/2,l=e+ImageManager.iconWidth,h=n.UName.makeNameAsItem(a);if(void 0!==t.selectedIndex){const r=this.contents.fontSize;this.contents.fontSize=16,this.drawText(t.selectedIndex+1,e-4,i-6,100,"left"),this.contents.fontSize=r}{const t=2*ImageManager.iconWidth+4,e=Math.max(0,r-t);this.resetTextColor(),this.drawTextEx(h,l,i,e),this._equipmentUser&&(this._equipmentUser.isEquipped(a)||this._equipmentUser.isShortcutEquipped(a))&&this.drawIcon(12,l,o),a.isStateAffected(s.MRData.system.states.plating)&&this.drawIcon(13,l,o)}const u=this.getActualPriceTag(a);if(u!=c.None){const t=a.queryPrice(),s=(u==c.SellingPrice?t.sellingPrice:t.purchasePrice).toString(),n=this.textWidth(s),o=(this.textSizeEx(s).height,2),l=8,h=this.lineHeight()-2*o,d=n+2*l,p=e+r-d,f=i+o;this.changeTextColor(ColorManager.textColor(29)),this.drawRect(p,f,d,h);const m=i+0,y=p+8;this.drawTextEx(s,y,m,n)}}}createPagenationArrowSprites(){this._leftArrowSprite=new Sprite(void 0),this.addChild(this._leftArrowSprite),this._rightArrowSprite=new Sprite(void 0),this.addChild(this._rightArrowSprite)}refreshPagenationArrows(){const t=this.width,e=this.height,i=12;this._leftArrowSprite&&(this._leftArrowSprite.bitmap=this.windowskin,this._leftArrowSprite.anchor.x=.5,this._leftArrowSprite.anchor.y=.5,this._leftArrowSprite.setFrame(120,36,i,24),this._leftArrowSprite.move(i,e/2)),this._rightArrowSprite&&(this._rightArrowSprite.bitmap=this.windowskin,this._rightArrowSprite.anchor.x=.5,this._rightArrowSprite.anchor.y=.5,this._rightArrowSprite.setFrame(156,36,i,24),this._rightArrowSprite.move(t-i,e/2))}updatePagenationArrows(){this._leftArrowSprite&&this._rightArrowSprite&&(this._leftArrowSprite.visible=!1,this._rightArrowSprite.visible=!1,this._pagenationEnabled&&(this._currentPageIndex>0&&(this._leftArrowSprite.visible=!0),this._currentPageIndex<this.maxPageCount-1&&(this._rightArrowSprite.visible=!0)))}}e.VItemListWindow=l},7525:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VMainStatusWindow=void 0;const r=i(1298),s=i(3654),a=i(4836),n=i(9185),o=i(913),c=i(4797),l=i(9832),h=i(1768),u=i(4341),d=i(2001);class p extends Window_Base{constructor(t){super(t),this._curve2=new l.VEasingAnimationCurve(50,0,.2,h.easing.outQuad),this._curve1=new l.VEasingAnimationCurve(0,20,.5,h.easing.outExpo),this._opacityCurve=new l.VEasingAnimationCurve(0,1,.2,h.easing.linear),this._initialY=0,this._invalidateLayout=!0,this._invalidateDraw=!0,this._initialY=t.y,this._layout=(new d.VUIGridLayout).margin(10),this._weaponText=new u.VUITextElement(s.DTextManager.weaponStrength()).setGrid(0,0).setColor(this.systemColor()).addTo(this._layout),this._weaponValue=new u.VUITextElement("-").setGrid(1,0).margin(0,0,0,10).addTo(this._layout),this._shieldText=new u.VUITextElement(s.DTextManager.shieldStrength()).setGrid(2,0).setColor(this.systemColor()).addTo(this._layout),this._shieldValue=new u.VUITextElement("-").setGrid(3,0).margin(0,0,0,10).addTo(this._layout),this._fpText=new u.VUITextElement(s.DTextManager.param(a.MRBasics.params.fp)).setGrid(0,1).setColor(this.systemColor()).addTo(this._layout),this._fpValue=new u.VUITextElement("1/1").setGrid(1,1).margin(0,0,0,10).addTo(this._layout),this._powText=new u.VUITextElement(s.DTextManager.param(a.MRBasics.params.pow)).setGrid(2,1).setColor(this.systemColor()).addTo(this._layout),this._powValue=new u.VUITextElement("1/1").setGrid(3,1).margin(0,0,0,10).addTo(this._layout);const e=TextManager.expTotal.format(TextManager.exp);this._expText=new u.VUITextElement(e).setGrid(0,2).setColor(this.systemColor()).addTo(this._layout),this._expValue=new u.VUITextElement("100").setGrid(1,2).margin(0,0,0,10).addTo(this._layout);const i=TextManager.expNext.format(TextManager.level);this._nextexpText=new u.VUITextElement(i).setGrid(2,2).setColor(this.systemColor()).addTo(this._layout),this._nextexpValue=new u.VUITextElement("100").setGrid(3,2).margin(0,0,0,10).addTo(this._layout),this._layout.children().forEach((t=>t.opacity=0)),l.VAnimation.startAt(this,"window.o",0,255,.3,h.easing.outQuad,(t=>{this.opacity=t}),0),l.VAnimation.startAt(this,"window.y",this.y+50,this.y,.3,h.easing.outQuad,(t=>{this.y=t}),0).then((()=>{l.VAnimation.start(this,"opacity",this._opacityCurve,(t=>{this._layout.children().forEach((e=>e.opacity=t))}),0);l.VAnimation.start(this,"weapon.x",this._curve1,(t=>{this._weaponText.x=this._weaponValue.x=t,this.invalidate()}),0),l.VAnimation.start(this,"shield.x",this._curve1,(t=>{this._shieldText.x=this._shieldValue.x=t,this.invalidate()}),-.01),l.VAnimation.start(this,"fp.x",this._curve1,(t=>{this._fpText.x=this._fpValue.x=t,this.invalidate()}),-.02),l.VAnimation.start(this,"pow.x",this._curve1,(t=>{this._powText.x=this._powValue.x=t,this.invalidate()}),-.03),l.VAnimation.start(this,"exp.x",this._curve1,(t=>{this._expText.x=this._expValue.x=t,this.invalidate()}),-.04),l.VAnimation.start(this,"nextexp.x",this._curve1,(t=>{this._nextexpText.x=this._nextexpValue.x=t,this.invalidate()}),-.05)})),this.invalidate()}setEntity(t){this._entity=t,this.refresh()}invalidate(){this._invalidateLayout=!0,this._invalidateDraw=!0}destroy(){l.VAnimation.startAt(this,"window.o",this.opacity,0,.3,h.easing.outQuad,(t=>{this.opacity=t,this._clientArea.opacity=t})),l.VAnimation.startAt(this,"window.y",this.y,this.y+50,.3,h.easing.outQuad,(t=>{this.y=t}),0).then((()=>{super.destroy()}))}update(){super.update(),this._invalidateLayout&&(this.layout(),this._invalidateLayout=!1),this._invalidateDraw&&(this.draw(),this._invalidateDraw=!1)}close(){super.close(),this.onClose&&this.onClose()}layout(){this._layout.measure(this),this._layout.arrange({x:0,y:0,width:this.contents.width,height:this.contents.height})}refresh(){if(!this._entity)return;this.contents.clear();const t=this._entity.findEntityBehavior(o.LEquipmentUserBehavior);if(t){let e=0,i=0;for(const s of t.equippedItemEntities()){const t=s.data;(0,r.assert)(t.equipment),e+=o.LEquipmentUserBehavior.calcEquipmentParam(s,a.MRBasics.params.atk),i+=o.LEquipmentUserBehavior.calcEquipmentParam(s,a.MRBasics.params.def)}this._weaponValue.setText(e.toString()),this._shieldValue.setText(i.toString())}else this._weaponValue.setText("-"),this._shieldValue.setText("-");const e=n.MRData.parameters[a.MRBasics.params.fp],i=Math.ceil(e.makeDisplayValue(this._entity.getActualParam(a.MRBasics.params.fp))),s=Math.ceil(e.makeDisplayValue(this._entity.getParamActualMax(a.MRBasics.params.fp)));this._fpValue.setText(`${i}/${s}`);const l=this._entity.getActualParam(a.MRBasics.params.pow),h=this._entity.getParamActualMax(a.MRBasics.params.pow);this._powValue.setText(`${l}/${h}`);const u=this._entity.findEntityBehavior(c.LExperienceBehavior);u?(this._expValue.setText(u.currentExp(this._entity).toString()),this._nextexpValue.setText(u.nextLevelExp(this._entity).toString())):(this._expValue.setText("-"),this._nextexpValue.setText("-"))}draw(){this.contents.clear(),this._layout.draw(this)}}e.VMainStatusWindow=p},337:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VMenuCommandWindow=void 0;const r=i(1298),s=i(3654),a=i(7352),n=i(3609);class o extends Window_Command{constructor(t){super(t)}makeCommandList(){this.addCommand(TextManager.item,"item",!0,void 0),a.MRLively.map.floorId().isSafetyMap()?this.addCommand(s.DTextManager.save,"save",!0,void 0):(this.addCommand((0,r.tr2)("足元"),"feet",!0,void 0),n.paramSuspendMenuEnabled&&this.addCommand((0,r.tr2)("中断"),"suspend",!0,void 0)),this.height=this.fittingHeight(this.maxItems())}}e.VMenuCommandWindow=o},7908:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VMessageLogWindow=void 0;const r=i(1298),s=i(2404),a=i(7352);class n extends Window_Base{constructor(t,e){super(e),this._waitCount=0,this._autoScroll=!0,this._autoScrollCount=0,this._autoScrollCountMax=10,this._maxLines=2,this._autoCloseCount=0,this._autoCloseCountMax=200,this._lineSpriteCache=[],this._textLines=[],this._autoCloseEnabled=!0,this._message=t,this.openness=0,this.initMembers()}initMembers(){this._waitCount=0,this._autoCloseCount=0,this._autoScrollCount=0}set autoCloseEnabled(t){this._autoCloseEnabled=t,this._autoCloseEnabled||(this.open(),this.openness=255)}maxLines(){return this._maxLines}update(){if(a.MRLively.map.floorId().isTacticsMap())for(this.checkToNotClose(),Window_Base.prototype.update.call(this);!this.isOpening()&&!this.isClosing();){if(this.updateWait())return;if(this.updateLoading())return;if(this.updateInput())return;if(this.updateAutoScroll())return;if(!this.canScrollStart())return void this.updateAutoClose();this.startNewMessageAndScroll()}}checkToNotClose(){this._autoScroll&&this.isOpen()&&this.isClosing()&&this.doesContinue()&&this.open()}doesContinue(){return this._message.hasText()&&this._message._lastViewLineIndex<this._message.texts().length-1}updateWait(){return this._waitCount>0&&(this._waitCount--,!0)}updateLoading(){return!1}updateInput(){return!1}updateAutoScroll(){if(this._autoScrollCount>0){this._autoScrollCount--;const t=this._autoScrollCountMax-this._autoScrollCount,e=-(0,s.linear)(t,0,this.lineHeight(),this._autoScrollCountMax);if(this._textLines.forEach((t=>{t.sprite.y=t.scrollStartY+e})),0==this._autoScrollCount){const t=this._textLines.shift();return(0,r.assert)(t),this.releaseLineSprite(t.sprite),this._textLines[this._textLines.length-1].sprite.visible=!0,this._textLines.forEach((t=>{t.scrollStartY=t.sprite.y})),this._autoCloseCount=this._autoCloseCountMax,!1}return!0}return!1}startNewMessageAndScroll(){var t;const e=this._message.texts()[this._message._lastViewLineIndex+1],i=this.createTextState(e,0,0,0);i.x=this.newLineX(i),i.startX=i.x,i.y=0,i.height=this.lineHeight();const r=this.acquireLineSprite();null===(t=r.bitmap)||void 0===t||t.clear(),r.x=0,r.height=i.height,r.visible=!0;const s=this._textLines.length>0?this._textLines[this._textLines.length-1].sprite:void 0;for(r.y=s?s.y+s.height:0,i.sprite=r,i.scrollStartY=r.y,this._textLines.push(i),this._message._lastViewLineIndex++,this._textLines.length>this.maxLines()?(this._autoScrollCount=this._autoScrollCountMax,r.visible=!1):(this.startWait(10),this._autoCloseCount=this._autoCloseCountMax);!this.isEndOfText(i);)this.processCharacter(i);this.flushTextState(i),this.isEndOfText(i)&&!this.pause&&this.onEndOfText(),this.open()}newLineX(t){return t.rtl?this.innerWidth-4:4}canScrollStart(){return this.doesContinue()&&this._autoScroll}terminateMessage(){this.close(),this._textLines.forEach((t=>{this.releaseLineSprite(t.sprite)})),this._textLines=[]}onEndOfText(){}processControlCharacter(t,e){if(Window_Base.prototype.processControlCharacter.call(this,t,e),"\f"===e)throw new Error("NewPage not supported.")}isEndOfText(t){return t.index>=t.text.length}processEscapeCharacter(t,e){switch(t){case"C":const i=e.sprite.bitmap;i&&(i.textColor=ColorManager.textColor(this.obtainEscapeParam(e)));break;case"$":throw new Error("GoldWindow not supported.");case".":this.startWait(15);break;case"|":this.startWait(60);break;case"!":throw new Error("StartPause not supported.");case">":case"<":throw new Error("LineShowFast not supported.");case"^":throw new Error("PauseSkip not supported.");default:Window_Base.prototype.processEscapeCharacter.call(this,t,e)}}flushTextState(t){const e=t.buffer,i=t.rtl,r=this.textWidth(e),s=t.height,a=i?t.x-r:t.x,n=t.y,o=t.sprite.bitmap;t.drawing&&o&&o.drawText(e,a,n,r,s,"left"),t.x+=i?-r:r,t.buffer=this.createTextBuffer(i);const c=Math.abs(t.x-t.startX);t.outputWidth<c&&(t.outputWidth=c),t.outputHeight=n-t.startY+s}processDrawIcon(t,e){var i;if(e.drawing){const r=e.x+2,s=e.y+2,a=ImageManager.loadSystem("IconSet"),n=ImageManager.iconWidth,o=ImageManager.iconHeight,c=t%16*n,l=Math.floor(t/16)*o;null===(i=e.sprite.bitmap)||void 0===i||i.blt(a,c,l,n,o,r,s,n,o)}e.x+=ImageManager.iconWidth+4}startWait(t){this._waitCount=t}updateAutoClose(){this._autoCloseEnabled&&this._autoCloseCount>0&&(this._autoCloseCount--,this._autoCloseCount<=0&&this.terminateMessage())}acquireLineSprite(){var t;if(this._lineSpriteCache.length>0){const e=this._lineSpriteCache.pop();return(0,r.assert)(e),null===(t=e.bitmap)||void 0===t||t.clear(),e}{const t=new Bitmap(this.width,this.lineHeight());t.fontSize=$gameSystem.mainFontSize();const e=new Sprite(t);return this._clientArea.addChild(e),e}}releaseLineSprite(t){t.visible=!1,this._lineSpriteCache.push(t)}}e.VMessageLogWindow=n},5318:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VNicknameEditWindow=void 0;class i extends Window_NameEdit{constructor(t){super(t)}setupFromEntity(t){this._maxLength=10,this._name="",this._index=0,this._defaultName=""}refresh(){this.contents.clear();for(let t=0;t<this._maxLength;t++)this.drawUnderline(t);for(let t=0;t<this._name.length;t++)this.drawChar(t);const t=this.itemRect(this._index);this.setCursorRect(t.x,t.y,t.width,t.height)}}e.VNicknameEditWindow=i},2443:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VWindowHelper=void 0;const r=i(9543),s=i(3482);class a{static calcWindowHeight(t,e){return e?Window_Selectable.prototype.fittingHeight(t):Window_Base.prototype.fittingHeight(t)}static calcWindowSizeFromClinetSize(t,e){return[t+2*this.DefaultPadding,e+2*this.DefaultPadding]}static calcOuterPadding(t){const e=t.padding;return[e-t.origin.x,e-t.origin.y]}static drawEntityItemName(t,e,i,a,n,o){if(e){const c=a+(t.lineHeight()-ImageManager.iconHeight)/2,l=i+ImageManager.iconWidth,h=s.UName.makeNameAsItem(e);{const i=2*ImageManager.iconWidth+4,r=Math.max(0,n-i);t.resetTextColor(),t.drawTextEx(h,l,a,r),o&&o.isEquipped(e)&&t.drawIcon(12,l,c)}const u=e.findEntityBehavior(r.LItemBehavior);if(u&&u.shopStructureId()>0){const i=e.queryPrice().sellingPrice.toString(),r=t.textWidth(i)+8,s=t.textSizeEx(i).height-4,o=a+(t.lineHeight()-s)/2,c=n-r+4;t.changeTextColor(ColorManager.textColor(29)),t.drawRect(c,o,r,s),t.drawTextEx(i,n-r,o,r)}}}}e.VWindowHelper=a,a.DefaultPadding=12,a.LineHeight=36},7147:t=>{"use strict";t.exports=require("fs")},1017:t=>{"use strict";t.exports=require("path")}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var i=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t].call(i.exports,i,i.exports,__webpack_require__),i.exports}__webpack_require__.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return __webpack_require__.d(e,{a:e}),e},__webpack_require__.d=(t,e)=>{for(var i in e)__webpack_require__.o(e,i)&&!__webpack_require__.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var __webpack_exports__=__webpack_require__(4180)})();